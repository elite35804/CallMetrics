/*
 strftime for Javascript
 Copyright (c) 2008, Philip S Tellis <philip@bluesmoon.info>
 All rights reserved.

 This code is distributed under the terms of the BSD licence

 Redistribution and use of this software in source and binary forms, with or without modification,
 are permitted provided that the following conditions are met:

   * Redistributions of source code must retain the above copyright notice, this list of conditions
     and the following disclaimer.
   * Redistributions in binary form must reproduce the above copyright notice, this list of
     conditions and the following disclaimer in the documentation and/or other materials provided
     with the distribution.
   * The names of the contributors to this file may not be used to endorse or promote products
     derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
//! Date extension object - all supporting objects go in here.
function PhoneCountryInitNames(){if(!PhoneCountryNames){var e={"sip:":"SIP/VoiP Phone","AC":"Ascension Island","QK":"Kosovo","XK":"Kosovo"},t=$("").countryPicker().countries;for(var n in t)if(t.hasOwnProperty(n))for(var a=0;a<t[n].length;a++)e[t[n][a][1]]=t[n][a][0];PhoneCountryNames=e}}function PhoneCountryFormatVal(e){if(e&&e.text){if(e.text.match(/sip/i)&&(e.text="sip:"),""==e.id){var t=e.text.match(/.*\((.*)\)/);if(t)var n=t[1];else n=e.text}else n=e.text;PhoneCountryInitNames();var a=n.replace(/[\s\d\+]*/g,"");return"<i data-prefix='"+n.replace(/[\s\D\+]*/g,"")+"' data-code='"+a+"' class='country "+a.replace(":","")+"'><i class='i'></i> "+e.text+"<small>"+(PhoneCountryNames[a]||"")+"</small></i>"}return""}function PhoneCountryFormatValNoFlag(e){if(e&&e.text){var t=e.text.split(" "),n=t.shift(),a=t.join();return"<i class='country-no-flag "+e.text.replace(/\s/g,"")+"'><cite>"+n+"</cite> <b>"+a+"</b></i>"}return""}function PhoneCountryMatcher(e,t){PhoneCountryInitNames();var n=t.replace(/[\s\d\+]*/g,"");return!!(n&&(PhoneCountryNames[n]||"").toUpperCase().indexOf(e.toUpperCase())>=0)||t.toUpperCase().indexOf(e.toUpperCase())>=0}function ClearDateRange(){$("#date_container").show(),$("#schedule_container").hide(),$("#range").val(""),$("#today").removeClass("callout"),$("#yesterday").removeClass("callout"),$("#last7").removeClass("callout"),$("#last7").removeClass("highlight"),$("#last30").removeClass("callout"),$("#lastmonth").removeClass("callout"),$("#thismonth").removeClass("callout"),$("#alltime").removeClass("callout"),$("#schedule").removeClass("callout"),builtin_date_ranges.indexOf($("#date_operator").val())>-1&&$("#date_operator").select2("val","range")}function SetDates(e,t){var n=wasOpened;wasOpened=!1,$("#start_date").datepicker("setDate",formatDate(e)),$("#end_date").datepicker("setDate",formatDate(t)),wasOpened=n}function ResetFilters(e,t){var n=$("#report-date-selection");filtered=!1,clearFilters(!e),e&&(SetDates(moment().subtract(30,"days"),moment()),ClearDateRange()),$("#filter_accounts").select2("val",""),$("#multi_tags").select2("val",""),$("#multi_agents").select2("val",""),$("#transfer_from").select2("val",""),$("#transfer_to").select2("val",""),$("#multi_sources").select2("val",""),$("#multi_tracking_numbers").select2("val",""),$("#multi_receiving_numbers").select2("val",""),$("#route_ids").select2("val",""),window.text_log?$("#direction").select2("val",["msg_inbound","msg_outbound"]):window.chat_log?$("#direction").select2("val",["chat"]):window.form_log?$("#direction").select2("val",["form"]):CTM.enable_chat?$("#direction").select2("val",["inbound","outbound","form","chat"]):$("#direction").select2("val",["inbound","outbound","form"]),$("#schedule_select").select2("val",""),$("#ring_time_min, #ring_time_max").val("").trigger("change"),$("#talk_time_min, #talk_time_max").val("").trigger("change"),$("#duration_min, #duration_max").val("").trigger("change"),$("#converted_amount_min, #converted_amount_max").val("").trigger("change"),n.find("[data-type=picker]").select2("val",""),n.find("[data-type=duration]").val("").trigger("change"),n.find("[data-type=text], [data-type=email], [data-type=phone], [data-type=url], [data-type=date], [data-type=number], [data-type=float], [data-type=region], [data-type=country]").val(""),n.find("[data-type=bool]").val(""),n.find("[data-type=rating][name^='custom_min']").val(""),n.find("[data-type=rating][name^='custom_max']").val("5"),$("#call_score_min").val(0),$("#call_score_max").val(5),$("#filter_visitor_data").val(0),$("#has_audio").val(0),$("#call_status").select2("val",""),$("#call_score_tag").select2("val",""),$("#keypress").select2("val",""),$("#reported_calls").prop("checked",!0),$("#excluded_calls").prop("checked",!1),$("#converted_calls").val("0"),$("#form_entry_calls").prop("checked",!0),t&&$("#report_filter_name").select2("val",""),n.find(".toggle-picker").each(function(e,t){var n=$(t).attr("data-name"),a="1"==$(t).attr("data-custom");$(t).find(".toggle-picker-popup").val(ctmFilterExcluded[a?"custom_operator["+n+"]":n+"_operator"]).trigger("change")}),n.find(".toggle-range").each(function(e,t){var n=$(t).attr("data-name"),a="1"==$(t).attr("data-custom");$(t).find(".toggle-range-popup").val(ctmFilterExcluded[a?"custom_operator["+n+"]":n+"_operator"]).trigger("change")}),window.CTMsearch&&(UpdateDate("alltime"),$("#form_entry_calls").prop("checked",!0))}function CTMInitFilters(e){function t(){$("body").addClass("filter-box-open"),$("#report-date-selection").removeClass("hiding"),$("#report-date-selection").addClass("showing"),$("#report-filter-shadow").removeClass("hiding"),$("#report-filter-shadow").addClass("showing"),updateScrollable()}function n(){$("body").removeClass("filter-box-open"),$("#report-date-selection").removeClass("showing"),$("#report-date-selection").addClass("hiding"),$("#report-filter-shadow").removeClass("showing"),$("#report-filter-shadow").addClass("hiding"),updateScrollable()}function a(){$("#report-date-selection").hasClass("showing")?n():t(),$("body").hasClass("left-nav")&&($("#left-manu").hasClass("closed")||($("#left-menu").addClass("closed"),$("#left-menu").css("margin-left","0px"),$("#content").removeClass("open")),$("body").hasClass("left-nav-hidden")||($("body").addClass("left-nav-hidden"),$("#left-menu").css("margin-left","-60px")))}function i(){var e=$("#report-filter-update-method");return e.length||(e=$("#report_filter_name")),e.closest("form")}function r(){bootbox.dialog({"message":"<h3>"+CTM.localize("ReportFilter","actions.save_filter.label")+" <small>"+CTM.localize("ReportFilter","actions.save_filter.hint")+'</small></h3><div style="margin-bottom:20px"><label>'+CTM.localize("ReportFilter","properties.name.label")+'</label><input type="text" id="save_report_filter_name" name="name" class="text" style="width:100%"/></div><div style="margin-bottom:10px"><label>'+CTM.localize("ReportFilter","properties.description.label")+" "+CTM.localize("ReportFilter","properties.description.label_extra")+'</label><input type="text" id="save_report_filter_description" name="description" class="text" style="width:100%"/></div>',"onEscape":function(){},"buttons":{"cancel":{"label":CTM.localize("ReportFilter","actions.cancel.label"),"className":"btn-default","callback":function(){}},"success":{"label":CTM.localize("ReportFilter","actions.save_filter.label"),"className":"btn-primary disabled","callback":function(){if(!$(this).hasClass("disabled")){var e=$.trim($(".bootbox-body input[name=name]").val());if(0==e.length)return!1;$("#report_filter_name").val(e);var t=$.trim($(".bootbox-body input[name=description]").val());$("#report_filter_description").val(t),$("#report-filter-update-method").val("post"),$("#is_new_caller_check").prop("checked")&&$("#is_new_caller_check").val("1"),$.post("/api/v1/accounts/"+CTM.account+"/report_filters/",i().serialize(),function(){bootbox.alert("<h3>Filter Saved</h3><p>Your filter has been saved.</p>")}).fail(function(e){bootbox.alert("<h3>Error Saving</h3><p>"+JSON.parse(e.responseText).errors.join(" ")+"</p>")})}}}}}),$("#save_report_filter_name").on("input",function(){$(".bootbox").find(".button.callout").toggleClass("disabled",$(this).val().length<=0)})}function s(e){"use strict";$("#report-filter-control-mask").addClass("show-mask"),$.get("/api/v1/accounts/"+CTM.account+"/report_filters/"+e,function(e){function t(t){!e[t]||e[t+"_min"]||e[t+"_max"]||e[t+"_operator"]||(e[t+"_up"]?(e[t+"_max"]=e[t],e[t+"_operator"]="less_than"):(e[t+"_min"]=e[t],e[t+"_operator"]="greater_than"))}var n,a;ResetFilters(),t("ring_time"),t("talk_time"),t("duration"),Object.keys(e).forEach(function(t){if(t.match(/_operator$/))e[t]&&i().find("#"+t).val(e[t]).trigger("change");else{"converted"==t&&"boolean"==typeof e[t]&&(e[t]=e[t]?1:0);var n=i().find('*[name="'+t+'"]');0==n.length&&(n=i().find('*[name="'+t+'[]"]'));var a="checkbox"==n.attr("type");("undefined"!=typeof e[t]||a)&&("is_new_caller"==t&&$("#is_new_caller_check").prop("checked",e[t]),a?n.prop("checked",e[t]).trigger("change"):n.val(e[t]),n.trigger("change"))}}),"undefined"!=typeof e.call_score_min&&(n=e.call_score_min),"undefined"!=typeof e.call_score_max&&(a=e.call_score_max),parseInt(n)==parseInt(a)?$("#call_score_operator").val("equal").trigger("change"):parseInt(n)>0?parseInt(a)<5?$("#call_score_operator").val("range").trigger("change"):$("#call_score_operator").val("greater_than_equal").trigger("change"):parseInt(a)<5?$("#call_score_operator").val("less_than_equal").trigger("change"):($("#call_score_min").val("0"),$("#call_score_max").val("5"),$("#call_score_operator").val(ctmFilterExcluded.call_score_operator).trigger("change")),e.range?UpdateDate(e.range):ClearDateRange(),CTMfilter()},"json").always(function(){$("#report-filter-control-mask").removeClass("show-mask")})}function o(e){return'<i class="'+p[e.id]+" "+e.id+'" style="font-size:90%;line-height:inherit"></i> '+escapeHtml(e.text)}var l=$("#report-date-selection");CTMGlobalFilter="true"==$("#report-date-selection").attr("data-global"),durationLabel=$("#duration-label"),talkTimeLabel=$("#talk_time-label"),ringTimeLabel=$("#ring_time-label");var c=$("#start_date").val(),d=$("#end_date").val();(c&&""!=c||d&&""!=d)&&$("#report-filter-box .dates").html(c.replace(/ 00:00:00/,"")+" - "+d.replace(/ 00:00:00/,"")),window.hideSidebarFilter=n,l.find(".toggle-picker").each(function(e,t){var n=$(t).attr("data-name"),a="1"==$(t).attr("data-custom");"yes"==$(t).attr("data-allow-equal")?$(t).append('<select class="toggle-picker-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["equal","not_equal","includes","excludes","blank","present"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.picker."+e)+"</option>"}).join("")+"</select>"):$(t).append('<select class="toggle-picker-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["includes","excludes","blank","present"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.picker."+e)+"</option>"}).join("")+"</select>"),$(t).find(".toggle-picker-popup").select2({"dropdownCssClass":"toggle-sidebar-dropdown"}),$(t).attr("data-operator")&&($(t).find(".toggle-picker-popup").val($(t).attr("data-operator")),$(t).removeAttr("data-operator"))}),l.find(".toggle-picker-popup").change(function(){var e=$(this),t=e.closest(".toggle-picker").attr("data-name"),n="1"==e.closest(".toggle-picker").attr("data-custom"),a=e.val(),i=$("#"+(n?"custom_":"")+t);"phone"==i.attr("data-type")?"equal"==a||"not_equal"==a?i.phoneCountryComboBox({"version":3}):i.phoneCountryComboBox("close"):"region"==i.attr("data-type")?"equal"==a||"not_equal"==a?i.stateRegionPicker():i.stateRegionPicker("close"):"country"==i.attr("data-type")&&("equal"==a||"not_equal"==a?i.countryPicker():i.countryPicker("close")),"present"==a||"blank"==a?i.attr("data-type")&&"SELECT"!=i.get(0).tagName?i.val("").attr("disabled",!0):i.select2("disable").select2("val",""):i.attr("data-type")&&"SELECT"!=i.get(0).tagName?i.removeAttr("disabled"):i.select2("enable")}).trigger("change"),$("#ring_time_min, #ring_time_max").timeUnitPicker(),$("#talk_time_min, #talk_time_max").timeUnitPicker(),$("#duration_min, #duration_max").timeUnitPicker(),l.find("[data-type=phone]").phoneCountryComboBox({"version":3}),l.find("[data-type=duration]").timeUnitPicker(),l.find("[data-type=date]").datepicker({"todayHighlight":!0,"showTime":!0,"format":"yyyy-mm-dd H:i","defaultTime":[0,0,0],"autoclose":!0,"container":"#report-date-selection .filter-content"}),l.find(".toggle-range").each(function(e,t){var n=$(t).attr("data-name"),a="1"==$(t).attr("data-custom");"no"==$(t).attr("data-allow-not-equal")?$(t).append('<select class="toggle-range-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["equal","greater_than_equal","less_than_equal","range"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.range."+e)+"</option>"}).join("")+"</select>"):"no"==$(t).attr("data-allow-set")?$(t).append('<select class="toggle-range-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["equal","not_equal","greater_than","less_than","greater_than_equal","less_than_equal","range"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.range."+e)+"</option>"}).join("")+"</select>"):"builtin"==$(t).attr("data-date")?$(t).append('<select class="toggle-range-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["greater_than_equal","less_than_equal","range",!1,"today","yesterday","last7","last30","lastmonth","thismonth","schedule"],function(e){return!1===e?"<option disabled></option>":'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.date."+e)+"</option>"}).join("")+"</select>"):"yes"==$(t).attr("data-date")?$(t).append('<select class="toggle-range-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["equal","not_equal","greater_than","less_than","greater_than_equal","less_than_equal","range","present","blank"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.date."+e)+"</option>"}).join("")+"</select>"):$(t).append('<select class="toggle-range-popup" id="'+(a?"custom_":"")+n+'_operator" name="'+(a?"custom_operator["+n+"]":n+"_operator")+'">'+$.map(["equal","not_equal","greater_than","less_than","greater_than_equal","less_than_equal","range","present","blank"],function(e){return'<option value="'+e+'">'+CTM.localize("ReportFilter","extra.range."+e)+"</option>"}).join("")+"</select>"),$(t).find(".toggle-range-popup").select2({"dropdownCssClass":"toggle-sidebar-dropdown"}),$(t).attr("data-operator")&&($(t).find(".toggle-range-popup").val($(t).attr("data-operator")),$(t).removeAttr("data-operator"))}),l.find(".toggle-range-popup").change(function(){var e=$(this),t=e.closest(".toggle-range").attr("data-name"),n="1"==e.closest(".toggle-range").attr("data-custom"),a=e.val(),i="#"+(n?"custom_":"")+t+"_min_container",r="#"+(n?"custom_":"")+t+"_max_container";"blank"==a||"present"==a?($(i+" input, "+i+" select").val(""),$(i+" input, "+i+" select").attr("disabled",!0)):$(i+" input, "+i+" select").removeAttr("disabled"),"less_than"==a||"less_than_equal"==a?($(i).hide(),$(r).show(),$(r).prev().hide(),$(r).addClass("full_width")):"greater_than"==a||"greater_than_equal"==a||"equal"==a||"not_equal"==a||"present"==a||"blank"==a?($(i).show(),$(r).hide(),$(r).prev().hide(),$(i).addClass("full_width")):($(i).show(),$(r).show(),$(i).removeClass("full_width"),$(r).removeClass("full_width"),$(r).prev().show())}).trigger("change"),$("#direction_operator option[value=blank], #direction_operator option[value=present]").remove(),$("#call_status_operator option[value=blank], #call_status_operator option[value=present]").remove(),$("#filter_accounts_operator option[value=blank], #filter_accounts_operator option[value=present]").remove(),$("#call_score_operator").change(function(){"equal"==$(this).val()&&$("#call_score_max").val($("#call_score_min").val())}),$("#report-filter-shadow").click(function(e){e.preventDefault(),n()}),$("#report-filter-box").click(function(e){e.preventDefault(),a()}),$("#report-filter-cancel").click(function(e){e.preventDefault(),n()}),l.find("form").submit(function(e){e.preventDefault(),n();var t=$("#start_date").val(),a=$("#end_date").val();$("#report-filter-box .dates").html(t+" - "+a),CTMfilter()}),$("#report-filter-reset").click(function(e){e.preventDefault(),ResetFilters(!0,!0)}),$("#save_current_filters").click(function(e){e.preventDefault();var t=$("#report_filter_name").select2("data");t?bootbox.dialog({"message":"<h3>"+CTM.localize("ReportFilter","actions.update.label")+"</h3><p>"+CTM.localize("ReportFilter","actions.update.hint",{"filter_name":t.text})+"</p>","onEscape":function(){},"buttons":{"cancel":{"label":CTM.localize("ReportFilter","actions.cancel.label"),"className":"btn-default pull-left","callback":function(){}},"create_new":{"label":CTM.localize("ReportFilter","actions.create.label"),"className":"btn-info button-background button-border","callback":function(){r()}},"success":{"label":CTM.localize("ReportFilter","actions.update.label"),"className":"btn-primary","callback":function(){$("#report-filter-update-method").val("put"),$("#is_new_caller_check").prop("checked")&&$("#is_new_caller_check").val("1"),$.post("/api/v1/accounts/"+CTM.account+"/report_filters/"+t.id,i().serialize(),function(){bootbox.alert("<h3>Filter Saved</h3><p>Your filter has been saved.</p>")}).fail(function(e){bootbox.alert("<h3>Error Saving</h3><p>"+JSON.parse(e.responseText).errors.join(" ")+"</p>")})}}}}):r()}),$("#report_filter_name").select2({"placeholder":CTM.localize("ReportFilter","extra.search.filter"),"minimumInputLength":0,"multiple":!1,"ajax":{"url":"/api/v1/lookup.json","dataType":"json","data":function(e,t){return{"search":e,"object_type":"report_filter","page":t,"nocount":1,"descriptions":1}},"results":function(e){return{"results":e.results.map(function(e){return{"text":e.text,"id":e.id,"description":e.description}}),"more":e.results.length>=e.per_page}}},"formatResult":formatStandardResult,"formatSelection":formatStandardResult,"initSelection":function(e,t){var n=$("#saved_filter_id").val();""!=n&&$.get("/api/v1/lookupid.json",{"object_type":"report_filter","object_id":n},t)}}).on("change",function(e){e.added?s(e.val):console.log(e)}),window.UpdateFilterQuery=s,setupMultiPicker("#schedule_select","schedule",CTM.localize("ReportFilter","extra.search.schedule"),!0,{"noEdit":!0,"formatters":{"formatResult":function(e){return escapeHtml(e.text)+'<span class="result-desc">'+$.map(e.times,function(e){var t,n,a=moment().startOf("day").add(e.start_time,"minutes").format("h:mma"),i=moment().startOf("day").add(e.end_time,"minutes").format("h:mma");return e.days?(t=[],e.days.sun&&t.push("S"),e.days.mon&&t.push("M"),e.days.tue&&t.push("T"),e.days.wed&&t.push("W"),e.days.thu&&t.push("Th"),e.days.fri&&t.push("F"),e.days.sat&&t.push("Sa"),n=t.join(" ")):n=e.start_day==e.end_day?humanize(e.start_day):humanize(e.start_day)+" - "+humanize(e.end_day),a+" - "+i+", "+n}).join(",<br/>")+"</span>"}}}),$("#schedule_container").hide(),setupMultiPicker("#filter_accounts","account","Filter by account"),$("#multi_tags").select2({"placeholder":"Search for a tag","minimumInputLength":0,"multiple":!0,"tokenSeparators":[","],"ajax":{"url":"/api/v1/lookup.json","dataType":"json","data":function(e,t){return{"search":e,"object_type":"tag","page":t,"nocount":1}},"results":function(e){return{"results":e.results.map(function(e){return{"text":e.text,"id":e.text}}),"more":e.results.length>=e.per_page}}},"initSelection":function(e,t){var n=$(e).val();n&&""!=n&&t(n.split(",").map(function(e){return{"text":e,"id":e}}))}}),l.find("[data-type=picker]").each(function(e,t){$(t).select2({"data":JSON.parse($(t).attr("data-options")),"separator":"\n","multiple":!0}),$(t).removeAttr("data-options")});var u=$("#direction").val(),p={"inbound":"font-phone-incoming","outbound":"font-phone-outgoing","msg_inbound":"font-bubbles","msg_outbound":"font-bubbles-2","form":"font-list-ul","chat":"font-bubble-2"};$("#direction").select2({"placeholder":"Search for a direction","formatResult":o,"formatSelection":o}),u&&u.length||(window.location.search&&window.location.search.includes("text_log")?$("#direction").select2("val",["msg_inbound","msg_outbound"]):CTM.enable_chat?$("#direction").select2("val",["inbound","outbound","form","chat"]):$("#direction").select2("val",["inbound","outbound","form"])),setupMultiPicker("#multi_agents","agent",CTM.localize("ReportFilter","extra.search.agent")),setupMultiPicker("#multi_sources","tracking_source",CTM.localize("ReportFilter","extra.search.tracking_source")),setupMultiPicker("#multi_tracking_numbers","tracking_number",CTM.localize("ReportFilter","extra.search.tracking_number")),setupMultiPicker("#multi_receiving_numbers","receiving_number",CTM.localize("ReportFilter","extra.search.receiving_number")),setupMultiPicker("#route_ids","route_ids",CTM.localize("ReportFilter","extra.search.route_ids")),setupMultiPicker("#transfer_from","transfer_from",CTM.localize("ReportFilter","extra.search.transfer_from")),setupMultiPicker("#transfer_to","transfer_to",CTM.localize("ReportFilter","extra.search.transfer_to")),$("#call_status").select2({"placeholder":CTM.localize("ReportFilter","extra.search.call_status")}),$("input#call_score_tag").length?CTMTagPicker("#call_score_tag",CTM.localize("ReportFilter","extra.search.call_score_tag"),{"object_type":"csr","allowClear":!0}):$("#call_score_tag").select2({"placeholder":CTM.localize("ReportFilter","extra.search.call_score_tag")}),$("#keypress").select2({"placeholder":CTM.localize("ReportFilter","extra.search.keypress")}),CTMGlobalFilter&&($("#save_current_filters").hide(),$("#report-filter-control p").hide()),e||CTMBindFiltersInit()}function UpdateDate(e){var t=moment().startOf("day"),n=moment().endOf("day"),a=$("#date_operator").val();switch(SetDates(t,n),ClearDateRange(),"schedule"==e?($("#date_container").hide(),$("#schedule_container").show()):($("#date_container").show(),$("#schedule_container").hide(),$("#schedule_select").select2("val","")),e){case"today":break;case"yesterday":t=moment().subtract(1,"day").startOf("day"),n=moment().subtract(1,"day").endOf("day");break;case"last7":t=moment().subtract(6,"days").startOf("day");break;case"last30":t=moment().subtract(29,"days").startOf("day");break;case"lastmonth":n=moment().subtract(1,"month").endOf("month"),t=moment().subtract(1,"month").startOf("month");break;case"thismonth":t=moment().startOf("month"),n=moment().endOf("month");break;case"schedule":t=null,n=null;break;default:e="alltime",t=null,n=null}if(t||n)SetDates(t,n);else{$("#start_date").val(""),$("#end_date").val("");var i=wasOpened;wasOpened=!1,$("#start_date").datepicker("setDate",""),$("#end_date").datepicker("setDate",""),wasOpened=i}var r=$("#"+e);r.length&&(r.addClass("callout"),"schedule"==e&&$("#last7").addClass("highlight")),builtin_date_ranges.indexOf(e)>-1&&($("#range").val(e),$("#date_operator").select2("val",e),-1==builtin_date_ranges.indexOf(a)&&$("#date_operator").trigger("change"))}function shouldShowTime(){return(window.location.pathname.match(/\/calls/)||window.location.pathname.match(/\/messages/))&&!window.location.pathname.match(/\/reports/)&&!window.location.pathname.match(/\/calls\/export2/)}function formatDate(e){return shouldShowTime()?e.format("YYYY-MM-D HH:mm"):e.format("YYYY-MM-D")}function CTMBindFiltersInit(){$("#call_score_min").change(function(){($("#call_score_max").val()<$(this).val()||"equal"==$("#call_score_operator").val())&&$("#call_score_max").val($(this).val())}),$("#call_score_max").change(function(){$("#call_score_min").val()>$(this).val()&&$("#call_score_min").val($(this).val())});var e=shouldShowTime();if(e)var t="yyyy-mm-dd H:i";else t="yyyy-mm-dd";$("#start_date").datepicker({"todayHighlight":!0,"showTime":e,"format":t,"defaultTime":[0,0,0],"autoclose":!0,"container":"#report-date-selection .filter-content"}).on("changeDate",function(){if(wasOpened){var e=$("#start_date").datepicker("getDate"),t=$("#end_date").datepicker("getDate");if(e&&t)if(shouldShowTime()){if(t.getTime()<=e.getTime()){var n=t.getHours(),a=t.getMinutes(),i=t.getSeconds();t.setTime(e.getTime()),t.setHours(n),t.setMinutes(a),t.setSeconds(i),t.getTime()<=e.getTime()&&(t.setTime(e.getTime()+86400),t.setHours(n),t.setMinutes(a),t.setSeconds(i),t.getTime()<=e.getTime()&&(t.setTime(e.getTime()),t.setMinutes(t.getMinutes()+1))),wasOpened=!1,$("#end_date").datepicker("setDate",formatDate(moment(t))),wasOpened=!0}}else e.setHours(0,0,0,0),t.setHours(0,0,0,0),t.getTime()<e.getTime()&&(wasOpened=!1,$("#end_date").datepicker("setDate",formatDate(moment(e))),wasOpened=!0);else;ClearDateRange()}}),$("#end_date").datepicker({"todayHighlight":!0,"showTime":e,"format":t,"defaultTime":[23,59,59],"autoclose":!0,"container":"#report-date-selection .filter-content"}).on("changeDate",function(){if(wasOpened){var e=$("#start_date").datepicker("getDate"),t=$("#end_date").datepicker("getDate");if(e&&t)if(shouldShowTime()){if(t.getTime()<=e.getTime()){var n=e.getHours(),a=e.getMinutes(),i=e.getSeconds();e.setTime(t.getTime()),e.setHours(n),e.setMinutes(a),e.setSeconds(i),t.getTime()<=e.getTime()&&(e.setTime(t.getTime()-86400),e.setHours(n),e.setMinutes(a),e.setSeconds(i),t.getTime()<=e.getTime()&&(e.setTime(e.getTime()),e.setMinutes(e.getMinutes()+1))),wasOpened=!1,$("#start_date").datepicker("setDate",formatDate(moment(e))),wasOpened=!0}}else e.setHours(0,0,0,0),t.setHours(0,0,0,0),t.getTime()<e.getTime()&&(wasOpened=!1,$("#start_date").datepicker("setDate",formatDate(moment(t))),wasOpened=!0);else;ClearDateRange()}}),$("#start_date").datepicker("setDate",$("#start_date").val()),$("#end_date").datepicker("setDate",$("#end_date").val()),""==$("#range").val()?ClearDateRange():UpdateDate($("#range").val()),$("#start_date").val()||$("#end_date").val()||"schedule"==$("#range").val()||$("#alltime").addClass("callout"),$("#report-date-selection .daterange .button").click(function(e){return e.preventDefault(),UpdateDate($(this).attr("data-range")),!1}),$("#date_operator").change(function(){builtin_date_ranges.indexOf($(this).val())>-1?UpdateDate($(this).val()):(ClearDateRange(),""==$("#start_date").val()&&""==$("#end_date").val()&&$("#alltime").addClass("callout"),$("#schedule_select").select2("val",""))}),$("#report-interval button.btn").on("click",function(){$("#report-interval button.btn").removeClass("active"),$(this).addClass("active"),Query.interval=$(this).attr("data-value"),CTMfilter()}),$("form.search,#report-filter").submit(function(e){e.preventDefault(),"function"==typeof window.CTMsearch&&window.CTMsearch()}),$("#clear-search").click(function(e){e.preventDefault(),$("#search-box").val(""),window.ColumnActions&&window.ColumnActions.applySortUI("metrics","DESC"),ResetFilters(!0),CTMsearch()});var n=!1;$("#report-date-selection").on("click","#report-filter-save",function(e){if(e.preventDefault(),!n){n=!0;var t=$(this).html();$(this).html("Saving...");var a=this;$.post("/reports/"+$(this).attr("data-id")+"/save_filters",{"_method":"PUT","filter_name":$("#report_filter_name").val()}).always(function(){n=!1,$(a).html(t)})}}),wasOpened=!0}function QueryasArray(e){Query[e]&&"string"==typeof Query[e]&&(Query[e]=Query[e].replace(/[\[\]"]/g,"").split(","))}function clearFilters(e){var t=$("#report-date-selection");e||($("#start_date").val(""),$("#end_date").val(""),ClearDateRange()),$("#multi_sources").val(""),$("#multi_tags").val(""),$("#filter_accounts").val(""),$("#multi_agents").val(""),$("#transfer_from").val(""),$("#transfer_to").val(""),$("#multi_tracking_numbers").val(""),$("#multi_receiving_numbers").val(""),$("#route_ids").val(""),$("#excluded_calls").prop("checked",!1),$("#reported_calls").prop("checked",!0),$("#converted_calls").val("0"),$("#form_entry_calls").prop("checked",!0),$("#direction").val(""),$("#ring_time_min, #ring_time_max").val("").trigger("change"),$("#talk_time_min, #talk_time_max").val("").trigger("change"),$("#duration_min, #duration_max").val("").trigger("change"),$("#converted_amount_min, #converted_amount_max").val("").trigger("change"),t.find("[data-type=picker]").val(""),t.find("[data-type=duration]").val("").trigger("change"),t.find("[data-type=text], [data-type=email], [data-type=phone], [data-type=url], [data-type=date], [data-type=number], [data-type=float], [data-type=region], [data-type=country]").val(""),t.find("[data-type=bool]").val(""),t.find("[data-type=rating]").val(""),$("#search-box").val(""),$("#call_score_min").val(0),$("#call_score_max").val(5),$("#filter_visitor_data").val(0),$("#has_audio").val(0),$("#call_status").select2("val",""),$("#call_score_tag").select2("val",""),$("#keypress").select2("val",""),$("#is_new_caller_check").prop("checked",!1),$("#schedule_select").val(""),t.find(".toggle-picker").each(function(e,t){$(t).find(".toggle-picker-popup").val("includes").trigger("change")})}function setQueryFiltersFromInput(){var e=$("#report-date-selection");Query.after=null,Query.with_time=1;var t=$("#date_operator").val();"equal"==t?Query.start_date=Query.end_date=$("#start_date").val():"greater_than_equal"==t?(Query.start_date=$("#start_date").val(),Query.end_date=""):"less_than_equal"==t?(Query.start_date="",Query.end_date=$("#end_date").val()):(Query.start_date=$("#start_date").val(),Query.end_date=$("#end_date").val()),Query.range=$("#range").val(),Query.multi_sources=$("#multi_sources").val(),Query.multi_sources_operator=$("#multi_sources_operator").val(),Query.filter_accounts=$("#filter_accounts").val(),QueryasArray("filter_accounts"),Query.filter_accounts_operator=$("#filter_accounts_operator").val(),Query.multi_tags=$("#multi_tags").val(),QueryasArray("multi_tags"),Query.multi_tags_operator=$("#multi_tags_operator").val(),Query.multi_agents=$("#multi_agents").val(),Query.multi_agents_operator=$("#multi_agents_operator").val(),Query.multi_tracking_numbers=$("#multi_tracking_numbers").val(),Query.multi_tracking_numbers_operator=$("#multi_tracking_numbers_operator").val(),Query.multi_receiving_numbers=$("#multi_receiving_numbers").val(),Query.multi_receiving_numbers_operator=$("#multi_receiving_numbers_operator").val(),Query.route_ids=$("#route_ids").val(),Query.route_ids_operator=$("#route_ids_operator").val(),Query.excluded=$("#excluded_calls").length>0?$("#excluded_calls").prop("checked")?"1":"0":null,Query.reported=$("#reported_calls").length>0?$("#reported_calls").prop("checked")?"1":"0":null,Query.converted=$("#converted_calls").length>0?$("#converted_calls").val():null,Query.form_entries=$("#form_entry_calls").prop("checked")?"1":"0",Query.direction=$("#direction").select2("val"),QueryasArray("direction"),Query.direction_operator=$("#direction_operator").val(),Query.talk_time_min=parseInt($("#talk_time_min").val()),Query.talk_time_max=parseInt($("#talk_time_max").val()),Query.talk_time_operator=$("#talk_time_operator").val(),isNaN(Query.talk_time_min)&&delete Query.talk_time_min,isNaN(Query.talk_time_max)&&delete Query.talk_time_max,Query.ring_time_min=parseInt($("#ring_time_min").val()),Query.ring_time_max=parseInt($("#ring_time_max").val()),Query.ring_time_operator=$("#ring_time_operator").val(),isNaN(Query.ring_time_min)&&delete Query.ring_time_min,isNaN(Query.ring_time_max)&&delete Query.ring_time_max,Query.duration_min=parseInt($("#duration_min").val()),Query.duration_max=parseInt($("#duration_max").val()),Query.duration_operator=$("#duration_operator").val(),isNaN(Query.duration_min)&&delete Query.duration_min,isNaN(Query.duration_max)&&delete Query.duration_max,Query.converted_amount_min=parseFloat($("#converted_amount_min").val()),Query.converted_amount_max=parseFloat($("#converted_amount_max").val()),Query.converted_amount_operator=$("#converted_amount_operator").val(),isNaN(Query.converted_amount_min)&&delete Query.converted_amount_min,isNaN(Query.converted_amount_max)&&delete Query.converted_amount_max,e.find("[data-type=duration], [data-type=number], [data-type=rating]").each(function(e,t){Query[t.name]=parseInt($(t).val()),isNaN(Query[t.name])&&delete Query[t.name];var n=t.name.match("^custom_min\\[(.+)\\]$");n&&(Query["custom_operator["+n[1]+"]"]=$("#custom_"+n[1]+"_operator").val())}),e.find("[data-type=float]").each(function(e,t){Query[t.name]=parseFloat($(t).val()),isNaN(Query[t.name])&&delete Query[t.name];var n=t.name.match("^custom_min\\[(.+)\\]$");n&&(Query["custom_operator["+n[1]+"]"]=$("#custom_"+n[1]+"_operator").val())}),e.find("[data-type=date]").each(function(e,t){Query[t.name]=$(t).val();var n=t.name.match("^custom_min\\[(.+)\\]$");n&&(Query["custom_operator["+n[1]+"]"]=$("#custom_"+n[1]+"_operator").val())}),e.find("[data-type=picker]").each(function(e,t){Query[t.name]=$(t).val();var n=t.name.match("^custom\\[(.+)\\]$");n&&(Query["custom_operator["+n[1]+"]"]=$("#custom_"+n[1]+"_operator").val())}),e.find("[data-type=text], [data-type=email], [data-type=phone], [data-type=url], [data-type=region], [data-type=country]").each(function(e,t){Query[t.name]=$(t).val();var n=t.name.match("^custom\\[(.+)\\]$");n&&(Query["custom_operator["+n[1]+"]"]=$("#custom_"+n[1]+"_operator").val())}),e.find("[data-type=bool]").each(function(e,t){Query[t.name]=$(t).val()}),Query.filter=$("#search-box").val(),Query.filter_visitor_data=$("#filter_visitor_data").val(),Query.has_audio=$("#has_audio").val(),Query.interval=$("#report-interval button.btn.active").attr("data-value"),Query.transfer_from=$("#transfer_from").val(),QueryasArray("transfer_from"),
Query.transfer_from_operator=$("#transfer_from_operator").val(),Query.transfer_to=$("#transfer_to").val(),QueryasArray("transfer_to"),Query.transfer_to_operator=$("#transfer_to_operator").val(),$("#call_status").length&&(Query.call_status=$("#call_status").select2("val"),QueryasArray("call_status"),Query.call_status_operator=$("#call_status_operator").val()),Query.schedule=$("#schedule_select").val(),Query.schedule&&(Query.range="schedule"),$("#call_score_tag").length&&(Query.call_score_tag=$("#call_score_tag").select2("val"),QueryasArray("call_score_tag"),Query.call_score_tag_operator=$("#call_score_tag_operator").val()),$("#keypress").length&&(Query.keypress=$("#keypress").select2("val"),QueryasArray("keypress"),Query.keypress_operator=$("#keypress_operator").val()),Query.is_new_caller=$("#is_new_caller_check").prop("checked")?"1":"0",Query.call_score_min=$("#call_score_min").val(),Query.call_score_max=$("#call_score_max").val();var n=$($("#calls > thead th.sort_asc, #calls > thead th.sort_desc")[0]);if(n.length){var a=n.find("a").attr("data-col");a&&(Query.order=a.replace("-","_"),Query.sort_dir=n.hasClass("sort_asc")?"ASC":"DESC")}CTM.phonemode&&"function"==typeof isMobileLayout&&(delete Query.contact_number,isMobileLayout()?(Query.group_callers=1,Query.per_page=10,$("body").hasClass("contacts")||(Query.contact_number=window.contactNumberSearch,$("body").hasClass("splitview")||(Query.filter="")),Query.limit_fields=["id","name","caller_number_format","caller_number"]):(Query.group_callers=0,Query.per_page=30,delete Query.limit_fields))}function setURLState(e){if(e&&"object"==typeof e.direction&&e.direction.length&&"object"==typeof e.direction[0]&&delete e.direction,e&&"object"==typeof e.call_status&&e.call_status.length&&"object"==typeof e.call_status[0]&&delete e.call_status,e&&"object"==typeof e.call_score_tag&&e.call_score_tag.length&&"object"==typeof e.call_score_tag[0]&&delete e.call_score_tag,e&&"object"==typeof e.keypress&&e.keypress.length&&"object"==typeof e.keypress[0]&&delete e.keypress,e&&"object"==typeof e.transfer_from&&e.transfer_from.length&&"object"==typeof e.transfer_from[0]&&delete e.transfer_from,e&&"object"==typeof e.transfer_to&&e.transfer_to.length&&"object"==typeof e.transfer_to[0]&&delete e.transfer_to,$(window).data("URLStateLock"))return $(window).data("URLStateLock",!1),void $(window).data("URLChangeLock",!1);var t=[],n=ctmFilterExcluded;for(var a in e){if(n[a]!=undefined){if("number"==typeof n[a]&&n[a]==parseInt(e[a]))continue;if("number"==typeof e[a]&&e[a]==parseInt(n[a]))continue;if(n[a]===e[a])continue;if("object"==typeof e[a]&&"object"==typeof n[a]&&e[a].length&&n[a].length&&e[a].length==n[a].length){for(var i=!0,r=0,s=e[a].length;r<s;++r)if(e[a][r]!=n[a][r]){i=!1;break}if(i)continue}}!e[a]&&"number"!=typeof e[a]||""==$.trim(e[a])||("page"==a||"callNav"==a||"callId"==a||"range"==a&&"schedule"==e[a]&&!e.schedule||(filtered=!0),t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a])))}if($(window).data("URLChangeLock",!0),$(window).off("hashchange",URLChangeEvent),$("#export-link").length&&(window.text_log?$("#export-link").attr("href","/calls/export2?text_log=true"):$("#export-link").attr("href","/calls/export2?"+t.join("&"))),!window.location.search.match(/filter_bar=hidden/))if(t.length||"function"!=typeof history.pushState)window.location.hash=t.join("&");else try{history.pushState("",document.title,window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search)}catch(o){window.location.hash=t.join("&")}setTimeout(function(){$(window).on("hashchange",URLChangeEvent),setTimeout(function(){$(window).data("URLChangeLock",!1)},10)},10)}function URLChangeEvent(){if(!$(window).data("URLChangeLock")){var e=updateFromHash();if($(window).data("URLChangeLock",!0),$(window).data("URLStateLock",!0),window.ColumnActions)if(e.order&&e.sort_dir&&window.ColumnActions.applySortUI(e.order.replace("-","_"),e.sort_dir),!isNaN(parseInt(e.callId))&&e.callNav){var t=$("#call-row-"+e.callId);t.length>0?($("#call-"+e.callId).length>0&&toggleAction(e.callNav,t,Query.placement),toggleAction(e.callNav,t,Query.placement)):(setURLState({"callNav":e.callNav,"callId":e.callId}),clearCallList(),fetchCallAndRender(e.callId,function(t){toggleAction(e.callNav,$("#call-row-"+t.id),Query.placement)}))}else Query=e,window.CTMFetchCalls(!0,Query)}}function getURLState(){var e={};return window.location.hash.replace(/^#/,"").split("&").map(function(e){return e.split("=").map(function(e){return decodeURIComponent(e)})}).filter(function(e){return e[0]&&$.trim(e[0]).length>0}).forEach(function(t){e[t[0]]=t[1]}),e}function updateFromHash(){var e=$("#report-date-selection");ResetFilters(!0,!0);for(var t,n,a,i,r=getURLState(),s=Object.keys(r),o=0,l=s.length;o<l;++o)if(!ctmFilterExcluded.hasOwnProperty(s[o])){filtered=!0;break}for(o=0,l=(s=Object.keys(ctmFilterExcluded)).length;o<l;++o)r.hasOwnProperty(s[o])||(r[s[o]]=ctmFilterExcluded[s[o]]);(r.schedule&&($("#schedule_select").select2("val",r.schedule),Query.schedule=r.schedule,Query.schedule&&(r.range="schedule")),$("#search-box").val(r.filter),r.range&&"alltime"!=r.range&&builtin_date_ranges.indexOf(r.range)>-1)?($("#range").val(r.range),Query.range=$("#range").val(),UpdateDate(r.range)):($("#range").val(""),Query.range="","undefined"!=typeof r.start_date&&(shouldShowTime()&&!r.start_date.match(/ \d\d:\d\d$/)&&(r.start_date+=" 00:00"),$("#start_date").val(r.start_date),$("#start_date").datepicker("setDate",$("#start_date").val()),t=Query.start_date=$("#start_date").val()),"undefined"!=typeof r.end_date&&(shouldShowTime()&&!r.end_date.match(/ \d\d:\d\d$/)&&(r.end_date+=" 23:59"),$("#end_date").val(r.end_date),$("#end_date").datepicker("setDate",$("#end_date").val()),n=Query.end_date=$("#end_date").val()),t?n?$("#date_operator").val("range").trigger("change"):$("#date_operator").val("greater_than_equal").trigger("change"):n?$("#date_operator").val("less_than_equal").trigger("change"):($("#start_date").val(""),$("#end_date").val(""),$("#date_operator").val(ctmFilterExcluded.date_operator).trigger("change")));if(r.multi_sources){var c=r.multi_sources.split(",");if(isNaN(parseInt(r.multi_sources))&&"string"==typeof r.multi_sources)c=c.map(function(e){return $("#multi_sources option:contains('"+e+"')").attr("value")});$("#multi_sources").select2("val",c),Query.multi_sources=c}if(r.multi_sources_operator&&($("#multi_sources_operator").val(r.multi_sources_operator).trigger("change"),Query.multi_sources_operator=r.multi_sources_operator),"1"==r.excluded&&($("#excluded_calls").prop("checked",!0),Query.excluded="1"),"1"!=r.reported&&null!=r.reported||($("#reported_calls").prop("checked",!0),Query.reported="1"),r.converted&&($("#converted_calls").val(r.converted),Query.converted=r.converted),"1"!=r.form_entries&&null!=r.reported||(null==r.reported&&"1"!=r.form_entries&&$("#chart").length>0?($("#form_entry_calls").prop("checked",!1),Query.form_entries="0"):($("#form_entry_calls").prop("checked",!0),Query.form_entries="1")),parseInt(r.multi_receiving_numbers)>0){c=r.multi_receiving_numbers.split(",");$("#multi_receiving_numbers").select2("val",c),Query.multi_receiving_numbers=c.toString()}if(r.multi_receiving_numbers_operator&&($("#multi_receiving_numbers_operator").val(r.multi_receiving_numbers_operator).trigger("change"),Query.multi_receiving_numbers_operator=r.multi_receiving_numbers_operator),parseInt(r.route_ids)>0){c=r.route_ids.split(",");$("#route_ids").select2("val",c),Query.route_ids=c.toString()}if(r.route_ids_operator&&($("#route_ids_operator").val(r.route_ids_operator).trigger("change"),Query.route_ids_operator=r.route_ids_operator),parseInt(r.multi_tracking_numbers)>0){c=r.multi_tracking_numbers.split(",");$("#multi_tracking_numbers").select2("val",c),Query.multi_tracking_numbers=c}if(r.multi_tracking_numbers_operator&&($("#multi_tracking_numbers_operator").val(r.multi_tracking_numbers_operator).trigger("change"),Query.multi_tracking_numbers_operator=r.multi_tracking_numbers_operator),"day"!=r.interval&&"week"!=r.interval&&"month"!=r.interval||(Query.interval=r.interval,$("#report-interval button").removeClass("active"),$("#report-interval button[data-value="+r.interval+"]").addClass("active")),r.secondary&&"function"==typeof window.ShowSecondaryDimensions&&(Query.secondary=r.secondary,ShowSecondaryDimensions()),!isNaN(parseInt(r.ring_time_min))){c=parseInt(r.ring_time_min);$("#ring_time_min").val(c).trigger("change"),Query.ring_time_min=c}if(!isNaN(parseInt(r.ring_time_max))){c=parseInt(r.ring_time_max);$("#ring_time_max").val(c).trigger("change"),Query.ring_time_max=c}if(r.ring_time_operator&&($("#ring_time_operator").val(r.ring_time_operator).trigger("change"),Query.ring_time_operator=r.ring_time_operator),!isNaN(parseInt(r.ring_time))){c=parseInt(r.ring_time);"1"==r.ring_time_up?($("#ring_time_operator").val("less_than").trigger("change"),$("#ring_time_max").val(c).trigger("change"),Query.ring_time_max=c):($("#ring_time_operator").val("greater_than").trigger("change"),$("#ring_time_min").val(c).trigger("change"),Query.ring_time_min=c)}if(!isNaN(parseInt(r.talk_time_min))){c=parseInt(r.talk_time_min);$("#talk_time_min").val(c).trigger("change"),Query.talk_time_min=c}if(!isNaN(parseInt(r.talk_time_max))){c=parseInt(r.talk_time_max);$("#talk_time_max").val(c).trigger("change"),Query.talk_time_max=c}if(r.talk_time_operator&&($("#talk_time_operator").val(r.talk_time_operator).trigger("change"),Query.talk_time_operator=r.talk_time_operator),!isNaN(parseInt(r.talk_time))){c=parseInt(r.talk_time);"1"==r.talk_time_up?($("#talk_time_operator").val("less_than").trigger("change"),$("#talk_time_max").val(c).trigger("change"),Query.talk_time_max=c):($("#talk_time_operator").val("greater_than").trigger("change"),$("#talk_time_min").val(c).trigger("change"),Query.talk_time_min=c)}if(!r.total_time&&r.duration&&(r.total_time=r.duration),!isNaN(parseInt(r.duration_min))){c=parseInt(r.duration_min);$("#duration_min").val(c).trigger("change"),Query.duration_min=c}if(!isNaN(parseInt(r.duration_max))){c=parseInt(r.duration_max);$("#duration_max").val(c).trigger("change"),Query.duration_max=c}if(r.duration_operator&&($("#duration_operator").val(r.duration_operator).trigger("change"),Query.duration_operator=r.duration_operator),!isNaN(parseInt(r.duration))){c=parseInt(r.duration);"1"==r.duration_up?($("#duration_operator").val("less_than").trigger("change"),$("#duration_max").val(c).trigger("change"),Query.duration_max=c):($("#duration_operator").val("greater_than").trigger("change"),$("#duration_min").val(c).trigger("change"),Query.duration_min=c)}if(!isNaN(parseFloat(r.converted_amount_min))){c=parseFloat(r.converted_amount_min);$("#converted_amount_min").val(c).trigger("change"),Query.converted_amount_min=c}if(!isNaN(parseFloat(r.converted_amount_max))){c=parseFloat(r.converted_amount_max);$("#converted_amount_max").val(c).trigger("change"),Query.converted_amount_max=c}if(r.converted_amount_operator&&($("#converted_amount_operator").val(r.converted_amount_operator).trigger("change"),Query.converted_amount_operator=r.converted_amount_operator),e.find("[data-type=duration], [data-type=number], [data-type=rating]").each(function(e,t){if(!isNaN(parseInt(r[t.name]))){var n=parseInt(r[t.name]);$('[name="'+t.name+'"]').val(n).trigger("change"),Query[t.name]=n}var a=t.name.match("^custom_max\\[(.+)\\]$");a&&($("#custom_"+a[1]+"_operator").val(r["custom_operator["+a[1]+"]"]).trigger("change"),Query["custom_operator["+a[1]+"]"]=r["custom_operator["+a[1]+"]"])}),e.find("[data-type=float]").each(function(e,t){if(!isNaN(parseFloat(r[t.name]))){var n=parseFloat(r[t.name]);$('[name="'+t.name+'"]').val(n).trigger("change"),Query[t.name]=n}var a=t.name.match("^custom_max\\[(.+)\\]$");a&&($("#custom_"+a[1]+"_operator").val(r["custom_operator["+a[1]+"]"]).trigger("change"),Query["custom_operator["+a[1]+"]"]=r["custom_operator["+a[1]+"]"])}),e.find("[data-type=date]").each(function(e,t){$('[name="'+t.name+'"]').val(r[t.name]).trigger("change"),Query[t.name]=r[t.name];var n=t.name.match("^custom_max\\[(.+)\\]$");n&&($("#custom_"+n[1]+"_operator").val(r["custom_operator["+n[1]+"]"]).trigger("change"),Query["custom_operator["+n[1]+"]"]=r["custom_operator["+n[1]+"]"])}),e.find("[data-type=picker]").each(function(e,t){if(r[t.name])if($('[name="'+t.name+'"]').val(r[t.name]),"string"==typeof r[t.name]){var n=r[t.name].split(",");$('[name="'+t.name+'"]').select2("val",n),Query[t.name]=n}else $('[name="'+t.name+'"]').select2("val",r[t.name]),Query[t.name]=r[t.name];var a=t.name.match("^custom\\[(.+)\\]$");a&&r["custom_operator["+a[1]+"]"]&&($("#custom_"+a[1]+"_operator").val(r["custom_operator["+a[1]+"]"]).trigger("change"),Query["custom_operator["+a[1]+"]"]=r["custom_operator["+a[1]+"]"])}),e.find("[data-type=text], [data-type=email], [data-type=phone], [data-type=url], [data-type=region], [data-type=country]").each(function(e,t){r[t.name]&&($('[name="'+t.name+'"]').val(r[t.name]),Query[t.name]=r[t.name]);var n=t.name.match("^custom\\[(.+)\\]$");n&&($("#custom_"+n[1]+"_operator").val(r["custom_operator["+n[1]+"]"]).trigger("change"),Query["custom_operator["+n[1]+"]"]=r["custom_operator["+n[1]+"]"])}),e.find("[data-type=bool]").each(function(e,t){$('[name="'+t.name+'"]').val(r[t.name]).trigger("change"),Query[t.name]=r[t.name]}),r.direction)if($("#direction").val(r.direction),"string"==typeof r.direction){c=r.direction.split(",");$("#direction").select2("val",c),Query.direction=c}else $("#direction").select2("val",r.direction),Query.direction=r.direction;if(r.direction_operator&&($("#direction_operator").val(r.direction_operator).trigger("change"),Query.direction_operator=r.direction_operator),r.multi_tags)if($("#multi_tags").val(r.multi_tags),"string"==typeof r.multi_tags){c=r.multi_tags.split(",");$("#multi_tags").select2("val",c),Query.multi_tags=c}else $("#multi_tags").select2("val",r.multi_tags),Query.multi_tags=r.multi_tags;if(r.multi_tags_operator&&($("#multi_tags_operator").val(r.multi_tags_operator).trigger("change"),Query.multi_tags_operator=r.multi_tags_operator),r.filter_accounts)if($("#filter_accounts").val(r.filter_accounts),"string"==typeof r.filter_accounts){c=r.filter_accounts.split(",");$("#filter_accounts").select2("val",c),Query.filter_accounts=c}else $("#filter_accounts").select2("val",r.filter_accounts),Query.filter_accounts=r.filter_accounts;if(r.multi_agents)if($("#multi_agents").val(r.multi_agents),"string"==typeof r.multi_agents){c=r.multi_agents.split(",");$("#multi_agents").select2("val",c),Query.multi_agents=c}else $("#multi_agents").select2("val",r.multi_agents),Query.multi_agents=r.multi_agents;if(r.multi_agents_operator&&($("#multi_agents_operator").val(r.multi_agents_operator).trigger("change"),Query.multi_agents_operator=r.multi_agents_operator),r.transfer_from)if($("#transfer_from").val(r.transfer_from),"string"==typeof r.transfer_from){c=r.transfer_from.split(",");$("#transfer_from").select2("val",c),Query.transfer_from=c}else $("#transfer_from").select2("val",r.transfer_from),Query.transfer_from=r.transfer_from;if(r.placement&&(Query.placement=r.placement),r.transfer_from_operator&&($("#transfer_from_operator").val(r.transfer_from_operator).trigger("change"),Query.transfer_from_operator=r.transfer_from_operator),r.transfer_to)if($("#transfer_to").val(r.transfer_to),"string"==typeof r.transfer_to){c=r.transfer_to.split(",");$("#transfer_to").select2("val",c),Query.transfer_to=c}else $("#transfer_to").select2("val",r.transfer_to),Query.transfer_to=r.transfer_to;if(r.transfer_to_operator&&($("#transfer_to_operator").val(r.transfer_to_operator).trigger("change"),Query.transfer_to_operator=r.transfer_to_operator),r.order?(Query.order=r.order,Query.sort_dir=r.sort_dir,window.ColumnActions&&window.ColumnActions.applySortUI(r.order.replace("-","_"),r.sort_dir)):window.ColumnActions&&window.ColumnActions.applySortUI("metrics","DESC"),"undefined"!=typeof r.call_score_min&&($("#call_score_min").val(r.call_score_min),a=Query.call_score_min=r.call_score_min),"undefined"!=typeof r.call_score_max&&($("#call_score_max").val(r.call_score_max),i=Query.call_score_max=r.call_score_max),parseInt(a)==parseInt(i)?$("#call_score_operator").val("equal").trigger("change"):parseInt(a)>0?parseInt(i)<5?$("#call_score_operator").val("range").trigger("change"):$("#call_score_operator").val("greater_than_equal").trigger("change"):parseInt(i)<5?$("#call_score_operator").val("less_than_equal").trigger("change"):($("#call_score_min").val("0"),$("#call_score_max").val("5"),$("#call_score_operator").val(ctmFilterExcluded.call_score_operator).trigger("change")),"1"==r.duration_up&&($("#duration_up").prop("checked",!0),Query.duration_up=1),"1"==r.talk_time_up&&($("#talk_time_up").prop("checked",!0),Query.talk_time_up=1),"yes"!=r.filter_visitor_data&&"no"!=r.filter_visitor_data&&"1"!=r.filter_visitor_data&&"2"!=r.filter_visitor_data||(Query.filter_visitor_data=r.filter_visitor_data,$("#filter_visitor_data").val(r.filter_visitor_data)),"yes"!=r.has_audio&&"no"!=r.has_audio&&"1"!=r.has_audio&&"2"!=r.has_audio||(Query.has_audio=r.has_audio,$("#has_audio").val(r.has_audio)),r.keypress)if($("#keypress").val(r.keypress),"string"==typeof r.keypress){c=r.keypress.split(",");$("#keypress").select2("val",c),Query.keypress=c}else $("#keypress").select2("val",r.keypress),Query.keypress=r.keypress;if(r.keypress_operator&&($("#keypress_operator").val(r.keypress_operator).trigger("change"),Query.keypress_operator=r.keypress_operator),r.call_status)if($("#call_status").val(r.call_status),"string"==typeof r.call_status){c=r.call_status.split(",");$("#call_status").select2("val",c),Query.call_status=c}else $("#call_status").select2("val",r.call_status),Query.call_status=r.call_status;if(window.AllowedAccess.status_filters||$("#call_status").closest(".field").hide(),r.call_status_operator&&($("#call_status_operator").val(r.call_status_operator).trigger("change"),Query.call_status_operator=r.call_status_operator),r.call_score_tag)if($("#call_score_tag").val(r.call_score_tag),"string"==typeof r.call_score_tag){c=r.call_score_tag.split(",");$("#call_score_tag").select2("val",c.length?c:""),Query.call_score_tag=c}else $("#call_score_tag").select2("val",r.call_score_tag.length?r.call_score_tag:""),Query.call_score_tag=r.call_score_tag;return r.call_score_tag_operator&&($("#call_score_tag_operator").val(r.call_score_tag_operator).trigger("change"),Query.call_score_tag_operator=r.call_score_tag_operator),Query.is_new_caller="1"==r.is_new_caller,$("#is_new_caller_check").prop("checked",Query.is_new_caller),setQueryFiltersFromInput(),r}function CTMCallStats(e,t){let n;n=filtered?window.text_log?CTM.localize("Call","extra.filtered_texts",{"count":e.total_entries}):CTM.localize("Call","extra.filtered_calls",{"count":e.total_entries}):window.text_log?CTM.localize("Call","extra.texts",{"count":e.total_entries}):CTM.localize("Call","extra.calls",{"count":e.total_entries}),$("#call-stats .total > .text, #call-stats .total + .popover .total-text span, .call-stats-mobile > span > span").text(n),$("#call-stats .total").prop("total",e.total_entries),$("#call-stats .total").popover("destroy");var a=!0;$("#call-stats .total").popover({"placement":"bottom","html":!0,"content":function(){$(this);if(a){a=!1;var e="/api/v1/accounts/"+CTM.account+"/calls/search.json?stats=on";return $.post(e,Query,function(e){console.log(e.stats),e.stats&&(e.stats.total_text=$("#call-stats .total > .text").text(),e.stats.text_log=window.text_log||void 0===t,["ring_time","talk_time","hold_time","minutes"].forEach(function(t){e.stats[t]&&(e.stats[t].total=sprintf("%.2f",e.stats[t].total),e.stats[t].total_text=I18n.t("datetime.distance_in_words.x_minutes",{"count":e.stats[t].total}))})),$("#call-stats .popover-content").html(HoganTemplates["calls/call_stats"].render(e.stats))}).always(function(){setTimeout(function(){a=!0},3e3)}),ProgressBarHtml}}})}function InitQueryLog(){window.Query={"page":1,"filter":"","with_time":1},setQueryFiltersFromInput()}function ctm_init_access(e){window.CTMDidInit=!0,window.AllowedAccess=e.allowed_access,window.UserPrefs=e.user_prefs,window.CTMScoring=e.ctm_scoring,window.CRMSalesforce=e.crm.salesforce,CTM.plan_name=e.ctm.plan_name,CTM.plan=e.ctm.plan,CTM.call_notifications_path=e.ctm.call_notifications_path,CTM.change_plan_accounts_path=e.ctm.change_plan_accounts_path,CTM.auth_form_tag_token=e.ctm.auth_form_tag_token,CTM._super=e.ctm._super,CTM.owner=e.ctm.owner,window.CTM_ALLOW_ADMIN_EDIT_ON=e.ctm_features.allow_admin_edit,window.CTM_CALLBACK_ON=e.ctm_features.allow_callback,window.CTM_EMAIL_ON=e.ctm_features.allow_email,window.CTM_BLOCK_ON=e.ctm_features.allow_block,window.CTM_EXCLUDE_ON=e.ctm_features.allow_exclude,window.CTM_REDACT_ON=e.ctm_features.allow_redact,window.CTM_CALLER_LOOKUP_ON=e.ctm_features.allow_lookup,window.CTM_MANUAL_LOOKUP=e.ctm_features.allow_manual_lookup,window.AllowedAccess.tags||$(function(){var e=document.createElement("style");e.innerHTML="#calls .call-tags, #calls .call-edit-tags { display: none; }",document.body.appendChild(e)}),window.AllowedAccess&&$(function(){for(var e in window.AllowedAccess){window.AllowedAccess[e]||(window.UserPrefs.columns[e]=!1,$("#call-customize a[data-col="+e.replace(/_/g,"-")+"]").closest("li").remove())}}),CTM.phonemode&&Object.keys(window.UserPrefs.sections).forEach(function(e){"caller"!=e&&(window.UserPrefs.sections[e]=!1)})}function CTMInitLogAccess(e){"use strict";window.CTMDidInit?e():"undefined"==typeof window.AllowedAccess?"function"==typeof window.fetch?fetch("/api/v1/users/log_access.json?type="+(window.text_log?"text":"call"),{"credentials":"include"})["catch"](function(){bootbox.alert(CTM.localize("Call","errors.session_expired"))}).then(function(e){return e.json()}).then(function(t){ctm_init_access(t),$(e)}):$.get("/api/v1/users/log_access.json",{"type":window.text_log?"text":"call"},function(t){ctm_init_access(t),$(e)}):$(e)}function allowCallWithFilter(e){if(window.IncomingPhoneCall&&e.id==window.IncomingPhoneCall.id)return!0;let t=e.agent_id;if(!t&&window.CallsTable&&CallsTable.has(parseInt(e.id))&&CallsTable.get(parseInt(e.id)).agent_id&&(t=CallsTable.get(parseInt(e.id)).agent_id),!t&&e.agent&&(t=e.agent.id),"chat"!=e.direction&&!CTM.allow_incoming_calls&&"agent"==CTM.role&&CTM.user!=t&&"hold"!=e.dial_status)return!1;if(CTM.allow_incoming_calls&&"agent"==CTM.role&&CTM.user!=t&&"in-progress"!=e.dial_status&&"hold"!=e.dial_status&&"ringing"!=e.dial_status)return!1;if(CTM.prevent_manager_roles&&!t&&(!e.dial_status||"in-progress"==e.dial_status||"ringing"==e.dial_status)&&"admin"!=CTM.role)return!1;var n=window.CTM.acl.receiving_number_ids,a=window.CTM.acl.tracking_number_ids,i=window.CTM.acl.tracking_source_ids,r=window.CTM.acl.statuses,s=window.CTM.acl.tags,o=1;if(1==o&&s&&s.length){var l=!1;"object"==typeof e.tag_list&&"function"==typeof e.tag_list.indexOf&&(l=s.filter(function(t){return-1!=e.tag_list.indexOf(t)}).length),o&="excludes"==Query.multi_tags_operator?!l:l}if(1==o&&r&&r.length){l=r.filter(function(t){return t==e.dial_status}).length;o&="excludes"==Query.call_status_operator?!l:l}if(1==o&&n&&n.length){l=n.filter(function(t){return t==e.receiving_number_id}).length;o&="excludes"==Query.multi_receiving_numbers_operator?!l:l}if(1==o&&a&&a.length){l=a.filter(function(t){return t==e.tracking_number_id}).length;o&="excludes"==Query.multi_tracking_numbers_operator?!l:l}if(1==o&&i&&i.length){l=i.filter(function(t){return t==e.tracking_source_id}).length;o&="excludes"==Query.multi_sources_operator?!l:l}if(1==o&&e.direction&&!e.direction.match(/^msg_/)&&!e.direction.match(/^chat/)&&"text_message"!=Query.callNav&&"call_chat"!=Query.callNav){var c=$("#direction").val();c&&c.length&&0==(o&=c&&c.indexOf(e.direction)>-1)&&(t==CTM.user?o=1:console.warn("msg blocked by allowedTypes: ",e.direction,c,e))}if(0==o)return console.log("not allowed acl"),!1;if(!isNaN(parseInt(Query.callId))&&CallsTable.has(parseInt(Query.callId))&&CallsTable.get(parseInt(Query.callId)).caller_number==e.caller_number)return 1==o;{let t=!0;Query.multi_agents&&"object"==typeof Query.multi_agents&&Query.multi_agents.length>0&&(t=Query.multi_agents.indexOf(e.agent_id)>-1,o&="excludes"==Query.multi_agents_operator?!t:t),Query.direction&&Query.direction.length>0&&(t=Query.direction.indexOf(e.direction)>-1,o&="excludes"==Query.direction_operator?!t:t)}if(0==o){if(t==CTM.user&&$("#call-row-"+e.id).length)return!0;console.warn("not pushing due to view preferences:",o,Query,e)}return 1==o}function InitLogHeader(){function e(e,t){CallsTable.has(parseInt(e))?window.CallActions[t].apply($("#call-row-"+e).get(0)):"function"==typeof window.fetchCallAndRender&&window.fetchCallAndRender(e,function(){window.CallActions[t].apply($("#call-row-"+e).get(0))})}function t(){let e=$("#call-stats .auto-load");e.attr("data-state","auto"),e.find("i").removeClass("font-spinner").addClass("font-stop"),e.find(".text").text(CTM.localize("Call","actions.toolbar.stop-auto-load.label")),window.AutoLoadCalls=!0,$("#search-box").parent().find(".new-calls").removeAttr("data-available"),window.localStorage.setItem("auto-load-calls","1"),$("#auto-load-btn i").removeClass("font-spinner").addClass("font-stop"),$("#auto-load-btn span").text(CTM.localize("Call","actions.toolbar.stop-auto-load.label"))}function n(){if(CTM.phonemode||CTM.deskmode)return;let e=$("#call-stats .auto-load");e.attr("data-state","manual"),e.find("i").removeClass("font-stop").addClass("font-spinner"),e.find(".text").text(CTM.localize("Call","actions.toolbar.auto-load.label")),window.AutoLoadCalls=!1,window.localStorage.setItem("auto-load-calls","0"),$("#auto-load-btn i").removeClass("font-stop").addClass("font-spinner"),$("#auto-load-btn span").text(CTM.localize("Call","actions.toolbar.auto-load.label"))}function a(e){(!d||(new Date).getTime()-d.getTime()>8e3)&&(d=new Date,e.emit("calls.active",{"account":CTM.account})),setTimeout(function(){a(e)},8e3)}function i(e,t,n,a){if("function"==typeof window.fetchCallAndRender&&0!=$("#call-row-"+e).length)try{window.fetchCallAndRender(e,function(e){"function"==typeof a&&a(e)},!0,t,n)}catch(i){console.error(i)}}function r(){var e=!1;return Query.callNav&&(e=!window.IncomingCallConnection&&!!$(".call-edit.showing").length&&isMobileLayout()),window.AutoLoadCalls&&!e&&!$(".call-audio audio").length}function s(e){return e.agent_id!=CTM.user&&!r()||"function"==typeof window.fetchCallAndRender&&(window.fetchCallAndRender(e.id,function(){},!0,e.call_start,!0),!0)}function o(e){var t=$("#search-box").parent().find(".new-calls"),n=t.data("count"),a=t.data("calls");a||(a=[]),n?(n=parseInt(n)+1,isNaN(n)&&(n=1)):n=1,a.push(e),t.data("calls",a),t.data("count",n),$("#search-box").parent().find(".new-calls .call-count").html(numberWithCommas(n)),1==n&&t.attr("data-available","1")}function l(){function e(e,t,n){var a=browserName(),i=function(e,n){t.toggleClass("font-checkmark-2",e),$("#alert-call").attr("data-on",$("#alert-call i.toggle.font-checkmark-2").length>0),$.post("/calls/enable_desktop_alerts",n,"json")};navigator.serviceWorker?(console.log("subscribing with service workers"),CTM.enableServiceWorkers(function(t,r){console.log("reg:",t,r),t.pushManager.subscribe({"userVisibleOnly":!0,"applicationServerKey":r}).then(function(t){console.log("nsub:",t),i(n,{"name":a,"type":e,"subscription":t.toJSON()})},function(e){console.log("esub error:",e)})})):window.ctm_push_tokens?i(n,{"device_type":$("body.ios").length?"iOS":"Android","type":e,"push_uuid":window.ctm_push_tokens.push}):i(n,{"type":e})}var t={};for(var n in CTM.icons||{})t[n]=CTM.cdn+CTM.icons[n];if(window.Notification||$("body.native").length){$("#alert-call").attr("data-on",$("#alert-call i.toggle.font-checkmark-2").length>0),$("#alert-call .dropdown-menu a").click(function(t){t.preventDefault();var n=$(this).attr("data-col"),a=$(this).find("i.toggle"),i=!a.hasClass("font-checkmark-2");i?window.Notification&&"granted"!==Notification.permission?Notification.requestPermission(function(t){"granted"==t?(console.log("permission granted"),e(n,a,i)):ctmFlash(CTM.localize("Call","errors.enable_notifications"),"error")}):window.ctm_push_tokens||window.Notification&&"granted"==Notification.permission?e(n,a,i):ctmFlash(CTM.localize("Call","errors.unsupported_notifications"),"error"):(a.toggleClass("font-checkmark-2",i),$("#alert-call").attr("data-on",$("#alert-call i.toggle.font-checkmark-2").length>0),navigator.serviceWorker?CTM.enableServiceWorkers(function(e,t){console.log("reg:",e,t),e.pushManager.subscribe({"userVisibleOnly":!0,"applicationServerKey":t}).then(function(e){console.log("nsub:",e),$.post("/calls/disable_desktop_alerts",{"type":n,"name":browserName(),"subscription":e.toJSON()})},function(e){console.log("esub error:",e),$.post("/calls/disable_desktop_alerts",{"type":n,"name":browserName()})})}):window.ctm_push_tokens&&window.ctm_push_tokens.push?$.post("/calls/disable_desktop_alerts",{"device_type":$("body.ios").length?"iOS":"Android","type":n,"name":browserName(),"token":window.ctm_push_tokens.push,"voip_token":window.ctm_push_tokens.voip}):$.post("/calls/disable_desktop_alerts",{"type":n,"name":browserName()}))});var a={};$(window).on("ctm.call.text_message",function(e,n){if(allowCallWithFilter(n)){if(s(n)&&o(n),window.Notification&&"granted"==Notification.permission){var r=n.message,l=!0;if("inbound"!=r.direction&&"outbound"!=r.direction&&(l=!1),"inbound"==r.direction&&0==$("#alert-call .dropdown-menu a[data-col=msg_inbound] i.toggle.font-checkmark-2").length&&(l=!1),"outbound"==r.direction&&0==$("#alert-call .dropdown-menu a[data-col=msg_outbound] i.toggle.font-checkmark-2").length&&(l=!1),a[r.id]&&(l=!1),l){a[r.id]=!0;var c=new Notification(("inbound"==r.direction?"Incoming":"Outbound")+" message "+r.from,{"body":r.body,"icon":"inbound"==r.direction?t.msg_inbound:t.msg_outbound});c.addEventListener("click",function(){CallsTable.has(parseInt(n.id))?window.CallActions.toggle.apply($("#call-row-"+n.id).get(0)):"function"==typeof window.fetchCallAndRender&&window.fetchCallAndRender(n.id,function(){window.CallActions.text.apply($("#call-row-"+n.id).get(0))}),c.close()}),c&&setTimeout(function(){c.close(),delete a[r.id]},8e3)}}var d=$(".new-message .message").map(function(){return $(this).attr("data-id")}).toArray(),u=d.filter(function(e){return e==n.message.id});if((d=d.filter(function(e){return e==n.message.parent_id})).length&&!u.length)try{window.activeTextMessageInjectThread(window.prepareTextMessage(n,n.message))}catch(p){console.log(p)}i(n.id,n.call_start,!0,function(){})}}),$(window).on("ctm.call.start",function(e,n){if(window.Notification&&"granted"==Notification.permission){if("inbound"!=n.direction&&"outbound"!=n.direction)return;if("inbound"==n.direction&&0==$("#alert-call .dropdown-menu a[data-col=inbound] i.toggle.font-checkmark-2").length)return;if("outbound"==n.direction&&0==$("#alert-call .dropdown-menu a[data-col=outbound] i.toggle.font-checkmark-2").length)return;if(CTM.acl&&CTM.acl.tracking_number_ids&&CTM.acl.tracking_number_ids.length){for(var a=!1,i=CTM.acl.tracking_number_ids,r=0;r<i.length;r++)if(i[r]==n.tracking_number_id){a=!0;break}if(!a)return}var s=new Notification(("inbound"==n.direction?"Incoming":"Outbound")+" call",{"body":"Caller: "+n.caller_number,"icon":"inbound"==n.direction?t.inbound:t.outbound});s.addEventListener("click",function(){CallsTable.has(parseInt(n.id))?window.CallActions.toggle.apply($("#call-row-"+n.id).get(0)):"function"==typeof window.fetchCallAndRender&&window.fetchCallAndRender(n.id,function(){window.CallActions.toggle.apply($("#call-row-"+n.id).get(0))}),s.close()}),s&&setTimeout(function(){s.close()},8e3)}})}else $("#alert-call").hide()}function c(){$("#stop-calls").hasClass("pulsebutton")?$("#stop-calls").html("<i class='font-play'></i> <span class=\"hidden-sm hidden-md hidden-lg\">"+CTM.localize("Call","actions.toolbar.start-calls.label")+"</span>"):$("#stop-calls").html("<i class='font-stop'></i> <span class=\"hidden-sm hidden-md hidden-lg\">"+CTM.localize("Call","actions.toolbar.stop-calls.label")+"</span>")}$("#calls thead th.sortable").click(function(e){e.preventDefault();var t=$(this).find("> a[data-action]"),n=t.attr("data-action"),a=t.attr("data-col").replace(/-/g,"_");if("sort"==n){var i=$(this).attr("data-dir");i||(i="down"),($(this).hasClass("sort_asc")||$(this).hasClass("sort_desc"))&&(i="down"==i?"up":"down"),$(this).attr("data-dir",i),ColumnActions.applySortUI(a,"down"==i?"DESC":"ASC")}ColumnActions[n](a,"down"==i?"DESC":"ASC")}),$("#search-box").parent().find(".new-calls").data("count",0),$("#search-box").parent().find(".new-calls").data("calls",[]),$("#search-box").parent().find(".new-calls").click(function(e){e.preventDefault();var t=$(this).data("calls");$(this).data("count",0),
$(this).data("calls",[]),$(this).removeAttr("data-available"),t.forEach(function(e){"function"==typeof window.fetchCallAndRender&&window.fetchCallAndRender(e.id)})}),window.loadCallPanel=e,window.turnOnAutoLoadCalls=t,window.turnOffAutoLoadCalls=n,$(function(){var e=window.location.search;if(e.match(/autoload=0/))n();else if(e.match(/autoload=1/))t();else{var a=window.localStorage.getItem("auto-load-calls");("1"==a||null==a&&"1"==$.cookie("auto-load-calls")||CTM.deskmode||CTM.phonemode||$("body").hasClass("native"))&&t()}}),$("#call-stats .auto-load").click(function(e){e.preventDefault(),"manual"==$(this).attr("data-state")?t():n()});var d=null;$(window).on("ctm.socket.granted",function(){$("#call-counter").text("").removeAttr("data-available"),CTM.socket.emit("calls.active",{"account":CTM.account}),setTimeout(function(){a(CTM.socket)},4e3)}),$(window).on("ctm.socket.denied",function(){$("#call-counter").text("").removeAttr("data-available")}),$(window).on("ctm.call.active",function(e,t){var n=parseInt(t);n>0?$("#call-counter").text(n+" active").attr("data-available","1"):$("#call-counter").text("").removeAttr("data-available")}),$(window).on("ctm.call.complete",function(e,t){allowCallWithFilter(t)&&(CTM.socket.emit("calls.active",{"account":CTM.account}),i(t.id,t.call_start,!0,function(){}))}),$(window).on("ctm.call.queued",function(e,t){allowCallWithFilter(t)&&i(t.id,t.call_start,!0)}),$(window).on("ctm.call.update",function(e,t){allowCallWithFilter(t)&&i(t.id,t.call_start)}),$(window).on("ctm.call.answered",function(e,t){allowCallWithFilter(t)&&(t.agent_id!=CTM.user&&!r()||"function"!=typeof window.fetchCallAndRender||window.fetchCallAndRender(t.id,function(){},!0,t.call_start,!0))}),window.ShouldAutoLoad=r,$(window).on("ctm.call.start",function(e,t){window.AutoLoadCalls&&(allowCallWithFilter(t)?s(t)&&o(t):console.log("skip start by filter"))}),$(window).on("ctm.call.queued",function(e,t){allowCallWithFilter(t)}),$(window).on("ctm.record.sf.found",function(e,t){allowCallWithFilter(t)&&$.get("/salesforce/leadrec.json?call_id="+t.call_id,function(e){$(window).trigger("ctm.salesforce.record_found",{"call":t,"record":e})},"json")}),$(window).on("ctm.record.sf.notfound",function(e,t){allowCallWithFilter(t)&&$(window).trigger("ctm.salesforce.record_not_found",{"call":t})}),$(window).on("ctm.call.sf.lead",function(e,t){$(window).trigger("ctm.salesforce.lead_update",t)}),l(),c(),$("#stop-calls").click(function(e){e.preventDefault();var t=$(this),n=t.hasClass("pulsebutton"),a="/api/v1/accounts/"+CTM.account+"/agents/"+CTM.user,i="",r=!1;n?(i="<h3>"+CTM.localize("Call","actions.toolbar.start-calls.label")+"</h3><p>"+CTM.localize("Call","actions.toolbar.start-calls.message")+"</p>",a+="/accept_calls.json",r=!1):(i="<h3>"+CTM.localize("Call","actions.toolbar.stop-calls.label")+"</h3><p>"+CTM.localize("Call","actions.toolbar.stop-calls.message")+"</p>",a+="/reject_calls.json?UserAcceptNewCalls=1",r=!0),bootbox.confirm(i,function(e){e&&(r?(t.removeClass("acceptbutton"),t.addClass("pulsebutton"),$("body").addClass("not_here")):(t.removeClass("pulsebutton"),t.addClass("acceptbutton"),$("body").removeClass("not_here")),c(),$.post(a))})})}function prepareCustomField(e,t){if(!e)return{};var n={"field":e,"value":t};switch(e.field_type){case"picker":n.picker_values=e.picker_options.map(function(e){return{"label":e.label,"value":e.value,"selected":n.value&&n.value==(e.value||e.label)?" selected ":""}}),n.field_partial=HoganTemplates["custom_fields/picker"].render({"field":e,"picker_values":n.picker_values});break;case"rating":var a={},i=parseInt(n.value);i>=1&&i<=5?a["rating"+i]=" selected":a.rating0=" selected",n.field_partial=HoganTemplates["custom_fields/rating"].render({"value":n.value,"field":e,"ratings":a});break;case"bool":case"number":case"float":case"textarea":case"text":case"email":case"url":case"phone":case"date":case"duration":case"country":case"region":n.field_partial=HoganTemplates["custom_fields/"+e.field_type].render(n)}return n}function setupCustomFields(e,t,n){try{return CTM.meta.custom_fields.filter(function(t){return t.panel==e}).map(function(e){try{var a=null;"Call"==e.object_type?a=t.custom_fields:"Caller"!=e.object_type&&"Contact"!=e.object_type||(a=t.caller.custom_fields);var i=prepareCustomField(e,a&&a[e.api_name]||null);return n||(i.field_partial="<div class='field'>"+i.field_partial+"</div>"),i}catch(r){console.error(e,t,n,r)}})}catch(a){console.error(a)}}function prepareDependentFields(e,t){t&&"function"==typeof t.forEach&&t.forEach(function(t){t&&bindFieldDependencies(e,t.field)})}function bindFieldDependencies(e,t){if(t&&t.dependent_field_id>0){var n=$(e).find('label[data-field-id="'+t.dependent_field_id+'"]'),a=n.attr("data-field-type");switch(a){case"bool":(i=function(){$(e).find('label[data-field-id="'+t.id+'"]').closest(".col-md-6").toggle(n.parent().find("input.custom_field[type=checkbox]").bootstrapSwitch("state")),"function"==typeof resizeCallLog&&resizeCallLog()})(),n.parent().find("input.custom_field[type=checkbox]").bootstrapSwitch().on("switchChange.bootstrapSwitch",i);break;case"country":case"picker":case"rating":case"region":(i=function(){var a=n.parent().find("select.custom_field").val(),i=!1;i=("string"!=typeof a||""!=a)&&(t.dependent_field_value==a||!t.dependent_field_value&&!!a),$(e).find('label[data-field-id="'+t.id+'"]').closest(".col-md-6").toggle(i),"function"==typeof resizeCallLog&&resizeCallLog();var r=$("label[data-field-id="+t.id+"]").next();r&&!i&&(r.hasClass("select2-container")?$("label[data-field-id="+t.id+"]").parent().find("select.custom_field").select2("val",null).trigger("input").trigger("change"):r.val("").trigger("input").trigger("change"))})(),n.parent().find("select.custom_field").on("change",i);break;case"text":case"textarea":case"number":case"float":case"date":case"duration":case"email":case"phone":var i;(i=function(){let a=n.parent().find("input.custom_field").val(),i=$(e).find('label[data-field-id="'+t.id+'"]').closest(".col-md-6");if(a.length&&(t.dependent_field_value==a||!t.dependent_field_value&&a))i.show();else{i.hide();let e=$("label[data-field-id="+t.id+"]").next();e&&e.val("").trigger("input").trigger("change")}"function"==typeof resizeCallLog&&resizeCallLog()})(),n.parent().find("input.custom_field").on("input",i);break;default:a&&console.warn("unknown field type: ",a)}}}function _MultipleSelection_(e){console.log("selected ids:",e),$(".bootbox.modal").data("ids",e)}function _SelectionWindowReady_(){$("#selection-loader").remove()}function setupSelect(e,t,n,a,i){function r(){var e=$(this);if($(a).val(e.val()),i.editURL){s||(e.after(" <a target='_blank' href='#' class='edit-url'>"+CTM.localize("Object","actions.edit.short_label").toLowerCase()+"</a>"),s=!0);var t=e.next(),n=e.select2("data");!e.val()||n&&n.missing?t.hide():(t.attr("href",i.editURL.replace(":id",e.val())),t.show())}}i||(i={});var s=!1,o="email"==t||"contact_number"==t||"tag"==t;return e.select2({"placeholder":"Search for a "+n,"minimumInputLength":0,"multiple":!1,"ajax":{"url":"/api/v1/lookup.json","dataType":"json","data":function(e,n){return{"search":e,"object_type":t,"page":n,"nocount":1,"descriptions":1}},"results":function(e){return{"results":e.results.map(function(e){return{"text":e.text,"id":e.id,"description":e.description,"pic_url":e.pic_url}}),"more":e.results.length>=e.per_page}}},"formatResult":formatStandardResult,"formatSelection":formatStandardResult,"initSelection":function(e,n){var a=$(e).val();""!==a&&($.get("/api/v1/lookupid.json",$.extend(i,{"object_type":t,"object_id":a,"descriptions":1}),function(e){e.id||(e.text=o?e.id:"Deleted",e.missing=!0,e.missing_object=!o),n(e)}),r.apply(e))}}).on("change",r)}function updateSelect(e,t,n,a,i,r){var s="",o="";switch(t){case"voice_mail":s="voice mail",o="VoiceMail",editURL="";break;case"voice_menu":s="voice menu",o="VoiceMenu",editURL="/voice_menus/:id/edit";break;case"receiving_number":s="receiving number",o="PhysicalPhoneNumber",editURL="/receiving_numbers/:id/edit_number";break;case"call_queue":s="call queue",o="CallQueue",editURL="/queues/:id/edit";break;case"agent":case"call_agent":t="agent",s="call agent",o="User",editURL="/account_users/:id/edit";break;case"geo_config":s="geo router",o="GeoConfig",editURL="/geo_routes/:id/edit";break;case"conditional_router":s="smart router",o="ConditionalRouter",editURL="/conditional_routers/:id/edit";break;case"dialer":s="dialer",o="Dialer",editURL="/dialers/:id/edit";break;case"target_number":s="target number",o="TargetNumber",editURL="/target_numbers/:id/edit";break;case"form_reactor":s="FormReactor",o="FormReactor",editURL="/form_reactors/:id/edit";break;case"call_script":s="call script",o="CallScript",editURL="/call_scripts/:id/edit";break;case"notification":s="notification",o="Notification",editURL="/notifications/:id/edit";break;case"price_schedule":s="price markup",o="PriceSchedule",editURL="/price_schedules/:id/edit";break;case"signup_page":s="signup page",o="SignupPage",editURL="/signup_pages/:id/edit";break;case"call_sale":$(n).val("PostCallSurvey");default:return console.log("default unknown: ",t),$(e).html(""),void $(e).hide()}$(e).show();var l=$(e);return l.html(Mustache.to_html('<input type="text" class="selector standard-width" {{#value}}value="{{value}}"{{/value}}/>',{"value":i})),$(n).val(o),i||$(a).val(""),editURL&&(r||(r={}),r.editURL=editURL),setupSelect(l.find("input.selector"),t,s,a,r)}function initScheduleSelect(){var e=$(this).val();$("#schedule-options").toggle(!(!e||""==e))}function addErrors(e,t,n){var a,i='{{#errors.0}}<ul class="error messages">{{#errors}}<li>{{.}}</li>{{/errors}}</ul>{{/errors.0}}{{#warnings.0}}<ul class="warning messages">{{#warnings}}<li>{{.}}</li>{{/warnings}}</ul>{{/warnings.0}}',r="CITE"==e.next().prop("tagName")||e.next().hasClass("edit-url")?e.next():e;r.parent().hasClass("bootstrap-switch-container")?(e=r=r.closest(".bootstrap-switch"),(r=r.next()).hasClass("bootstrap-switch-spacer")&&(r=r.next())):r.parent().hasClass("say_upload")?e=r=r.parent():e.prev().hasClass("time-unit-picker")?e=e.prev():"show-preset"==r.next().attr("id")?r=r.next():(a=e.closest(".phone-picker-2")).length?e=a.find(".select2-container, .phone-input-control"):e.prev().hasClass("state-region-picker")&&(e=e.prev().find(".select2-container")),r.after(Mustache.to_html(i,{"errors":t,"warnings":n})),t&&t.length&&e.addClass("error"),n&&n.length&&e.addClass("warning")}function clearErrors(e){e.find(".error.messages, .warning.messages").remove(),e.find(".error").each(function(){$(this).removeClass("error")}),e.find(".warning").each(function(){$(this).removeClass("warning")})}function formResponse(e,t,n){var a=e.attr("id"),i=!1;if(t&&t.errors&&Object.keys(t.errors).length)if(Object.keys(t.errors).forEach(function(n){addErrors(e.find(" "==n[0]?n:"#"+a+"_"+n),t.errors[n])}),i=!0,$(".error:visible").length&&"undefined"!=typeof smoothScrollToElem)smoothScrollToElem($($(".error:visible")[0]));else{var r=[];Object.keys(t.errors).forEach(function(e){r.push(e+":<ul><li>"+$.map(t.errors[e],function(e){return escapeHtml(e)}).join("</li><li>")+"</li></ul>")}),!0===n&&ctmFlash("Could not save changes: <ul><li>"+r.join("</li><li>")+"</li></ul>","error","",!0)}t&&t.warnings&&Object.keys(t.warnings).length&&Object.keys(t.warnings).forEach(function(n){addErrors(e.find(" "==n[0]?n:"#"+a+"_"+n),[],t.warnings[n])}),i||!0!==n||ctmFlash("Saved changes successfully.")}function ctmSave(){function e(e,t){e.find(".indicator-loop").addClass("show-loop"),e.find(".indicator-loop .save").addClass("font-spinner-2 icon-loop-repeat"),e.prop("disabled",!0),e.addClass("disabled"),e.data("original_text",e.find("span").html()),e.find("span").html(t)}function t(e){e.find(".indicator-loop .save").removeClass("font-spinner-2 icon-loop-repeat"),e.find(".indicator-loop").removeClass("show-loop"),e.prop("disabled",!1),e.removeClass("disabled");var t=e.data("original_text");e.find("span").html(t)}var n=[];for(var a in arguments)n.push(arguments[a]);var i="Saving...",r=n.shift();if("string"==typeof r||"FORM"==r.tagName){$("string"==typeof r?r:".save-button").each(function(){e($(this),i)}),(s=$.post.apply($,n)).always(function(){setTimeout(function(){$("string"==typeof r?r:".save-button").each(function(){t($(this))})},800)})}else{var s,o=$(r);e(o,i),(s=$.post.apply($,n)).always(function(){setTimeout(function(){t(o)},800)})}return s}function enableScrollNav(){$("body").scrollspy({"offset":130,"target":"nav.pagenav"}),$("body").scrollspy("refresh"),$(window).on("load",function(){$("body").scrollspy("refresh")})}function displayEditList(e,t,n,a,i,r,s,o,l,c,d){void 0===d&&(d={}),bootbox.dialog({"title":o,"message":"<div class='edit-list-message' style='width:100%'><div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%'><span class='sr-only'>"+CTM.localize("Object","actions.loading.short_label")+"</span></div></div></div>","buttons":{"cancel":{"label":d.cancel_label||CTM.localize("Object","actions.cancel.short_label"),"className":"btn-default"+(d.cancel_class?" "+d.cancel_class:""),"callback":d.cancel_callback||function(){}},"success":{"label":d.save_label||CTM.localize("Object","actions.save_changes.label"),"className":"btn-success guide-save-changes"+(d.save_class?" "+d.save_class:""),"callback":function(){var i={"updateErrorLabel":"You must save the "+n+" before assigning a "+l,"idsSelector":$(r),"url":"/api/v1/accounts/"+CTM.account+"/"+n+"s/"+e+".json","idParam":s};handleSaveMultiSelect($(t),$(t).hasClass("edit_"+a.replace(/s$/,"")),i),c&&$(c).text(CTM.localize("Object","extra.assigned",{"count":($(r).val()||[]).length})),"function"==typeof d.save_callback&&d.save_callback()}}}}),$(".modal-footer").hide(),$.get("/api/v1/accounts/"+CTM.account+"/"+n+"s/"+e+"/"+i+".json",function(e){e.selection=markSelections(e);var n=null;try{n=HoganTemplates[a+"/"+i].render(e)}catch(s){console.error("Template Error:",a+"/"+i," with: ",e),n="<p>Error Loading</p>"}$(".edit-list-message").html(n),$(".modal-footer").show();var r=t.replace(/#/,"").replace(/-/,"_");multiSelector(".multiple-list.numbers","ms-"+r+"_"+i,"Available "+l,"Assigned "+l,{"clickToActivate":!1}),"function"==typeof d.callback&&d.callback()})}function markSelections(e){var t={};return e.assigned.forEach(function(e){t[e]=!0}),e.available.map(function(e){return{"id":e[1],"selected":t[e[1]]?" selected ":"","name":(e[2]||{}).text||e[0],"description":(e[2]||{}).description,"initials":(e[2]||{}).initials,"pic_url":(e[2]||{}).pic_url,"icon":(e[2]||{}).icon}})}function handleSaveMultiSelect(e,t,n){if(t){var a={};a[n.idParam]=n.idsSelector.val(),console.log("save with options:",a),$.ajax({"url":n.url,"method":"PUT","data":JSON.stringify(a),"contentType":"application/json","success":function(){bootbox.hideAll(),CTM.current_history&&CTM.current_history.fetch()}})}else bootbox.alert(n.updateErrorLabel)}function MagicType(e){"use strict";return e&&e.length>1?255===e[0]&&216===e[1]&&255===e[2]?{"ext":"jpg","mime":"image/jpeg"}:137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]?{"ext":"png","mime":"image/png"}:71===e[0]&&73===e[1]&&70===e[2]?{"ext":"gif","mime":"image/gif"}:87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]?{"ext":"webp","mime":"image/webp"}:70===e[0]&&76===e[1]&&73===e[2]&&70===e[3]?{"ext":"flif","mime":"image/flif"}:(73===e[0]&&73===e[1]&&42===e[2]&&0===e[3]||77===e[0]&&77===e[1]&&0===e[2]&&42===e[3])&&67===e[8]&&82===e[9]?{"ext":"cr2","mime":"image/x-canon-cr2"}:73===e[0]&&73===e[1]&&42===e[2]&&0===e[3]||77===e[0]&&77===e[1]&&0===e[2]&&42===e[3]?{"ext":"tif","mime":"image/tiff"}:66===e[0]&&77===e[1]?{"ext":"bmp","mime":"image/bmp"}:73===e[0]&&73===e[1]&&188===e[2]?{"ext":"jxr","mime":"image/vnd.ms-photo"}:56===e[0]&&66===e[1]&&80===e[2]&&83===e[3]?{"ext":"psd","mime":"image/vnd.adobe.photoshop"}:80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]&&109===e[30]&&105===e[31]&&109===e[32]&&101===e[33]&&116===e[34]&&121===e[35]&&112===e[36]&&101===e[37]&&97===e[38]&&112===e[39]&&112===e[40]&&108===e[41]&&105===e[42]&&99===e[43]&&97===e[44]&&116===e[45]&&105===e[46]&&111===e[47]&&110===e[48]&&47===e[49]&&101===e[50]&&112===e[51]&&117===e[52]&&98===e[53]&&43===e[54]&&122===e[55]&&105===e[56]&&112===e[57]?{"ext":"epub","mime":"application/epub+zip"}:80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]&&77===e[30]&&69===e[31]&&84===e[32]&&65===e[33]&&45===e[34]&&73===e[35]&&78===e[36]&&70===e[37]&&47===e[38]&&109===e[39]&&111===e[40]&&122===e[41]&&105===e[42]&&108===e[43]&&108===e[44]&&97===e[45]&&46===e[46]&&114===e[47]&&115===e[48]&&97===e[49]?{"ext":"xpi","mime":"application/x-xpinstall"}:80!==e[0]||75!==e[1]||3!==e[2]&&5!==e[2]&&7!==e[2]||4!==e[3]&&6!==e[3]&&8!==e[3]?117===e[257]&&115===e[258]&&116===e[259]&&97===e[260]&&114===e[261]?{"ext":"tar","mime":"application/x-tar"}:82!==e[0]||97!==e[1]||114!==e[2]||33!==e[3]||26!==e[4]||7!==e[5]||0!==e[6]&&1!==e[6]?31===e[0]&&139===e[1]&&8===e[2]?{"ext":"gz","mime":"application/gzip"}:66===e[0]&&90===e[1]&&104===e[2]?{"ext":"bz2","mime":"application/x-bzip2"}:55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?{"ext":"7z","mime":"application/x-7z-compressed"}:120===e[0]&&1===e[1]?{"ext":"dmg","mime":"application/x-apple-diskimage"}:0===e[0]&&0===e[1]&&0===e[2]&&(24===e[3]||32===e[3])&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]||51===e[0]&&103===e[1]&&112===e[2]&&53===e[3]||0===e[0]&&0===e[1]&&0===e[2]&&28===e[3]&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]&&109===e[8]&&112===e[9]&&52===e[10]&&50===e[11]&&109===e[16]&&112===e[17]&&52===e[18]&&49===e[19]&&109===e[20]&&112===e[21]&&52===e[22]&&50===e[23]&&105===e[24]&&115===e[25]&&111===e[26]&&109===e[27]||0===e[0]&&0===e[1]&&0===e[2]&&28===e[3]&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]&&105===e[8]&&115===e[9]&&111===e[10]&&109===e[11]||0===e[0]&&0===e[1]&&0===e[2]&&28===e[3]&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]&&109===e[8]&&112===e[9]&&52===e[10]&&50===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&0===e[15]?{"ext":"mp4","mime":"video/mp4"}:0===e[0]&&0===e[1]&&0===e[2]&&28===e[3]&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]&&77===e[8]&&52===e[9]&&86===e[10]?{"ext":"m4v","mime":"video/x-m4v"}:77===e[0]&&84===e[1]&&104===e[2]&&100===e[3]?{"ext":"mid","mime":"audio/midi"}:109===e[31]&&97===e[32]&&116===e[33]&&114===e[34]&&111===e[35]&&115===e[36]&&107===e[37]&&97===e[38]?{"ext":"mkv","mime":"video/x-matroska"}:26===e[0]&&69===e[1]&&223===e[2]&&163===e[3]?{"ext":"webm","mime":"video/webm"}:0===e[0]&&0===e[1]&&0===e[2]&&20===e[3]&&102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]?{"ext":"mov","mime":"video/quicktime"}:82===e[0]&&73===e[1]&&70===e[2]&&70===e[3]&&65===e[8]&&86===e[9]&&73===e[10]?{"ext":"avi","mime":"video/x-msvideo"}:48===e[0]&&38===e[1]&&178===e[2]&&117===e[3]&&142===e[4]&&102===e[5]&&207===e[6]&&17===e[7]&&166===e[8]&&217===e[9]?{"ext":"wmv","mime":"video/x-ms-wmv"}:0===e[0]&&0===e[1]&&1===e[2]&&"b"===e[3].toString(16)[0]?{"ext":"mpg","mime":"video/mpeg"}:73===e[0]&&68===e[1]&&51===e[2]||255===e[0]&&(!0&e[1]||!1&e[1])?{"ext":"mp3","mime":"audio/mpeg"}:102===e[4]&&116===e[5]&&121===e[6]&&112===e[7]&&77===e[8]&&52===e[9]&&65===e[10]||77===e[0]&&52===e[1]&&65===e[2]&&32===e[3]?{"ext":"m4a","mime":"audio/m4a"}:79===e[28]&&112===e[29]&&117===e[30]&&115===e[31]&&72===e[32]&&101===e[33]&&97===e[34]&&100===e[35]?{"ext":"opus","mime":"audio/opus"}:79===e[0]&&103===e[1]&&103===e[2]&&83===e[3]?{"ext":"ogg","mime":"audio/ogg"}:102===e[0]&&76===e[1]&&97===e[2]&&67===e[3]?{"ext":"flac","mime":"audio/x-flac"}:82===e[0]&&73===e[1]&&70===e[2]&&70===e[3]&&87===e[8]&&65===e[9]&&86===e[10]&&69===e[11]?{"ext":"wav","mime":"audio/x-wav"}:35===e[0]&&33===e[1]&&65===e[2]&&77===e[3]&&82===e[4]&&10===e[5]?{"ext":"amr","mime":"audio/amr"}:37===e[0]&&80===e[1]&&68===e[2]&&70===e[3]?{"ext":"pdf","mime":"application/pdf"}:77===e[0]&&90===e[1]?{"ext":"exe","mime":"application/x-msdownload"}:67!==e[0]&&70!==e[0]||87!==e[1]||83!==e[2]?123===e[0]&&92===e[1]&&114===e[2]&&116===e[3]&&102===e[4]?{"ext":"rtf","mime":"application/rtf"}:119===e[0]&&79===e[1]&&70===e[2]&&70===e[3]&&(0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]||79===e[4]&&84===e[5]&&84===e[6]&&79===e[7])?{"ext":"woff","mime":"application/font-woff"}:119===e[0]&&79===e[1]&&70===e[2]&&50===e[3]&&(0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]||79===e[4]&&84===e[5]&&84===e[6]&&79===e[7])?{"ext":"woff2","mime":"application/font-woff"}:76===e[34]&&80===e[35]&&(0===e[8]&&0===e[9]&&1===e[10]||1===e[8]&&0===e[9]&&2===e[10]||2===e[8]&&0===e[9]&&2===e[10])?{"ext":"eot","mime":"application/octet-stream"}:0===e[0]&&1===e[1]&&0===e[2]&&0===e[3]&&0===e[4]?{"ext":"ttf","mime":"application/font-sfnt"}:79===e[0]&&84===e[1]&&84===e[2]&&79===e[3]&&0===e[4]?{"ext":"otf","mime":"application/font-sfnt"}:0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?{"ext":"ico","mime":"image/x-icon"}:70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]?{"ext":"flv","mime":"video/x-flv"}:37===e[0]&&33===e[1]?{"ext":"ps","mime":"application/postscript"}:253===e[0]&&55===e[1]&&122===e[2]&&88===e[3]&&90===e[4]&&0===e[5]?{"ext":"xz","mime":"application/x-xz"}:83===e[0]&&81===e[1]&&76===e[2]&&105===e[3]?{"ext":"sqlite","mime":"application/x-sqlite3"}:78===e[0]&&69===e[1]&&83===e[2]&&26===e[3]?{"ext":"nes","mime":"application/x-nintendo-nes-rom"}:67===e[0]&&114===e[1]&&50===e[2]&&52===e[3]?{"ext":"crx","mime":"application/x-google-chrome-extension"}:77===e[0]&&83===e[1]&&67===e[2]&&70===e[3]||73===e[0]&&83===e[1]&&99===e[2]&&40===e[3]?{"ext":"cab","mime":"application/vnd.ms-cab-compressed"}:33===e[0]&&60===e[1]&&97===e[2]&&114===e[3]&&99===e[4]&&104===e[5]&&62===e[6]&&10===e[7]&&100===e[8]&&101===e[9]&&98===e[10]&&105===e[11]&&97===e[12]&&110===e[13]&&45===e[14]&&98===e[15]&&105===e[16]&&110===e[17]&&97===e[18]&&114===e[19]&&121===e[20]?{"ext":"deb","mime":"application/x-deb"}:33===e[0]&&60===e[1]&&97===e[2]&&114===e[3]&&99===e[4]&&104===e[5]&&62===e[6]?{"ext":"ar","mime":"application/x-unix-archive"}:237===e[0]&&171===e[1]&&238===e[2]&&219===e[3]?{"ext":"rpm","mime":"application/x-rpm"}:31===e[0]&&160===e[1]||31===e[0]&&157===e[1]?{"ext":"Z","mime":"application/x-compress"}:76===e[0]&&90===e[1]&&73===e[2]&&80===e[3]?{"ext":"lz","mime":"application/x-lzip"}:208===e[0]&&207===e[1]&&17===e[2]&&224===e[3]&&161===e[4]&&177===e[5]&&26===e[6]&&225===e[7]?{"ext":"msi","mime":"application/x-msi"}:null:{"ext":"swf","mime":"application/x-shockwave-flash"}:{"ext":"rar","mime":"application/x-rar-compressed"}:{"ext":"zip","mime":"application/zip"}:null}function addEmptyLabel(e){var t=e.text();e.find(".place-holder").length||!t?e.html("<span class='place-holder'>"+CTM.localize("Object","properties.description.label")+"</span>"):e.find(".place-holder").remove()}function initInlineEdit(e,t){var n=e.attr("data-save"),a=e.find(".desc"),i=(n=e.attr("data-save"),null);addEmptyLabel(a),e.find(".desc, > span:last-child").click(function(e){if(e.preventDefault(),e.stopPropagation(),!a.hasClass("editing")&&!a.hasClass("saving")){var r="";a.find(".place-holder").remove(),a.addClass("editing").html("<span>"+escapeHtml(a.text())+'</span><input style="position:absolute;left:1px;top:1px;width:100%;height:calc(100% - 2px)" onclick="event.stopPropagation()"/>'),a.find("input").val(a.find("span").text()).on("focus",function(){$(this).select(),r=a.find("span").text(),i&&(clearTimeout(i),i=null)}).on("keydown",function(e){return 10==e.which||13==e.which?(a.removeClass("editing"),void $(this).blur()):27==e.which?(a.removeClass("editing"),void $(this).val(r).trigger("input").blur()):void 0}).on("blur",function(){var e=$(this).val();if(a.text(e),addEmptyLabel(a),e==r)return"function"==typeof t&&t(r,!1),void(i=setTimeout(function(){a.removeClass("editing")},800));a.addClass("saving"),a.next(".inline-edit-icon").addClass("icon-loop-repeat"),$.post(n,{"value":e},function(){"function"==typeof t&&t(e,!0)}).fail(function(){a.text(r),a.addClass("error"),setTimeout(function(){a.removeClass("error")},800),"function"==typeof t&&t(r,!1)}).always(function(){i=setTimeout(function(){a.removeClass("saving editing"),a.next(".inline-edit-icon").removeClass("icon-loop-repeat")},250)})}).on("input",function(){a.find("span").text($(this).val())}).focus()}})}function ZendeskApiClient(e){this.hostname=e.hostname,this.username=e.username,this.apiToken=e.apiToken,this.password=e.password}function buildAuthString(e){return e.apiToken?(e.username+"/token",e.apiToken):e.username+":"+e.password}function buildRequestOptions(e,t){var n=t.headers||{};return n.Accept="application/json",{"hostname":e.hostname,"type":t.method,"url":e.hostname+t.url,"headers":n,"cache":!1,"headers":{"Authorization":"Bearer "+buildAuthString(e)}}}function sendRequest(e,t){$.ajax(e).done(function(e){t(e,null)}).fail(function(e,n,a){t(null,a)})}function LambdaCustomPanelMessage(e){function t(e){return new Promise(function(t,n){$.get("/api/v1/accounts/"+CTM.account+"/lambdas/"+e+"/arn.json",function(e){t(e)}).fail(function(){n()})})}if(e.origin.match(/tctm.co|ctmbizapp.co/)){var n=parseInt($("tr.call-edit.showing").attr("id").replace(/call-/,""));switch(console.log("LambdaCustomPanelMessage:",n,e.data),e.data.type){case"lambda":let a=[$.get(`/api/v1/accounts/${CTM.account}/calls/${n}.json`)];const i=CTM.sf&&CTM.sf.on;i&&(a.push($.get(`/api/v1/accounts/${CTM.account}/salesforce/access_token_for_lambda`)),console.log("fetching sf data")),$.when.apply($,a).done(function(n,a){let r=i?n[0]:n,s={"type":"context","payload":{"auth_cap_token":$.cookie("ctm_auth_cap"),"dark":$("html.dark").length>0,"salesforce":i&&a?a[0]:null,"activity":r}};t(e.data.id).then(function(t){s.payload.arn=t.arn,s.payload.debug="debug"==t.mode,console.log("post context:",s.payload),e.source.postMessage(s,e.origin)})["catch"](function(){bootbox.alert("unable to locate your lambda function check that it is still configured")})});break;case"api.invoke":console.log("invoke",e.data),t(e.data.lambda).then(function(t){$.get("/api/v1/accounts/"+CTM.account+"/calls/"+n+".json",function(n){console.log("execute: ",t.arn,e.data);var a={"type":"api.invoke","id":e.data.id,"payload":{"debug":"debug"==t.mode,"activity":n,"arn":t.arn,"dark":$("html.dark").length>0,"auth_cap_token":$.cookie("ctm_auth_cap"),"options":e.data.data}};e.source.postMessage(a,e.origin)})})["catch"](function(){bootbox.alert("unable to locate your lambda function check that it is still configured")});break;case"api.save":console.log("save",e.data),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/modify.json",e.data.data,function(t){var n={"type":"api.save.status","id":e.data.id,"success":!0,"payload":{"response":t}};e.source.postMessage(n,e.origin)}).fail(function(t){data={"type":"api.save.status","id":e.data.id,"success":!1,"payload":{"response":t}},e.source.postMessage(data,e.origin)})}}else console.warn("not for us:",e)}function capitaliseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function GetSelectedText(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:""}Date.ext={},
//! Utility methods
Date.ext.util={},Date.ext.util.xPad=function(e,t,n){for(void 0===n&&(n=10);parseInt(e,10)<n&&n>1;n/=10)e=t.toString()+e;return e.toString()},Date.prototype.locale="en-GB",
//! \cond FALSE
document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang&&(Date.prototype.locale=document.getElementsByTagName("html")[0].lang),
//! \endcond
Date.ext.locales={},Date.ext.locales.en={"a":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"A":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"b":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"B":["January","February","March","April","May","June","July","August","September","October","November","December"],"c":"%a %d %b %Y %T %Z","p":["AM","PM"],"P":["am","pm"],"x":"%d/%m/%y","X":"%T"},
//! \cond FALSE
Date.ext.locales["en-US"]=Date.ext.locales.en,Date.ext.locales["en-US"].c="%a %d %b %Y %r %Z",Date.ext.locales["en-US"].x="%D",Date.ext.locales["en-US"].X="%r",Date.ext.locales["en-GB"]=Date.ext.locales.en,Date.ext.locales["en-AU"]=Date.ext.locales["en-GB"],
//! \endcond
//! \brief List of supported format specifiers.
Date.ext.formats={"a":function(e){return Date.ext.locales[e.locale].a[e.getDay()]},"A":function(e){return Date.ext.locales[e.locale].A[e.getDay()]},"b":function(e){return Date.ext.locales[e.locale].b[e.getMonth()]},"B":function(e){return Date.ext.locales[e.locale].B[e.getMonth()]},"c":"toLocaleString","C":function(e){return Date.ext.util.xPad(parseInt(e.getFullYear()/100,10),0)},"d":["getDate","0"],"e":["getDate"," "],"g":function(e){return Date.ext.util.xPad(parseInt(Date.ext.util.G(e)/100,10),0)},"G":function(e){var t=e.getFullYear(),n=parseInt(Date.ext.formats.V(e),10),a=parseInt(Date.ext.formats.W(e),10);return a>n?t++:0===a&&n>=52&&t--,t},"H":["getHours","0"],"I":function(e){var t=e.getHours()%12;return Date.ext.util.xPad(0===t?12:t,0)},"j":function(e){var t=e-new Date(e.getFullYear()+"/1/1 GMT");t+=6e4*e.getTimezoneOffset();var n=parseInt(t/6e4/60/24,10)+1;return Date.ext.util.xPad(n,0,100)},"m":function(e){return Date.ext.util.xPad(e.getMonth()+1,0)},"M":["getMinutes","0"],"p":function(e){return Date.ext.locales[e.locale].p[e.getHours()>=12?1:0]},"P":function(e){return Date.ext.locales[e.locale].P[e.getHours()>=12?1:0]},"S":["getSeconds","0"],"u":function(e){var t=e.getDay();return 0===t?7:t},"U":function(e){var t=parseInt(Date.ext.formats.j(e),10),n=6-e.getDay(),a=parseInt((t+n)/7,10);return Date.ext.util.xPad(a,0)},"V":function(e){var t=parseInt(Date.ext.formats.W(e),10),n=new Date(e.getFullYear()+"/1/1").getDay(),a=t+(n>4||n<=1?0:1);return 53==a&&new Date(e.getFullYear()+"/12/31").getDay()<4?a=1:0===a&&(a=Date.ext.formats.V(new Date(e.getFullYear()-1+"/12/31"))),Date.ext.util.xPad(a,0)},"w":"getDay","W":function(e){var t=parseInt(Date.ext.formats.j(e),10),n=7-Date.ext.formats.u(e),a=parseInt((t+n)/7,10);return Date.ext.util.xPad(a,0,10)},"y":function(e){return Date.ext.util.xPad(e.getFullYear()%100,0)},"Y":"getFullYear","z":function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+Date.ext.util.xPad(parseInt(Math.abs(t/60),10),0)+Date.ext.util.xPad(t%60,0)},"Z":function(e){return e.toString().replace(/^.*\(([^)]+)\)$/,"$1")},"%":function(){return"%"}},Date.ext.aggregates={"c":"locale","D":"%m/%d/%y","h":"%b","n":"\n","r":"%I:%M:%S %p","R":"%H:%M","t":"\t","T":"%H:%M:%S","x":"locale","X":"locale"},
//! \cond FALSE
Date.ext.aggregates.z=Date.ext.formats.z(new Date),Date.ext.aggregates.Z=Date.ext.formats.Z(new Date),
//! \endcond
//! List of unsupported format specifiers.
Date.ext.unsupported={},Date.prototype.strftime=function(e){this.locale in Date.ext.locales||(this.locale.replace(/-[a-zA-Z]+$/,"")in Date.ext.locales?this.locale=this.locale.replace(/-[a-zA-Z]+$/,""):this.locale="en-GB");for(var t=this;e.match(/%[cDhnrRtTxXzZ]/);)e=e.replace(/%([cDhnrRtTxXzZ])/g,function(e,n){var a=Date.ext.aggregates[n];return"locale"==a?Date.ext.locales[t.locale][n]:a});var n=e.replace(/%([aAbBCdegGHIjmMpPSuUVwWyY%])/g,function(e,n){var a=Date.ext.formats[n];return"string"==typeof a?t[a]():"function"==typeof a?a.call(t,t):"object"==typeof a&&"string"==typeof a[0]?Date.ext.util.xPad(t[a[0]](),a[1]):n});return t=null,n};
/*!
 *
 * MediaElement.js
 * HTML5 <video> and <audio> shim and player
 * http://mediaelementjs.com/
 *
 * Creates a JavaScript object that mimics HTML5 MediaElement API
 * for browsers that don't understand HTML5 or can't play the provided codec
 * Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
 *
 * Copyright 2010-2014, John Dyer (http://j.hn)
 * License: MIT
 *
 * see: https://raw.githubusercontent.com/mediaelement/mediaelement/b78c8e9416b1ba9d8be3de9417fbb7eda95a6b59/build/mediaelement-and-player.js
 * see: browse files here: https://github.com/mediaelement/mediaelement/tree/b78c8e9416b1ba9d8be3de9417fbb7eda95a6b59
 *
 */
var mejs=mejs||{};mejs.version="2.23.5",mejs.meIndex=0,mejs.plugins={"silverlight":[{"version":[3,0],"types":["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],"flash":[{"version":[9,0,124],"types":["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mp4","audio/mpeg","video/dailymotion","video/x-dailymotion","application/x-mpegURL","audio/ogg"]}],"youtube":[{"version":null,"types":["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],"vimeo":[{"version":null,"types":["video/vimeo","video/x-vimeo"]}]},mejs.Utility={"encodeUrl":function(e){return encodeURIComponent(e)},"escapeHTML":function(e){return e.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},"absolutizeUrl":function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this.escapeHTML(e)+'">x</a>',t.firstChild.href},"getScriptPath":function(e){for(var t,n,a,i,r,s=0,o="",l="",c=document.getElementsByTagName("script"),d=c.length,u=e.length;s<d;s++){for((n=(a=c[s].src).lastIndexOf("/"))>-1?(r=a.substring(n+1),i=a.substring(0,n+1)):(r=a,i=""),t=0;t<u;t++)if(l=e[t],r.indexOf(l)>-1){o=i;break}if(""!==o)break}return o},"calculateTimeFormat":function(e,t,n){e<0&&(e=0),void 0===n&&(n=25);var a=t.timeFormat,i=a[0],r=a[1]==a[0],s=r?2:1,o=":",l=Math.floor(e/3600)%24,c=Math.floor(e/60)%60,d=Math.floor(e%60),u=[[Math.floor((e%1*n).toFixed(3)),"f"],[d,"s"],[c,"m"],[l,"h"]];a.length<s&&(o=a[s]);for(var p=!1,f=0,b=u.length;f<b;f++)if(-1!==a.indexOf(u[f][1]))p=!0;else if(p){for(var h=!1,m=f;m<b;m++)if(u[m][0]>0){h=!0;break}if(!h)break;r||(a=i+a),a=u[f][1]+o+a,r&&(a=u[f][1]+a),i=u[f][1]}t.currentTimeFormat=a},"twoDigitsString":function(e){return e<10?"0"+e:String(e)},"secondsToTimeCode":function(e,t){if(e<0&&(e=0),"object"!=typeof t){var n="m:ss";n=arguments[1]?"hh:mm:ss":n,t={"currentTimeFormat":n=arguments[2]?n+":ff":n,"framesPerSecond":arguments[3]||25}}var a=t.framesPerSecond;void 0===a&&(a=25);n=t.currentTimeFormat;var r=Math.floor(e/3600)%24,s=Math.floor(e/60)%60,o=Math.floor(e%60),l=Math.floor((e%1*a).toFixed(3));lis=[[l,"f"],[o,"s"],[s,"m"],[r,"h"]];var c=n;for(i=0,len=lis.length;i<len;i++)c=(c=c.replace(lis[i][1]+lis[i][1],this.twoDigitsString(lis[i][0]))).replace(lis[i][1],lis[i][0]);return c},"timeCodeToSeconds":function(e,t,n,a){void 0===n?n=!1:void 0===a&&(a=25);var i=e.split(":"),r=parseInt(i[0],10),s=parseInt(i[1],10),o=parseInt(i[2],10),l=0;return n&&(l=parseInt(i[3])/a),3600*r+60*s+o+l},"convertSMPTEtoSeconds":function(e){if("string"!=typeof e)return!1;var t=0,n=-1!=(e=e.replace(",",".")).indexOf(".")?e.split(".")[1].length:0,a=1;e=e.split(":").reverse();for(var i=0;i<e.length;i++)a=1,i>0&&(a=Math.pow(60,i)),t+=Number(e[i])*a;return Number(t.toFixed(n))},"removeSwf":function(e){var t=document.getElementById(e);t&&/object|embed/i.test(t.nodeName)&&(mejs.MediaFeatures.isIE?(t.style.display="none",function(){4==t.readyState?mejs.Utility.removeObjectInIE(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))},"removeObjectInIE":function(e){var t=document.getElementById(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}},"determineScheme":function(e){return e&&-1!=e.indexOf("://")?e.substr(0,e.indexOf("://")+3):"//"},"debounce":function(e,t,n){var a;return function(){var i=this,r=arguments,s=function(){a=null,n||e.apply(i,r)},o=n&&!a;clearTimeout(a),a=setTimeout(s,t),o&&e.apply(i,r)}},"isNodeAfter":function(e,t){return!!(e&&t&&"function"==typeof e.compareDocumentPosition&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)}},mejs.PluginDetector={"hasPluginVersion":function(e,t){var n=this.plugins[e];return t[1]=t[1]||0,t[2]=t[2]||0,n[0]>t[0]||n[0]==t[0]&&n[1]>t[1]||n[0]==t[0]&&n[1]==t[1]&&n[2]>=t[2]},"nav":window.navigator,"ua":window.navigator.userAgent.toLowerCase(),"plugins":[],"addPlugin":function(e,t,n,a,i){this.plugins[e]=this.detectPlugin(t,n,a,i)},"detectPlugin":function(e,t,n,a){var i,r,s,o=[0,0,0];if("undefined"!=typeof this.nav.plugins&&"object"==typeof this.nav.plugins[e]){if((i=this.nav.plugins[e].description)&&("undefined"==typeof this.nav.mimeTypes||!this.nav.mimeTypes[t]||this.nav.mimeTypes[t].enabledPlugin))for(o=i.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split("."),r=0;r<o.length;r++)o[r]=parseInt(o[r].match(/\d+/),10)}else if("undefined"!=typeof window.ActiveXObject)try{(s=new ActiveXObject(n))&&(o=a(s))}catch(l){}return o}},mejs.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(e){var t=[],n=e.GetVariable("$version");return n&&(n=n.split(" ")[1].split(","),t=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)]),t}),mejs.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(e){var t=[0,0,0,0],n=function(e,t,n,a){for(;e.isVersionSupported(t[0]+"."+t[1]+"."+t[2]+"."+t[3]);)t[n]+=a;t[n]-=a};return n(e,t,0,1),n(e,t,1,1),n(e,t,2,1e4),n(e,t,2,1e3),n(e,t,2,100),n(e,t,2,10),n(e,t,2,1),n(e,t,3,1),t}),mejs.MediaFeatures={"init":function(){var e,t,n,a,i,r,s=this,o=document,l=mejs.PluginDetector.nav,c=mejs.PluginDetector.ua.toLowerCase(),d=["source","track","audio","video"];s.isiPad=null!==c.match(/ipad/i),s.isiPhone=null!==c.match(/iphone/i),s.isiOS=s.isiPhone||s.isiPad,s.isAndroid=null!==c.match(/android/i),s.isBustedAndroid=null!==c.match(/android 2\.[12]/),s.isBustedNativeHTTPS="https:"===location.protocol&&(null!==c.match(/android [12]\./)||null!==c.match(/macintosh.* version.* safari/)),s.isIE=-1!=l.appName.toLowerCase().indexOf("microsoft")||null!==l.appName.toLowerCase().match(/trident/gi),s.isChrome=null!==c.match(/chrome/gi),s.isChromium=null!==c.match(/chromium/gi),s.isFirefox=null!==c.match(/firefox/gi),s.isWebkit=null!==c.match(/webkit/gi),s.isGecko=null!==c.match(/gecko/gi)&&!s.isWebkit&&!s.isIE,s.isOpera=null!==c.match(/opera/gi),s.hasTouch="ontouchstart"in window,s.svgAsImg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");for(e=0;e<d.length;e++)t=document.createElement(d[e]);s.supportsMediaTag="undefined"!=typeof t.canPlayType||s.isBustedAndroid;try{t.canPlayType("video/mp4")}catch(u){s.supportsMediaTag=!1}s.supportsPointerEvents=(a=document.createElement("x"),i=document.documentElement,r=window.getComputedStyle,"pointerEvents"in a.style&&(a.style.pointerEvents="auto",a.style.pointerEvents="x",i.appendChild(a),n=r&&"auto"===r(a,"").pointerEvents,i.removeChild(a),!!n)),s.hasFirefoxPluginMovingProblem=!1,s.hasiOSFullScreen="undefined"!=typeof t.webkitEnterFullscreen,s.hasNativeFullscreen="undefined"!=typeof t.requestFullscreen,s.hasWebkitNativeFullScreen="undefined"!=typeof t.webkitRequestFullScreen,s.hasMozNativeFullScreen="undefined"!=typeof t.mozRequestFullScreen,s.hasMsNativeFullScreen="undefined"!=typeof t.msRequestFullscreen,s.hasTrueNativeFullScreen=s.hasWebkitNativeFullScreen||s.hasMozNativeFullScreen||s.hasMsNativeFullScreen,s.nativeFullScreenEnabled=s.hasTrueNativeFullScreen,s.hasMozNativeFullScreen?s.nativeFullScreenEnabled=document.mozFullScreenEnabled:s.hasMsNativeFullScreen&&(s.nativeFullScreenEnabled=document.msFullscreenEnabled),s.isChrome&&(s.hasiOSFullScreen=!1),s.hasTrueNativeFullScreen&&(s.fullScreenEventName="",s.hasWebkitNativeFullScreen?s.fullScreenEventName="webkitfullscreenchange":s.hasMozNativeFullScreen?s.fullScreenEventName="mozfullscreenchange":s.hasMsNativeFullScreen&&(s.fullScreenEventName="MSFullscreenChange"),s.isFullScreen=function(){return s.hasMozNativeFullScreen?o.mozFullScreen:s.hasWebkitNativeFullScreen?o.webkitIsFullScreen:s.hasMsNativeFullScreen?null!==o.msFullscreenElement:void 0},s.requestFullScreen=function(e){s.hasWebkitNativeFullScreen?e.webkitRequestFullScreen():s.hasMozNativeFullScreen?e.mozRequestFullScreen():s.hasMsNativeFullScreen&&e.msRequestFullscreen()},s.cancelFullScreen=function(){s.hasWebkitNativeFullScreen?document.webkitCancelFullScreen():s.hasMozNativeFullScreen?document.mozCancelFullScreen():s.hasMsNativeFullScreen&&document.msExitFullscreen()}),s.hasiOSFullScreen&&c.match(/mac os x 10_5/i)&&(s.hasNativeFullScreen=!1,s.hasiOSFullScreen=!1)}},mejs.MediaFeatures.init(),mejs.HtmlMediaElement={"pluginType":"native","isFullScreen":!1,"setCurrentTime":function(e){this.currentTime=e},"setMuted":function(e){this.muted=e},"setVolume":function(e){this.volume=e},"stop":function(){this.pause()},"setSrc":function(e){for(var t,n,a=this.getElementsByTagName("source");a.length>0;)this.removeChild(a[0]);if("string"==typeof e)this.src=e;else for(t=0;t<e.length;t++)if(n=e[t],this.canPlayType(n.type)){this.src=n.src;break}},"setVideoSize":function(e,t){this.width=e,this.height=t}},mejs.PluginMediaElement=function(e,t,n){this.id=e,this.pluginType=t,this.src=n,this.events={},this.attributes={}},mejs.PluginMediaElement.prototype={"pluginElement":null,"pluginType":"","isFullScreen":!1,"playbackRate":-1,"defaultPlaybackRate":-1,"seekable":[],"played":[],"paused":!0,"ended":!1,"seeking":!1,"duration":0,"error":null,"tagName":"","muted":!1,"volume":1,"currentTime":0,"play":function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.playVideo():this.pluginApi.playMedia(),this.paused=!1)},"load":function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType||this.pluginApi.loadMedia(),this.paused=!1)},"pause":function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?1==this.pluginApi.getPlayerState()&&this.pluginApi.pauseVideo():this.pluginApi.pauseMedia(),this.paused=!0)},"stop":function(){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.stopVideo():this.pluginApi.stopMedia(),this.paused=!0)},"canPlayType":function(e){var t,n,a,i=mejs.plugins[this.pluginType];for(t=0;t<i.length;t++)if(a=i[t],mejs.PluginDetector.hasPluginVersion(this.pluginType,a.version))for(n=0;n<a.types.length;n++)if(e==a.types[n])return"probably";return""},"positionFullscreenButton":function(e,t,n){null!=this.pluginApi&&this.pluginApi.positionFullscreenButton&&this.pluginApi.positionFullscreenButton(Math.floor(e),Math.floor(t),n)},"hideFullscreenButton":function(){null!=this.pluginApi&&this.pluginApi.hideFullscreenButton&&this.pluginApi.hideFullscreenButton()},"setSrc":function(e){var t,n;if("string"==typeof e)this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(e)),this.src=mejs.Utility.absolutizeUrl(e);else for(t=0;t<e.length;t++)if(n=e[t],this.canPlayType(n.type)){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(n.src)),this.src=mejs.Utility.absolutizeUrl(n.src);break}},"setCurrentTime":function(e){null!=this.pluginApi&&("youtube"==this.pluginType||"vimeo"==this.pluginType?this.pluginApi.seekTo(e):this.pluginApi.setCurrentTime(e),this.currentTime=e)},"setVolume":function(e){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.setVolume(100*e):this.pluginApi.setVolume(e),this.volume=e)},"setMuted":function(e){null!=this.pluginApi&&("youtube"==this.pluginType?(e?this.pluginApi.mute():this.pluginApi.unMute(),this.muted=e,this.dispatchEvent({"type":"volumechange"})):this.pluginApi.setMuted(e),this.muted=e)},"setVideoSize":function(e,t){this.pluginElement&&this.pluginElement.style&&(this.pluginElement.style.width=e+"px",this.pluginElement.style.height=t+"px"),null!=this.pluginApi&&this.pluginApi.setVideoSize&&this.pluginApi.setVideoSize(e,t)},"setFullscreen":function(e){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.pluginApi.setFullscreen(e)},"enterFullScreen":function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!0)},"exitFullScreen":function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!1)},"addEventListener":function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},"removeEventListener":function(e,t){if(!e)return this.events={},!0;var n=this.events[e];if(!n)return!0;if(!t)return this.events[e]=[],!0;for(var a=0;a<n.length;a++)if(n[a]===t)return this.events[e].splice(a,1),!0;return!1},"dispatchEvent":function(e){var t,n=this.events[e.type];if(n)for(t=0;t<n.length;t++)n[t].apply(this,[e])},"hasAttribute":function(e){return e in this.attributes},"removeAttribute":function(e){delete this.attributes[e]},"getAttribute":function(e){return this.hasAttribute(e)?this.attributes[e]:null},"setAttribute":function(e,t){this.attributes[e]=t},"remove":function(){mejs.Utility.removeSwf(this.pluginElement.id)}},mejs.MediaElementDefaults={"mode":"auto","plugins":["flash","silverlight","youtube","vimeo"],"enablePluginDebug":!1,"httpsBasicAuthSite":!1,"type":"","pluginPath":mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),"flashName":"flashmediaelement.swf","flashStreamer":"","flashScriptAccess":"sameDomain","enablePluginSmoothing":!1,"enablePseudoStreaming":!1,"pseudoStreamingStartQueryParam":"start","silverlightName":"silverlightmediaelement.xap","defaultVideoWidth":480,"defaultVideoHeight":270,"pluginWidth":-1,"pluginHeight":-1,"pluginVars":[],"timerRate":250,"startVolume":.8,"customError":"","success":function(){},"error":function(){}},mejs.MediaElement=function(e,t){return mejs.HtmlMediaElementShim.create(e,t)},mejs.HtmlMediaElementShim={"create":function(e,t){var n,a,i={},r="string"==typeof e?document.getElementById(e):e,s=r.tagName.toLowerCase(),o="audio"===s||"video"===s,l=o?r.getAttribute("src"):r.getAttribute("href"),c=r.getAttribute("poster"),d=r.getAttribute("autoplay"),u=r.getAttribute("preload"),p=r.getAttribute("controls");for(a in mejs.MediaElementDefaults)i[a]=mejs.MediaElementDefaults[a];for(a in t)i[a]=t[a];return l=null==l||""==l?null:l,c=null==c?"":c,u=null==u||"false"===u?"none":u,d=!(null==d||"false"===d),p=!(null==p||"false"===p),(n=this.determinePlayback(r,i,mejs.MediaFeatures.supportsMediaTag,o,l)).url=null!==n.url?mejs.Utility.absolutizeUrl(n.url):"",n.scheme=mejs.Utility.determineScheme(n.url),"native"==n.method?(mejs.MediaFeatures.isBustedAndroid&&(r.src=n.url,r.addEventListener("click",function(){r.play()},!1)),this.updateNative(n,i,d,u)):""!==n.method?this.createPlugin(n,i,c,d,u,p):(this.createErrorMessage(n,i,c),this)},"determinePlayback":function(e,t,n,a,i){var r,s,o,l,c,d,u,p,f,b,h,m=[],v={"method":"","url":"","htmlMediaElement":e,"isVideo":"audio"!==e.tagName.toLowerCase(),"scheme":""};if("undefined"!=typeof t.type&&""!==t.type)if("string"==typeof t.type)m.push({"type":t.type,"url":i});else for(r=0;r<t.type.length;r++)m.push({"type":t.type[r],"url":i});else if(null!==i)d=this.formatType(i,e.getAttribute("type")),m.push({"type":d,"url":i});else for(r=0;r<e.childNodes.length;r++)1==(c=e.childNodes[r]).nodeType&&"source"==c.tagName.toLowerCase()&&(i=c.getAttribute("src"),d=this.formatType(i,c.getAttribute("type")),(!(h=c.getAttribute("media"))||!window.matchMedia||window.matchMedia&&window.matchMedia(h).matches)&&m.push({"type":d,"url":i}));if(!a&&m.length>0&&null!==m[0].url&&this.getTypeFromFile(m[0].url).indexOf("audio")>-1&&(v.isVideo=!1),v.isVideo&&mejs.MediaFeatures.isBustedAndroid&&(e.canPlayType=function(e){return null!==e.match(/video\/(mp4|m4v)/gi)?"maybe":""}),v.isVideo&&mejs.MediaFeatures.isChromium&&(e.canPlayType=function(e){return null!==e.match(/video\/(webm|ogv|ogg)/gi)?"maybe":""}),n&&("auto"===t.mode||"auto_plugin"===t.mode||"native"===t.mode)&&(!mejs.MediaFeatures.isBustedNativeHTTPS||!0!==t.httpsBasicAuthSite)){for(a||(b=document.createElement(v.isVideo?"video":"audio"),e.parentNode.insertBefore(b,e),e.style.display="none",v.htmlMediaElement=e=b),r=0;r<m.length;r++)if("video/m3u8"==m[r].type||""!==e.canPlayType(m[r].type).replace(/no/,"")||""!==e.canPlayType(m[r].type.replace(/mp3/,"mpeg")).replace(/no/,"")||""!==e.canPlayType(m[r].type.replace(/m4a/,"mp4")).replace(/no/,"")){v.method="native",v.url=m[r].url;break}if("native"===v.method&&(null!==v.url&&(e.src=v.url),"auto_plugin"!==t.mode))return v}if("auto"===t.mode||"auto_plugin"===t.mode||"shim"===t.mode)for(r=0;r<m.length;r++)for(d=m[r].type,s=0;s<t.plugins.length;s++)for(u=t.plugins[s],p=mejs.plugins[u],o=0;o<p.length;o++)if(null==(f=p[o]).version||mejs.PluginDetector.hasPluginVersion(u,f.version))for(l=0;l<f.types.length;l++)if(d.toLowerCase()==f.types[l].toLowerCase())return v.method=u,v.url=m[r].url,v;return"auto_plugin"===t.mode&&"native"===v.method?v:(""===v.method&&m.length>0&&(v.url=m[0].url),v)},"formatType":function(e,t){return e&&!t?this.getTypeFromFile(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t},"getTypeFromFile":function(e){var t=(e=e.split("?")[0]).substring(e.lastIndexOf(".")+1).toLowerCase(),n=/(mp4|m4v|ogg|ogv|m3u8|webm|webmv|flv|wmv|mpeg|mov)/gi.test(t)?"video/":"audio/";return this.getTypeFromExtension(t,n)},"getTypeFromExtension":function(e,t){switch(t=t||"",e){case"mp4":case"m4v":case"m4a":case"f4v":case"f4a":return t+"mp4";case"flv":return t+"x-flv";case"webm":case"webma":case"webmv":return t+"webm";case"ogg":case"oga":case"ogv":return t+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return t+"mp2t";default:return t+e}},"createErrorMessage":function(e,t,n){var a=e.htmlMediaElement,i=document.createElement("div"),r=t.customError;i.className="me-cannotplay";try{i.style.width=a.width+"px",i.style.height=a.height+"px"}catch(s){}r||(r='<a href="'+e.url+'">',""!==n&&(r+='<img src="'+n+'" width="100%" height="100%" alt="" />'),r+="<span>"+mejs.i18n.t("mejs.download-file")+"</span></a>"),i.innerHTML=r,a.parentNode.insertBefore(i,a),a.style.display="none",t.error(a)},"createPlugin":function(e,t,n,a,i,r){var s,o,l,c=e.htmlMediaElement,d=1,u=1,p="me_"+e.method+"_"+mejs.meIndex++,f=new mejs.PluginMediaElement(p,e.method,e.url),b=document.createElement("div");f.tagName=c.tagName;for(var h=0;h<c.attributes.length;h++){var m=c.attributes[h];m.specified&&f.setAttribute(m.name,m.value)}for(o=c.parentNode;null!==o&&null!=o.tagName&&"body"!==o.tagName.toLowerCase()&&null!=o.parentNode&&null!=o.parentNode.tagName&&null!=o.parentNode.constructor&&"ShadowRoot"===o.parentNode.constructor.name;){if("p"===o.parentNode.tagName.toLowerCase()){o.parentNode.parentNode.insertBefore(o,o.parentNode);break}o=o.parentNode}if(e.isVideo?(d=t.pluginWidth>0?t.pluginWidth:t.videoWidth>0?t.videoWidth:null!==c.getAttribute("width")?c.getAttribute("width"):t.defaultVideoWidth,u=t.pluginHeight>0?t.pluginHeight:t.videoHeight>0?t.videoHeight:null!==c.getAttribute("height")?c.getAttribute("height"):t.defaultVideoHeight,d=mejs.Utility.encodeUrl(d),u=mejs.Utility.encodeUrl(u)):t.enablePluginDebug&&(d=320,u=240),f.success=t.success,b.className="me-plugin",b.id=p+"_container",e.isVideo?c.parentNode.insertBefore(b,c):document.body.insertBefore(b,document.body.childNodes[0]),"flash"===e.method||"silverlight"===e.method){var v="audio/mp4"===c.getAttribute("type"),g=c.getElementsByTagName("source");if(g&&!v){h=0;for(var _=g.length;h<_;h++)"audio/mp4"===g[h].getAttribute("type")&&(v=!0)}l=["id="+p,"isvideo="+(e.isVideo||v?"true":"false"),"autoplay="+(a?"true":"false"),"preload="+i,"width="+d,"startvolume="+t.startVolume,"timerrate="+t.timerRate,"flashstreamer="+t.flashStreamer,"height="+u,"pseudostreamstart="+t.pseudoStreamingStartQueryParam],null!==e.url&&("flash"==e.method?l.push("file="+mejs.Utility.encodeUrl(e.url)):l.push("file="+e.url)),t.enablePluginDebug&&l.push("debug=true"),t.enablePluginSmoothing&&l.push("smoothing=true"),t.enablePseudoStreaming&&l.push("pseudostreaming=true"),r&&l.push("controls=true"),t.pluginVars&&(l=l.concat(t.pluginVars)),window[p+"_init"]=function(){switch(f.pluginType){case"flash":f.pluginElement=f.pluginApi=document.getElementById(p);break;case"silverlight":f.pluginElement=document.getElementById(f.id),f.pluginApi=f.pluginElement.Content.MediaElementJS}null!=f.pluginApi&&f.success&&f.success(f,c)},window[p+"_event"]=function(e,t){var n,a,i;for(a in n={"type":e,"target":f},t)f[a]=t[a],n[a]=t[a];i=t.bufferedTime||0,n.target.buffered=n.buffered={"start":function(){return 0},"end":function(){return i},"length":1},f.dispatchEvent(n)}}switch(e.method){case"silverlight":b.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+p+'" name="'+p+'" width="'+d+'" height="'+u+'" class="mejs-shim"><param name="initParams" value="'+l.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+t.pluginPath+t.silverlightName+'" /></object>';break;case"flash":mejs.MediaFeatures.isIE?(s=document.createElement("div"),b.appendChild(s),s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+p+'" width="'+d+'" height="'+u+'" class="mejs-shim"><param name="movie" value="'+t.pluginPath+t.flashName+"?"+(new Date).getTime()+'" /><param name="flashvars" value="'+l.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+t.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /><param name="scale" value="default" /></object>'):b.innerHTML='<embed id="'+p+'" name="'+p+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="'+t.flashScriptAccess+'" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="'+t.pluginPath+t.flashName+'" flashvars="'+l.join("&")+'" width="'+d+'" height="'+u+'" scale="default"class="mejs-shim"></embed>';break;case"youtube":var y;if(-1!=e.url.lastIndexOf("youtu.be"))-1!=(y=e.url.substr(e.url.lastIndexOf("/")+1)).indexOf("?")&&(y=y.substr(0,y.indexOf("?")));else{var w=e.url.match(/[?&]v=([^&#]+)|&|#|$/);w&&(y=w[1])}youtubeSettings={"container":b,"containerId":b.id,"pluginMediaElement":f,"pluginId":p,"videoId":y,"height":u,"width":d,"scheme":e.scheme,"variables":t.youtubeIframeVars},window.postMessage?mejs.YouTubeApi.enqueueIframe(youtubeSettings):mejs.PluginDetector.hasPluginVersion("flash",[10,0,0])&&mejs.YouTubeApi.createFlash(youtubeSettings,t);break;case"vimeo":var k=p+"_player";if(f.vimeoid=e.url.substr(e.url.lastIndexOf("/")+1),b.innerHTML='<iframe src="'+e.scheme+"player.vimeo.com/video/"+f.vimeoid+"?api=1&portrait=0&byline=0&title=0&player_id="+k+'" width="'+d+'" height="'+u+'" frameborder="0" class="mejs-shim" id="'+k+'" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',"function"==typeof $f){var C=$f(b.childNodes[0]),x=-1;C.addEvent("ready",function(){function e(e,t,n,a){var i={"type":n,"target":t};"timeupdate"==n&&(t.currentTime=i.currentTime=a.seconds,t.duration=i.duration=a.duration),t.dispatchEvent(i)}C.playVideo=function(){C.api("play")},C.stopVideo=function(){C.api("unload")},C.pauseVideo=function(){C.api("pause")},C.seekTo=function(e){C.api("seekTo",e)},C.setVolume=function(e){C.api("setVolume",e)},C.setMuted=function(e){e?(C.lastVolume=C.api("getVolume"),C.api("setVolume",0)):(C.api("setVolume",C.lastVolume),delete C.lastVolume)},C.getPlayerState=function(){return x},C.addEvent("play",function(){x=1,e(C,f,"play"),e(C,f,"playing")}),C.addEvent("pause",function(){x=2,e(C,f,"pause")}),C.addEvent("finish",function(){x=0,e(C,f,"ended")}),C.addEvent("playProgress",function(t){e(C,f,"timeupdate",t)}),C.addEvent("seek",function(t){x=3,e(C,f,"seeked",t)}),C.addEvent("loadProgress",function(t){x=3,e(C,f,"progress",t)}),f.pluginElement=b,f.pluginApi=C,f.success(f,f.pluginElement)})}else console.warn("You need to include froogaloop for vimeo to work")}return c.style.display="none",c.removeAttribute("autoplay"),f},"updateNative":function(e,t){var n,a=e.htmlMediaElement;for(n in mejs.HtmlMediaElement)a[n]=mejs.HtmlMediaElement[n];return t.success(a,a),a}},mejs.YouTubeApi={"isIframeStarted":!1,"isIframeLoaded":!1,"loadIframeApi":function(e){if(!this.isIframeStarted){var t=document.createElement("script");t.src=e.scheme+"www.youtube.com/player_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.isIframeStarted=!0}},"iframeQueue":[],"enqueueIframe":function(e){this.isLoaded?this.createIframe(e):(this.loadIframeApi(e),this.iframeQueue.push(e))},"createIframe":function(e){var t=e.pluginMediaElement,n={"controls":0,"wmode":"transparent"},a=new YT.Player(e.containerId,{"height":e.height,"width":e.width,"videoId":e.videoId,"playerVars":mejs.$.extend({},n,e.variables),"events":{"onReady":function(){a.setVideoSize=function(e,t){a.setSize(e,t)},e.pluginMediaElement.pluginApi=a,e.pluginMediaElement.pluginElement=document.getElementById(e.containerId),t.success(t,t.pluginElement),mejs.YouTubeApi.createEvent(a,t,"canplay"),setInterval(function(){mejs.YouTubeApi.createEvent(a,t,"timeupdate")},250),"undefined"!=typeof t.attributes.autoplay&&a.playVideo()},"onStateChange":function(e){mejs.YouTubeApi.handleStateChange(e.data,a,t)}}})},"createEvent":function(e,t,n){var a={"type":n,"target":t};if(e&&e.getDuration){t.currentTime=a.currentTime=e.getCurrentTime(),t.duration=a.duration=e.getDuration(),a.paused=t.paused,a.ended=t.ended,a.muted=e.isMuted(),a.volume=e.getVolume()/100,a.bytesTotal=e.getVideoBytesTotal(),a.bufferedBytes=e.getVideoBytesLoaded();var i=a.bufferedBytes/a.bytesTotal*a.duration;a.target.buffered=a.buffered={"start":function(){return 0},"end":function(){return i},"length":1}}t.dispatchEvent(a)},"iFrameReady":function(){for(this.isLoaded=!0,this.isIframeLoaded=!0;this.iframeQueue.length>0;){var e=this.iframeQueue.pop();this.createIframe(e)}},"flashPlayers":{},"createFlash":function(e){this.flashPlayers[e.pluginId]=e;var t,n=e.scheme+"www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+e.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";mejs.MediaFeatures.isIE?(t=document.createElement("div"),e.container.appendChild(t),t.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+e.scheme+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+e.pluginId+'" width="'+e.width+'" height="'+e.height+'" class="mejs-shim"><param name="movie" value="'+n+'" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="'+options.flashScriptAccess+'" /><param name="allowFullScreen" value="true" /></object>'):e.container.innerHTML='<object type="application/x-shockwave-flash" id="'+e.pluginId+'" data="'+n+'" width="'+e.width+'" height="'+e.height+'" style="visibility: visible; " class="mejs-shim"><param name="allowScriptAccess" value="'+options.flashScriptAccess+'"><param name="wmode" value="transparent"></object>'},"flashReady":function(e){var t=this.flashPlayers[e],n=document.getElementById(e),a=t.pluginMediaElement;a.pluginApi=a.pluginElement=n,t.success(a,a.pluginElement),n.cueVideoById(t.videoId);var i=t.containerId+"_callback";window[i]=function(e){mejs.YouTubeApi.handleStateChange(e,n,a)},n.addEventListener("onStateChange",i),setInterval(function(){mejs.YouTubeApi.createEvent(n,a,"timeupdate")},250),mejs.YouTubeApi.createEvent(n,a,"canplay")},"handleStateChange":function(e,t,n){switch(e){case-1:n.paused=!0,n.ended=!0,mejs.YouTubeApi.createEvent(t,n,"loadedmetadata");break;case 0:n.paused=!1,n.ended=!0,mejs.YouTubeApi.createEvent(t,n,"ended");break;case 1:n.paused=!1,n.ended=!1,mejs.YouTubeApi.createEvent(t,n,"play"),mejs.YouTubeApi.createEvent(t,n,"playing");break;case 2:n.paused=!0,n.ended=!1,mejs.YouTubeApi.createEvent(t,n,"pause");break;case 3:mejs.YouTubeApi.createEvent(t,n,"progress")}}},window.onYouTubePlayerAPIReady=function(){mejs.YouTubeApi.iFrameReady()},window.onYouTubePlayerReady=function(e){mejs.YouTubeApi.flashReady(e)},window.mejs=mejs,window.MediaElement=mejs.MediaElement,function(e,t,n){var a={"default":"en","locale":{"language":n.i18n&&n.i18n.locale.language||"","strings":n.i18n&&n.i18n.locale.strings||{}},"pluralForms":[function(){return arguments[1]},function(){var e=arguments;return 1===e[0]?e[1]:e[2]},function(){var e=arguments;return[0,1].indexOf(e[0])>-1?e[1]:e[2]},function(){var e=arguments;return e[0]%10==1&&e[0]%100!=11?e[1]:0!==e[0]?e[2]:e[3]},function(){var e=arguments;return 1===e[0]||11===e[0]?e[1]:2===e[0]||12===e[0]?e[2]:e[0]>2&&e[0]<20?e[3]:e[4]},function(){return 1===args[0]?args[1]:0===args[0]||args[0]%100>0&&args[0]%100<20?args[2]:args[3]},function(){var e=arguments;return e[0]%10==1&&e[0]%100!=11?e[1]:e[0]%10>=2&&(e[0]%100<10||e[0]%100>=20)?e[2]:[3]},function(){var e=arguments;return e[0]%10==1&&e[0]%100!=11?e[1]:e[0]%10>=2&&e[0]%10<=4&&(e[0]%100<10||e[0]%100>=20)?e[2]:e[3]},function(){var e=arguments;return 1===e[0]?e[1]:e[0]>=2&&e[0]<=4?e[2]:e[3]},function(){var e=arguments;return 1===e[0]?e[1]:e[0]%10>=2&&e[0]%10<=4&&(e[0]%100<10||e[0]%100>=20)?e[2]:e[3]},function(){var e=arguments;return e[0]%100==1?e[2]:e[0]%100==2?e[3]:e[0]%100==3||e[0]%100==4?e[4]:e[1]},function(){var e=arguments;return 1===e[0]?e[1]:2===e[0]?e[2]:e[0]>2&&e[0]<7?e[3]:e[0]>6&&e[0]<11?e[4]:e[5]},function(){var e=arguments;return 0===e[0]?e[1]:1===e[0]?e[2]:2===e[0]?e[3]:e[0]%100>=3&&e[0]%100<=10?e[4]:e[0]%100>=11?e[5]:e[6]},function(){var e=arguments;return 1===e[0]?e[1]:0===e[0]||e[0]%100>1&&e[0]%100<11?e[2]:e[0]%100>10&&e[0]%100<20?e[3]:e[4]},function(){var e=arguments;return e[0]%10==1?e[1]:e[0]%10==2?e[2]:e[3]},function(){var e=arguments;return 11!==e[0]&&e[0]%10==1?e[1]:e[2]},function(){var e=arguments;return 1===e[0]?e[1]:e[0]%10>=2&&e[0]%10<=4&&(e[0]%100<10||e[0]%100>=20)?e[2]:e[3]},function(){var e=arguments;return 1===e[0]?e[1]:2===e[0]?e[2]:8!==e[0]&&11!==e[0]?e[3]:e[4]},function(){var e=arguments;return 0===e[0]?e[1]:e[2]},function(){var e=arguments;return 1===e[0]?e[1]:2===e[0]?e[2]:3===e[0]?e[3]:e[4]},function(){var e=arguments;return 0===e[0]?e[1]:1===e[0]?e[2]:e[3]}],"getLanguage":function(){var e=a.locale.language||a["default"];return/^(x\-)?[a-z]{2,}(\-\w{2,})?(\-\w{2,})?$/.exec(e)?e:a["default"]},"t":function(e,t){if("string"==typeof e&&e.length){var n,i,r=a.getLanguage(),s=function(e,t,n){return"object"!=typeof e||"number"!=typeof t||"number"!=typeof n?e:"string"==typeof e?e:a.pluralForms[n].apply(null,[t].concat(e))},o=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e.replace(/[&<>"]/g,function(e){return t[e]})};return a.locale.strings&&a.locale.strings[r]&&(n=a.locale.strings[r][e],"number"==typeof t&&(i=a.locale.strings[r]["mejs.plural-form"],n=s.apply(null,[n,t,i]))),!n&&a.locale.strings&&a.locale.strings[a["default"]]&&(n=a.locale.strings[a["default"]][e],"number"==typeof t&&(i=a.locale.strings[a["default"]]["mejs.plural-form"],n=s.apply(null,[n,t,i]))),n=n||e,"number"==typeof t&&(n=n.replace("%1",t)),o(n)}return e}};"undefined"!=typeof mejsL10n&&(a.locale.language=mejsL10n.language),n.i18n=a}(document,window,mejs),function(e){"use strict";"undefined"!=typeof mejsL10n&&(e[mejsL10n.language]=mejsL10n.strings)}(mejs.i18n.locale.strings),
/*!
 * This is a i18n.locale language object.
 *
 * English; This can serve as a template for other languages to translate
 *
 * @author
 *   TBD
 *   Sascha Greuel (Twitter: @SoftCreatR)
 *
 * @see
 *   me-i18n.js
 *
 * @params
 *  - exports - CommonJS, window ..
 */
function(e){"use strict";e.en===undefined&&(e.en={"mejs.plural-form":1,"mejs.download-file":"Download File","mejs.fullscreen-off":"Turn off Fullscreen","mejs.fullscreen-on":"Go Fullscreen","mejs.download-video":"Download Video","mejs.fullscreen":"Fullscreen","mejs.time-jump-forward":["Jump forward 1 second","Jump forward %1 seconds"],"mejs.play":"Play","mejs.pause":"Pause","mejs.close":"Close","mejs.time-slider":"Time Slider","mejs.time-help-text":"Use Left/Right Arrow keys to advance one second, Up/Down arrows to advance ten seconds.","mejs.time-skip-back":["Skip back 1 second","Skip back %1 seconds"],"mejs.captions-subtitles":"Captions/Subtitles","mejs.none":"None","mejs.mute-toggle":"Mute Toggle","mejs.volume-help-text":"Use Up/Down Arrow keys to increase or decrease volume.","mejs.unmute":"Unmute","mejs.mute":"Mute","mejs.volume-slider":"Volume Slider","mejs.video-player":"Video Player","mejs.audio-player":"Audio Player","mejs.ad-skip":"Skip ad","mejs.ad-skip-info":["Skip in 1 second","Skip in %1 seconds"],"mejs.source-chooser":"Source Chooser"})}(mejs.i18n.locale.strings),
/*!
 *
 * MediaElementPlayer
 * http://mediaelementjs.com/
 *
 * Creates a controller bar for HTML5 <video> add <audio> tags
 * using jQuery and MediaElement.js (HTML5 Flash/Silverlight wrapper)
 *
 * Copyright 2010-2013, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
"undefined"!=typeof jQuery?mejs.$=jQuery:"undefined"!=typeof Zepto?(mejs.$=Zepto,Zepto.fn.outerWidth=function(e){var t=$(this).width();return e&&(t+=parseInt($(this).css("margin-right"),10),t+=parseInt($(this).css("margin-left"),10)),t}):"undefined"!=typeof ender&&(mejs.$=ender),function(e){mejs.MepDefaults={"poster":"","showPosterWhenEnded":!1,"defaultVideoWidth":480,"defaultVideoHeight":270,"videoWidth":-1,"videoHeight":-1,"defaultAudioWidth":400,"defaultAudioHeight":30,"defaultSeekBackwardInterval":function(e){return.05*e.duration},"defaultSeekForwardInterval":function(e){return.05*e.duration},"setDimensions":!0,"audioWidth":-1,"audioHeight":-1,"startVolume":.8,"loop":!1,"autoRewind":!0,"enableAutosize":!0,"timeFormat":"","alwaysShowHours":!1,"showTimecodeFrameCount":!1,"framesPerSecond":25,"autosizeProgress":!0,"alwaysShowControls":!1,"hideVideoControlsOnLoad":!1,"clickToPlayPause":!0,"controlsTimeoutDefault":1500,"controlsTimeoutMouseEnter":2500,"controlsTimeoutMouseLeave":1e3,"iPadUseNativeControls":!1,"iPhoneUseNativeControls":!1,"AndroidUseNativeControls":!1,"features":["playpause","current","progress","duration","tracks","volume","fullscreen"],"isVideo":!0,"stretching":"auto","enableKeyboard":!0,"pauseOtherPlayers":!0,"keyActions":[{"keys":[32,179],"action":function(e,t){mejs.MediaFeatures.isFirefox||(t.paused||t.ended?t.play():t.pause())}},{"keys":[38],"action":function(e,t){e.container.find(".mejs-volume-slider").css("display","block"),e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.min(t.volume+.1,1);t.setVolume(n)}},{"keys":[40],"action":function(e,t){e.container.find(".mejs-volume-slider").css("display","block"),e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.max(t.volume-.1,0);t.setVolume(n)}},{"keys":[37,227],"action":function(e,t){if(isFinite(t.duration)&&t.duration>0){e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.max(t.currentTime-e.options.defaultSeekBackwardInterval(t),0);t.setCurrentTime(n)}}},{"keys":[39,228],"action":function(e,t){if(isFinite(t.duration)&&t.duration>0){e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.min(t.currentTime+e.options.defaultSeekForwardInterval(t),t.duration);t.setCurrentTime(n)}}},{"keys":[70],"action":function(e){"undefined"!=typeof e.enterFullScreen&&(e.isFullScreen?e.exitFullScreen():e.enterFullScreen())}},{"keys":[77],"action":function(e){e.container.find(".mejs-volume-slider").css("display","block"),e.isVideo&&(e.showControls(),e.startControlsTimer()),e.media.muted?e.setMuted(!1):e.setMuted(!0)}}]},mejs.mepIndex=0,mejs.players={},mejs.MediaElementPlayer=function(t,n){if(!(this instanceof mejs.MediaElementPlayer))return new mejs.MediaElementPlayer(t,n);var a=this;return a.$media=a.$node=e(t),a.node=a.media=a.$media[0],a.node?"undefined"!=typeof a.node.player?a.node.player:(void 0===n&&(n=a.$node.data("mejsoptions")),a.options=e.extend({},mejs.MepDefaults,n),a.options.timeFormat||(a.options.timeFormat="mm:ss",a.options.alwaysShowHours&&(a.options.timeFormat="hh:mm:ss"),a.options.showTimecodeFrameCount&&(a.options.timeFormat+=":ff")),mejs.Utility.calculateTimeFormat(0,a.options,a.options.framesPerSecond||25),a.id="mep_"+mejs.mepIndex++,mejs.players[a.id]=a,a.init(),a):void 0},mejs.MediaElementPlayer.prototype={"hasFocus":!1,"controlsAreVisible":!0,"init":function(){var t=this,n=mejs.MediaFeatures,a=e.extend(!0,{},t.options,{"success":function(e,n){t.meReady(e,n)},"error":function(e){t.handleError(e)}}),i=t.media.tagName.toLowerCase();if(t.isDynamic="audio"!==i&&"video"!==i,t.isDynamic?t.isVideo=t.options.isVideo:t.isVideo="audio"!==i&&t.options.isVideo,n.isiPad&&t.options.iPadUseNativeControls||n.isiPhone&&t.options.iPhoneUseNativeControls)t.$media.attr("controls","controls"),n.isiPad&&null!==t.media.getAttribute("autoplay")&&t.play();else if(n.isAndroid&&t.options.AndroidUseNativeControls);else if(t.isVideo||!t.isVideo&&t.options.features.length){t.$media.removeAttr("controls");var r=t.isVideo?mejs.i18n.t("mejs.video-player"):mejs.i18n.t("mejs.audio-player");e('<span class="mejs-offscreen">'+r+"</span>").insertBefore(t.$media),t.container=e('<div id="'+t.id+'" class="mejs-container '+(mejs.MediaFeatures.svgAsImg?"svg":"no-svg")+'" tabindex="0" role="application" aria-label="'+r+'"><div class="mejs-inner"><div class="mejs-mediaelement"></div><div class="mejs-layers"></div><div class="mejs-controls"></div><div class="mejs-clear"></div></div></div>').addClass(t.$media[0].className).insertBefore(t.$media).focus(function(e){if(!t.controlsAreVisible&&!t.hasFocus&&t.controlsEnabled&&(t.showControls(!0),!t.hasMsNativeFullScreen)){var n=".mejs-playpause-button > button";mejs.Utility.isNodeAfter(e.relatedTarget,t.container[0])&&(n=".mejs-controls .mejs-button:last-child > button"),t.container.find(n).focus()}}),t.options.features.length||t.container.css("background","transparent").find(".mejs-controls").hide(),t.isVideo&&"fill"===t.options.stretching&&!t.container.parent("mejs-fill-container").length&&(t.outerContainer=t.$media.parent(),t.container.wrap('<div class="mejs-fill-container"/>')),t.container.addClass((n.isAndroid?"mejs-android ":"")+(n.isiOS?"mejs-ios ":"")+(n.isiPad?"mejs-ipad ":"")+(n.isiPhone?"mejs-iphone ":"")+(t.isVideo?"mejs-video ":"mejs-audio ")),t.container.find(".mejs-mediaelement").append(t.$media),t.node.player=t,t.controls=t.container.find(".mejs-controls"),t.layers=t.container.find(".mejs-layers");var s=t.isVideo?"video":"audio",o=s.substring(0,1).toUpperCase()+s.substring(1);t.options[s+"Width"]>0||t.options[s+"Width"].toString().indexOf("%")>-1?t.width=t.options[s+"Width"]:""!==t.media.style.width&&null!==t.media.style.width?t.width=t.media.style.width:null!==t.media.getAttribute("width")?t.width=t.$media.attr("width"):t.width=t.options["default"+o+"Width"],t.options[s+"Height"]>0||t.options[s+"Height"].toString().indexOf("%")>-1?t.height=t.options[s+"Height"]:""!==t.media.style.height&&null!==t.media.style.height?t.height=t.media.style.height:null!==t.$media[0].getAttribute("height")?t.height=t.$media.attr("height"):t.height=t.options["default"+o+"Height"],t.setPlayerSize(t.width,t.height),a.pluginWidth=t.width,a.pluginHeight=t.height}else t.isVideo||t.options.features.length||t.$media.hide();mejs.MediaElement(t.$media[0],a),"undefined"!=typeof t.container&&t.options.features.length&&t.controlsAreVisible&&t.container.trigger("controlsshown")},"showControls":function(e){var t=this;e=void 0===e||e,t.controlsAreVisible||(e?(t.controls.removeClass("mejs-offscreen").stop(!0,!0).fadeIn(200,function(){t.controlsAreVisible=!0,t.container.trigger("controlsshown")}),t.container.find(".mejs-control").removeClass("mejs-offscreen").stop(!0,!0).fadeIn(200,function(){t.controlsAreVisible=!0})):(t.controls.removeClass("mejs-offscreen").css("display","block"),t.container.find(".mejs-control").removeClass("mejs-offscreen").css("display","block"),t.controlsAreVisible=!0,t.container.trigger("controlsshown")),t.setControlsSize())},"hideControls":function(t){var n=this;t=void 0===t||t,!n.controlsAreVisible||n.options.alwaysShowControls||n.keyboardAction||n.media.paused||n.media.ended||(t?(n.controls.stop(!0,!0).fadeOut(200,function(){e(this).addClass("mejs-offscreen").css("display","block"),n.controlsAreVisible=!1,n.container.trigger("controlshidden")}),n.container.find(".mejs-control").stop(!0,!0).fadeOut(200,function(){e(this).addClass("mejs-offscreen").css("display","block")})):(n.controls.addClass("mejs-offscreen").css("display","block"),n.container.find(".mejs-control").addClass("mejs-offscreen").css("display","block"),n.controlsAreVisible=!1,n.container.trigger("controlshidden")))},"controlsTimer":null,"startControlsTimer":function(e){var t=this;e=void 0!==e?e:t.options.controlsTimeoutDefault,t.killControlsTimer("start"),t.controlsTimer=setTimeout(function(){t.hideControls(),t.killControlsTimer("hide")},e)},"killControlsTimer":function(){var e=this;null!==e.controlsTimer&&(clearTimeout(e.controlsTimer),delete e.controlsTimer,e.controlsTimer=null)},"controlsEnabled":!0,"disableControls":function(){var e=this;e.killControlsTimer(),e.hideControls(!1),this.controlsEnabled=!1},"enableControls":function(){var e=this;e.showControls(!1),e.controlsEnabled=!0},"meReady":function(t,n){var a,i,r=this,s=mejs.MediaFeatures,o=n.getAttribute("autoplay"),l=!(null==o||"false"===o);if(!r.created){if(r.created=!0,r.media=t,r.domNode=n,!(s.isAndroid&&r.options.AndroidUseNativeControls||s.isiPad&&r.options.iPadUseNativeControls||s.isiPhone&&r.options.iPhoneUseNativeControls)){if(!r.isVideo&&!r.options.features.length)return l&&"native"==t.pluginType&&r.play(),void(r.options.success&&("string"==typeof r.options.success?window[r.options.success](r.media,r.domNode,r):r.options.success(r.media,r.domNode,r)));for(a in r.buildposter(r,r.controls,r.layers,r.media),r.buildkeyboard(r,r.controls,r.layers,r.media),r.buildoverlays(r,r.controls,r.layers,r.media),r.findTracks(),r.options.features)if(i=r.options.features[a],r["build"+i])try{r["build"+i](r,r.controls,r.layers,r.media)}catch(d){}r.container.trigger("controlsready"),r.setPlayerSize(r.width,r.height),r.setControlsSize(),r.isVideo&&(mejs.MediaFeatures.hasTouch&&!r.options.alwaysShowControls?r.$media.bind("touchstart",function(){r.controlsAreVisible?r.hideControls(!1):r.controlsEnabled&&r.showControls(!1)}):(r.clickToPlayPauseCallback=function(){if(r.options.clickToPlayPause){r.media.paused?r.play():r.pause();var e=r.$media.closest(".mejs-container").find(".mejs-overlay-button"),t=e.attr("aria-pressed");e.attr("aria-pressed",!t)}},r.media.addEventListener("click",r.clickToPlayPauseCallback,!1),r.container.bind("mouseenter",function(){r.controlsEnabled&&(r.options.alwaysShowControls||(r.killControlsTimer("enter"),r.showControls(),r.startControlsTimer(r.options.controlsTimeoutMouseEnter)))}).bind("mousemove",function(){r.controlsEnabled&&(r.controlsAreVisible||r.showControls(),r.options.alwaysShowControls||r.startControlsTimer(r.options.controlsTimeoutMouseEnter))}).bind("mouseleave",function(){r.controlsEnabled&&(r.media.paused||r.options.alwaysShowControls||r.startControlsTimer(r.options.controlsTimeoutMouseLeave))})),r.options.hideVideoControlsOnLoad&&r.hideControls(!1),l&&!r.options.alwaysShowControls&&r.hideControls(),r.options.enableAutosize&&r.media.addEventListener("loadedmetadata",function(e){r.options.videoHeight<=0&&null===r.domNode.getAttribute("height")&&isFinite(e.target.videoHeight)&&(r.setPlayerSize(e.target.videoWidth,e.target.videoHeight),r.setControlsSize(),r.media.setVideoSize(e.target.videoWidth,e.target.videoHeight))},!1)),r.media.addEventListener("play",function(){var e;for(e in mejs.players){var t=mejs.players[e];t.id==r.id||!r.options.pauseOtherPlayers||t.paused||t.ended||t.pause(),t.hasFocus=!1}r.hasFocus=!0},!1),r.media.addEventListener("ended",function(){if(r.options.autoRewind)try{r.media.setCurrentTime(0),window.setTimeout(function(){e(r.container).find(".mejs-overlay-loading").parent().hide()},20)}catch(t){}"youtube"===r.media.pluginType?r.media.stop():r.media.pause(),r.setProgressRail&&r.setProgressRail(),r.setCurrentRail&&r.setCurrentRail(),r.options.loop?r.play():!r.options.alwaysShowControls&&r.controlsEnabled&&r.showControls()},!1),r.media.addEventListener("loadedmetadata",function(){mejs.Utility.calculateTimeFormat(r.duration,r.options,r.options.framesPerSecond||25),r.updateDuration&&r.updateDuration(),r.updateCurrent&&r.updateCurrent(),r.isFullScreen||(r.setPlayerSize(r.width,r.height),r.setControlsSize())},!1);var c=null;r.media.addEventListener("timeupdate",function(){c!==this.duration&&(c=this.duration,mejs.Utility.calculateTimeFormat(c,r.options,r.options.framesPerSecond||25),r.updateDuration&&r.updateDuration(),r.updateCurrent&&r.updateCurrent(),r.setControlsSize())},!1),r.container.focusout(function(t){if(t.relatedTarget){var n=e(t.relatedTarget);r.keyboardAction&&0===n.parents(".mejs-container").length&&(r.keyboardAction=!1,r.isVideo&&!r.options.alwaysShowControls&&r.hideControls(!0))}}),setTimeout(function(){r.setPlayerSize(r.width,r.height),r.setControlsSize()},50),r.globalBind("resize",function(){r.isFullScreen||mejs.MediaFeatures.hasTrueNativeFullScreen&&document.webkitIsFullScreen||r.setPlayerSize(r.width,r.height),r.setControlsSize()}),"youtube"==r.media.pluginType&&(s.isiOS||s.isAndroid)&&(r.container.find(".mejs-overlay-play").hide(),r.container.find(".mejs-poster").hide())}l&&"native"==t.pluginType&&r.play(),r.options.success&&("string"==typeof r.options.success?window[r.options.success](r.media,r.domNode,r):r.options.success(r.media,r.domNode,r))}},"handleError":function(e){var t=this;t.controls&&t.controls.hide(),t.options.error&&t.options.error(e)},"setPlayerSize":function(e,t){var n=this;if(!n.options.setDimensions)return!1;switch(void 0!==e&&(n.width=e),void 0!==t&&(n.height=t),n.options.stretching){case"fill":n.isVideo?this.setFillMode():this.setDimensions(n.width,n.height);break;case"responsive":this.setResponsiveMode();break;case"none":this.setDimensions(n.width,n.height);break;default:!0===this.hasFluidMode()?this.setResponsiveMode():this.setDimensions(n.width,n.height)}},"hasFluidMode":function(){var e=this;return e.height.toString().indexOf("%")>0||"none"!==e.$node.css("max-width")&&"t.width"!==e.$node.css("max-width")||e.$node[0].currentStyle&&"100%"===e.$node[0].currentStyle.maxWidth},"setResponsiveMode":function(){var t=this,n=t.isVideo?t.media.videoWidth&&t.media.videoWidth>0?t.media.videoWidth:null!==t.media.getAttribute("width")?t.media.getAttribute("width"):t.options.defaultVideoWidth:t.options.defaultAudioWidth,a=t.isVideo?t.media.videoHeight&&t.media.videoHeight>0?t.media.videoHeight:null!==t.media.getAttribute("height")?t.media.getAttribute("height"):t.options.defaultVideoHeight:t.options.defaultAudioHeight,i=t.container.parent().closest(":visible").width(),r=t.container.parent().closest(":visible").height(),s=t.isVideo||!t.options.autosizeProgress?parseInt(i*a/n,10):a;(!isFinite(s)||0!==r&&s>r&&r>a)&&(s=r),t.container.parent().length>0&&"body"===t.container.parent()[0].tagName.toLowerCase()&&(i=e(window).width(),s=e(window).height()),s&&i&&(t.container.width(i).height(s),t.$media.add(t.container.find(".mejs-shim")).width("100%").height("100%"),t.isVideo&&t.media.setVideoSize&&t.media.setVideoSize(i,s),t.layers.children(".mejs-layer").width("100%").height("100%"))},"setFillMode":function(){var e=this,t=e.outerContainer;t.width()||t.height(e.$media.width()),t.height()||t.height(e.$media.height());var n=t.width(),a=t.height();e.setDimensions("100%","100%"),e.container.find(".mejs-poster img").css("display","block"),targetElement=e.container.find("object, embed, iframe, video");var i=e.height,r=e.width,s=n,o=i*n/r,l=r*a/i,c=a,d=!(l>n),u=d?Math.floor(s):Math.floor(l),p=d?Math.floor(o):Math.floor(c);d?(targetElement.height(p).width(n),e.media.setVideoSize&&e.media.setVideoSize(n,p)):(targetElement.height(a).width(u),e.media.setVideoSize&&e.media.setVideoSize(u,a)),targetElement.css({"margin-left":Math.floor((n-u)/2),"margin-top":0})},"setDimensions":function(e,t){var n=this;n.container.width(e).height(t),n.layers.children(".mejs-layer").width(e).height(t)},"setControlsSize":function(){var t=this,n=0,a=0,i=t.controls.find(".mejs-time-rail"),r=t.controls.find(".mejs-time-total"),s=i.siblings(),o=s.last(),l=null,c=t.options&&!t.options.autosizeProgress;if(t.container.is(":visible")&&i.length&&i.is(":visible")){c&&(a=parseInt(i.css("width"),10)),0!==a&&a||(s.each(function(){var t=e(this);"absolute"!=t.css("position")&&t.is(":visible")&&(n+=e(this).outerWidth(!0))}),a=t.controls.width()-n-(i.outerWidth(!0)-i.width()));do{c||i.width(a),r.width(a-(r.outerWidth(!0)-r.width())),"absolute"!=o.css("position")&&(l=o.length?o.position():null,a--)}while(null!==l&&l.top.toFixed(2)>0&&a>0);t.container.trigger("controlsresize")}},"buildposter":function(t,n,a,i){var r=this,s=e('<div class="mejs-poster mejs-layer"></div>').appendTo(a),o=t.$media.attr("poster");""!==t.options.poster&&(o=t.options.poster),o?r.setPoster(o):s.hide(),i.addEventListener("play",function(){s.hide()},!1),t.options.showPosterWhenEnded&&t.options.autoRewind&&i.addEventListener("ended",function(){s.show()},!1)},"setPoster":function(t){var n=this.container.find(".mejs-poster"),a=n.find("img");0===a.length&&(a=e('<img width="100%" height="100%" alt="" />').appendTo(n)),a.attr("src",t),n.css({"background-image":"url("+t+")"})},"buildoverlays":function(t,n,a,i){var r=this;if(t.isVideo){var s=e('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-loading"><span></span></div></div>').hide().appendTo(a),o=e('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-error"></div></div>').hide().appendTo(a),l=e('<div class="mejs-overlay mejs-layer mejs-overlay-play"><div class="mejs-overlay-button" role="button" aria-label="'+mejs.i18n.t("mejs.play")+'" aria-pressed="false"></div></div>').appendTo(a).bind("click",function(){if(r.options.clickToPlayPause){i.paused&&i.play();var t=e(this).find(".mejs-overlay-button"),n=t.attr("aria-pressed");t.attr("aria-pressed",!!n)}});i.addEventListener("play",function(){l.hide(),s.hide(),n.find(".mejs-time-buffering").hide(),o.hide()},!1),i.addEventListener("playing",function(){l.hide(),s.hide(),n.find(".mejs-time-buffering").hide(),o.hide()},!1),i.addEventListener("seeking",function(){s.show(),n.find(".mejs-time-buffering").show()},!1),i.addEventListener("seeked",function(){s.hide(),n.find(".mejs-time-buffering").hide()},!1),i.addEventListener("pause",function(){mejs.MediaFeatures.isiPhone||l.show()},!1),i.addEventListener("waiting",function(){s.show(),n.find(".mejs-time-buffering").show()},!1),i.addEventListener("loadeddata",function(){s.show(),n.find(".mejs-time-buffering").show(),mejs.MediaFeatures.isAndroid&&(i.canplayTimeout=window.setTimeout(function(){if(document.createEvent){var e=document.createEvent("HTMLEvents");return e.initEvent("canplay",!0,!0),i.dispatchEvent(e)}},300))},!1),i.addEventListener("canplay",function(){s.hide(),n.find(".mejs-time-buffering").hide(),clearTimeout(i.canplayTimeout)},!1),i.addEventListener("error",function(e){r.handleError(e),s.hide(),l.hide(),o.show(),o.find(".mejs-overlay-error").html("Error loading this resource")},!1),i.addEventListener("keydown",function(e){r.onkeydown(t,i,e)},!1)}},"buildkeyboard":function(t,n,a,i){var r=this;r.container.keydown(function(){r.keyboardAction=!0}),r.globalBind("keydown",function(n){return t.hasFocus=0!==e(n.target).closest(".mejs-container").length&&e(n.target).closest(".mejs-container").attr("id")===t.$media.closest(".mejs-container").attr("id"),r.onkeydown(t,i,n)}),r.globalBind("click",function(n){t.hasFocus=0!==e(n.target).closest(".mejs-container").length})},"onkeydown":function(e,t,n){if(e.hasFocus&&e.options.enableKeyboard)for(var a=0,i=e.options.keyActions.length;a<i;a++)for(var r=e.options.keyActions[a],s=0,o=r.keys.length;s<o;s++)if(n.keyCode==r.keys[s])return"function"==typeof n.preventDefault&&n.preventDefault(),r.action(e,t,n.keyCode,n),!1;return!0},"findTracks":function(){var t=this,n=t.$media.find("track");t.tracks=[],n.each(function(n,a){a=e(a),t.tracks.push({"srclang":a.attr("srclang")?a.attr("srclang").toLowerCase():"","src":a.attr("src"),"kind":a.attr("kind"),"label":a.attr("label")||"","entries":[],"isLoaded":!1})})},"changeSkin":function(e){this.container[0].className="mejs-container "+e,this.setPlayerSize(this.width,this.height),this.setControlsSize()},"play":function(){this.load(),this.media.play()},"pause":function(){try{this.media.pause()}catch(e){}},"load":function(){this.isLoaded||this.media.load(),this.isLoaded=!0},"setMuted":function(e){this.media.setMuted(e)},"setCurrentTime":function(e){this.media.setCurrentTime(e)},"getCurrentTime":function(){return this.media.currentTime},"setVolume":function(e){this.media.setVolume(e)},"getVolume":function(){return this.media.volume},"setSrc":function(e){var t=this;if("youtube"===t.media.pluginType){var n,a,i;if("string"!=typeof e)for(a=0;a<e.length;a++)if(i=e[a],this.canPlayType(i.type)){e=i.src;break}if(-1!==e.lastIndexOf("youtu.be"))-1!==(n=e.substr(e.lastIndexOf("/")+1)).indexOf("?")&&(n=n.substr(0,n.indexOf("?")));else{var r=e.match(/[?&]v=([^&#]+)|&|#|$/);r&&(n=r[1])}null!==t.media.getAttribute("autoplay")?t.media.pluginApi.loadVideoById(n):t.media.pluginApi.cueVideoById(n)}else t.media.setSrc(e)},"remove":function(){var e,t,n=this;for(e in n.container.prev(".mejs-offscreen").remove(),n.options.features)if(n["clean"+(t=n.options.features[e])])try{n["clean"+t](n)}catch(a){}n.isDynamic?n.$node.insertBefore(n.container):(n.$media.prop("controls",!0),n.$node.clone().insertBefore(n.container).show(),n.$node.remove()),"native"!==n.media.pluginType&&n.media.remove(),delete mejs.players[n.id],"object"==typeof n.container&&n.container.remove(),n.globalUnbind(),delete n.node.player},"rebuildtracks":function(){var e=this;e.findTracks(),e.buildtracks(e,e.controls,e.layers,e.media)},"resetSize":function(){var e=this;setTimeout(function(){e.setPlayerSize(e.width,e.height),e.setControlsSize()},50)}},function(){function t(t,a){var i={"d":[],"w":[]};return e.each((t||"").split(" "),function(e,t){var r=t+"."+a;0===r.indexOf(".")?(i.d.push(r),i.w.push(r)):i[n.test(t)?"w":"d"].push(r)}),i.d=i.d.join(" "),i.w=i.w.join(" "),i}var n=/^((after|before)print|(before)?unload|hashchange|message|o(ff|n)line|page(hide|show)|popstate|resize|storage)\b/;mejs.MediaElementPlayer.prototype.globalBind=function(n,a,i){var r=this,s=r.node?r.node.ownerDocument:document;(n=t(n,r.id)).d&&e(s).bind(n.d,a,i),n.w&&e(window).bind(n.w,a,i)},mejs.MediaElementPlayer.prototype.globalUnbind=function(n,a){var i=this,r=i.node?i.node.ownerDocument:document;(n=t(n,i.id)).d&&e(r).unbind(n.d,a),n.w&&e(window).unbind(n.w,a)}}(),void 0!==e&&(e.fn.mediaelementplayer=function(t){return!1===t?this.each(function(){var t=e(this).data("mediaelementplayer");t&&t.remove(),e(this).removeData("mediaelementplayer")}):this.each(function(){e(this).data("mediaelementplayer",new mejs.MediaElementPlayer(this,t))}),this},e(document).ready(function(){e(".mejs-player").mediaelementplayer()})),window.MediaElementPlayer=mejs.MediaElementPlayer}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"playText":"","pauseText":""}),e.extend(MediaElementPlayer.prototype,{"buildplaypause":function(t,n,a,i){function r(e){"play"===e?(d.removeClass("mejs-play").addClass("mejs-pause"),u.attr({"title":c,"aria-label":c})):(d.removeClass("mejs-pause").addClass("mejs-play"),u.attr({"title":l,"aria-label":l}))}var s=this,o=s.options,l=o.playText?o.playText:mejs.i18n.t("mejs.play"),c=o.pauseText?o.pauseText:mejs.i18n.t("mejs.pause"),d=e('<div class="mejs-button mejs-playpause-button mejs-play" ><button type="button" aria-controls="'+s.id+'" title="'+l+'" aria-label="'+c+'"></button></div>').appendTo(n).click(function(e){return e.preventDefault(),i.paused?i.play():i.pause(),!1}),u=d.find("button");r("pse"),i.addEventListener("play",function(){r("play")},!1),i.addEventListener("playing",function(){r("play")},!1),i.addEventListener("pause",function(){r("pse")},!1),i.addEventListener("paused",function(){r("pse")},!1)}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"stopText":"Stop"}),e.extend(MediaElementPlayer.prototype,{"buildstop":function(t,n,a,i){var r=this;e('<div class="mejs-button mejs-stop-button mejs-stop"><button type="button" aria-controls="'+r.id+'" title="'+r.options.stopText+'" aria-label="'+r.options.stopText+'"></button></div>').appendTo(n).click(function(){i.paused||i.pause(),i.currentTime>0&&(i.setCurrentTime(0),i.pause(),n.find(".mejs-time-current").width("0px"),n.find(".mejs-time-handle").css("left","0px"),n.find(".mejs-time-float-current").html(mejs.Utility.secondsToTimeCode(0,t.options)),n.find(".mejs-currenttime").html(mejs.Utility.secondsToTimeCode(0,t.options)),a.find(".mejs-poster").show())})}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"enableProgressTooltip":!0,"progressHelpText":""}),e.extend(MediaElementPlayer.prototype,{"buildprogress":function(t,n,a,i){var r=this,s=!1,o=0,l=!1,c=t.options.autoRewind,d=(r.options.progressHelpText?r.options.progressHelpText:mejs.i18n.t("mejs.time-help-text"),t.options.enableProgressTooltip?'<span class="mejs-time-float"><span class="mejs-time-float-current">00:00</span><span class="mejs-time-float-corner"></span></span>':"");e('<div class="mejs-time-rail"><span  class="mejs-time-total mejs-time-slider"><span class="mejs-time-buffering"></span><span class="mejs-time-loaded"></span><span class="mejs-time-current"></span><span class="mejs-time-handle"></span>'+d+"</span></div>").appendTo(n),n.find(".mejs-time-buffering").hide(),r.total=n.find(".mejs-time-total"),r.loaded=n.find(".mejs-time-loaded"),r.current=n.find(".mejs-time-current"),r.handle=n.find(".mejs-time-handle"),r.timefloat=n.find(".mejs-time-float"),r.timefloatcurrent=n.find(".mejs-time-float-current"),r.slider=n.find(".mejs-time-slider");var u=function(e){var n,a=r.total.offset(),o=r.total.width(),l=0,c=0,d=0;n=e.originalEvent&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageX:e.changedTouches?e.changedTouches[0].pageX:e.pageX,isFinite(i.duration)&&i.duration>0&&(n<a.left?n=a.left:n>o+a.left&&(n=o+a.left),c=!(l=(d=n-a.left)/o)||l<=.02?0:l*i.duration,s&&c!==i.currentTime&&i.setCurrentTime(c),mejs.MediaFeatures.hasTouch||(r.timefloat.css("left",d),r.timefloatcurrent.html(mejs.Utility.secondsToTimeCode(c,t.options)),r.timefloat.show()))},p=function(){var e=i.currentTime,n=mejs.i18n.t("mejs.time-slider"),a=mejs.Utility.secondsToTimeCode(e,t.options),s=i.duration;r.slider.attr({"aria-label":n,"aria-valuemin":0,"aria-valuemax":s,"aria-valuenow":e,"aria-valuetext":a,"role":"slider","tabindex":0})},f=function(){new Date-o>=1e3&&i.play()};r.slider.bind("focus",function(){t.options.autoRewind=!1}),r.slider.bind("blur",function(){t.options.autoRewind=c}),r.slider.bind("keydown",function(e){new Date-o>=1e3&&(l=i.paused);var n=e.keyCode,a=i.duration,r=i.currentTime,s=t.options.defaultSeekForwardInterval(i),c=t.options.defaultSeekBackwardInterval(i);switch(n){case 37:case 40:r-=c;break;case 39:case 38:r+=s;break;case 36:r=0;break;case 35:r=a;break;case 32:case 13:return void(i.paused?i.play():i.pause());default:return}return r=r<0?0:r>=a?a:Math.floor(r),o=new Date,l||i.pause(),r<i.duration&&!l&&setTimeout(f,1100),i.setCurrentTime(r),e.preventDefault(),e.stopPropagation(),!1}),r.total.bind("mousedown touchstart",function(e){1!==e.which&&0!==e.which||(s=!0,u(e),r.globalBind("mousemove.dur touchmove.dur",function(e){u(e)}),r.globalBind("mouseup.dur touchend.dur",function(){s=!1,"undefined"!=typeof r.timefloat&&r.timefloat.hide(),r.globalUnbind(".dur")}))}).bind("mouseenter",function(){!0,r.globalBind("mousemove.dur",function(e){u(e)}),"undefined"==typeof r.timefloat||mejs.MediaFeatures.hasTouch||r.timefloat.show()}).bind("mouseleave",function(){!1,s||(r.globalUnbind(".dur"),"undefined"!=typeof r.timefloat&&r.timefloat.hide())}),i.addEventListener("progress",function(e){t.setProgressRail(e),t.setCurrentRail(e)},!1),i.addEventListener("timeupdate",function(e){t.setProgressRail(e),t.setCurrentRail(e),p(e)},!1),r.container.on("controlsresize",function(e){t.setProgressRail(e),t.setCurrentRail(e)})},"setProgressRail":function(e){var t=this,n=e!==undefined?e.target:t.media,a=null;n&&n.buffered&&n.buffered.length>0&&n.buffered.end&&n.duration?a=n.buffered.end(n.buffered.length-1)/n.duration:n&&n.bytesTotal!==undefined&&n.bytesTotal>0&&n.bufferedBytes!==undefined?a=n.bufferedBytes/n.bytesTotal:e&&e.lengthComputable&&0!==e.total&&(a=e.loaded/e.total),null!==a&&(a=Math.min(1,Math.max(0,a)),t.loaded&&t.total&&t.loaded.width(t.total.width()*a))},"setCurrentRail":function(){var e=this;if(e.media.currentTime!==undefined&&e.media.duration&&e.total&&e.handle){var t=Math.round(e.total.width()*e.media.currentTime/e.media.duration),n=t-Math.round(e.handle.outerWidth(!0)/2);e.current.width(t),e.handle.css("left",n)}}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"duration":-1,"timeAndDurationSeparator":"<span> | </span>"}),e.extend(MediaElementPlayer.prototype,{"buildcurrent":function(t,n,a,i){var r=this;e('<div class="mejs-time" role="timer" aria-live="off"><span class="mejs-currenttime">'+mejs.Utility.secondsToTimeCode(0,t.options)+"</span></div>").appendTo(n),r.currenttime=r.controls.find(".mejs-currenttime"),i.addEventListener("timeupdate",function(){r.controlsAreVisible&&t.updateCurrent()},!1)},"buildduration":function(t,n,a,i){var r=this;n.children().last().find(".mejs-currenttime").length>0?e(r.options.timeAndDurationSeparator+'<span class="mejs-duration">'+mejs.Utility.secondsToTimeCode(r.options.duration,r.options)+"</span>").appendTo(n.find(".mejs-time")):(n.find(".mejs-currenttime").parent().addClass("mejs-currenttime-container"),e('<div class="mejs-time mejs-duration-container"><span class="mejs-duration">'+mejs.Utility.secondsToTimeCode(r.options.duration,r.options)+"</span></div>").appendTo(n)),r.durationD=r.controls.find(".mejs-duration"),i.addEventListener("timeupdate",function(){r.controlsAreVisible&&t.updateDuration()},!1)},"updateCurrent":function(){var e=this,t=e.media.currentTime;isFinite(t)||(t=0),e.currenttime&&e.currenttime.html(mejs.Utility.secondsToTimeCode(t,e.options))},"updateDuration":function(){var e=this,t=e.media.duration;e.options.duration>0&&(t=e.options.duration),isFinite(t)||(t=0),e.container.toggleClass("mejs-long-video",t>3600),e.durationD&&t>0&&e.durationD.html(mejs.Utility.secondsToTimeCode(t,e.options))}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"muteText":mejs.i18n.t("mejs.mute-toggle"),"allyVolumeControlText":mejs.i18n.t("mejs.volume-help-text"),"hideVolumeOnTouchDevices":!0,"audioVolume":"vertical","videoVolume":"vertical"}),e.extend(MediaElementPlayer.prototype,{"buildvolume":function(t,n,a,i){if(!mejs.MediaFeatures.isAndroid&&!mejs.MediaFeatures.isiOS||!this.options.hideVolumeOnTouchDevices){var r=this,s=r.isVideo?r.options.videoVolume:r.options.audioVolume,o="horizontal"==s?e('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+r.id+'" title="'+r.options.muteText+'" aria-label="'+r.options.muteText+'"></button></div><a href="javascript:void(0);" class="mejs-horizontal-volume-slider"><span class="mejs-offscreen">'+r.options.allyVolumeControlText+'</span><div class="mejs-horizontal-volume-total"></div><div class="mejs-horizontal-volume-current"></div><div class="mejs-horizontal-volume-handle"></div></a>').appendTo(n):e('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+r.id+'" title="'+r.options.muteText+'" aria-label="'+r.options.muteText+'"></button><a href="javascript:void(0);" class="mejs-volume-slider"><span class="mejs-offscreen">'+r.options.allyVolumeControlText+'</span><div class="mejs-volume-total"></div><div class="mejs-volume-current"></div><div class="mejs-volume-handle"></div></a></div>').appendTo(n),l=r.container.find(".mejs-volume-slider, .mejs-horizontal-volume-slider"),c=r.container.find(".mejs-volume-total, .mejs-horizontal-volume-total"),d=r.container.find(".mejs-volume-current, .mejs-horizontal-volume-current"),u=r.container.find(".mejs-volume-handle, .mejs-horizontal-volume-handle"),p=function(e,t){if(!l.is(":visible")&&void 0===t)return l.show(),p(e,!0),void l.hide();e=Math.max(0,e),0===(e=Math.min(e,1))?(o.removeClass("mejs-mute").addClass("mejs-unmute"),o.children("button").attr("title",mejs.i18n.t("mejs.unmute")).attr("aria-label",mejs.i18n.t("mejs.unmute"))):(o.removeClass("mejs-unmute").addClass("mejs-mute"),o.children("button").attr("title",mejs.i18n.t("mejs.mute")).attr("aria-label",mejs.i18n.t("mejs.mute")));var n=c.position();if("vertical"==s){var a=c.height(),i=a-a*e;u.css("top",Math.round(n.top+i-u.height()/2)),d.height(a-i),d.css("top",n.top+i)}else{var r=c.width()*e;u.css("left",Math.round(n.left+r-u.width()/2)),d.width(Math.round(r))}},f=function(e){var t=null,n=c.offset();if("vertical"===s){var a=c.height();if(t=(a-(e.pageY-n.top))/a,0===n.top||0===n.left)return}else{var r=c.width();t=(e.pageX-n.left)/r}t=Math.max(0,t),t=Math.min(t,1),p(t),0===t?i.setMuted(!0):i.setMuted(!1),i.setVolume(t)},b=!1,h=!1;o.hover(function(){l.show(),h=!0},function(){h=!1,b||"vertical"!=s||l.hide()});var m=function(){var e=Math.floor(100*i.volume);l.attr({"aria-label":mejs.i18n.t("mejs.volume-slider"),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e,"aria-valuetext":e+"%","role":"slider","tabindex":0})};l.bind("mouseover",function(){h=!0}).bind("mousedown",function(e){return f(e),r.globalBind("mousemove.vol",function(e){f(e)}),r.globalBind("mouseup.vol",function(){b=!1,r.globalUnbind(".vol"),h||"vertical"!=s||l.hide()}),b=!0,!1}).bind("keydown",function(e){var t=e.keyCode,n=i.volume;switch(t){case 38:
n=Math.min(n+.1,1);break;case 40:n=Math.max(0,n-.1);break;default:return!0}return b=!1,p(n),i.setVolume(n),!1}),o.find("button").click(function(){i.setMuted(!i.muted)}),o.find("button").bind("focus",function(){l.show()}),i.addEventListener("volumechange",function(e){b||(i.muted?(p(0),o.removeClass("mejs-mute").addClass("mejs-unmute")):(p(i.volume),o.removeClass("mejs-unmute").addClass("mejs-mute"))),m(e)},!1),0===t.options.startVolume&&i.setMuted(!0),"native"===i.pluginType&&i.setVolume(t.options.startVolume),r.container.on("controlsresize",function(){i.muted?(p(0),o.removeClass("mejs-mute").addClass("mejs-unmute")):(p(i.volume),o.removeClass("mejs-unmute").addClass("mejs-mute"))})}}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"usePluginFullScreen":!0,"newWindowCallback":function(){return""},"fullscreenText":""}),e.extend(MediaElementPlayer.prototype,{"isFullScreen":!1,"isNativeFullScreen":!1,"isInIframe":!1,"fullscreenMode":"","buildfullscreen":function(t,n,a,i){if(t.isVideo){t.isInIframe=window.location!=window.parent.location,i.addEventListener("loadstart",function(){t.detectFullscreenMode()});var r=this,s=null,o=r.options.fullscreenText?r.options.fullscreenText:mejs.i18n.t("mejs.fullscreen"),l=e('<div class="mejs-button mejs-fullscreen-button"><button type="button" aria-controls="'+r.id+'" title="'+o+'" aria-label="'+o+'"></button></div>').appendTo(n).on("click",function(){mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||t.isFullScreen?t.exitFullScreen():t.enterFullScreen()}).on("mouseover",function(){if("plugin-hover"==r.fullscreenMode){null!==s&&(clearTimeout(s),delete s);var e=l.offset(),n=t.container.offset();i.positionFullscreenButton(e.left-n.left,e.top-n.top,!0)}}).on("mouseout",function(){"plugin-hover"==r.fullscreenMode&&(null!==s&&(clearTimeout(s),delete s),s=setTimeout(function(){i.hideFullscreenButton()},1500))});if(t.fullscreenBtn=l,r.globalBind("keydown",function(e){27==e.keyCode&&(mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||r.isFullScreen)&&t.exitFullScreen()}),r.normalHeight=0,r.normalWidth=0,mejs.MediaFeatures.hasTrueNativeFullScreen){var c=function(){t.isFullScreen&&(mejs.MediaFeatures.isFullScreen()?(t.isNativeFullScreen=!0,t.setControlsSize()):(t.isNativeFullScreen=!1,t.exitFullScreen()))};t.globalBind(mejs.MediaFeatures.fullScreenEventName,c)}}},"detectFullscreenMode":function(){var e=this,t="",n=mejs.MediaFeatures;return n.hasTrueNativeFullScreen&&"native"===e.media.pluginType?t="native-native":n.hasTrueNativeFullScreen&&"native"!==e.media.pluginType&&!n.hasFirefoxPluginMovingProblem?t="plugin-native":e.usePluginFullScreen?mejs.MediaFeatures.supportsPointerEvents?(t="plugin-click",e.createPluginClickThrough()):t="plugin-hover":t="fullwindow",e.fullscreenMode=t,t},"isPluginClickThroughCreated":!1,"createPluginClickThrough":function(){var t=this;if(!t.isPluginClickThroughCreated){var n,a,i=!1,r=function(){if(i){for(var e in s)s[e].hide();t.fullscreenBtn.css("pointer-events",""),t.controls.css("pointer-events",""),t.media.removeEventListener("click",t.clickToPlayPauseCallback),i=!1}},s={},o=["top","left","right","bottom"],l=function(){var e=fullscreenBtn.offset().left-t.container.offset().left,a=fullscreenBtn.offset().top-t.container.offset().top,i=fullscreenBtn.outerWidth(!0),r=fullscreenBtn.outerHeight(!0),o=t.container.width(),l=t.container.height();for(n in s)s[n].css({"position":"absolute","top":0,"left":0});s.top.width(o).height(a),s.left.width(e).height(r).css({"top":a}),s.right.width(o-e-i).height(r).css({"top":a,"left":e+i}),s.bottom.width(o).height(l-r-a).css({"top":a+r})};for(t.globalBind("resize",function(){l()}),n=0,a=o.length;n<a;n++)s[o[n]]=e('<div class="mejs-fullscreen-hover" />').appendTo(t.container).mouseover(r).hide();fullscreenBtn.on("mouseover",function(){if(!t.isFullScreen){var e=fullscreenBtn.offset(),a=player.container.offset();for(n in media.positionFullscreenButton(e.left-a.left,e.top-a.top,!1),t.fullscreenBtn.css("pointer-events","none"),t.controls.css("pointer-events","none"),t.media.addEventListener("click",t.clickToPlayPauseCallback),s)s[n].show();l(),i=!0}}),media.addEventListener("fullscreenchange",function(){t.isFullScreen=!t.isFullScreen,t.isFullScreen?t.media.removeEventListener("click",t.clickToPlayPauseCallback):t.media.addEventListener("click",t.clickToPlayPauseCallback),r()}),t.globalBind("mousemove",function(e){if(i){var n=fullscreenBtn.offset();(e.pageY<n.top||e.pageY>n.top+fullscreenBtn.outerHeight(!0)||e.pageX<n.left||e.pageX>n.left+fullscreenBtn.outerWidth(!0))&&(fullscreenBtn.css("pointer-events",""),t.controls.css("pointer-events",""),i=!1)}}),t.isPluginClickThroughCreated=!0}},"cleanfullscreen":function(e){e.exitFullScreen()},"containerSizeTimeout":null,"enterFullScreen":function(){var t=this;if(mejs.MediaFeatures.isiOS&&mejs.MediaFeatures.hasiOSFullScreen&&"function"==typeof t.media.webkitEnterFullscreen)t.media.webkitEnterFullscreen();else{e(document.documentElement).addClass("mejs-fullscreen"),t.normalHeight=t.container.height(),t.normalWidth=t.container.width(),"native-native"===t.fullscreenMode||"plugin-native"===t.fullscreenMode?(mejs.MediaFeatures.requestFullScreen(t.container[0]),t.isInIframe&&setTimeout(function a(){if(t.isNativeFullScreen){var n=.002,i=e(window).width(),r=screen.width;Math.abs(r-i)>r*n?t.exitFullScreen():setTimeout(a,500)}},1e3)):t.fullscreeMode,t.container.addClass("mejs-container-fullscreen").width("100%").height("100%"),t.containerSizeTimeout=setTimeout(function(){t.container.css({"width":"100%","height":"100%"}),t.setControlsSize()},500),"native"===t.media.pluginType?t.$media.width("100%").height("100%"):(t.container.find(".mejs-shim").width("100%").height("100%"),setTimeout(function(){var n=e(window),a=n.width(),i=n.height();t.media.setVideoSize(a,i)},500)),t.layers.children("div").width("100%").height("100%"),t.fullscreenBtn&&t.fullscreenBtn.removeClass("mejs-fullscreen").addClass("mejs-unfullscreen"),t.setControlsSize(),t.isFullScreen=!0;var n=Math.min(screen.width/t.width,screen.height/t.height);t.container.find(".mejs-captions-text").css("font-size",100*n+"%"),t.container.find(".mejs-captions-text").css("line-height","normal"),t.container.find(".mejs-captions-position").css("bottom","45px"),t.container.trigger("enteredfullscreen")}},"exitFullScreen":function(){var t=this;clearTimeout(t.containerSizeTimeout),mejs.MediaFeatures.hasTrueNativeFullScreen&&(mejs.MediaFeatures.isFullScreen()||t.isFullScreen)&&mejs.MediaFeatures.cancelFullScreen(),e(document.documentElement).removeClass("mejs-fullscreen"),t.container.removeClass("mejs-container-fullscreen").width(t.normalWidth).height(t.normalHeight),"native"===t.media.pluginType?t.$media.width(t.normalWidth).height(t.normalHeight):(t.container.find(".mejs-shim").width(t.normalWidth).height(t.normalHeight),t.media.setVideoSize(t.normalWidth,t.normalHeight)),t.layers.children("div").width(t.normalWidth).height(t.normalHeight),t.fullscreenBtn.removeClass("mejs-unfullscreen").addClass("mejs-fullscreen"),t.setControlsSize(),t.isFullScreen=!1,t.container.find(".mejs-captions-text").css("font-size",""),t.container.find(".mejs-captions-text").css("line-height",""),t.container.find(".mejs-captions-position").css("bottom",""),t.container.trigger("exitedfullscreen")}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"speeds":["2.00","1.50","1.25","1.00","0.75"],"defaultSpeed":"1.00","speedChar":"x"}),e.extend(MediaElementPlayer.prototype,{"buildspeed":function(t,n,a,i){var r=this;if("native"==r.media.pluginType){for(var s=null,o=null,l=null,c=null,d=[],u=!1,p=0,f=r.options.speeds.length;p<f;p++){var b=r.options.speeds[p];"string"==typeof b?(d.push({"name":b+r.options.speedChar,"value":b}),b===r.options.defaultSpeed&&(u=!0)):(d.push(b),b.value===r.options.defaultSpeed&&(u=!0))}u||d.push({"name":r.options.defaultSpeed+r.options.speedChar,"value":r.options.defaultSpeed}),d.sort(function(e,t){return parseFloat(t.value)-parseFloat(e.value)});var h=function(e){for(p=0,f=d.length;p<f;p++)if(d[p].value===e)return d[p].name},m='<div class="mejs-button mejs-speed-button"><button type="button">'+h(r.options.defaultSpeed)+'</button><div class="mejs-speed-selector"><ul>';for(p=0,il=d.length;p<il;p++)c=r.id+"-speed-"+d[p].value,m+='<li><input type="radio" name="speed" value="'+d[p].value+'" id="'+c+'" '+(d[p].value===r.options.defaultSpeed?" checked":"")+' /><label for="'+c+'" '+(d[p].value===r.options.defaultSpeed?' class="mejs-speed-selected"':"")+">"+d[p].name+"</label></li>";s=e(m+="</ul></div></div>").appendTo(n),o=s.find(".mejs-speed-selector"),l=r.options.defaultSpeed,i.addEventListener("loadedmetadata",function(){l&&(i.playbackRate=parseFloat(l))},!0),s.on("click",function(){e(this).toggleClass("open")}).on("focusout",function(){e(this).removeClass("open")}),o.on("mousedown",function(e){e.stopPropagation(),e.preventDefault()}).on("click",'input[type="radio"]',function(){var t=e(this).attr("value");l=t,i.playbackRate=parseFloat(t),s.find("button").html(h(t)),s.find(".mejs-speed-selected").removeClass("mejs-speed-selected"),s.find('input[type="radio"]:checked').next().addClass("mejs-speed-selected"),setTimeout(function(){s.removeClass("open")},1)}),s.one("mouseenter focusin",function(){o.height(s.find(".mejs-speed-selector ul").outerHeight(!0)+s.find(".mejs-speed-translations").outerHeight(!0)).css("top",-1*o.height()+"px")})}}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"startLanguage":"","tracksText":"","tracksAriaLive":!1,"hideCaptionsButtonWhenEmpty":!0,"toggleCaptionsButtonWhenOnlyOne":!1,"slidesSelector":""}),e.extend(MediaElementPlayer.prototype,{"hasChapters":!1,"cleartracks":function(e){e&&(e.captions&&e.captions.remove(),e.chapters&&e.chapters.remove(),e.captionsText&&e.captionsText.remove(),e.captionsButton&&e.captionsButton.remove())},"buildtracks":function(t,n,a,i){if(0!==t.tracks.length){var r,s,o=this,l=o.options.tracksAriaLive?'role="log" aria-live="assertive" aria-atomic="false"':"",c=o.options.tracksText?o.options.tracksText:mejs.i18n.t("mejs.captions-subtitles");if(o.domNode.textTracks)for(r=o.domNode.textTracks.length-1;r>=0;r--)o.domNode.textTracks[r].mode="hidden";o.cleartracks(t,n,a,i),t.chapters=e('<div class="mejs-chapters mejs-layer"></div>').prependTo(a).hide(),t.captions=e('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position mejs-captions-position-hover" '+l+'><span class="mejs-captions-text"></span></div></div>').prependTo(a).hide(),t.captionsText=t.captions.find(".mejs-captions-text"),t.captionsButton=e('<div class="mejs-button mejs-captions-button"><button type="button" aria-controls="'+o.id+'" title="'+c+'" aria-label="'+c+'"></button><div class="mejs-captions-selector"><ul><li><input type="radio" name="'+t.id+'_captions" id="'+t.id+'_captions_none" value="none" checked="checked" /><label for="'+t.id+'_captions_none">'+mejs.i18n.t("mejs.none")+"</label></li></ul></div></div>").appendTo(n);var d=0;for(r=0;r<t.tracks.length;r++)"subtitles"!==(s=t.tracks[r].kind)&&"captions"!==s||d++;for(o.options.toggleCaptionsButtonWhenOnlyOne&&1==d?t.captionsButton.on("click",function(){null===t.selectedTrack?lang=t.tracks[0].srclang:lang="none",t.setTrack(lang)}):(t.captionsButton.on("mouseenter focusin",function(){e(this).find(".mejs-captions-selector").removeClass("mejs-offscreen")}).on("click","input[type=radio]",function(){lang=this.value,t.setTrack(lang)}),t.captionsButton.on("mouseleave focusout",function(){e(this).find(".mejs-captions-selector").addClass("mejs-offscreen")})),t.options.alwaysShowControls?t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover"):t.container.bind("controlsshown",function(){t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")}).bind("controlshidden",function(){i.paused||t.container.find(".mejs-captions-position").removeClass("mejs-captions-position-hover")}),t.trackToLoad=-1,t.selectedTrack=null,t.isLoadingTrack=!1,r=0;r<t.tracks.length;r++)"subtitles"!==(s=t.tracks[r].kind)&&"captions"!==s||t.addTrackButton(t.tracks[r].srclang,t.tracks[r].label);t.loadNextTrack(),i.addEventListener("timeupdate",function(){t.displayCaptions()},!1),""!==t.options.slidesSelector&&(t.slidesContainer=e(t.options.slidesSelector),i.addEventListener("timeupdate",function(){t.displaySlides()},!1)),i.addEventListener("loadedmetadata",function(){t.displayChapters()},!1),t.container.hover(function(){t.hasChapters&&(t.chapters.removeClass("mejs-offscreen"),t.chapters.fadeIn(200).height(t.chapters.find(".mejs-chapter").outerHeight()))},function(){t.hasChapters&&!i.paused&&t.chapters.fadeOut(200,function(){e(this).addClass("mejs-offscreen"),e(this).css("display","block")})}),o.container.on("controlsresize",function(){o.adjustLanguageBox()}),null!==t.node.getAttribute("autoplay")&&t.chapters.addClass("mejs-offscreen")}},"setTrack":function(e){var t,n=this;if("none"==e)n.selectedTrack=null,n.captionsButton.removeClass("mejs-captions-enabled");else for(t=0;t<n.tracks.length;t++)if(n.tracks[t].srclang==e){null===n.selectedTrack&&n.captionsButton.addClass("mejs-captions-enabled"),n.selectedTrack=n.tracks[t],n.captions.attr("lang",n.selectedTrack.srclang),n.displayCaptions();break}},"loadNextTrack":function(){var e=this;e.trackToLoad++,e.trackToLoad<e.tracks.length?(e.isLoadingTrack=!0,e.loadTrack(e.trackToLoad)):(e.isLoadingTrack=!1,e.checkForTracks())},"loadTrack":function(t){var n=this,a=n.tracks[t],i=function(){a.isLoaded=!0,n.enableTrackButton(a.srclang,a.label),n.loadNextTrack()};a.src===undefined&&""===a.src||e.ajax({"url":a.src,"dataType":"text","success":function(e){"string"==typeof e&&/<tt\s+xml/gi.exec(e)?a.entries=mejs.TrackFormatParser.dfxp.parse(e):a.entries=mejs.TrackFormatParser.webvtt.parse(e),i(),"chapters"==a.kind&&n.media.addEventListener("play",function(){n.media.duration>0&&n.displayChapters(a)},!1),"slides"==a.kind&&n.setupSlides(a)},"error":function(){n.removeTrackButton(a.srclang),n.loadNextTrack()}})},"enableTrackButton":function(t,n){var a=this;""===n&&(n=mejs.language.codes[t]||t),a.captionsButton.find("input[value="+t+"]").prop("disabled",!1).siblings("label").html(n),a.options.startLanguage==t&&e("#"+a.id+"_captions_"+t).prop("checked",!0).trigger("click"),a.adjustLanguageBox()},"removeTrackButton":function(e){var t=this;t.captionsButton.find("input[value="+e+"]").closest("li").remove(),t.adjustLanguageBox()},"addTrackButton":function(t,n){var a=this;""===n&&(n=mejs.language.codes[t]||t),a.captionsButton.find("ul").append(e('<li><input type="radio" name="'+a.id+'_captions" id="'+a.id+"_captions_"+t+'" value="'+t+'" disabled="disabled" /><label for="'+a.id+"_captions_"+t+'">'+n+" (loading)</label></li>")),a.adjustLanguageBox(),a.container.find(".mejs-captions-translations option[value="+t+"]").remove()},"adjustLanguageBox":function(){var e=this;e.captionsButton.find(".mejs-captions-selector").height(e.captionsButton.find(".mejs-captions-selector ul").outerHeight(!0)+e.captionsButton.find(".mejs-captions-translations").outerHeight(!0))},"checkForTracks":function(){var e=this,t=!1;if(e.options.hideCaptionsButtonWhenEmpty){for(var n=0;n<e.tracks.length;n++){var a=e.tracks[n].kind;if(("subtitles"===a||"captions"===a)&&e.tracks[n].isLoaded){t=!0;break}}t||(e.captionsButton.hide(),e.setControlsSize())}},"displayCaptions":function(){if("undefined"!=typeof this.tracks){var e,t=this,n=t.selectedTrack;if(null!==n&&n.isLoaded){for(e=0;e<n.entries.times.length;e++)if(t.media.currentTime>=n.entries.times[e].start&&t.media.currentTime<=n.entries.times[e].stop)return t.captionsText.html(n.entries.text[e]).attr("class","mejs-captions-text "+(n.entries.times[e].identifier||"")),void t.captions.show().height(0);t.captions.hide()}else t.captions.hide()}},"setupSlides":function(e){var t=this;t.slides=e,t.slides.entries.imgs=[t.slides.entries.text.length],t.showSlide(0)},"showSlide":function(t){if("undefined"!=typeof this.tracks&&"undefined"!=typeof this.slidesContainer){var n=this,a=n.slides.entries.text[t],i=n.slides.entries.imgs[t];void 0===i||"undefined"==typeof i.fadeIn?n.slides.entries.imgs[t]=i=e('<img src="'+a+'">').on("load",function(){i.appendTo(n.slidesContainer).hide().fadeIn().siblings(":visible").fadeOut()}):i.is(":visible")||i.is(":animated")||i.fadeIn().siblings(":visible").fadeOut()}},"displaySlides":function(){if("undefined"!=typeof this.slides){var e,t=this,n=t.slides;for(e=0;e<n.entries.times.length;e++)if(t.media.currentTime>=n.entries.times[e].start&&t.media.currentTime<=n.entries.times[e].stop)return void t.showSlide(e)}},"displayChapters":function(){var e,t=this;for(e=0;e<t.tracks.length;e++)if("chapters"==t.tracks[e].kind&&t.tracks[e].isLoaded){t.drawChapters(t.tracks[e]),t.hasChapters=!0;break}},"drawChapters":function(t){var n,a,i=this,r=0,s=0;for(i.chapters.empty(),n=0;n<t.entries.times.length;n++)a=t.entries.times[n].stop-t.entries.times[n].start,((r=Math.floor(a/i.media.duration*100))+s>100||n==t.entries.times.length-1&&r+s<100)&&(r=100-s),i.chapters.append(e('<div class="mejs-chapter" rel="'+t.entries.times[n].start+'" style="left: '+s.toString()+"%;width: "+r.toString()+'%;"><div class="mejs-chapter-block'+(n==t.entries.times.length-1?" mejs-chapter-block-last":"")+'"><span class="ch-title">'+t.entries.text[n]+'</span><span class="ch-time">'+mejs.Utility.secondsToTimeCode(t.entries.times[n].start,i.options)+"&ndash;"+mejs.Utility.secondsToTimeCode(t.entries.times[n].stop,i.options)+"</span></div></div>")),s+=r;i.chapters.find("div.mejs-chapter").click(function(){i.media.setCurrentTime(parseFloat(e(this).attr("rel"))),i.media.paused&&i.media.play()}),i.chapters.show()}}),mejs.language={"codes":{"af":"Afrikaans","sq":"Albanian","ar":"Arabic","be":"Belarusian","bg":"Bulgarian","ca":"Catalan","zh":"Chinese","zh-cn":"Chinese Simplified","zh-tw":"Chinese Traditional","hr":"Croatian","cs":"Czech","da":"Danish","nl":"Dutch","en":"English","et":"Estonian","fl":"Filipino","fi":"Finnish","fr":"French","gl":"Galician","de":"German","el":"Greek","ht":"Haitian Creole","iw":"Hebrew","hi":"Hindi","hu":"Hungarian","is":"Icelandic","id":"Indonesian","ga":"Irish","it":"Italian","ja":"Japanese","ko":"Korean","lv":"Latvian","lt":"Lithuanian","mk":"Macedonian","ms":"Malay","mt":"Maltese","no":"Norwegian","fa":"Persian","pl":"Polish","pt":"Portuguese","ro":"Romanian","ru":"Russian","sr":"Serbian","sk":"Slovak","sl":"Slovenian","es":"Spanish","sw":"Swahili","sv":"Swedish","tl":"Tagalog","th":"Thai","tr":"Turkish","uk":"Ukrainian","vi":"Vietnamese","cy":"Welsh","yi":"Yiddish"}},mejs.TrackFormatParser={"webvtt":{"pattern_timecode":/^((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{1,3})?) --\> ((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{3})?)(.*)$/,"parse":function(t){for(var n,a,i,r=0,s=mejs.TrackFormatParser.split2(t,/\r?\n/),o={"text":[],"times":[]};r<s.length;r++){if((n=this.pattern_timecode.exec(s[r]))&&r<s.length){for(r-1>=0&&""!==s[r-1]&&(i=s[r-1]),a=s[++r],r++;""!==s[r]&&r<s.length;)a=a+"\n"+s[r],r++;a=e.trim(a).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1' target='_blank'>$1</a>"),o.text.push(a),o.times.push({"identifier":i,"start":0===mejs.Utility.convertSMPTEtoSeconds(n[1])?.2:mejs.Utility.convertSMPTEtoSeconds(n[1]),"stop":mejs.Utility.convertSMPTEtoSeconds(n[3]),"settings":n[5]})}i=""}return o}},"dfxp":{"parse":function(t){var n,a,i=0,r=(t=e(t).filter("tt")).children("div").eq(0),s=r.find("p"),o=t.find("#"+r.attr("style")),l={"text":[],"times":[]};if(o.length){var c=o.removeAttr("id").get(0).attributes;if(c.length)for(n={},i=0;i<c.length;i++)n[c[i].name.split(":")[1]]=c[i].value}for(i=0;i<s.length;i++){var d,u={"start":null,"stop":null,"style":null};if(s.eq(i).attr("begin")&&(u.start=mejs.Utility.convertSMPTEtoSeconds(s.eq(i).attr("begin"))),!u.start&&s.eq(i-1).attr("end")&&(u.start=mejs.Utility.convertSMPTEtoSeconds(s.eq(i-1).attr("end"))),s.eq(i).attr("end")&&(u.stop=mejs.Utility.convertSMPTEtoSeconds(s.eq(i).attr("end"))),!u.stop&&s.eq(i+1).attr("begin")&&(u.stop=mejs.Utility.convertSMPTEtoSeconds(s.eq(i+1).attr("begin"))),n)for(var p in d="",n)d+=p+":"+n[p]+";";d&&(u.style=d),0===u.start&&(u.start=.2),l.times.push(u),a=e.trim(s.eq(i).html()).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1' target='_blank'>$1</a>"),l.text.push(a)}return l}},"split2":function(e,t){return e.split(t)}},3!="x\n\ny".split(/\n/gi).length&&(mejs.TrackFormatParser.split2=function(e,t){var n,a=[],i="";for(n=0;n<e.length;n++)i+=e.substring(n,n+1),t.test(i)&&(a.push(i.replace(t,"")),i="");return a.push(i),a})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"sourcechooserText":""}),e.extend(MediaElementPlayer.prototype,{"buildsourcechooser":function(t,n,a,i){var r,s=this,o=s.options.sourcechooserText?s.options.sourcechooserText:mejs.i18n.t("mejs.source-chooser");for(var l in t.sourcechooserButton=e('<div class="mejs-button mejs-sourcechooser-button"><button type="button" role="button" aria-haspopup="true" aria-owns="'+s.id+'" title="'+o+'" aria-label="'+o+'"></button><div class="mejs-sourcechooser-selector mejs-offscreen" role="menu" aria-expanded="false" aria-hidden="true"><ul></ul></div></div>').appendTo(n).hover(function(){clearTimeout(r),t.showSourcechooserSelector()},function(){e(this);r=setTimeout(function(){t.hideSourcechooserSelector()},500)}).on("keydown",function(n){switch(n.keyCode){case 32:mejs.MediaFeatures.isFirefox||t.showSourcechooserSelector(),e(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 13:t.showSourcechooserSelector(),e(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 27:t.hideSourcechooserSelector(),e(this).find("button").focus();break;default:return!0}}).on("focusout",mejs.Utility.debounce(function(){setTimeout(function(){e(document.activeElement).closest(".mejs-sourcechooser-selector").length||t.hideSourcechooserSelector()},0)},100)).delegate("input[type=radio]","click",function(){e(this).attr("aria-selected",!0).attr("checked","checked"),e(this).closest(".mejs-sourcechooser-selector").find("input[type=radio]").not(this).attr("aria-selected","false").removeAttr("checked");var t=this.value;if(i.currentSrc!=t){var n=i.currentTime,a=i.paused;i.pause(),i.setSrc(t),i.addEventListener("loadedmetadata",function(){i.currentTime=n},!0);var r=function(){a||i.play(),i.removeEventListener("canplay",r,!0)};i.addEventListener("canplay",r,!0),i.load()}}).delegate("button","click",function(){e(this).siblings(".mejs-sourcechooser-selector").hasClass("mejs-offscreen")?(t.showSourcechooserSelector(),e(this).siblings(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus()):t.hideSourcechooserSelector()}),this.node.children){var c=this.node.children[l];"SOURCE"!==c.nodeName||"probably"!=i.canPlayType(c.type)&&"maybe"!=i.canPlayType(c.type)||t.addSourceButton(c.src,c.title,c.type,i.src==c.src)}},"addSourceButton":function(t,n,a,i){var r=this;""!==n&&n!=undefined||(n=t),a=a.split("/")[1],r.sourcechooserButton.find("ul").append(e('<li><input type="radio" name="'+r.id+'_sourcechooser" id="'+r.id+"_sourcechooser_"+n+a+'" role="menuitemradio" value="'+t+'" '+(i?'checked="checked"':"")+'aria-selected="'+i+'" /><label for="'+r.id+"_sourcechooser_"+n+a+'" aria-hidden="true">'+n+" ("+a+")</label></li>")),r.adjustSourcechooserBox()},"adjustSourcechooserBox":function(){var e=this;e.sourcechooserButton.find(".mejs-sourcechooser-selector").height(e.sourcechooserButton.find(".mejs-sourcechooser-selector ul").outerHeight(!0))},"hideSourcechooserSelector":function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").addClass("mejs-offscreen").attr("aria-expanded","false").attr("aria-hidden","true").find("input[type=radio]").attr("tabindex","-1")},"showSourcechooserSelector":function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").removeClass("mejs-offscreen").attr("aria-expanded","true").attr("aria-hidden","false").find("input[type=radio]").attr("tabindex","0")}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"contextMenuItems":[{"render":function(e){return"undefined"==typeof e.enterFullScreen?null:e.isFullScreen?mejs.i18n.t("mejs.fullscreen-off"):mejs.i18n.t("mejs.fullscreen-on")},"click":function(e){e.isFullScreen?e.exitFullScreen():e.enterFullScreen()}},{"render":function(e){return e.media.muted?mejs.i18n.t("mejs.unmute"):mejs.i18n.t("mejs.mute")},"click":function(e){e.media.muted?e.setMuted(!1):e.setMuted(!0)}},{"isSeparator":!0},{"render":function(){return mejs.i18n.t("mejs.download-video")},"click":function(e){window.location.href=e.media.currentSrc}}]}),e.extend(MediaElementPlayer.prototype,{"buildcontextmenu":function(t){t.contextMenu=e('<div class="mejs-contextmenu"></div>').appendTo(e("body")).hide(),t.container.bind("contextmenu",function(e){if(t.isContextMenuEnabled)return e.preventDefault(),t.renderContextMenu(e.clientX-1,e.clientY-1),!1}),t.container.bind("click",function(){t.contextMenu.hide()}),t.contextMenu.bind("mouseleave",function(){t.startContextMenuTimer()})},"cleancontextmenu":function(e){e.contextMenu.remove()},"isContextMenuEnabled":!0,"enableContextMenu":function(){this.isContextMenuEnabled=!0},"disableContextMenu":function(){this.isContextMenuEnabled=!1},"contextMenuTimeout":null,"startContextMenuTimer":function(){var e=this;e.killContextMenuTimer(),e.contextMenuTimer=setTimeout(function(){e.hideContextMenu(),e.killContextMenuTimer()},750)},"killContextMenuTimer":function(){var e=this.contextMenuTimer;null!=e&&(clearTimeout(e),delete e,e=null)},"hideContextMenu":function(){this.contextMenu.hide()},"renderContextMenu":function(t,n){for(var a=this,i="",r=a.options.contextMenuItems,s=0,o=r.length;s<o;s++)if(r[s].isSeparator)i+='<div class="mejs-contextmenu-separator"></div>';else{var l=r[s].render(a);null!=l&&(i+='<div class="mejs-contextmenu-item" data-itemindex="'+s+'" id="element-'+1e6*Math.random()+'">'+l+"</div>")}a.contextMenu.empty().append(e(i)).css({"top":n,"left":t}).show(),a.contextMenu.find(".mejs-contextmenu-item").each(function(){var t=e(this),n=parseInt(t.data("itemindex"),10),i=a.options.contextMenuItems[n];"undefined"!=typeof i.show&&i.show(t,a),t.click(function(){"undefined"!=typeof i.click&&i.click(a),a.contextMenu.hide()})}),setTimeout(function(){a.killControlsTimer("rev3")},100)}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"skipBackInterval":30,"skipBackText":""}),e.extend(MediaElementPlayer.prototype,{"buildskipback":function(t,n,a,i){var r=this,s=mejs.i18n.t("mejs.time-skip-back",r.options.skipBackInterval),o=r.options.skipBackText?r.options.skipBackText:s;e('<div class="mejs-button mejs-skip-back-button"><button type="button" aria-controls="'+r.id+'" title="'+o+'" aria-label="'+o+'">'+r.options.skipBackInterval+"</button></div>").appendTo(n).click(function(){i.setCurrentTime(Math.max(i.currentTime-r.options.skipBackInterval,0)),e(this).find("button").blur()})}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"postrollCloseText":""}),e.extend(MediaElementPlayer.prototype,{"buildpostroll":function(t,n,a){var i=this,r=i.options.postrollCloseText?i.options.postrollCloseText:mejs.i18n.t("mejs.close"),s=i.container.find('link[rel="postroll"]').attr("href");void 0!==s&&(t.postroll=e('<div class="mejs-postroll-layer mejs-layer"><a class="mejs-postroll-close" onclick="$(this).parent().hide();return false;">'+r+'</a><div class="mejs-postroll-layer-content"></div></div>').prependTo(a).hide(),i.media.addEventListener("ended",function(){e.ajax({"dataType":"html","url":s,"success":function(e){a.find(".mejs-postroll-layer-content").html(e)}}),t.postroll.show()},!1))}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{"markerColor":"#E9BC3D","markers":[],"markerCallback":function(){}}),e.extend(MediaElementPlayer.prototype,{"buildmarkers":function(e,t,n,a){var i=0,r=-1,s=-1,o=-1,l=-1;for(i=0;i<e.options.markers.length;++i)t.find(".mejs-time-total").append('<span class="mejs-time-marker"></span>');a.addEventListener("durationchange",function(){e.setmarkers(t)}),a.addEventListener("timeupdate",function(){for(r=Math.floor(a.currentTime),o>r?l>r&&(l=-1):o=r,i=0;i<e.options.markers.length;++i)s=Math.floor(e.options.markers[i]),r===s&&s!==l&&(e.options.markerCallback(a,a.currentTime),l=s)},!1)},"setmarkers":function(t){var n,a=this,i=0;for(i=0;i<a.options.markers.length;++i)Math.floor(a.options.markers[i])<=a.media.duration&&Math.floor(a.options.markers[i])>=0&&(n=100*Math.floor(a.options.markers[i])/a.media.duration,e(t.find(".mejs-time-marker")[i]).css({"width":"1px","left":n+"%","background":a.options.markerColor}))}})}(mejs.$),
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-05-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See http://www.datejs.com/license/.
 * @website: http://www.datejs.com/
 */
Date.CultureInfo={"name":"en-US","englishName":"English (United States)","nativeName":"English (United States)","dayNames":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"abbreviatedDayNames":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"shortestDayNames":["Su","Mo","Tu","We","Th","Fr","Sa"],"firstLetterDayNames":["S","M","T","W","T","F","S"],"monthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"abbreviatedMonthNames":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"amDesignator":"AM","pmDesignator":"PM","firstDayOfWeek":0,"twoDigitYearMax":2029,"dateElementOrder":"mdy","formatPatterns":{"shortDate":"M/d/yyyy","longDate":"dddd, MMMM dd, yyyy","shortTime":"h:mm tt","longTime":"h:mm:ss tt","fullDateTime":"dddd, MMMM dd, yyyy h:mm:ss tt","sortableDateTime":"yyyy-MM-ddTHH:mm:ss","universalSortableDateTime":"yyyy-MM-dd HH:mm:ssZ","rfc1123":"ddd, dd MMM yyyy HH:mm:ss GMT","monthDay":"MMMM dd","yearMonth":"MMMM, yyyy"},"regexPatterns":{"jan":/^jan(uary)?/i,"feb":/^feb(ruary)?/i,"mar":/^mar(ch)?/i,"apr":/^apr(il)?/i,"may":/^may/i,"jun":/^jun(e)?/i,"jul":/^jul(y)?/i,"aug":/^aug(ust)?/i,"sep":/^sep(t(ember)?)?/i,"oct":/^oct(ober)?/i,"nov":/^nov(ember)?/i,"dec":/^dec(ember)?/i,"sun":/^su(n(day)?)?/i,"mon":/^mo(n(day)?)?/i,"tue":/^tu(e(s(day)?)?)?/i,"wed":/^we(d(nesday)?)?/i,"thu":/^th(u(r(s(day)?)?)?)?/i,"fri":/^fr(i(day)?)?/i,"sat":/^sa(t(urday)?)?/i,"future":/^next/i,"past":/^last|past|prev(ious)?/i,"add":/^(\+|aft(er)?|from|hence)/i,"subtract":/^(\-|bef(ore)?|ago)/i,"yesterday":/^yes(terday)?/i,"today":/^t(od(ay)?)?/i,"tomorrow":/^tom(orrow)?/i,"now":/^n(ow)?/i,"millisecond":/^ms|milli(second)?s?/i,"second":/^sec(ond)?s?/i,"minute":/^mn|min(ute)?s?/i,"hour":/^h(our)?s?/i,"week":/^w(eek)?s?/i,"month":/^m(onth)?s?/i,"day":/^d(ay)?s?/i,"year":/^y(ear)?s?/i,"shortMeridian":/^(a|p)/i,"longMeridian":/^(a\.?m?\.?|p\.?m?\.?)/i,"timezone":/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,"ordinalSuffix":/^\s*(st|nd|rd|th)/i,"timeContext":/^\s*(\:|a(?!u|p)|p)/i},"timezones":[{"name":"UTC","offset":"-000"},{"name":"GMT","offset":"-000"},{"name":"EST","offset":"-0500"},{"name":"EDT","offset":"-0400"},{"name":"CST","offset":"-0600"},{"name":"CDT","offset":"-0500"},{"name":"MST","offset":"-0700"},{"name":"MDT","offset":"-0600"},{"name":"PST","offset":"-0800"},{"name":"PDT","offset":"-0700"}]},function(){var e,t,n,a=Date,i=a.prototype,r=a.CultureInfo,s=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};i.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},i.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},a.today=function(){return(new Date).clearTime()},a.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},a.equals=function(e,t){return 0===e.compareTo(t)},a.getDayNumberFromName=function(e){for(var t=r.dayNames,n=r.abbreviatedDayNames,a=r.shortestDayNames,i=e.toLowerCase(),s=0;s<t.length;s++)if(t[s].toLowerCase()==i||n[s].toLowerCase()==i||a[s].toLowerCase()==i)return s;return-1},a.getMonthNumberFromName=function(e){for(var t=r.monthNames,n=r.abbreviatedMonthNames,a=e.toLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase()==a||n[i].toLowerCase()==a)return i;return-1},a.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},a.getDaysInMonth=function(e,t){return[31,a.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},a.getTimezoneAbbreviation=function(e){for(var t=r.timezones,n=0;n<t.length;n++)if(t[n].offset===e)return t[n].name;return null},a.getTimezoneOffset=function(e){for(var t=r.timezones,n=0;n<t.length;n++)if(t[n].name===e.toUpperCase())return t[n].offset;return null},i.clone=function(){return new Date(this.getTime())},i.compareTo=function(e){return Date.compare(this,e)},i.equals=function(e){return Date.equals(this,e||new Date)},i.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},i.isAfter=function(e){return 1===this.compareTo(e||new Date)},i.isBefore=function(e){return-1===this.compareTo(e||new Date)},i.isToday=function(){return this.isSameDay(new Date)},i.isSameDay=function(e){return this.clone().clearTime().equals(e.clone().clearTime())},i.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},i.addSeconds=function(e){return this.addMilliseconds(1e3*e)},i.addMinutes=function(e){return this.addMilliseconds(6e4*e)},i.addHours=function(e){return this.addMilliseconds(36e5*e)},i.addDays=function(e){return this.setDate(this.getDate()+e),this},i.addWeeks=function(e){return this.addDays(7*e)},i.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,a.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},i.addYears=function(e){return this.addMonths(12*e)},i.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),this},i.getWeek=function(){var a,i,r,s,o,l,c;return e=e||this.getFullYear(),t=t||this.getMonth()+1,n=n||this.getDate(),t<=2?(c=(i=((a=e-1)/4|0)-(a/100|0)+(a/400|0))-(((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0)),r=0,s=n-1+31*(t-1)):(r=(c=(i=((a=e)/4|0)-(a/100|0)+(a/400|0))-(((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0)))+1,s=n+(153*(t-3)+2)/5+58+c),e=t=n=null,(l=s+3-(s+(o=(a+i)%7)-r)%7|0)<0?53-((o-c)/5|0):l>364+c?1:1+(l/7|0)},i.getISOWeek=function(){return e=this.getUTCFullYear(),t=this.getUTCMonth()+1,n=this.getUTCDate(),s(this.getWeek())},i.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())},a._validate=function(e,t,n,a){if(void 0===e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(e<t||e>n)throw new RangeError(e+" is not a valid value for "+a+".");return!0},a.validateMillisecond=function(e){return a._validate(e,0,999,"millisecond")},a.validateSecond=function(e){return a._validate(e,0,59,"second")},a.validateMinute=function(e){return a._validate(e,0,59,"minute")},a.validateHour=function(e){return a._validate(e,0,23,"hour")},a.validateDay=function(e,t,n){return a._validate(e,1,a.getDaysInMonth(t,n),"day")},a.validateMonth=function(e){return a._validate(e,0,11,"month")},a.validateYear=function(e){return a._validate(e,0,9999,"year")},i.set=function(e){return a.validateMillisecond(e.millisecond)&&this.addMilliseconds(e.millisecond-this.getMilliseconds()),a.validateSecond(e.second)&&this.addSeconds(e.second-this.getSeconds()),a.validateMinute(e.minute)&&this.addMinutes(e.minute-this.getMinutes()),a.validateHour(e.hour)&&this.addHours(e.hour-this.getHours()),a.validateMonth(e.month)&&this.addMonths(e.month-this.getMonth()),a.validateYear(e.year)&&this.addYears(e.year-this.getFullYear()),a.validateDay(e.day,this.getFullYear(),this.getMonth())&&this.addDays(e.day-this.getDate()),e.timezone&&this.setTimezone(e.timezone),e.timezoneOffset&&this.setTimezoneOffset(e.timezoneOffset),e.week&&a._validate(e.week,0,53,"week")&&this.setWeek(e.week),this},i.moveToFirstDayOfMonth=function(){return this.set({"day":1})},i.moveToLastDayOfMonth=function(){return this.set({"day":a.getDaysInMonth(this.getFullYear(),this.getMonth())})},i.moveToNthOccurrence=function(e,t){var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)},i.moveToDayOfWeek=function(e,t){var n=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===n?n+=7*(t||1):n)},i.moveToMonth=function(e,t){var n=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===n?n+=12*(t||1):n)},i.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},i.getTimezone=function(){return a.getTimezoneAbbreviation(this.getUTCOffset())},i.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return this.addMinutes(n-t)},i.setTimezone=function(e){return this.setTimezoneOffset(a.getTimezoneOffset(e))},i.hasDaylightSavingTime=function(){return Date.today().set({"month":0,"day":1}).getTimezoneOffset()!==Date.today().set({"month":6,"day":1}).getTimezoneOffset()},i.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({"month":6,"day":1}).getTimezoneOffset()},i.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return t<0?(e=(t-1e4).toString()).charAt(0)+e.substr(2):"+"+(e=(t+1e4).toString()).substr(1)},i.getElapsed=function(e){return(e||new Date)-this},i.toISOString||(i.toISOString=function(){function e(e){return e<10?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),i._toString=i.toString,i.toString=function(e){var t=this;if(e&&1==e.length){var n=r.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(n.shortDate);case"D":return t.t(n.longDate);case"F":return t.t(n.fullDateTime);case"m":return t.t(n.monthDay);case"r":return t.t(n.rfc1123);case"s":return t.t(n.sortableDateTime);case"t":return t.t(n.shortTime);case"T":return t.t(n.longTime);case"u":return t.t(n.universalSortableDateTime);case"y":return t.t(n.yearMonth)}}var a=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return s(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return s(t.h());case"H":return t.h();case"mm":return s(t.getMinutes());case"m":return t.getMinutes();case"ss":return s(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return s(t.getFullYear(),4);case"yy":return s(t.getFullYear());case"dddd":return r.dayNames[t.getDay()];case"ddd":return r.abbreviatedDayNames[t.getDay()];case"dd":return s(t.getDate());case"d":return t.getDate();case"MMMM":return r.monthNames[t.getMonth()];case"MMM":return r.abbreviatedMonthNames[t.getMonth()];case"MM":return s(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?r.amDesignator.substring(0,1):r.pmDesignator.substring(0,1);case"tt":return t.h()<12?r.amDesignator:r.pmDesignator;case"S":return a(t.getDate());default:return e}}):this._toString()}}(),function(){var e=Date,t=e.prototype,n=e.CultureInfo,a=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,a._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},a.fromNow=a.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},a.ago=a.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var i,r="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),s="january february march april may june july august september october november december".split(/\s/),o="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),l="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),c="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<o.length;t++)e[o[t].toLowerCase()]=this["get"+l[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var d=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var a=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>a)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(a.getMonth())+" "+a.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},u=function(t){return function(){var a=e.today(),i=t-a.getDay();return 0===t&&1===n.firstDayOfWeek&&0!==a.getDay()&&(i+=7),a.addDays(i)}},p=0;p<r.length;p++)e[r[p].toUpperCase()]=e[r[p].toUpperCase().substring(0,3)]=p,e[r[p]]=e[r[p].substring(0,3)]=u(p),t[r[p]]=t[r[p].substring(0,3)]=d(p);for(var f=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},b=function(t){return function(){return e.today().set({"month":t,"day":1})}},h=0;h<s.length;h++)e[s[h].toUpperCase()]=e[s[h].toUpperCase().substring(0,3)]=h,e[s[h]]=e[s[h].substring(0,3)]=b(h),t[s[h]]=t[s[h].substring(0,3)]=f(h);for(var m=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),n=(arguments[0]||new Date).toObject(),a="",i=e.toLowerCase(),r=o.length-1;r>-1;r--){if(t[a=o[r].toLowerCase()]!=n[a])return!1;if(i==a)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},v=function(e){return function(){return this._dateElement=e,this}},g=0;g<o.length;g++)t[i=o[g].toLowerCase()]=t[i+"s"]=m(o[g]),a[i]=a[i+"s"]=v(i);t._ss=m("Second");for(var _=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||t!==undefined&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},y=0;y<c.length;y++)t[c[y]]=_(0===y?-1:y)}(),function(){Date.Parsing={"Exception":function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={"rtoken":function(t){return function(n){var a=n.match(t);if(a)return[a[0],n.substring(a[0].length)];throw new e.Exception(n)}},"token":function(){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},"stoken":function(e){return t.rtoken(new RegExp("^"+e))},"until":function(e){return function(t){for(var n=[],a=null;t.length;){try{a=e.call(this,t)}catch(i){n.push(a[0]),t=a[1];continue}break}return[n,t]}},"many":function(e){return function(t){for(var n=[],a=null;t.length;){try{a=e.call(this,t)}catch(i){return[n,t]}n.push(a[0]),t=a[1]}return[n,t]}},"optional":function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(a){return[null,t]}return[n[0],n[1]]}},"not":function(t){return function(n){try{t.call(this,n)}catch(a){return[null,n]}throw new e.Exception(n)}},"ignore":function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},"product":function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),a=[],i=0;i<e.length;i++)a.push(t.each(e[i],n));return a},"cache":function(t){var n={},a=null;return function(i){try{a=n[i]=n[i]||t.call(this,i)}catch(r){a=n[i]=r}if(a instanceof e.Exception)throw a;return a}},"any":function(){var t=arguments;return function(n){for(var a=null,i=0;i<t.length;i++)if(null!=t[i]){try{a=t[i].call(this,n)}catch(r){a=null}if(a)return a}throw new e.Exception(n)}},"each":function(){var t=arguments;return function(n){for(var a=[],i=null,r=0;r<t.length;r++)if(null!=t[r]){try{i=t[r].call(this,n)}catch(s){throw new e.Exception(n)}a.push(i[0]),n=i[1]}return[a,n]}},"all":function(){var e=arguments,t=t;return t.each(t.optional(e))},"sequence":function(n,a,i){return a=a||t.rtoken(/^\s*/),i=i||null,1==n.length?n[0]:function(t){for(var r=null,s=null,o=[],l=0;l<n.length;l++){try{r=n[l].call(this,t)}catch(c){break}o.push(r[0]);try{s=a.call(this,r[1])}catch(d){s=null;break}t=s[1]}if(!r)throw new e.Exception(t);if(s)throw new e.Exception(s[1]);if(i)try{r=i.call(this,r[1])}catch(u){throw new e.Exception(r[1])}return[o,r?r[1]:t]}},"between":function(e,n,a){a=a||e;var i=t.each(t.ignore(e),n,t.ignore(a));return function(e){var t=i.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},"list":function(e,n,a){return n=n||t.rtoken(/^\s*/),a=a||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(a)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(a))},"set":function(n,a,i){return a=a||t.rtoken(/^\s*/),i=i||null,function(r){for(var s=null,o=null,l=null,c=null,d=[[],r],u=!1,p=0;p<n.length;p++){l=null,o=null,s=null,u=1==n.length;try{s=n[p].call(this,r)}catch(h){continue}if(c=[[s[0]],s[1]],s[1].length>0&&!u)try{l=a.call(this,s[1])}catch(m){u=!0}else u=!0;if(u||0!==l[1].length||(u=!0),!u){for(var f=[],b=0;b<n.length;b++)p!=b&&f.push(n[b]);(o=t.set(f,a).call(this,l[1]))[0].length>0&&(c[0]=c[0].concat(o[0]),c[1]=o[1])}if(c[1].length<d[1].length&&(d=c),0===d[1].length)break}if(0===d[0].length)return d;if(i){try{l=i.call(this,d[1])}catch(v){throw new e.Exception(d[1])}d[1]=l[1]}return d}},"forward":function(e,t){return function(n){return e[t].call(this,n)}},"replace":function(e,t){return function(n){var a=e.call(this,n);return[t,a[1]]}},"process":function(e,t){return function(n){var a=e.call(this,n);return[t.call(this,a[0]),a[1]]}},"min":function(t,n){return function(a){var i=n.call(this,a);if(i[0].length<t)throw new e.Exception(a);return i}}},n=function(e){return function(){var t=null,n=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var a=0,i=t.shift();a<i.length;a++)return t.unshift(i[a]),n.push(e.apply(null,t)),t.shift(),n}},a="optional not ignore cache".split(/\s/),i=0;i<a.length;i++)t[a[i]]=n(t[a[i]]);for(var s=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},o="each any all".split(/\s/),l=0;l<o.length;l++)t[o[l]]=s(t[o[l]])}(),function(){var e=Date,t=(e.prototype,e.CultureInfo),n=function(e){for(var t=[],a=0;a<e.length;a++)e[a]instanceof Array?t=t.concat(n(e[a])):e[a]&&t.push(e[a]);return t};e.Grammar={},e.Translator={"hour":function(e){return function(){this.hour=Number(e)}},"minute":function(e){return function(){this.minute=Number(e)}},"second":function(e){return function(){this.second=Number(e)}},"meridian":function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},"timezone":function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},"day":function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},"month":function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},"year":function(e){return function(){var n=Number(e);this.year=e.length>2?n:n+(n+2e3<t.twoDigitYearMax?2e3:1900)}},"rday":function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},"finishExact":function(t){t=t instanceof Array?t:[t];for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);var a=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=a.getDate()),this.year||(this.year=a.getFullYear()),this.month||0===this.month||(this.month=a.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?i.set({"timezone":this.timezone}):this.timezoneOffset&&i.set({"timezoneOffset":this.timezoneOffset}),i},"finish":function(t){if(0===(t=t instanceof Array?n(t):[t]).length)return null;for(var a=0;a<t.length;a++)"function"==typeof t[a]&&t[a].call(this);var i=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(i=new Date);var r,s,o,l=!!(this.days&&null!==this.days||this.orient||this.operator);if(o="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||i.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,l=!0),!l&&this.weekday&&!this.day&&!this.days){var c=Date[this.weekday]();this.day=c.getDate(),this.month||(this.month=c.getMonth()),this.year=c.getFullYear()}if(l&&this.weekday&&"month"!=this.unit&&(this.unit="day",r=e.getDayNumberFromName(this.weekday)-i.getDay(),s=7,this.days=r?(r+o*s)%s:o*s),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(i.set({"day":1*this.value}),l||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,l=!0),l&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",r=this.month-i.getMonth(),s=12,this.months=r?(r+o*s)%s:o*s,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*o:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*o),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){c=Date[this.weekday]();this.day=c.getDate(),c.getMonth()!==i.getMonth()&&(this.month=c.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(l&&this.timezone&&this.day&&this.days&&(this.day=this.days),l?i.add(this):i.set(this)):Date.today().setWeek(this.value)}};var a,i=e.Parsing.Operators,r=e.Grammar,s=e.Translator;r.datePartDelimiter=i.rtoken(/^([\s\-\.\,\/\x27]+)/),r.timePartDelimiter=i.stoken(":"),r.whiteSpace=i.rtoken(/^\s*/),r.generalDelimiter=i.rtoken(/^(([\s\,]|at|@|on)+)/);var o={};r.ctoken=function(e){var n=o[e];if(!n){for(var a=t.regexPatterns,r=e.split(/\s+/),s=[],l=0;l<r.length;l++)s.push(i.replace(i.rtoken(a[r[l]]),r[l]));n=o[e]=i.any.apply(null,s)}return n},r.ctoken2=function(e){return i.rtoken(t.regexPatterns[e])},r.h=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),s.hour)),r.hh=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2])/),s.hour)),r.H=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),s.hour)),r.HH=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3])/),s.hour)),r.m=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),s.minute)),r.mm=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),s.minute)),r.s=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),s.second)),r.ss=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),s.second)),r.hms=i.cache(i.sequence([r.H,r.m,r.s],r.timePartDelimiter)),r.t=i.cache(i.process(r.ctoken2("shortMeridian"),s.meridian)),r.tt=i.cache(i.process(r.ctoken2("longMeridian"),s.meridian)),r.z=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),s.timezone)),r.zz=i.cache(i.process(i.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),s.timezone)),r.zzz=i.cache(i.process(r.ctoken2("timezone"),s.timezone)),r.timeSuffix=i.each(i.ignore(r.whiteSpace),i.set([r.tt,r.zzz])),r.time=i.each(i.optional(i.ignore(i.stoken("T"))),r.hms,r.timeSuffix),r.d=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1]|\d)/),i.optional(r.ctoken2("ordinalSuffix"))),s.day)),r.dd=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1])/),i.optional(r.ctoken2("ordinalSuffix"))),s.day)),r.ddd=r.dddd=i.cache(i.process(r.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),r.M=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d|\d)/),s.month)),r.MM=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d)/),s.month)),r.MMM=r.MMMM=i.cache(i.process(r.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),s.month)),r.y=i.cache(i.process(i.rtoken(/^(\d\d?)/),s.year)),r.yy=i.cache(i.process(i.rtoken(/^(\d\d)/),s.year)),r.yyy=i.cache(i.process(i.rtoken(/^(\d\d?\d?\d?)/),s.year)),r.yyyy=i.cache(i.process(i.rtoken(/^(\d\d\d\d)/),s.year)),a=function(){return i.each(i.any.apply(null,arguments),i.not(r.ctoken2("timeContext")))},r.day=a(r.d,r.dd),r.month=a(r.M,r.MMM),r.year=a(r.yyyy,r.yy),r.orientation=i.process(r.ctoken("past future"),function(e){return function(){this.orient=e}}),r.operator=i.process(r.ctoken("add subtract"),function(e){return function(){this.operator=e}}),r.rday=i.process(r.ctoken("yesterday tomorrow today now"),s.rday),r.unit=i.process(r.ctoken("second minute hour day week month year"),function(e){return function(){this.unit=e}}),r.value=i.process(i.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),r.expression=i.set([r.rday,r.operator,r.value,r.unit,r.orientation,r.ddd,r.MMM]),a=function(){return i.set(arguments,r.datePartDelimiter)},r.mdy=a(r.ddd,r.month,r.day,r.year),r.ymd=a(r.ddd,r.year,r.month,r.day),r.dmy=a(r.ddd,r.day,r.month,r.year),r.date=function(e){return(r[t.dateElementOrder]||r.mdy).call(this,e)},r.format=i.process(i.many(i.any(i.process(i.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(r[t])return r[t];throw e.Parsing.Exception(t)}),i.process(i.rtoken(/^[^dMyhHmstz]+/),function(e){return i.ignore(i.stoken(e))}))),function(e){return i.process(i.each.apply(null,e),s.finishExact)});var l={},c=function(e){return l[e]=l[e]||r.format(e)[0]};r.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(c(e[n]));return i.any.apply(null,t)}return c(e)},r._formats=r.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),r._start=i.process(i.set([r.date,r.time,r.expression],r.generalDelimiter,r.whiteSpace),s.finish),r.start=function(e){try{var t=r._formats.call({},e);if(0===t[1].length)return t}catch(n){}return r._start.call({},e)},e._parse=e.parse,e.parse=function(t){var n=null;if(!t)return null;if(t instanceof Date)return t;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(a){return null}return 0===n[1].length?n[0]:null},e.getParseFunction=function(t){var n=e.Grammar.formats(t);return function(e){var t=null;try{t=n.call({},e)}catch(a){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}(),function(e){var t=function(t,n,a){var i,r="object"==typeof n;this.startDate=Date.today(),this.endDate=Date.today(),this.minDate=!1,this.maxDate=!1,this.changed=!1,this.ranges={},this.opens="right",this.cb=function(){},this.format="MM/dd/yyyy",this.separator=" - ",this.showWeekNumbers=!1,this.buttonClasses=["btn-success"],this.locale={"applyLabel":"Set","fromLabel":"From","toLabel":"To","weekLabel":"W","customRangeLabel":"Custom Range","daysOfWeek":Date.CultureInfo.shortestDayNames,"monthNames":Date.CultureInfo.monthNames,"firstDay":0},i=this.locale,this.leftCalendar={"month":Date.today().set({"day":1,"month":this.startDate.getMonth(),"year":this.startDate.getFullYear()}),"calendar":Array()},this.rightCalendar={"month":Date.today().set({"day":1,"month":this.endDate.getMonth(),"year":this.endDate.getFullYear()}),"calendar":Array()},this.parentEl="body",this.element=e(t),this.element.hasClass("pull-right")&&(this.opens="left"),this.element.is("input")?this.element.on({"click":e.proxy(this.show,this),"focus":e.proxy(this.show,this)}):this.element.on("click",e.proxy(this.show,this)),r&&"object"==typeof n.locale&&e.each(i,function(e,t){i[e]=n.locale[e]||t});var s='<div class="daterangepicker dropdown-menu"><div class="calendar left"></div><div class="calendar right"></div><div class="ranges"><div class="range_inputs"><div><label for="daterangepicker_start">'+this.locale.fromLabel+'</label><input class="input-mini" type="text" id="daterangepicker_start" name="daterangepicker_start" value="" disabled="disabled" /></div><div><label for="daterangepicker_end">'+this.locale.toLabel+'</label><input class="input-mini" type="text" id="daterangepicker_end" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="button callout" disabled="disabled">'+this.locale.applyLabel+"</button></div></div></div>";if(this.parentEl=r&&n.parentEl&&e(n.parentEl)||e(this.parentEl),this.container=e(s).appendTo(this.parentEl),r){if("string"==typeof n.format&&(this.format=n.format),"string"==typeof n.separator&&(this.separator=n.separator),"string"==typeof n.startDate&&(this.startDate=Date.parse(n.startDate,this.format)),"string"==typeof n.endDate&&(this.endDate=Date.parse(n.endDate,this.format)),"string"==typeof n.minDate&&(this.minDate=Date.parse(n.minDate,this.format)),"string"==typeof n.maxDate&&(this.maxDate=Date.parse(n.maxDate,this.format)),"object"==typeof n.startDate&&(this.startDate=n.startDate),"object"==typeof n.endDate&&(this.endDate=n.endDate),"object"==typeof n.minDate&&(this.minDate=n.minDate),"object"==typeof n.maxDate&&(this.maxDate=n.maxDate),"object"==typeof n.ranges){for(var o in n.ranges){var l=n.ranges[o][0],c=n.ranges[o][1];"string"==typeof l&&(l=Date.parse(l)),"string"==typeof c&&(c=Date.parse(c)),this.minDate&&l<this.minDate&&(l=this.minDate),this.maxDate&&c>this.maxDate&&(c=this.maxDate),this.minDate&&c<this.minDate||this.maxDate&&l>this.maxDate||(this.ranges[o]=[l,c])}var d="<ul>";for(var o in this.ranges)d+="<li>"+o+"</li>";d+="<li>"+this.locale.customRangeLabel+"</li>",d+="</ul>",this.container.find(".ranges").prepend(d)}if("object"==typeof n.locale&&"number"==typeof n.locale.firstDay){this.locale.firstDay=n.locale.firstDay;for(var u=n.locale.firstDay;u>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),u--}"string"==typeof n.opens&&(this.opens=n.opens),"boolean"==typeof n.showWeekNumbers&&(this.showWeekNumbers=n.showWeekNumbers),"string"==typeof n.buttonClasses&&(this.buttonClasses=[n.buttonClasses]),"object"==typeof n.buttonClasses&&(this.buttonClasses=n.buttonClasses)}var p=this.container;if(e.each(this.buttonClasses,function(e,t){p.find("button").addClass(t)}),"right"==this.opens){var f=this.container.find(".calendar.left"),b=this.container.find(".calendar.right");f.removeClass("left").addClass("right"),b.removeClass("right").addClass("left")}void 0!==n&&"undefined"!=typeof n.ranges||this.container.find(".calendar").show(),"function"==typeof a&&(this.cb=a),this.container.addClass("opens"+this.opens),this.container.on("mousedown",e.proxy(this.mousedown,this)),this.container.find(".calendar").on("click",".prev",e.proxy(this.clickPrev,this)),this.container.find(".calendar").on("click",".next",e.proxy(this.clickNext,this)),this.container.find(".ranges").on("click","button",e.proxy(this.clickApply,this)),this.container.find(".calendar").on("click","td.available",e.proxy(this.clickDate,this)),this.container.find(".calendar").on("mouseenter","td.available",e.proxy(this.enterDate,this)),this.container.find(".calendar").on("mouseleave","td.available",e.proxy(this.updateView,this)),this.container.find(".ranges").on("click","li",e.proxy(this.clickRange,this)),this.container.find(".ranges").on("mouseenter","li",e.proxy(this.enterRange,this)),this.container.find(".ranges").on("mouseleave","li",e.proxy(this.updateView,this)),this.element.on("keyup",e.proxy(this.updateFromControl,this)),this.updateView(),this.updateCalendars()};t.prototype={"constructor":t,"mousedown":function(e){e.stopPropagation(),e.preventDefault()},"updateView":function(){this.notSet||(this.leftCalendar.month.set({"month":this.startDate.getMonth(),"year":this.startDate.getFullYear()}),this.rightCalendar.month.set({"month":this.endDate.getMonth(),"year":this.endDate.getFullYear()}),this.container.find("input[name=daterangepicker_start]").val(this.startDate.toString(this.format)),
this.container.find("input[name=daterangepicker_end]").val(this.endDate.toString(this.format)),this.startDate.equals(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button").removeAttr("disabled"):this.container.find("button").attr("disabled","disabled"))},"updateFromControl":function(){if(this.element.is("input")){var e=this.element.val().split(this.separator),t=Date.parseExact(e[0],this.format),n=Date.parseExact(e[1],this.format);null!=t&&null!=n&&(n.isBefore(t)||(this.startDate=t,this.endDate=n,this.updateView(),this.cb(this.startDate,this.endDate),this.updateCalendars()))}},"notify":function(){this.updateView(),this.element.is("input")&&this.element.val(this.startDate.toString(this.format)+this.separator+this.endDate.toString(this.format)),this.cb(this.startDate,this.endDate)},"move":function(){var t={"top":this.parentEl.offset().top-this.parentEl.scrollTop(),"left":this.parentEl.offset().left-this.parentEl.scrollLeft()};"left"==this.opens?this.container.css({"top":this.element.offset().top+this.element.outerHeight()-t.top,"right":e(window).width()-this.element.offset().left-this.element.outerWidth()-t.left,"left":"auto"}):this.container.css({"top":this.element.offset().top+this.element.outerHeight()-t.top,"left":this.element.offset().left-t.left,"right":"auto"})},"show":function(t){this.container.show(),this.move(),t&&(t.stopPropagation(),t.preventDefault()),this.changed=!1,e(document).on("mousedown",e.proxy(this.hide,this))},"hide":function(){this.container.hide(),e(document).off("mousedown",this.hide),this.changed&&(this.changed=!1,this.notify())},"enterRange":function(e){var t=e.target.innerHTML;if(t==this.locale.customRangeLabel)this.updateView();else{var n=this.ranges[t];this.container.find("input[name=daterangepicker_start]").val(n[0].toString(this.format)),this.container.find("input[name=daterangepicker_end]").val(n[1].toString(this.format))}},"clickRange":function(e){var t=e.target.innerHTML;if(t==this.locale.customRangeLabel)this.container.find(".calendar").show(),this.container.find(".range_inputs").show().find("div").hide();else{var n=this.ranges[t];this.startDate=n[0],this.endDate=n[1],this.startDate&&this.leftCalendar.month.set({"month":this.startDate.getMonth(),"year":this.startDate.getFullYear()}),this.endDate&&this.rightCalendar.month.set({"month":this.endDate.getMonth(),"year":this.endDate.getFullYear()}),this.endDate&&this.startDate?(this.updateCalendars(),this.notSet=!1):this.notSet=!0,this.changed=!0,this.container.find(".calendar").hide(),this.hide()}},"clickPrev":function(t){e(t.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add({"months":-1}):this.rightCalendar.month.add({"months":-1}),this.updateCalendars()},"clickNext":function(t){e(t.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add({"months":1}):this.rightCalendar.month.add({"months":1}),this.updateCalendars()},"enterDate":function(t){var n=e(t.target).attr("title"),a=n.substr(1,1),i=n.substr(3,1);e(t.target).parents(".calendar").hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[a][i].toString(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[a][i].toString(this.format))},"clickDate":function(t){var n=e(t.target).attr("title"),a=n.substr(1,1),i=n.substr(3,1),r=e(t.target).parents(".calendar");r.hasClass("left")?(startDate=this.leftCalendar.calendar[a][i],endDate=this.endDate):(startDate=this.startDate,endDate=this.rightCalendar.calendar[a][i]),r.find("td").removeClass("active"),(startDate.equals(endDate)||startDate.isBefore(endDate))&&(e(t.target).addClass("active"),startDate.equals(this.startDate)&&endDate.equals(this.endDate)||(this.changed=!0),this.startDate=startDate,this.endDate=endDate),this.leftCalendar.month.set({"month":this.startDate.getMonth(),"year":this.startDate.getFullYear()}),this.rightCalendar.month.set({"month":this.endDate.getMonth(),"year":this.endDate.getFullYear()}),this.updateCalendars()},"clickApply":function(){this.hide()},"updateCalendars":function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.getMonth(),this.leftCalendar.month.getFullYear()),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.getMonth(),this.rightCalendar.month.getFullYear()),this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.endDate)),this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate))},"buildCalendar":function(e,t){for(var n=Date.today().set({"day":1,"month":e,"year":t}),a=n.clone().add(-1).day().getMonth(),i=n.clone().add(-1).day().getFullYear(),r=(Date.getDaysInMonth(t,e),Date.getDaysInMonth(i,a)),s=n.getDay(),o=Array(),l=0;l<6;l++)o[l]=Array();var c=r-s+this.locale.firstDay+1;c>r&&(c-=7),s==this.locale.firstDay&&(c=r-6);for(var d=Date.today().set({"day":c,"month":a,"year":i}),u=(l=0,0),p=0;l<42;l++,u++,d=d.clone().add(1).day())l>0&&u%7==0&&(u=0,p++),o[p][u]=d;return o},"renderCalendar":function(t,n,a,i){var r='<table class="table-condensed">';r+="<thead>",r+="<tr>",this.showWeekNumbers&&(r+="<th></th>"),!a||a<t[1][1]?r+='<th class="prev available"><i class="font-arrow-left"></i></th>':r+="<th></th>",r+='<th colspan="5" style="width: auto">'+this.locale.monthNames[t[1][1].getMonth()]+t[1][1].toString(" yyyy")+"</th>",!i||i>t[1][1]?r+='<th class="next available"><i class="font-arrow-right"></i></th>':r+="<th></th>",r+="</tr>",r+="<tr>",this.showWeekNumbers&&(r+='<th class="week">'+this.locale.weekLabel+"</th>"),e.each(this.locale.daysOfWeek,function(e,t){r+="<th>"+t+"</th>"}),r+="</tr>",r+="</thead>",r+="<tbody>";for(var s=0;s<6;s++){r+="<tr>",this.showWeekNumbers&&(r+='<td class="week">'+t[s][0].getWeek()+"</td>");for(var o=0;o<7;o++){var l="available ";l+=t[s][o].getMonth()==t[1][1].getMonth()?"":"off",n.setHours(0,0,0,0),a&&t[s][o]<a||i&&t[s][o]>i?l="off disabled":t[s][o].equals(n)&&(l+="active"),r+='<td class="'+l+'" title="'+("r"+s+"c"+o)+'">'+t[s][o].getDate()+"</td>"}r+="</tr>"}return r+="</tbody>",r+="</table>"}},e.fn.daterangepicker=function(n,a){return this.each(function(){var i=e(this);i.data("daterangepicker")||i.data("daterangepicker",new t(i,n,a))}),this}}(window.jQuery);
/* ==========================================================
 * bootstrap-formhelpers-phone.format.js v1.3.0
 * https://github.com/vlamanna/BootstrapFormHelpers
 * ==========================================================
 * Copyright 2012 Vincent Lamanna
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file edcept in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either edpress or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
var PhoneOverlays={"1":{"CA":["403","780","250","604","778","204","506","709","867","902","289","416","519","613","647","705","807","905","418","450","514","819","306","437","226","236","249","343","365","431","438","579","581","587","639","873"],"PR":["787","939"],"DO":["809","829","849"],"AS":["684"],"AI":["264"],"AG":["268"],"BS":["242"],"BB":["246"],"BM":["441"],"KY":["345"],"DM":["767"],"GD":["473"],"GU":["671"],"JM":["876"],"MS":["664"],"MP":["670"],"KN":["869"],"LC":["758"],"VC":["784"],"SX":["721"],"TT":["868"],"TC":["649"],"VG":["284"],"VI":["340"]}},PhoneFormatList={"AF":"0dd ddd dddd","AL":"0dd ddd ddd","DZ":"ddd dd dd dd?d","AS":"(ddd) ddd-dddd","AD":"ddddddddd","AO":"ddd ddd ddd","AI":"(ddd) ddd-dddd","AQ":"ddddddddd","AG":"(ddd) ddd-dddd","AR":"(dd) dd dddd-dd?dd","AM":"0dd dddddd","AW":"ddd dddd","AU":"dd dddd ddd?ddd","AT":"ddd? ddd ddd dddd","AZ":"ddddddddd","BH":"dddd ddd?dd","BD":"ddddddddd","BB":"(ddd) ddd-dddd","BY":"ddddddddd","BE":"dddd dd dd?d","BZ":"ddd dddd?dd","BJ":"ddddddddd","BM":"(ddd) ddd-dddd","BT":"ddddddddd","BO":"d ddddddd?dd","BA":"ddddddddd","BW":"ddddddd?d","BV":"ddddddddd","BR":"dd dddd-dddd?d","IO":"ddddddddd","VG":"(ddd) ddd-dddd","BN":"ddddddddd","BG":"dddd ddddd?d","BF":"ddddddddd","BI":"ddddddddd","CI":"ddddddddd","KH":"ddddddddd","CM":"ddddddddd","CA":"(ddd) ddd-dddd","CV":"ddddddddd","KY":"(ddd) ddd-dddd","CF":"ddddddddd","TD":"ddddddddd","CL":"ddddd dddd?d","CN":"ddd ddd ddd?dd","CX":"ddddddddd","CC":"ddddddddd","CO":"ddd dddd ?ddddd","KM":"ddddddddd","CG":"ddddddddd","CK":"ddddddddd","CR":"dddd-dddd?d","HR":"dd ddd dddd","CU":"ddddddddd","CY":"dd dddddd?d","CZ":"ddd ddd ddd","CD":"ddddddddd","DK":"dd dd dd dd?dd","DJ":"ddddddddd","DM":"(ddd) ddd-dddd","DO":"(ddd) ddd-dddd","TL":"ddddddddd","EC":"ddddddddd","EG":"dd-dddd-ddd?d","SV":"dddd dddd?d","GQ":"ddddddddd","ER":"ddddddddd","EE":"ddd dddd?dd","ET":"ddddddddd","FO":"ddddddddd","FK":"ddddddddd","FJ":"ddddddddd","FI":"d ddd ddd?ddd","MK":"ddddddddd","FR":"d dd dd dd dd","GF":"ddddddddd","PF":"ddddddddd","TF":"ddddddddd","GA":"ddddddddd","GE":"dd-dd-ddd dd? dddd","DE":"ddd ddd dd?dddd","GH":"ddddddddd","GI":"ddddddddd","GR":"ddddd dddd?d","GL":"ddddddddd","GD":"(ddd) ddd-dddd","GP":"ddddddddd","GU":"(ddd) ddd-dddd","GT":"dddd dddd","GN":"ddddddddd","GW":"ddddddddd","GY":"ddd dddd","HT":"dddd dddd","HM":"ddddddddd","HN":"dddd-dddd","HK":"ddd ddd d?dd","HU":"d d ddd-ddd?dd","IS":"ddd dddd","IN":"ddd ddd ddd?ddd","ID":"ddd.dddd.dd?dd","IR":"ddddddddd","IQ":"ddddddddd","IE":"(0dd) ddd dd?ddd","IL":"d-ddd-dddd?dd","IT":"ddd ddd-dd?ddddd","JM":"(ddd) ddd-dddd","JP":"0dd-dddd-ddd?d","JO":"ddddddddd","KZ":"ddddddddd","KE":"ddd dddddd","KI":"ddddddddd","KW":"ddddddddd","KG":"ddddddddd","LA":"ddddddddd","LV":"dd ddd ddd","LB":"dd ddddd?dd","LS":"ddddddddd","LR":"ddddddddd","LY":"ddddddddd","LI":"ddddddddd","LT":"d ddd dddd","LU":"dd dd dd? dddd","MO":"ddddddddd","MG":"ddddddddd","MW":"ddddddddd","MY":"dd-dd dddd?dd","MV":"ddddddddd","ML":"ddddddddd","MT":"dddd dddd?d","MH":"ddddddddd","MQ":"ddddddddd","MR":"ddddddddd","MU":"ddddddddd","YT":"ddddddddd","MX":"dddd-dddd?ddd","FM":"ddddddddd","MD":"dd-dd-dd-dd?d","MC":"dd dd dd dd?dd","MN":"ddddddddd","MS":"(ddd) ddd-dddd","MA":"ddddddddd","MZ":"ddddddddd","MM":"ddddddddd","NA":"ddddddddd","NR":"ddddddddd","NP":"ddddddddd","NL":"ddd dddddd?dd","AN":"ddd dddd?d","NC":"ddddddddd","NZ":"dd ddd-ddd?dd","NI":"dddd dddd","NE":"ddddddddd","NG":"ddd dddd? dd","NU":"ddddddddd","NF":"ddddddddd","KP":"ddddddddd","MP":"(ddd) ddd-dddd","NO":"dd dd dd d?ddddd","OM":"ddddddddd","PK":"dddd dd?ddd","PW":"ddddddddd","PA":"ddd-dddd?d","PG":"ddddddddd","PY":"ddddddddd","PE":"dddddd?ddd","PH":"d-ddd dddd?dd","PN":"ddd-ddddd?ddd","PL":"dd ddd dd dd? dd","PT":"ddd ddd ddd","PR":"(ddd) ddd-dddd","QA":"ddddddddd","RE":"ddddddddd","RO":"ddd ddd ddd","RS":"dd ddd dd ?dd","RU":"d.ddd.ddd-dd?-dd","RW":"ddddddddd","ST":"ddddddddd","SH":"ddddddddd","KN":"(ddd) ddd-dddd","LC":"(ddd) ddd-dddd","PM":"ddddddddd","VC":"(ddd) ddd-dddd","WS":"ddddddddd","SM":"ddddddddd","SA":"dd ddd dddd?dd","SN":"ddddddddd","SC":"ddddddddd","SL":"ddddddddd","SG":"dddd dddd?dd","SK":"ddddddddd","SI":"dd ddd dd? dd","SB":"ddddddddd","SO":"ddddddddd","ZA":"dd ddd dddd","GS":"ddddddddd","KR":"dd dddd ddd?dd","ES":"dd ddd dd dd","LK":"ddddddddd","SD":"ddddddddd","SR":"dd dddd?d","SJ":"ddddddddd","SZ":"ddddddddd","SE":"dd-ddd dd d?d ddd","CH":"dddd-dd dd d?d dd","SY":"ddddddddd","TW":"dddd d?dd dd","TJ":"ddddddddd","TZ":"ddddddddd","TH":"dd ddd ddd?dd","BS":"(ddd) ddd-dddd","GM":"ddddddddd","TG":"ddddddddd","TK":"ddddddddd","TO":"ddddddddd","TT":"(ddd) ddd-dddd","TN":"ddddddddd","TR":"(ddd) ddd-dddd","TM":"ddddddddd","TC":"(ddd) ddd-dddd","TV":"ddddddddd","VI":"(ddd) ddd-dddd","UG":"ddddddddd","UA":"ddd dd-dd-dd?dd","AE":"ddd ddd dd?d ddd","GB":"ddddd dddd?dd","US":"(ddd) ddd-dddd","UM":"ddddddddd","UY":"ddddddddd","UZ":"ddddddddd","VU":"ddddddddd","VA":"ddddddddd","VE":"ddd ddd dddd","VN":"ddd-dddddd?d","WF":"ddddddddd","EH":"ddddddddd","YE":"ddddddddd","YU":"ddddddddd","ZM":"ddddddddd","ZW":"ddddddddd","SX":"(ddd) ddd-dddd","SIP":"****************************************"};$.fn.ratingPicker=function(e){return e=e||{},this.each(function(){var t=$(this),n=e.start.call(t);n&&!isNaN(n)||(n=0),t.html('<select class="rating-picker" style="width:'+e.width+'px;height:28px"'+(t.attr("readonly")||t.attr("disabled")?" disabled ":"")+'><option value="0">No rating</option><option value="1">\u2605</option><option value="2">\u2605\u2605</option><option value="3">\u2605\u2605\u2605</option><option value="4">\u2605\u2605\u2605\u2605</option><option value="5">\u2605\u2605\u2605\u2605\u2605</option></select><input type="hidden" name="score">');var a=t.find("select");return a.val(n),$(e.target).val(n),a.change(function(){$("input[name=score]").val(a.val()),$(e.target).val(a.val())}),this})},this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_agent_selector"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="agent-selector">'),a.b("\n"+n),a.b('  <input class="input-agent-selector" type="text"/><br/>'),a.b("\n"+n),a.s(a.f("canAddAgents",e,t,1),e,t,0,105,153,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="add-agent font-plus-sign-2"></a>'),a.b("\n"+n)}),e.pop()),a.b('  <a class="cancel-agent-select">cancel</a>'),a.b("\n"+n),a.b("  "),a.s(a.f("id",e,t,1),e,t,0,224,261,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a class="remove-agent">un-assign</a>')}),e.pop()),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_call_agent"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="agent" '),a.s(a.f("agent",e,t,1),e,t,0,29,45,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('data-id="'),n.b(n.v(n.f("id",e,t,0))),n.b('"')}),e.pop()),a.b(">"),a.b("\n"+n),a.s(a.f("agent",e,t,1),e,t,0,69,461,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="agent-name change-agent" class="change-agent">'),a.b(a.v(a.f("name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('    <span class="agent-initials button-background">'),a.s(a.f("initials",e,t,1),e,t,0,207,219,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,318,401,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url(/api/v1/accounts/'),n.b(n.v(n.f("account_id",e,t,0))),n.b("/users/"),n.b(n.v(n.f("id",e,t,0))),n.b('/pic_url)"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n)}),e.pop()),a.s(a.f("agent",e,t,1),e,t,1,0,0,"")||(a.b('    <a class="change-agent" title="You can automatically assign agents to calls by routing calls through a call queue"><i class="font-plus"></i> set agent</a>'),a.b("\n"+n)),a.b("</div>"),a.b("\n"+n),a.b('<div class="clear"></div>'),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_call_primary_actions"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("isText",e,t,1),e,t,0,11,1032,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("can_callback",e,t,1),e,t,0,29,508,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="action text"'),a.b("\n"+n),a.b('     data-action="text_options"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-digits="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-callback-count="'),a.b(a.v(a.f("callback_count",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-from-number="'),a.b(a.v(a.f("tracking_number_id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-excluded="null"'),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.text_options.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.text_options.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.text_options.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()),a.b('  <a class="action text"'),a.b("\n"+n),a.b('     data-action="text"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-digits="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-callback-count="'),a.b(a.v(a.f("callback_count",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-from-number="'),a.b(a.v(a.f("tracking_number_id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-excluded="null"'),a.b("\n"+n),a.b("     "),a.s(a.f("can_callback",e,t,1),e,t,0,803,823,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('style="display:none"')}),e.pop()),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.text.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.text.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.text.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("isText",e,t,1),e,t,1,0,0,"")||a.s(a.f("isChat",e,t,1),e,t,0,1068,2304,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("can_answer_call",e,t,1),e,t,0,1091,1697,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="action chat answerable"'),a.b("\n"+n),a.b('      data-action="chat"'),a.b("\n"+n),a.b('      data-placement="right"'),a.b("\n"+n),a.b('      data-digits="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('"'),a.b("\n"+n),a.b('      data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('      data-callback-count="'),a.b(a.v(a.f("callback_count",e,t,0))),a.b('"'),a.b("\n"+n),a.b('      data-from-number="'),a.b(a.v(a.f("tracking_number_id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('      data-excluded="null"'),a.b("\n"+n),a.b('      title="'),a.b(a.v(a.d("Call.actions.primary.chat.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('      <span class="'),a.b(a.v(a.d("Call.actions.primary.chat.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('      <span class="text">'),a.s(a.f("can_pickup_hold",e,t,1),e,t,0,1533,1583,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("Call.actions.primary.pickup_call_on_hold.label",e,t,0)))}),e.pop()),a.s(a.f("can_pickup_hold",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.d("Call.actions.primary.chat.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("can_answer_call",e,t,1),e,t,1,0,0,"")||(a.b('  <a class="action chat"'),a.b("\n"+n),a.b('     data-action="chat"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-digits="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-callback-count="'),a.b(a.v(a.f("callback_count",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-from-number="'),a.b(a.v(a.f("tracking_number_id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-excluded="null"'),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.chat.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.chat.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.chat.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n))}),e.pop()),a.s(a.f("isChat",e,t,1),e,t,1,0,0,"")||(a.s(a.f("can_callback",e,t,1),e,t,0,2359,2942,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="action '),a.s(a.f("callback_count",e,t,1),e,t,0,2398,2408,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("calledback")}),e.pop()),a.b('"'),a.b("\n"+n),a.b('     data-action="callback"'),a.b("\n"+n),a.b("     "),a.s(a.f("isText",e,t,1),e,t,0,2473,2493,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('style="display:none"')}),e.pop()),a.b("\n"+n),a.b('     data-digits="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-callback-count="'),a.b(a.v(a.f("callback_count",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-from-number="'),a.b(a.v(a.f("tracking_number_id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     data-excluded="null">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.callback.icon",e,t,0))),a.b(' a-icon"'),a.s(a.f("callback_count",e,t,1),e,t,0,2766,2835,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-badge="'),n.b(n.v(n.f("callback_count",e,t,0))),n.b('" title="'),n.b(n.v(n.f("callback_count",e,t,0))),n.b(' callbacks"')}),e.pop()),a.b("></span>"),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.callback.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("isText",e,t,1),e,t,1,0,0,"")||(a.s(a.f("can_live_listen",e,t,1),e,t,0,2994,3322,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="action live_listen"'),a.b("\n"+n),a.b('     data-action="live_listen"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.live_listen.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.live_listen.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.live_listen.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("can_pickup_hold",e,t,1),e,t,0,3366,3734,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="action pickup_call_on_hold"'),a.b("\n"+n),a.b('     data-action="pickup_call_on_hold"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.pickup_call_on_hold.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.pickup_call_on_hold.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.pickup_call_on_hold.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("can_answer_call",e,t,1),e,t,0,3778,4106,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="action answer_call"'),a.b("\n"+n),a.b('     data-action="answer_call"'),a.b("\n"+n),a.b('     data-placement="right"'),a.b("\n"+n),a.b('     data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('     title="'),a.b(a.v(a.d("Call.actions.primary.answer_call.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <span class="'),a.b(a.v(a.d("Call.actions.primary.answer_call.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('    <span class="text">'),a.b(a.v(a.d("Call.actions.primary.answer_call.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </a>"),a.b("\n"+n)}),e.pop()))),a.b("\n"+n),a.s(a.f("can_see_profile",e,t,1),e,t,0,4172,4393,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<a class="action"'),a.b("\n"+n),a.b('   data-action="edit"'),a.b("\n"+n),a.b('   data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('   data-excluded="null">'),a.b("\n"+n),a.b('  <span class="'),a.b(a.v(a.d("Call.actions.primary.edit.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('  <span class="text">'),a.b(a.v(a.d("Call.actions.primary.edit.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_call_row_sale_column"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("sale",e,t,1),e,t,0,9,519,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="noborder-small action sale-info" data-action="sale" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <strong class="call-conversion">'),a.s(a.d("sale.conversion",e,t,1),e,t,0,146,173,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<i class="font-signup"></i>')}),e.pop()),a.b("</strong>"),a.b("\n"+n),a.b('  <span class="call-sale-name">'),a.b(a.v(a.d("sale.name",e,t,0))),a.b("</span>"),a.b("\n"+n),a.s(a.d("sale.conversion",e,t,1),e,t,0,277,384,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    "),a.s(a.d("sale.value",e,t,1),e,t,0,297,366,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<span class="call-sale-value"><strong>$'),n.b(n.v(n.d("sale.value",e,t,0))),n.b("</strong></span>")}),e.pop()),a.b("\n"+n)}),e.pop()),a.b('  <span class="call-sale-stars stars">'),a.b("\n"+n),a.b("  "),a.s(a.d("sale.stars",e,t,1),e,t,0,461,486,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<i class="font-star"></i>')}),e.pop()),a.b("\n"+n),a.b("  </span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("sale",e,t,1),e,t,1,0,0,"")||(a.b('<a class="noborder-small action font-user-2" data-action="sale" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <span class="text">'),a.b(a.v(a.f("saleColumnName",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</a>"),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_chat_message"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="message '),a.b(a.v(a.f("direction",e,t,0))),a.b("_message"),a.s(a.f("typing",e,t,1),e,t,0,52,59,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" typing")}),e.pop()),a.s(a.f("status_warning",e,t,1),e,t,0,89,97,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" warning")}),e.pop()),a.s(a.f("status_error",e,t,1),e,t,0,133,139,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" error")}),e.pop()),a.b('" data-author="'),a.b(a.v(a.f("author",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <div class="page-header">'),a.b("\n"+n),a.b("    <h3>"),a.b("\n"+n),a.s(a.f("inbound_message",e,t,1),e,t,0,247,532,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <span class="agent-initials button-background" title="'),a.b(a.v(a.f("sender_name",e,t,0))),a.b('">'),a.s(a.f("system",e,t,1),e,t,0,338,363,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<i class="font-bolt"></i>')}),e.pop()),a.s(a.f("system",e,t,1),e,t,1,0,0,"")||(a.b('<i class="font-user"></i><span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,445,487,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span>")),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("outbound_message",e,t,1),e,t,0,580,885,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <span class="agent-initials button-background" title="'),a.b(a.v(a.f("sender_name",e,t,0))),a.b('">'),a.s(a.f("chat_initials",e,t,1),e,t,0,678,695,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("chat_initials",e,t,0)))}),e.pop()),a.s(a.f("chat_initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-bolt"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,809,851,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n)}),e.pop()),a.b("    </h3>"),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="bubble" title="'),a.b(a.v(a.f("created_at",e,t,0))),a.b('">'),a.b("\n"+n),a.s(a.f("typing",e,t,1),e,t,0,1017,1058,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <span class="indicator"></span>'),a.b("\n"+n)}),e.pop()),a.s(a.f("typing",e,t,1),e,t,1,0,0,"")||(a.b('    <p class="textselect">'),a.s(a.f("body_html",e,t,1),e,t,0,1126,1141,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.t(n.f("body_html",e,t,0)))}),e.pop()),a.s(a.f("body_html",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.f("body",e,t,0))),a.b("</p>"),a.b("\n"+n),a.s(a.d("medias.0",e,t,1),e,t,0,1213,1371,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="medias">'),a.b("\n"+n),a.s(a.f("medias",e,t,1),e,t,0,1254,1344,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a href="'),a.b(a.v(a.f("url",e,t,0))),a.b('" target="_blank" class="media image"><img src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"/></a>'),a.b("\n"+n)}),e.pop()),a.b("    </div>"),a.b("\n"+n)}),e.pop())),a.b("  </div>"),a.b("\n"+n),a.b('  <span class="timestamp">'),a.b(a.v(a.f("created_at",e,t,0))),a.s(a.f("status_visible",e,t,1),e,t,0,1469,1516,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span class="message-status">'),n.b(n.v(n.f("status",e,t,0))),n.b("</span>")}),e.pop()),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_comment"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="box">'),a.b("\n"+n),a.b('  <div class="comment-col-pic">'),a.b("\n"+n),a.b('    <span class="agent-initials button-background">'),a.s(a.d("agent.initials",e,t,1),e,t,0,120,138,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("agent.initials",e,t,0)))}),e.pop()),a.s(a.d("agent.initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b('<span class="agent-pic"'),a.s(a.d("agent.pic_url",e,t,1),e,t,0,261,309,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.d("agent.pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n),a.b("    <small>"),a.b("\n"+n),a.s(a.f("this_call",e,t,1),e,t,0,375,400,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        this call"),a.b("\n"+n)}),e.pop()),a.s(a.f("this_call",e,t,1),e,t,1,0,0,"")||(a.b('        <a class="jump-to-call" data-id="'),a.b(a.v(a.f("call_id",e,t,0))),a.b('" target="_blank" href="/calls#callNav=caller_profile&callId='),a.b(a.v(a.f("call_id",e,t,0))),a.b('">view call</a>'),a.b("\n"+n)),a.b("    </small>"),a.b("\n"+n),a.b('  </div><div class="comment-col-note">'),a.b("\n"+n),a.b('    <div class="comment-body">'),a.b("\n"+n),a.b('      <div class="comment-display">'),a.b("\n"+n),a.b('        <div class="comment-frame">'),a.b(a.t(a.f("formattedNote",e,t,0))),a.b("</div>"),a.b("\n"+n),a.b('        <div class="comment-raw" style="display:none">'),a.b(a.v(a.f("note",e,t,0))),a.b("</div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="comment-editable"></div>'),a.b("\n"+n),a.b('      <span class="comment-desc">'),a.b("\n"+n),a.b("        <cite>"),a.b("\n"+n),a.b("          "),a.s(a.d("agent.name",e,t,1),e,t,0,976,1029,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<small title="'),n.b(n.v(n.d("agent.email",e,t,0))),n.b('">'),n.b(n.v(n.d("agent.name",e,t,0))),n.b("</small>")}),e.pop()),a.s(a.d("agent.name",e,t,1),e,t,1,0,0,"")||a.b("<small>system</small>"),a.b("\n"+n),a.b("        </cite>"),a.b("\n"+n),a.b("        <small>"),a.b("\n"+n),a.b("          <cite>"),a.b(a.v(a.f("created",e,t,0))),a.b("</cite>"),a.b("\n"+n),a.b("        </small>"),a.b("\n"+n),a.b("      </span>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('  </div><div class="comment-col-edit">'),a.b("\n"+n),a.b("    "),a.s(a.f("owner",e,t,1),e,t,0,1258,1463,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.s(n.d("scoring_settings.notes_on",e,t,1),e,t,0,1288,1433,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b('<a class="edit-comment" data-comment="'),n.b(n.v(n.f("id",e,t,0))),n.b('" data-call-id="'),n.b(n.v(n.f("call_id",e,t,0))),n.b('"><i class="font-pencil"></i> <span class=\'hidden-xs\'>edit</span></a><br/>')}),e.pop())}),e.pop()),a.b("\n"+n),a.b("    "),a.s(a.f("owner",e,t,1),e,t,0,1488,1612,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a class="delete-comment danger-color" data-id="'),n.b(n.v(n.f("id",e,t,0))),n.b('"><i class="font-trash"></i> <span class=\'hidden-xs\'>delete</span></a>')}),e.pop()),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="clear"></div>'),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_custom_column"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("support_allowed",e,t,1),e,t,0,20,770,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("hasValues",e,t,1),e,t,0,35,546,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="noborder-small field-info action custom_inline_column" data-action="custom_'),a.b(a.v(a.d("panel.id",e,t,0))),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" href="#">'),a.b("\n"+n),a.s(a.f("values",e,t,1),e,t,0,177,527,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="call-custom_field">'),a.b("\n"+n),a.b('      <span class="call-custom_field-name">'),a.b(a.v(a.d("val.name",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b('      <span class="call-custom_field-value">'),a.b("\n"+n),a.s(a.d("val.display_value",e,t,1),e,t,0,352,393,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        "),a.b(a.t(a.d("val.display_value",e,t,0))),a.b("\n"+n)}),e.pop()),a.s(a.d("val.display_value",e,t,1),e,t,1,0,0,"")||(a.b("        "),a.b(a.v(a.d("val.value",e,t,0))),a.b("\n"+n)),a.b("      </span>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("hasValues",e,t,1),e,t,1,0,0,"")||(a.b('<a class="noborder-small action font-'),a.b(a.v(a.d("panel.icon",e,t,0))),a.b('" data-action="custom_'),a.b(a.v(a.d("panel.id",e,t,0))),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <span class="text">'),a.b(a.v(a.d("panel.name",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</a>"),a.b("\n"+n)),a.b('<div class="clear"></div>'),a.b("\n"+n)}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,1,0,0,"")||(a.b('  <span style="opacity:0.5"><i class="font-lock"></i> '),a.b(a.v(a.d("Call.extra.support_access_required",e,t,0))),a.b("</span>"),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_desk_com_cases"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("entries",e,t,1),e,t,0,12,1408,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="box">'),a.b("\n"+n),a.b("  <h4>#"),a.b(a.v(a.f("id",e,t,0))),a.b(": "),a.b(a.v(a.f("subject",e,t,0))),a.b(' <span class="case-name-assignment" style="float:right">'),a.s(a.d("assigned_user.name",e,t,1),e,t,0,136,170,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Assigned to "),n.b(n.v(n.d("assigned_user.name",e,t,0)))}),e.pop()),a.s(a.d("assigned_user.name",e,t,1),e,t,1,0,0,"")||a.b("Unassigned"),a.b("</span></h4>"),a.b("\n"+n),a.b("  <p>"),a.b(a.v(a.f("blurb",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("  <span>Status: "),a.b("\n"+n),a.b('    <select name="desk_com_case_status" data-status='),a.b(a.v(a.f("status",e,t,0))),a.b(" data-caseid="),a.b(a.v(a.f("id",e,t,0))),a.b(">"),a.b("\n"+n),a.b('      <option value="new">New</option>'),a.b("\n"+n),a.b('      <option value="open">Open</option>'),a.b("\n"+n),a.b('      <option value="pending">Pending</option>'),a.b("\n"+n),a.b('      <option value="resolved">Resolved</option>'),a.b("\n"+n),a.b('      <option value="closed">Closed</option>'),a.b("\n"+n),a.b('      <option value="deleted">Deleted</option>'),a.b("\n"+n),a.b("    </select>"),a.b("\n"+n),a.b("  </span> "),a.b("\n"+n),a.b("  <span>Modified: "),a.b(a.v(a.f("updated_at",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  <p>"),a.b("\n"+n),a.b('    <a style="float:left" class="desk-replies" data-type="replies" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">Load Replies</a> <span style="float:left">|</span> '),a.b("\n"+n),a.b('    <a style="float:left" class="desk-replies" data-type="notes" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">Load Notes</a>'),a.b("\n"+n),a.b('    <a style="float:right" href="#" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="desk-assign-agent">Update Assignment</a> <span style="float:right"> | </span> '),a.b("\n"+n),a.b('    <a style="float:right" href="#" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="desk-new-note">Add Note</a> <span style="float:right"> | </span> '),a.b("\n"+n),a.b('    <a style="float:right" target="_blank" href="'),a.b(a.v(a.f("site_url",e,t,0))),a.b("/agent/case/"),a.b(a.v(a.f("id",e,t,0))),a.b('">View</a>'),a.b("\n"+n),a.b('    <br style="clear:both"/>'),a.b("\n"+n),a.b("  </p>"),a.b("\n"+n),a.b('  <div class="desk-replies-list" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"></div>'),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_desk_com_notes"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="panel">'),a.b("\n"+n),a.s(a.f("entries",e,t,1),e,t,0,34,173,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h4>"),a.b(a.v(a.f("subject",e,t,0))),a.b("</h4>"),a.b("\n"+n),a.b("    <small>"),a.s(a.f("users",e,t,1),e,t,0,103,111,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("name",e,t,0)))}),e.pop()),a.b("</small>"),a.b("\n"+n),a.b("    <p>"),a.b("\n"+n),a.b("      "),a.b(a.v(a.f("body",e,t,0))),a.b("\n"+n),a.b("    </p>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop()),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_desk_com_replies"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="panel">'),a.b("\n"+n),a.s(a.f("entries",e,t,1),e,t,0,34,166,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h4>"),a.b(a.v(a.f("subject",e,t,0))),a.b("</h4>"),a.b("\n"+n),a.b("    <small>"),a.b(a.v(a.f("from",e,t,0))),a.b(" -&lt; "),a.b(a.v(a.f("to",e,t,0))),a.b("</small>"),a.b("\n"+n),a.b("    <p>"),a.b("\n"+n),a.b("      "),a.b(a.v(a.f("body",e,t,0))),a.b("\n"+n),a.b("    </p>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop()),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_desk_com_results"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.d("desk_com_record.default",e,t,1),e,t,0,28,86,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <p>"),a.b("\n"+n),a.b("    <small>Records matching contact</small>"),a.b("\n"+n),a.b("  </p>"),a.b("\n"+n)}),e.pop()),a.b('<hr style="border-bottom:1px solid #eee"/>'),a.b("\n"+n),a.s(a.d("desk_com_record.entries",e,t,1),e,t,0,186,2090,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="panel">'),a.b("\n"+n),a.b('  <div style="width:50px;float:left;margin-right:10px">'),a.b("\n"+n),a.b('    <span class="agent-initials button-background" style="width:50px;height:50px;line-height:50px;font-size:18px">'),a.s(a.f("initials",e,t,1),e,t,0,390,402,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("avatar",e,t,1),e,t,0,500,541,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("avatar",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div style="width:calc(100% - 60px);float:left">'),a.b("\n"+n),a.b('    <h3 style="border-bottom:1px solid #eee">'),a.b("\n"+n),a.b('      <a target="_blank" href="https://'),a.b(a.v(a.f("desk_com_domain",e,t,0))),a.b("/agent/customer/"),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.v(a.f("display_name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('      <small class="pull-right"><a class="desk_com_customer_add_case" data-call-id="'),a.b(a.v(a.f("call_id",e,t,0))),a.b('" data-customer-id="'),a.b(a.v(a.f("id",e,t,0))),a.b("\"><i class='font-plus'></i> Add Case</a></small>"),a.b("\n"+n),a.b("    </h3>"),a.b("\n"+n),a.b('    <div class="row">'),
a.b("\n"+n),a.b('      <div class="col-md-6">'),a.b("\n"+n),a.s(a.d("emails.0",e,t,1),e,t,0,1029,1179,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <p><i class="font-envelope"></i>'),a.b("\n"+n),a.s(a.f("emails",e,t,1),e,t,0,1090,1146,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="email">'),a.b(a.v(a.f("value",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.b("        </p>"),a.b("\n"+n)}),e.pop()),a.s(a.d("phone_numbers.0",e,t,1),e,t,0,1221,1382,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <p><i class="font-phone"></i>'),a.b("\n"+n),a.s(a.f("phone_numbers",e,t,1),e,t,0,1286,1342,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <span class='phone'>"),a.b(a.v(a.f("value",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.b("        </p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("company_name",e,t,1),e,t,0,1428,1526,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <p><i class="font-office"></i> <span class="company">'),a.b(a.v(a.f("company_name",e,t,0))),a.b("</span></p>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="col-md-6">'),a.b("\n"+n),a.b('        <div class="custom-fields">'),a.b("\n"+n),a.b("          <table>"),a.b("\n"+n),a.s(a.f("custom_fields",e,t,1),e,t,0,1668,1736,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <tr><td>"),a.b(a.v(a.f("name",e,t,0))),a.b("</td><td>"),a.b(a.v(a.f("value",e,t,0))),a.b("</td></tr>"),a.b("\n"+n)}),e.pop()),a.b("          </table>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="cases">'),a.b("\n"+n),a.b('        <a class="desk_com_customer_details" data-call-id="'),a.b(a.v(a.f("call_id",e,t,0))),a.b('" data-customer-id="'),a.b(a.v(a.f("id",e,t,0))),a.b("\"><i class='font-zoom-in'></i> Cases: "),a.b(a.v(a.d("_links.cases.count",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="clear"></div>'),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.s(a.d("desk_com_record.entries",e,t,1),e,t,1,0,0,"")||(a.b("<strong>Desk.com customer file not found</strong>"),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_edit_comment"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="edit-notes '),a.s(a.f("editing",e,t,1),e,t,1,0,0,"")||a.b("main-notes"),a.b('">'),a.b("\n"+n),a.b('  <div class="row">'),a.b("\n"+n),a.b('    <div class="col-xs-12">'),a.b("\n"+n),a.b("      <label>"),a.s(a.f("editing",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.d("Call.actions.new_note.label",e,t,0))),a.s(a.f("editing",e,t,1),e,t,0,188,220,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("Call.actions.edit_note.label",e,t,0)))}),e.pop()),a.b(' (supports <a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="_blank">Markdown</a>)</label>'),a.b("\n"+n),a.b('      <textarea data-note_id="'),a.b(a.v(a.f("note_id",e,t,0))),a.b('" class="text input-full call_comments" name="call[comments]" rows="20">'),a.b(a.v(a.f("note_notes",e,t,0))),a.b("</textarea>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <footer style="margin-bottom:20px">'),a.b("\n"+n),a.b('    <a class="button callout save-note"><div class="indicator-loop"><i class="save"></i></div><span>'),a.b(a.v(a.d("Call.actions.save_note.label",e,t,0))),a.b("</span></a>"),a.b("\n"+n),a.b('    <a class="button save-note-close outlined"><div class="indicator-loop"><i class="save"></i></div><span>'),a.b(a.v(a.d("Call.actions.save_and_close.label",e,t,0))),a.b("</span></a>"),a.b("\n"+n),a.s(a.f("editing",e,t,1),e,t,0,869,951,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="button cancel minimal">'),a.b(a.v(a.d("Call.actions.cancel.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_message_speaker"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="message '),a.b(a.v(a.f("direction",e,t,0))),a.b('_message first-message last-message" data-channel="'),a.b(a.v(a.f("channel_tag",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <div class="page-header">'),a.b("\n"+n),a.b('    <span class="agent-initials button-background" title="'),a.b(a.v(a.f("speaker",e,t,0))),a.b('">'),a.s(a.f("initials",e,t,1),e,t,0,214,226,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,325,367,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="bubble">'),a.b("\n"+n),a.b("    <p>"),a.b("\n"+n),a.s(a.f("partial",e,t,1),e,t,0,453,483,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        "),a.b(a.v(a.f("transcript",e,t,0))),a.b("\n"+n)}),e.pop()),a.s(a.f("partial",e,t,1),e,t,1,0,0,"")||a.s(a.f("words",e,t,1),e,t,0,533,658,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <a data-position="'),a.b(a.v(a.f("offset",e,t,0))),a.b('" title="Confidence '),a.b(a.v(a.f("score",e,t,0))),a.b('%" class="jump word_'),a.b(a.v(a.f("confidence",e,t,0))),a.b('">'),a.b(a.v(a.f("text",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("    </p>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <span class="timestamp"><a class="jump" data-position="'),a.b(a.v(a.f("offset",e,t,0))),a.b('">'),a.b(a.v(a.f("start_fmt",e,t,0))),a.b(" - "),a.b(a.v(a.f("end_fmt",e,t,0))),a.b("</small></a></span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_reminder"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<!--<div class="field">'),a.b("\n"+n),a.b("  <label>Reminder Name</label>"),a.b("\n"+n),a.b('  <input type="text" class="text" name="reminder[name]" value="'),a.b(a.v(a.d("reminder.name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("</div>-->"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>Remind me about</label>"),a.b("\n"+n),a.b('  <input type="text" class="text" style="width:100%" name="reminder[description]" value="'),a.b(a.v(a.d("reminder.description",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>Remind At</label>"),a.b("\n"+n),a.b('  <input type="text" class="text  reminder-schedule" name="reminder[scheduled_at]" value="'),a.b(a.v(a.d("reminder.scheduled_at",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>Remind me by</label>"),a.b("\n"+n),a.b('  <label><input type="checkbox" '),a.s(a.d("reminder.email",e,t,1),e,t,0,600,607,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("checked")}),e.pop()),a.b(' name="reminder[email]" value="email"/> Email <small> ( '),a.b(a.v(a.f("myemail",e,t,0))),a.b(" )</small></label>"),a.b("\n"+n),a.s(a.f("mynumber",e,t,1),e,t,0,727,897,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <label><input type="checkbox" '),a.s(a.d("reminder.text",e,t,1),e,t,0,778,785,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("checked")}),e.pop()),a.b(' name="reminder[text]" value="text"/> Text Message <small> ( '),a.b(a.v(a.f("mynumber",e,t,0))),a.b(" )</small></label>"),a.b("\n"+n)}),e.pop()),a.s(a.f("mynumber",e,t,1),e,t,1,0,0,"")||(a.b('    <label><input disabled type="checkbox" name="" value=""/> Text Message <small><br/>add your mobile number to receive text message reminders</small></label>'),a.b("\n"+n)),a.b('  <label><input type="checkbox" '),a.s(a.d("reminder.call",e,t,1),e,t,0,1153,1160,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("checked")}),e.pop()),a.b(' name="reminder[call]" value="call"/> Phone Call'),a.b("\n"+n),a.s(a.f("mynumber",e,t,1),e,t,1,0,0,"")||(a.b("    <small><br/>without a phone number assigned to your agent you will only receive reminder calls via the builtin softphone.</small>"),a.b("\n"+n)),a.b("  </label>"),a.b("\n"+n),a.s(a.d("reminder.id",e,t,1),e,t,0,1422,1520,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <a class="button activebutton cancel-reminder" data-id="'),a.b(a.v(a.d("reminder.id",e,t,0))),a.b('">Cancel Reminder</a>'),a.b("\n"+n)}),e.pop()),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_session_path_entry"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="session page '),a.s(a.f("start",e,t,1),e,t,0,35,53,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("session_push_lower")}),e.pop()),a.b('">'),a.b("\n"+n),a.s(a.f("is_first",e,t,1),e,t,0,81,221,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <span class="session_time">'),a.b(a.v(a.f("time",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    <input class='text' style='width:70%;border:0' type=\"text\" readonly value=\""),a.b(a.v(a.f("url",e,t,0))),a.b('"/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("is_first",e,t,1),e,t,1,0,0,"")||(a.s(a.f("is_last",e,t,1),e,t,0,267,272,"{{ }}")&&(a.rs(e,t,function(){}),e.pop()),a.s(a.f("is_last",e,t,1),e,t,1,0,0,"")||(a.s(a.f("start",e,t,1),e,t,0,318,581,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <span class='session_section session_host'>"),a.b("\n"+n),a.b('          <strong tabindex="-1">'),a.b(a.v(a.f("host",e,t,0))),a.b("</strong>"),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("        <span class='session_section session_path'>"),a.b("\n"+n),a.b("          "),a.b(a.v(a.f("path",e,t,0))),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("        <span class='session_time'>"),a.b(a.v(a.f("time",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("start",e,t,1),e,t,1,0,0,"")||(a.b("        <span class='session_section session_path'>"),a.b("\n"+n),a.b("          "),a.b(a.v(a.f("path",e,t,0))),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("        <span class='session_time'>"),a.b(a.v(a.f("duration",e,t,0))),a.b("</span>"),a.b("\n"+n)))),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_sf_tasks"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="panel">'),a.b("\n"+n),a.s(a.f("tasks",e,t,1),e,t,0,30,215,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h4>"),a.b(a.v(a.f("Subject",e,t,0))),a.b("</h4>"),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.f("Description",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("    <p>Owner: <strong>"),a.b(a.v(a.f("Owner",e,t,0))),a.b("</strong> - Last Modified by: <strong>"),a.b(a.v(a.f("LastModifiedBy",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop()),a.b("<div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_source_detail_col"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.d("plan.base.keywords",e,t,1),e,t,0,23,3802,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("visitor",e,t,1),e,t,0,38,2123,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="source-detail" style="max-width:280px;height: 65px;">'),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <span class="info" data-field="webvisit.location_path" title="'),a.b(a.v(a.d("Call.properties.location.label",e,t,0))),a.b('"><i class="font-picture"></i></span> <a class="search" title="'),a.b(a.v(a.d("location.host",e,t,0))),a.b('">'),a.b(a.v(a.d("location.pathname",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <span class="info" data-field="webvisit.referrer_host" title="'),a.b(a.v(a.d("Call.properties.referrer.label",e,t,0))),a.b('"><i class="font-share-2"></i></span> <a class="search" title="'),a.b(a.v(a.d("referrer.host",e,t,0))),a.b('">'),a.b(a.v(a.d("referrer.host",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <span class="info" data-field="webvisit.keywords" title="'),a.b(a.v(a.d("Call.properties.search.label",e,t,0))),a.b('"><i class="font-map-marker"></i></span>'),a.b("\n"+n),a.b('      <a class="search">'),a.b(a.v(a.f("search",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="ga-source-info">'),a.b("\n"+n),a.s(a.f("webvisit",e,t,1),e,t,0,914,1293,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("browser",e,t,1),e,t,0,933,1030,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <span class="browser" title="'),a.b(a.v(a.f("browser",e,t,0))),a.b('"><i class="font-'),a.b(a.v(a.f("browser",e,t,0))),a.b('"></i></span>'),a.b("\n"+n)}),e.pop()),a.s(a.f("device",e,t,1),e,t,0,1060,1154,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <span class="device" title="'),a.b(a.v(a.f("device",e,t,0))),a.b('"><i class="font-'),a.b(a.v(a.f("device",e,t,0))),a.b('"></i></span>'),a.b("\n"+n)}),e.pop()),a.s(a.f("mobile",e,t,1),e,t,0,1183,1277,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <span class="mobile" title="'),a.b(a.v(a.f("mobile",e,t,0))),a.b('"><i class="font-'),a.b(a.v(a.f("mobile",e,t,0))),a.b('"></i></span>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("campaign_medium_str",e,t,1),e,t,0,1335,1544,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <span title="'),a.b(a.v(a.d("Call.properties.paid.properties.medium.label",e,t,0))),a.b("/"),a.b(a.v(a.d("Call.properties.paid.properties.campaign.label",e,t,0))),a.b('" class="ga-campaign source-visitor-icon"><small>'),a.b(a.v(a.f("campaign_medium_str",e,t,0))),a.b("</small></span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("ga",e,t,1),e,t,0,1580,1753,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.d("ga.events.0",e,t,1),e,t,0,1603,1732,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="source-visitor-icon" title="Sent to Google Analytics '),a.b(a.v(a.d("ga.events.0",e,t,0))),a.b('"><i class="font-link"></i></span>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.b('    <span class="source-visitor-icon" title="'),a.b(a.v(a.d("Call.properties.likelihood.label",e,t,0))),a.b('"><i class="font-bars"></i> <small>'),a.b(a.v(a.f("likelihood",e,t,0))),a.b("%</small></span>"),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.s(a.f("ubv",e,t,1),e,t,0,1957,2112,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="unbounce-info">'),a.b("\n"+n),a.b('    <span title="'),a.b(a.v(a.d("Call.properties.unbounce.properties.ubv.label",e,t,0))),a.b('"><i class="font-unbounce"></i> '),a.b(a.v(a.f("ubv",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("\n"+n),a.s(a.f("visitor",e,t,1),e,t,1,0,0,"")||(a.s(a.f("paid",e,t,1),e,t,0,2163,3391,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="source-detail" style="max-width:280px;height: 65px;">'),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <a class="search" data-field="paid.campaign" title="'),a.b(a.v(a.d("Call.properties.paid.properties.campaign.label",e,t,0))),a.b('">'),a.b(a.v(a.f("campaign",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <a class="search" data-field="paid.ad_group" title="'),a.b(a.v(a.d("Call.properties.paid.properties.ad_group.label",e,t,0))),a.b('">'),a.b(a.v(a.f("ad_group",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="source-info">'),a.b("\n"+n),a.b('      <a class="search" data-field="paid.keyword" title="'),a.b(a.v(a.d("Call.properties.paid.properties.keyword.label",e,t,0))),a.b('">'),a.b(a.v(a.f("keyword",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      <br/>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="ga-source-info">'),a.b("\n"+n),a.s(a.f("campaign_medium_str",e,t,1),e,t,0,2837,3046,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <span title="'),a.b(a.v(a.d("Call.properties.paid.properties.medium.label",e,t,0))),a.b("/"),a.b(a.v(a.d("Call.properties.paid.properties.campaign.label",e,t,0))),a.b('" class="ga-campaign source-visitor-icon"><small>'),a.b(a.v(a.f("campaign_medium_str",e,t,0))),a.b("</small></span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("ga",e,t,1),e,t,0,3082,3255,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.d("ga.events.0",e,t,1),e,t,0,3105,3234,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="source-visitor-icon" title="Sent to Google Analytics '),a.b(a.v(a.d("ga.events.0",e,t,0))),a.b('"><i class="font-link"></i></span>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.b('    <span class="source-visitor-icon" title="'),a.b(a.v(a.d("Call.properties.likelihood.label",e,t,0))),a.b('"><i class="font-bars"></i> </span>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("paid",e,t,1),e,t,1,0,0,"")||(a.b('  <div class="smaller lighter">'),a.b("\n"+n),a.b('    <div class="visitor-data-not-available"><i title="'),a.b(a.v(a.d("Call.columns.source-detail.no_data_title",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.columns.source-detail.no_data",e,t,0))),a.b("</i></div>"),a.b("\n"+n),a.s(a.f("account_owner_no_keywords",e,t,1),e,t,0,3628,3735,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <br/><a href="'),a.b(a.v(a.f("change_plan_accounts_path",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.columns.source-detail.upgrade_to_view",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n)))}),e.pop()),a.s(a.d("plan.base.keywords",e,t,1),e,t,1,0,0,"")||(a.b('<div class="smaller lighter">'),a.b("\n"+n),a.b('  <div class="visitor-data-not-available" data-offset="10" data-placement="left">'),a.b(a.v(a.d("Call.columns.source-detail.no_data",e,t,0))),a.b("</div>"),a.b("\n"+n),a.s(a.f("account_owner_no_keywords",e,t,1),e,t,0,4038,4141,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <br/><a href="'),a.b(a.v(a.f("change_plan_accounts_path",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.columns.source-detail.upgrade_to_view",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("</div>"),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/_text_message_thread"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="message '),a.b(a.v(a.f("direction",e,t,0))),a.b("_message"),a.s(a.f("status_warning",e,t,1),e,t,0,60,68,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" warning")}),e.pop()),a.s(a.f("status_error",e,t,1),e,t,0,104,110,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" error")}),e.pop()),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <div class="page-header">'),a.b("\n"+n),a.b("    <h3>"),a.b("\n"+n),a.s(a.f("inbound_message",e,t,1),e,t,0,208,374,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="agent-initials button-background" title="'),a.b(a.v(a.f("sender_name",e,t,0))),a.b(" ("),a.b(a.v(a.f("from",e,t,0))),a.b(" \u2192 "),a.b(a.v(a.f("to",e,t,0))),a.b(')"><i class="font-user"></i><span class="agent-pic"></span></span>'),a.b("\n"+n)}),e.pop()),a.s(a.f("outbound_message",e,t,1),e,t,0,420,716,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="agent-initials button-background" title="'),a.b(a.v(a.f("sender_name",e,t,0))),a.b(" ("),a.b(a.v(a.f("from",e,t,0))),a.b(" \u2192 "),a.b(a.v(a.f("to",e,t,0))),a.b(')">'),a.s(a.f("initials",e,t,1),e,t,0,531,543,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-bolt"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,642,684,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n)}),e.pop()),a.b("    </h3>"),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="bubble" title="'),a.b(a.v(a.f("created_at",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <p class="textselect">'),a.s(a.f("body_html",e,t,1),e,t,0,873,888,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.t(n.f("body_html",e,t,0)))}),e.pop()),a.s(a.f("body_html",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.f("body",e,t,0))),a.b("</p>"),a.b("\n"+n),a.s(a.d("medias.0",e,t,1),e,t,0,960,1264,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="medias">'),a.b("\n"+n),a.s(a.f("medias",e,t,1),e,t,0,1001,1237,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("image",e,t,1),e,t,1,0,0,"")||(a.b('          <a href="'),a.b(a.v(a.f("url",e,t,0))),a.b('" class="media vcard">'),a.b(a.v(a.d("Call.actions.download_vcard.label",e,t,0))),a.b("</a>"),a.b("\n"+n)),a.s(a.f("image",e,t,1),e,t,0,1142,1222,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <a href="'),a.b(a.v(a.f("url",e,t,0))),a.b('" class="media image"><img src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"/></a>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n),a.b('  <span class="timestamp">'),a.b(a.v(a.f("created_at",e,t,0))),a.s(a.f("status_visible",e,t,1),e,t,0,1346,1393,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span class="message-status">'),n.b(n.v(n.f("status",e,t,0))),n.b("</span>")}),e.pop()),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/add_agent_profile"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b("        <h3>New User</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <form action="/api/v1/accounts/'),a.b(a.v(a.f("accountId",e,t,0))),a.b('/agents" enctype="multipart/form-data" method="POST">'),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b("            <label>Email Address</label>"),a.b("\n"+n),a.b('            <input type="text" class="text" name="agent[email]" style="width:300px"/>'),a.b("\n"+n),a.b('            <span class="hint">email is used to log in</span>'),a.b("\n"+n),a.b('            <div class="user-email-exists error messages" style="display:none;margin-top:15px"></div>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b("            <label>Name</label>"),a.b("\n"+n),a.b('            <div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.b('              <div class="col-xs-12 col-sm-6" style="padding:0 10px"><input type="text" class="text" name="agent[first_name]" placeholder="First" style="width:100%"/></div>'),a.b("\n"+n),a.b('              <div class="col-xs-12 col-sm-6" style="padding:0 10px"><input type="text" class="text" name="agent[last_name]" placeholder="Last" style="width:100%"/></div>'),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b("            <label>Profile Picture</label>"),a.b("\n"+n),a.s(a.f("hasFormData",e,t,1),e,t,0,1352,1418,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <input type="file" name="agent[photo]"/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("hasFormData",e,t,1),e,t,1,0,0,"")||(a.b("            <p>Your browser does not support file uploads. Please try Google Chrome, Firefox, or IE10+.</p>"),a.b("\n"+n)),a.b('            <span class="hint">Image dimensions: (80x80), max size: (1 MB)</span>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b("            <label>Assign Role</label>"),a.b("\n"+n),a.b('            <select name="agent[role]" class="chzn-select standard-width">'),a.b("\n"+n),a.b('              <option value="admin">Administrator</option>'),a.b("\n"+n),a.b('              <option value="report_manager">Report Manager</option>'),a.b("\n"+n),a.b('              <option value="call_manager">Call Manager</option>'),a.b("\n"+n),a.b('              <option value="agent" selected>Agent</option>'),a.b("\n"+n),a.b("            </select>"),a.b("\n"+n),a.b('            <div class="role-definitions">'),a.b("\n"+n),a.b('              <span class="hint" data-role="admin">An administrator has the ability to manage all aspects of an account.</span>'),a.b("\n"+n),a.b('              <span class="hint" data-role="report_manager">A report manager has the ability to manage reports and can view, edit, and export the call log.</span>'),a.b("\n"+n),a.b('              <span class="hint" data-role="call_manager">A call manager has the ability to access the call log and call map only.</span>'),a.b("\n"+n),a.b('              <span class="hint" data-role="agent">An agent has the ability to access calls that are routed or assigned to him or her and make new calls.</span>'),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b('            <label><input name="agent[send_password]" checked type="checkbox"/> Send Instructions</label>'),a.b("\n"+n),a.b('            <span class="hint">Includes information about how to access the site and set a new password</span>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </form>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <a class="button action-cancel">Cancel</a>'),a.b("\n"+n),a.b('        <a class="button callout action-create">Add Agent</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/audio_player"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<audio>"),a.b("\n"+n),a.b("  "),a.s(a.f("mp3",e,t,1),e,t,0,18,59,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<source type="audio/mpeg" src="'),n.b(n.v(n.f("mp3",e,t,0))),n.b('"/>')}),e.pop()),a.b("\n"+n),a.b('  <source type="audio/wav" src="'),a.b(a.v(a.f("wav",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("</audio>"),a.b("\n"+n),a.b('<span class="replace"></span>'),a.b("\n"+n),a.s(a.f("download_links",e,t,1),e,t,0,169,388,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class=\'playback-links\'><a style="color:inherit;opacity:0.5;font-size:10px" target="_blank" href="'),a.b(a.v(a.f("mp3",e,t,0))),a.b('">mp3</a> | <a style="color:inherit;opacity:0.5;font-size:10px" target="_blank" href="'),a.b(a.v(a.f("wav",e,t,0))),a.b('">wav</a></div>'),a.b("\n"+n)}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_edit"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<tr id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="call-edit">'),a.b("\n"+n),a.b('  <td colspan="'),a.b(a.v(a.f("column_count",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <div class="call-edit-shadow" class="showing"></div>'),a.b("\n"+n),a.b('    <div class="call-edit-frame">'),a.b("\n"+n),a.b('      <div class="call-audio-review-frame" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"></div>'),a.b("\n"+n),a.b('      <div class="col-sm-2 navbar-sidenav">'),a.b("\n"+n),a.b('        <div class="sidebar-nav row">'),a.b("\n"+n),a.b('          <div class="navbar">'),a.b("\n"+n),a.b('            <div class="navbar-header header crumbs hidden-sm hidden-md hidden-lg">'),a.b("\n"+n),a.b('              <div class="title" style="display:inline-block">'),a.b("\n"+n),a.b('                <div class="paths-sm">'),a.b("\n"+n),a.b('                  <a class="close-mobile-nav"><i class="font-chevron-left"></i></a><span>Edit</span>'),a.b("\n"+n),a.b("                </div>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b('              <div class="actions">'),a.b("\n"+n),a.b('                <span class="custom"></span>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b('            <div class="collapse navbar-collapse" id="bs-call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-nav">'),a.b("\n"+n),a.b('              <ul class="nav navbar-nav">'),a.b("\n"+n),a.b("              </ul>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="col-sm-10 call-edit-container">'),a.b("\n"+n),a.b('        <ul class="nav navbar-nav"><li><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"><span class="caption">&nbsp;</span></a>'),a.b("\n"+n),a.b("        <div class=\"close-call-panel\"><i class='font-close'></i></div>"),a.b("\n"+n),a.b('        <div class="call-edit-panel" id="call-edit-panel-'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <div class="field">'),a.b("\n"+n),a.b('          <h3>&nbsp;<small class="call-id">'),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('          <div class="card" style="min-height:250px">'),a.b("\n"+n),a.b('            <div class="loading-call" style="display:none;padding-top:90px">'),a.b("\n"+n),a.b('              <div class="progress progress-striped active">'),a.b("\n"+n),a.b('                <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">'),a.b("\n"+n),a.b('                  <span class="sr-only">Loading...</span>'),a.b("\n"+n),a.b("                </div>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("        </li></ul>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="clear"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b("</tr>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_flow"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.call_flow.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.call_flow.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <header><span><i class="font-phone"></i> Check call quality <a class="insights" href="/calls/'),a.b(a.v(a.f("id",e,t,0))),a.b('/insights">insights <i class="font-chevron-right" style="font-size:85%"></i></a></span></header>'),a.b("\n"+n),a.s(a.d("times.0",e,t,1),e,t,0,400,4919,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <ul class="timeline">'),a.b("\n"+n),a.s(a.f("times",e,t,1),e,t,0,435,4839,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <li class="field">'),a.b("\n"+n),a.b('        <span class="indicator"></span>'),a.b("\n"+n),a.b('        <div class="card">'),a.b("\n"+n),a.s(a.f("events",e,t,1),e,t,0,543,4736,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("route_name",e,t,1),e,t,0,565,4716,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="field">'),a.b("\n"+n),a.b("        <label>"),a.b(a.v(a.f("route_name",e,t,0))),a.b("</label>"),a.b("\n"+n),a.s(a.f("text",e,t,1),e,t,0,649,946,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("say",e,t,1),e,t,0,668,802,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <input class="text upload_say" type="text" style="width:100%" value="say:'),a.b(a.v(a.f("voice",e,t,0))),a.b(":"),a.b(a.v(a.f("lang",e,t,0))),a.b(":"),a.b(a.v(a.f("text",e,t,0))),a.b('" readonly/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("say",e,t,1),e,t,1,0,0,"")||(a.b('          <input class="text" type="text" style="width:100%" value="'),a.b(a.v(a.f("text",e,t,0))),a.b('" readonly/>'),a.b("\n"+n))}),e.pop()),a.s(a.f("url",e,t,1),e,t,0,972,1045,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <p><audio controls><source src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"></audio></p>'),a.b("\n"+n)}),e.pop()),
a.s(a.f("call_by_gather",e,t,1),e,t,0,1081,1779,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("prompt_agent",e,t,1),e,t,0,1109,1163,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p>Call to agent: "),a.b(a.v(a.f("name",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("prompt_agent",e,t,1),e,t,1,0,0,"")||a.s(a.f("nodes",e,t,1),e,t,0,1231,1732,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("text",e,t,1),e,t,0,1255,1594,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("say",e,t,1),e,t,0,1280,1426,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <input class="text upload_say" type="text" style="width:100%" value="say:'),a.b(a.v(a.f("voice",e,t,0))),a.b(":"),a.b(a.v(a.f("lang",e,t,0))),a.b(":"),a.b(a.v(a.f("text",e,t,0))),a.b('" readonly/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("say",e,t,1),e,t,1,0,0,"")||(a.b('                <input class="text" type="text" style="width:100%" value="'),a.b(a.v(a.f("text",e,t,0))),a.b('" readonly/>'),a.b("\n"+n))}),e.pop()),a.s(a.f("url",e,t,1),e,t,0,1626,1711,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <p><audio controls><source src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"></audio></p>'),a.b("\n"+n)}),e.pop())}),e.pop())}),e.pop()),a.s(a.f("dialed",e,t,1),e,t,0,1818,1855,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p>"),a.b(a.v(a.f("dialed",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.b("        "),a.s(a.f("enter_queue",e,t,1),e,t,0,1891,1930,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<p><strong>"),n.b(n.v(n.f("enter_queue",e,t,0))),n.b("</strong></p>")}),e.pop()),a.b("\n"+n),a.s(a.f("route_to",e,t,1),e,t,0,1968,4681,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p>"),a.b("\n"+n),a.b("            "),a.b("\n"+n),a.s(a.f("route_type",e,t,1),e,t,0,2025,2155,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <i class="'),a.b(a.v(a.f("icon",e,t,0))),a.b('"></i>'),a.b("\n"+n),a.b("                "),a.s(a.f("log_link",e,t,1),e,t,0,2096,2127,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<a href='"),n.b(n.v(n.f("log_link",e,t,0))),n.b("'>logs</a>")}),e.pop()),a.b("\n"+n)}),e.pop()),a.s(a.f("route_type",e,t,1),e,t,1,0,0,"")||(a.b("                <strong>"),a.b(a.v(a.f("route_to",e,t,0))),a.b("</strong>"),a.b("\n"+n),a.b("                "),a.s(a.f("log_link",e,t,1),e,t,0,2276,2328,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<a class='embed-window' href='"),n.b(n.v(n.f("log_link",e,t,0))),n.b("'>logs</a>")}),e.pop()),a.b("<br/>"),a.b("\n"+n)),a.b("          </p>"),a.b("\n"+n),a.s(a.f("keypress",e,t,1),e,t,0,2415,2528,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="tap-token"><i class="font-grid" style="font-size:80%"></i> '),a.b(a.v(a.f("keypress",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("agent_dial",e,t,1),e,t,0,2567,4657,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="table-responsive">'),a.b("\n"+n),a.b('          <table class="table" style="margin-bottom:0">'),a.b("\n"+n),a.b("            <thead>"),a.b("\n"+n),a.b("            <tr>"),a.b("\n"+n),a.b("              <td>Method</td>"),a.b("\n"+n),a.b("              <td>Details</td>"),a.b("\n"+n),a.b("              <td>Duration</td>"),a.b("\n"+n),a.b("              <td>Status</td>"),a.b("\n"+n),a.b("              <td>Other <i class='font-question' title=\"FIFO queue agent could be dialed from this call but answer another call\"></i></td>"),a.b("\n"+n),a.b("            </tr>"),a.b("\n"+n),a.b("            <thead>"),a.b("\n"+n),a.b("            <tbody>"),a.b("\n"+n),a.s(a.f("dial_legs",e,t,1),e,t,0,3048,3383,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <tr>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("call_by_dial",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("desc",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("duration",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("status",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.s(a.f("bridged_id",e,t,1),e,t,0,3241,3332,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<a href='#filter="),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("&callNav=call_flow&callId="),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("'>"),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("</a>")}),e.pop()),a.b("</td>"),a.b("\n"+n),a.b("            </tr>"),a.b("\n"+n)}),e.pop()),a.s(a.f("client_legs",e,t,1),e,t,0,3426,3761,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <tr>"),a.b("\n"+n),a.b("              <td>Phone Soft Phone</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("desc",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("duration",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("status",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.s(a.f("bridged_id",e,t,1),e,t,0,3619,3710,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<a href='#filter="),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("&callNav=call_flow&callId="),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("'>"),n.b(n.v(n.f("bridged_id",e,t,0))),n.b("</a>")}),e.pop()),a.b("</td>"),a.b("\n"+n),a.b("            </tr>"),a.b("\n"+n)}),e.pop()),a.s(a.f("sip_legs",e,t,1),e,t,0,3803,3985,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <tr>"),a.b("\n"+n),a.b("              <td>Sip Call</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("desc",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("duration",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("              <td>"),a.b(a.v(a.f("status",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            </tr>"),a.b("\n"+n)}),e.pop()),a.b("            </tbody>"),a.b("\n"+n),a.b("          </table>"),a.b("\n"+n),a.s(a.f("call_by_native",e,t,1),e,t,0,4070,4610,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <div class="dial-options box">'),a.b("\n"+n),a.b("              <!--"),a.s(a.f("call_by_dial",e,t,1),e,t,0,4149,4219,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<span>dialed phone <i class="font-phone-2"></i> '),n.b(n.v(n.f("number",e,t,0))),n.b("</span><br/>")}),e.pop()),a.b("\n"+n),a.b("              "),a.s(a.f("call_by_client",e,t,1),e,t,0,4270,4329,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<span>dialed client <i class="font-screen"></i></span><br/>')}),e.pop()),a.b("\n"+n),a.b("              "),a.s(a.f("call_by_sip",e,t,1),e,t,0,4379,4441,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<span>dialed SIP <i class="font-headphones-2"></i></span><br/>')}),e.pop()),a.b("-->"),a.b("\n"+n),a.b("              "),a.s(a.f("call_by_native",e,t,1),e,t,0,4494,4559,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<span>dialed Native <i class="font-headphones-2"></i></span><br/>')}),e.pop()),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n)}),e.pop()),a.b("          </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("        </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("        </div>"),a.b("\n"+n),a.b('        <span class="timeline-times"><span>'),a.b(a.v(a.f("ts",e,t,0))),a.b("</span></span>"),a.b("\n"+n),a.b("      </li>"),a.b("\n"+n)}),e.pop()),a.b('    <li><i class="'),a.b(a.v(a.f("status_icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.f("call_status",e,t,0))),a.b("</li>"),a.b("\n"+n),a.b("  </ul>"),a.b("\n"+n)}),e.pop()),a.s(a.d("times.0",e,t,1),e,t,1,0,0,"")||(a.b("  <p>No call flow available.</p>"),a.b("\n"+n)),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_form_fields"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.call_form_fields.label",e,t,0))),a.b(" <small><strong>("),a.b(a.v(a.d("form.form_name",e,t,0))),a.b(")</strong> "),a.b(a.v(a.d("form.name",e,t,0))),a.b(" / "),a.b(a.v(a.d("form.customer_number_to_dial",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div class="row" style="margin-bottom:10px"><div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("Call.properties.form.properties.name.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="form-control textselect">'),a.s(a.d("form.name",e,t,1),e,t,0,575,588,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("form.name",e,t,0)))}),e.pop()),a.s(a.d("form.name",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("Call.properties.form.properties.email.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="form-control textselect">'),a.s(a.d("form.email",e,t,1),e,t,0,869,883,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("form.email",e,t,0)))}),e.pop()),a.s(a.d("form.email",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("Call.properties.form.properties.customer_number_to_dial.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="form-control textselect">'),a.s(a.d("form.customer_number_to_dial",e,t,1),e,t,0,1203,1235,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("form.customer_number_to_dial",e,t,0)))}),e.pop()),a.s(a.d("form.customer_number_to_dial",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("Call.properties.form.properties.number_to_call.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="form-control textselect">'),a.s(a.d("form.number_to_call",e,t,1),e,t,0,1591,1614,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("form.number_to_call",e,t,0)))}),e.pop()),a.s(a.d("form.number_to_call",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.s(a.d("form.custom",e,t,1),e,t,0,1730,2026,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("        <label>"),a.s(a.f("label",e,t,1),e,t,0,1846,1855,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("label",e,t,0)))}),e.pop()),a.s(a.f("label",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</label>"),a.b("\n"+n),a.b('        <div class="form-control textselect">'),a.s(a.f("value",e,t,1),e,t,0,1955,1966,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.t(n.f("value",e,t,0)))}),e.pop()),a.s(a.f("value",e,t,1),e,t,1,0,0,"")||a.b("&nbsp;"),a.b("</div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b("  </div></div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_loader"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<tr id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-loader" class="call-loader">'),a.b("\n"+n),a.b('  <td colspan="'),a.b(a.v(a.f("column_count",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <div style="margin:90px 3%;text-align:center;">'),a.b("\n"+n),a.b('      <div class="progress progress-striped active">'),a.b("\n"+n),a.b('        <div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('          <span class="sr-only">Loading...</span>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b("</tr>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_nav"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("phonemode",e,t,1),e,t,0,14,256,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("call_scripts",e,t,1),e,t,0,32,238,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="scripts_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="scripts_panel"><i class="'),a.b(a.v(a.d("Call.panels.scripts_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.scripts_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("custom_actions",e,t,1),e,t,0,290,480,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="custom_'),a.b(a.v(a.f("id",e,t,0))),a.b('"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="custom_'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.s(a.f("live",e,t,1),e,t,0,379,393,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-live="1"')}),e.pop()),a.b('><i class="font-'),a.b(a.v(a.f("icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.f("name",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("texts_last",e,t,1),e,t,1,0,0,"")||a.s(a.f("support_allowed",e,t,1),e,t,0,536,770,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("sms_allowed",e,t,1),e,t,0,552,754,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="text_message"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="text_message"><i class="'),a.b(a.v(a.d("Call.panels.text_message.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.text_message.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.d("access.profile",e,t,1),e,t,0,826,1134,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="caller_profile" class="active"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="caller_profile"><i class="'),a.b(a.v(a.d("Call.panels.caller_profile.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.caller_profile.label",e,t,0))),a.b('</span> <small class="call-id" style="color: #777;">'),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.d("plan.base.keywords",e,t,1),e,t,0,1176,1436,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.d("access.source_detail",e,t,1),e,t,0,1201,1411,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="caller_session"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="caller_session"><i class="'),a.b(a.v(a.d("Call.panels.caller_session.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.caller_session.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.d("access.csr",e,t,1),e,t,0,1475,1658,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="caller_sale"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="caller_sale"><i class="'),a.b(a.v(a.d("Call.panels.caller_sale.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.f("saleColumnName",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("form",e,t,1),e,t,0,1683,1941,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("support_allowed",e,t,1),e,t,0,1703,1921,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="call_form_fields"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="call_form_fields"><i class="'),a.b(a.v(a.d("Call.panels.call_form_fields.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.call_form_fields.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("texts_last",e,t,1),e,t,1,0,0,"")||a.s(a.f("support_allowed",e,t,1),e,t,0,1987,2189,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("isChat",e,t,1),e,t,0,1998,2178,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="call_chat"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="call_chat"><i class="'),a.b(a.v(a.d("Call.panels.chat.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.chat.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("can_email",e,t,1),e,t,0,2240,2480,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("sendgrid",e,t,1),e,t,1,0,0,"")||(a.b('<li data-action="caller_messages"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="caller_messages"><i class="'),a.b(a.v(a.d("Call.panels.caller_messages.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.caller_messages.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n))}),e.pop()),a.s(a.f("sendgrid",e,t,1),e,t,0,2508,2719,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="sendgrid_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="sendgrid_panel"><i class="'),a.b(a.v(a.d("Call.panels.sendgrid_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.caller_messages.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("can_do_not_call",e,t,1),e,t,0,2754,2952,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="do_not_call"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="do_not_call"><i class="'),a.b(a.v(a.d("Call.panels.do_not_call.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.do_not_call.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("hasVoiceAnalysis",e,t,1),e,t,0,2995,3598,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("can_playback",e,t,1),e,t,0,3012,3581,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("support_allowed",e,t,1),e,t,0,3032,3561,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("in_progress",e,t,1),e,t,0,3049,3280,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<li data-action="caller_transcription" data-live-listen="1"><a data-id="'),n.b(n.v(n.f("id",e,t,0))),n.b('" data-action="caller_transcription"><i class="'),n.b(n.v(n.d("Call.panels.live_call.icon",e,t,0))),n.b('"></i> <span class="caption">'),n.b(n.v(n.d("Call.panels.live_call.label",e,t,0))),n.b("</span></a></li>")}),e.pop()),a.s(a.f("in_progress",e,t,1),e,t,1,0,0,"")||(a.b('<li data-action="caller_transcription"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="caller_transcription"><i class="'),a.b(a.v(a.d("Call.panels.caller_transcription.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.caller_transcription.label",e,t,0))),a.b("</span></a></li>")),a.b("\n"+n)}),e.pop())}),e.pop())}),e.pop()),a.s(a.f("hasCallFlow",e,t,1),e,t,0,3636,3826,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="call_flow"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="call_flow"><i class="'),a.b(a.v(a.d("Call.panels.call_flow.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.call_flow.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,0,3863,4057,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("custom_panels",e,t,1),e,t,0,3881,4039,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="custom_'),a.b(a.v(a.f("id",e,t,0))),a.b('"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="custom_'),a.b(a.v(a.f("id",e,t,0))),a.b('"><i class="font-'),a.b(a.v(a.f("icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.f("name",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("dynamics",e,t,1),e,t,0,4091,4301,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="dynamics_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="dynamics_panel"><i class="'),a.b(a.v(a.d("Call.panels.dynamics_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.dynamics_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("can_remind",e,t,1),e,t,0,4331,4591,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("hide_remind_panel",e,t,1),e,t,1,0,0,"")||(a.b('<li data-action="reminder_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="reminder_panel"><i class="'),a.b(a.v(a.d("Call.panels.reminder_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.reminder_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n))}),e.pop()),a.s(a.f("hubspot",e,t,1),e,t,0,4619,4825,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="hubspot_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="hubspot_panel"><i class="'),a.b(a.v(a.d("Call.panels.hubspot_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.hubspot_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("allow_sf_data",e,t,1),e,t,0,4856,5074,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="salesforce_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="salesforce_panel"><i class="'),a.b(a.v(a.d("Call.panels.salesforce_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.salesforce_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("zoho",e,t,1),e,t,0,5102,5296,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="zoho_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="zoho_panel"><i class="'),a.b(a.v(a.d("Call.panels.zoho_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.zoho_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("desk_com",e,t,1),e,t,0,5319,5529,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="desk_com_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="desk_com_panel"><i class="'),a.b(a.v(a.d("Call.panels.desk_com_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.desk_com_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("phonemode",e,t,1),e,t,1,0,0,"")||a.s(a.f("call_scripts",e,t,1),e,t,0,5575,5781,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="scripts_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="scripts_panel"><i class="'),a.b(a.v(a.d("Call.panels.scripts_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.scripts_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("shopify",e,t,1),e,t,0,5826,6032,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="shopify_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="shopify_panel"><i class="'),a.b(a.v(a.d("Call.panels.shopify_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.shopify_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("zendesk",e,t,1),e,t,0,6057,6285,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="zendesk_panel" class="zendesk_panel"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="zendesk_panel"><i class="'),a.b(a.v(a.d("Call.panels.zendesk_panel.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.zendesk_panel.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop()),a.s(a.f("texts_last",e,t,1),e,t,0,6313,6832,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("support_allowed",e,t,1),e,t,0,6334,6568,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("sms_allowed",e,t,1),e,t,0,6350,6552,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="text_message"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="text_message"><i class="'),a.b(a.v(a.d("Call.panels.text_message.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.text_message.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,0,6609,6811,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("isChat",e,t,1),e,t,0,6620,6800,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<li data-action="call_chat"><a data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="call_chat"><i class="'),a.b(a.v(a.d("Call.panels.chat.icon",e,t,0))),a.b('"></i> <span class="caption">'),a.b(a.v(a.d("Call.panels.chat.label",e,t,0))),a.b("</span></a></li>"),a.b("\n"+n)}),e.pop())}),e.pop())}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_path"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b("        <h3>"),a.b(a.v(a.d("Call.panels.call_flow.label",e,t,0))),a.b("</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <div class="container">'),a.b("\n"+n),a.s(a.f("call_path",e,t,1),e,t,0,367,1743,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="row">'),a.b("\n"+n),a.s(a.f("route_name",e,t,1),e,t,0,419,1652,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <h3>"),a.b(a.v(a.f("route_name",e,t,0))),a.b(" <small>"),a.b(a.v(a.f("ts",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.s(a.f("text",e,t,1),e,t,0,495,566,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <input class="text" type="text" value="'),a.b(a.v(a.f("text",e,t,0))),a.b('">'),a.b("\n"+n)}),e.pop()),a.s(a.f("url",e,t,1),e,t,0,594,699,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p>"),a.b("\n"+n),a.b('              <audio controls><source src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"></audio>'),a.b("\n"+n),a.b("            </p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("call_by_gather",e,t,1),e,t,0,737,1155,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("prompt_agent",e,t,1),e,t,0,767,825,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("              <p>Call to agent: "),a.b(a.v(a.f("name",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("prompt_agent",e,t,1),e,t,1,0,0,"")||a.s(a.f("nodes",e,t,1),e,t,0,895,1104,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("text",e,t,1),e,t,0,919,966,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                <p>"),a.b(a.v(a.f("text",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("url",e,t,1),e,t,0,998,1083,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <p><audio controls><source src="'),a.b(a.v(a.f("url",e,t,0))),a.b('"></audio></p>'),a.b("\n"+n)}),e.pop())}),e.pop())}),e.pop()),a.s(a.f("dialed",e,t,1),e,t,0,1196,1259,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p>"),a.b("\n"+n),a.b("            "),a.b(a.v(a.f("dialed",e,t,0))),a.b("\n"+n),a.b("          </p>"),a.b("\n"+n)}),e.pop()),a.b("          "),a.s(a.f("enter_queue",e,t,1),e,t,0,1297,1319,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<p>"),n.b(n.v(n.f("enter_queue",e,t,0))),n.b("</p>")}),e.pop()),a.b("\n"+n),a.s(a.f("route_to",e,t,1),e,t,0,1359,1628,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p>"),a.b("\n"+n),a.b("            <strong>"),a.b(a.v(a.f("route_to",e,t,0))),a.b("</strong><br/>"),a.b("\n"+n),a.b("            <cite>"),a.s(a.f("call_by_dial",e,t,1),e,t,0,1456,1497,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('called phone <i class="font-phone-2"></i>')}),e.pop()),a.b("\n"+n),a.b("            "),a.s(a.f("call_by_client",e,t,1),e,t,0,1546,1587,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('called client <i class="font-screen"></i>')}),e.pop()),a.b("</cite>"),a.b("\n"+n),a.b("          </p>")}),e.pop()),a.b("\n"+n)}),e.pop()),a.s(a.f("route_name",e,t,1),e,t,1,0,0,""),a.b("        </div>"),a.b("\n"+n)}),e.pop()),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <a class="button activebutton action-cancel outlined">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_row"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<tr data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" id="call-row-'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-number="'),a.b(a.v(a.f("caller_number",e,t,0))),a.b('"'),a.b("\n"+n),a.b("   "),a.s(a.f("can_pickup_hold",e,t,1),e,t,0,97,128,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('data-new="1" data-status="hold"')}),e.pop()),a.b("\n"+n),a.b('    class="call call-row wide-call '),a.s(a.f("isChat",e,t,1),e,t,1,0,0,"")||a.s(a.f("form",e,t,1),e,t,0,204,208,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("form")}),e.pop()),a.b(" "),a.s(a.f("isChat",e,t,1),e,t,0,240,244,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("chat")}),e.pop()),a.b(" "),a.b(a.v(a.f("blocked_text",e,t,0))),a.b(" "),a.s(a.f("reviewed_by",e,t,1),e,t,0,289,297,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("reviewed")}),e.pop()),a.s(a.f("reviewed_by",e,t,1),e,t,1,0,0,"")||a.b("pending"),a.s(a.f("excluded",e,t,1),e,t,0,365,374,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" excluded")}),e.pop()),a.s(a.f("redacted",e,t,1),e,t,0,400,409,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" redacted")}),e.pop()),a.b(a.v(a.f("visible-columns",e,t,0))),a.b(a.v(a.f("visible-sections",e,t,0))),a.b(' mobile-closed"'),a.s(a.f("active",e,t,1),e,t,0,487,503,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-active="1"')}),e.pop()),a.s(a.f("active_action",e,t,1),e,t,0,532,571,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-active-action="'),n.b(n.v(n.f("active_action",e,t,0))),n.b('"')}),e.pop()),a.b(">"),a.b("\n"),a.b("\n"+n),a.s(a.f("agency_all",e,t,1),e,t,0,609,1008,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column caller-account call-caller-actions mobile-option" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <a class="action account text" data-action="account" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-account="'),a.b(a.v(a.f("account_id",e,t,0))),a.b('" href="/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/enable?redir=/calls#callNav=caller_profile&callId="),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('      <span class="font-office a-icon"></span>'),a.b("\n"+n),a.b('      <span class="text">'),a.b(a.v(a.f("account_name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("agency_all",e,t,1),e,t,1,0,0,"")||a.s(a.d("access.caller_actions",e,t,1),e,t,0,1071,1359,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("\n"+n),a.b('  <td class="log-column call-caller-actions openable mobile-option'),a.s(a.d("prefs.columns.caller_actions",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.caller_actions",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b(a.rp("<call_primary_actions0",e,t,"    ")),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.s(a.d("access.caller",e,t,1),e,t,0,1424,6401,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-caller openable mobile-primary'),a.s(a.d("prefs.columns.caller",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.caller",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <div class="caller-info-section">'),a.b("\n"+n),a.b('      <div class="callicons">'),a.b("\n"+n),a.s(a.d("access.view_direction",e,t,1),e,t,0,1734,2155,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("isText",e,t,1),e,t,0,1756,2135,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <span data-action="text" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="direction '),a.b(a.v(a.f("direction",e,t,0))),a.b('" data-container="body" title="'),a.s(a.f("isTextInbound",e,t,1),e,t,0,1890,1902,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Inbound Text")}),e.pop()),a.s(a.f("isTextOutbound",e,t,1),e,t,0,1939,1952,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Outbound Text")}),e.pop()),a.b('">'),a.b("\n"+n),a.b('              <i class="'),a.s(a.f("isTextInbound",e,t,1),e,t,0,2016,2028,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("font-bubbles")}),e.pop()),a.s(a.f("isTextOutbound",e,t,1),e,t,0,2065,2079,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("font-bubbles-2")}),e.pop()),a.b('"></i>'),a.b("\n"+n),a.b("            </span>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("isText",e,t,1),e,t,1,0,0,"")||(a.s(a.f("isChat",e,t,1),e,t,1,0,0,"")||(a.s(a.f("isForm",e,t,1),e,t,0,2247,2492,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('              <span data-action="formFields" data-id="'),
a.b(a.v(a.f("id",e,t,0))),a.b('" style="cursor:pointer" class="action direction '),a.b(a.v(a.f("direction",e,t,0))),a.b(' form" data-container="body" title="Form">'),a.b("\n"+n),a.b('                <i class="font-list-ul"></i>'),a.b("\n"+n),a.b("              </span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("isForm",e,t,1),e,t,1,0,0,"")||a.s(a.d("access.view_direction",e,t,1),e,t,0,2568,2948,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <span data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="call_flow" class="direction '),a.b(a.v(a.f("direction",e,t,0))),a.b('" data-container="body" title="'),a.s(a.f("isInbound",e,t,1),e,t,0,2707,2719,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Inbound Call")}),e.pop()),a.s(a.f("isOutbound",e,t,1),e,t,0,2748,2761,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Outbound Call")}),e.pop()),a.b('">'),a.b("\n"+n),a.b('                  <i class="'),a.s(a.f("isInbound",e,t,1),e,t,0,2821,2840,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("font-phone-incoming")}),e.pop()),a.s(a.f("isOutbound",e,t,1),e,t,0,2869,2888,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("font-phone-outgoing")}),e.pop()),a.b('"></i>'),a.b("\n"+n),a.b("                </span>"),a.b("\n"+n)}),e.pop())),a.s(a.f("isChat",e,t,1),e,t,0,3042,3428,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <span "),a.s(a.f("isChatSMS",e,t,1),e,t,0,3075,3091,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("data-badge='sms'")}),e.pop()),a.b("\n"+n),a.b('                  data-action="formFields" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('                  style="cursor:pointer"'),a.b("\n"+n),a.b('                  class="action direction '),a.b(a.v(a.f("direction",e,t,0))),a.b('"'),a.b("\n"+n),a.b('                  data-container="body" title="Chat '),a.s(a.f("isChatSMS",e,t,1),e,t,0,3330,3337,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("via SMS")}),e.pop()),a.b('">'),a.b("\n"+n),a.b('              <i class="font-bubble-2"></i>'),a.b("\n"+n),a.b("            </span>"),a.b("\n"+n)}),e.pop())),a.s(a.f("can_see_profile",e,t,1),e,t,0,3488,3665,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("summary",e,t,1),e,t,0,3509,3644,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="notes-available"><i class="font-notebook" style="color:#995511" data-container="body"></i></span><br/>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("keywordSpotted",e,t,1),e,t,0,3713,3879,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="keyword-spotted" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"><i data-container="#calls" title="Keyword Spotted Call" class="font-radio-checked"></i></span><br/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("caller_gender",e,t,1),e,t,0,3925,4054,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="gender" data-container="#calls" title="'),a.b(a.v(a.f("caller_gender",e,t,0))),a.b('">'),a.b(a.t(a.f("caller_gender_symbol",e,t,0))),a.b("</span><br/>"),a.b("\n"+n)}),e.pop()),a.s(a.f("transcription",e,t,1),e,t,0,4099,4266,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="transcription-available" data-container="#calls" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" title="Call Transcription"><i class="font-file-alt"></i></span><br/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("is_spam",e,t,1),e,t,0,4305,4471,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="spam-level '),a.b(a.v(a.d("spam.risk",e,t,0))),a.b('" data-container="#calls" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" title="Spam level: '),a.b(a.v(a.d("spam.risk",e,t,0))),a.b('"><i class="font-spam"></i></span>'),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"),a.b("\n"+n),a.b('      <span class="agent-initials button-background '),a.b(a.v(a.f("active_class",e,t,0))),a.b('"'),a.s(a.f("active_title",e,t,1),e,t,0,4584,4609,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' title="'),n.b(n.v(n.f("active_title",e,t,0))),n.b('"')}),e.pop()),a.b(">"),a.s(a.f("active_icon",e,t,1),e,t,0,4643,4674,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<i class="'),n.b(n.v(n.f("active_icon",e,t,0))),n.b('"></i>')}),e.pop()),a.s(a.f("active_icon",e,t,1),e,t,1,0,0,"")||(a.s(a.f("initials",e,t,1),e,t,0,4719,4731,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>')),a.b('<span class="agent-pic"></span></span>'),a.b("\n"),a.b("\n"+n),a.b("      <h5>"),a.b("\n"+n),a.b('        <a data-field="name" class="search callerid">'),a.b(a.v(a.f("name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.s(a.f("can_lookup",e,t,1),e,t,0,4951,5163,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <a data-action="lookup" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="noborder-link action font-more2" data-placement="bottom" title="Look up additional information about this caller, using enhanced Caller ID"></a>'),a.b("\n"+n)}),e.pop()),a.s(a.f("caller_business",e,t,1),e,t,0,5207,5271,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <i class="font-user-2" title="business"></i>'),a.b("\n"+n)}),e.pop()),a.s(a.f("caller_consumer",e,t,1),e,t,0,5320,5382,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <i class="font-user" title="consumer"></i>'),a.b("\n"+n)}),e.pop()),a.b("      </h5>"),a.b("\n"+n),a.b('      <h6 class="'),a.b(a.v(a.f("canText",e,t,0))),a.b('">'),a.b("\n"+n),a.b('        <a data-field="caller_number" data-search="'),a.b(a.v(a.f("caller_digits",e,t,0))),a.b('" data-digits="'),a.b(a.v(a.f("phone_number_digits",e,t,0))),a.b('" class="search call_caller_number"'),a.s(a.f("carrier",e,t,1),e,t,0,5599,5642,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' title="'),n.b(n.v(n.f("carrier",e,t,0))),n.b('" data-placement="right"')}),e.pop()),a.b(">"),a.b(a.v(a.f("caller_number_format",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("        "),a.s(a.f("canText",e,t,1),e,t,0,5704,5811,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a class="font-reply action" style="display:inline;float:none" data-id="'),n.b(n.v(n.f("id",e,t,0))),n.b('" data-action="text">text</a>')}),e.pop()),a.b("\n"+n),a.b("      </h6>"),a.b("\n"+n),a.s(a.f("hasCallerloc",e,t,1),e,t,0,5859,6123,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("showCallerloc",e,t,1),e,t,0,5884,6098,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <p class="callerloc">'),a.s(a.f("city",e,t,1),e,t,0,5923,5973,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a data-field="city" class="search">'),n.b(n.v(n.f("city",e,t,0))),n.b("</a>, ")}),e.pop()),a.b('<a data-field="state" class="search">'),a.b(a.v(a.f("state",e,t,0))),a.b('</a> <a data-field="country" class="search">'),a.b(a.v(a.f("country",e,t,0))),a.b("</a></p>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("has_tags",e,t,1),e,t,0,6160,6365,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="call-tags">'),a.b("\n"+n),a.s(a.f("tag_list",e,t,1),e,t,0,6212,6332,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a data-field="tag_list" data-search="'),a.b(a.v(a.d(".",e,t,0))),a.b('" class="inline-tags callout-border-hover search">'),a.b(a.v(a.d(".",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b("    </div>"),a.b("\n"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.d("access.inputs",e,t,1),e,t,0,6441,6924,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-inputs openable mobile-option'),a.s(a.d("prefs.columns.inputs",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.inputs",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"),a.b("\n"+n),a.b("    <ul>"),a.b("\n"+n),a.s(a.d("inputs.menu_inputs",e,t,1),e,t,0,6686,6774,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("\t    <li>"),a.b("\n"+n),a.b('\t      <i class="font-grid" style="font-size:80%"></i> '),a.b(a.v(a.d(".",e,t,0))),a.b("\n"+n),a.b("\t    </li>"),a.b("\n"+n)}),e.pop()),a.b("    </ul>"),a.b("\n"),a.b("\n"+n),a.b("    <ul>"),a.b("\n"+n),a.s(a.d("inputs.geo_inputs",e,t,1),e,t,0,6845,6880,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("\t    <li>zipcode: "),a.b(a.v(a.d(".",e,t,0))),a.b("</li>"),a.b("\n"+n)}),e.pop()),a.b("    </ul>"),a.b("\n"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.d("access.message_body",e,t,1),e,t,0,6970,8681,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-message-body action-col openable'),a.s(a.f("support_allowed",e,t,1),e,t,0,7052,7117,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.s(n.f("message_body",e,t,1),e,t,1,0,0,"")||n.s(n.f("form",e,t,1),e,t,1,0,0,"")||n.b(" empty-column")}),e.pop()),a.s(a.d("prefs.columns.message_body",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.message_body",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.s(a.f("support_allowed",e,t,1),e,t,0,7333,8496,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("message_body",e,t,1),e,t,0,7357,7751,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="text">'),a.s(a.f("message_body_html",e,t,1),e,t,0,7443,7466,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.t(n.f("message_body_html",e,t,0)))}),e.pop()),a.s(a.f("message_body_html",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.f("message_body",e,t,0))),a.s(a.d("message_media.0",e,t,1),e,t,0,7568,7717,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<br/>"),n.s(n.f("message_media",e,t,1),e,t,0,7591,7699,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.s(n.f("is_image",e,t,1),e,t,0,7604,7686,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b('<a href="'),n.b(n.v(n.f("url",e,t,0))),n.b('"><img src="'),n.b(n.v(n.f("url",e,t,0))),n.b('" style="max-width:120px;max-height:80px"/></a>')}),e.pop())}),e.pop())}),e.pop()),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("message_body",e,t,1),e,t,1,0,0,"")||(a.s(a.f("summary",e,t,1),e,t,0,7813,7915,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <span class="action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="text"><p>'),a.b(a.v(a.f("summary",e,t,0))),a.b("</p></span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("form",e,t,1),e,t,0,7943,8465,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="custom_inline_column action'),a.s(a.d("custom.0",e,t,1),e,t,1,0,0,"")||a.b(" empty-column"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-action="formFields">'),a.b("\n"+n),a.s(a.f("custom",e,t,1),e,t,0,8090,8341,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="call-custom_field">'),a.b("\n"+n),a.b('        <span class="call-custom_field-name">'),a.s(a.f("label",e,t,1),e,t,0,8184,8193,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("label",e,t,0)))}),e.pop()),a.s(a.f("label",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.f("id",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b('        <span class="call-custom_field-value">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.f("value",e,t,0))),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.s(a.d("custom.0",e,t,1),e,t,1,0,0,"")||(a.b('      <span style="opacity:0.5">no form entry</span>'),a.b("\n"+n))}),e.pop()))}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,1,0,0,"")||(a.b('      <span style="opacity:0.5"><i class="font-lock"></i> '),a.b(a.v(a.d("Call.extra.support_access_required",e,t,0))),a.b("</span>"),a.b("\n"+n)),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.d("access.source",e,t,1),e,t,0,8727,9874,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-source openable mobile-option'),a.s(a.d("prefs.columns.source",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.source",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"),a.b("\n"+n),a.s(a.d("access.source_name",e,t,1),e,t,0,8960,9100,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("source",e,t,1),e,t,0,8976,9086,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <h5>"),a.b("\n"+n),a.b('\t\t<a data-field="source" class="search"><i class="font-newspaper"></i> '),a.b(a.v(a.f("source",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("    </h5>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("\n"+n),a.s(a.f("form",e,t,1),e,t,0,9138,9321,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <span>"),a.b("\n"+n),a.b('        <a class="search" data-field="form.form_name"'),a.b("\n"+n),a.b('           data-search="'),a.b(a.v(a.d("form.form_name",e,t,0))),a.b('"><i class="font-list-alt"></i> '),a.b(a.v(a.d("form.form_name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </span>"),a.b("\n"+n)}),e.pop()),a.s(a.f("form",e,t,1),e,t,1,0,0,"")||(a.b("      <span>"),a.b("\n"+n),a.b('        <a class="search" data-field="tracking_number"'),a.b("\n"+n),a.b('           data-search="'),a.b(a.v(a.f("called_digits",e,t,0))),a.b('">'),a.b(a.v(a.f("tracking_number_format",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </span>"),a.b("\n"),a.b("\n"+n),a.s(a.f("tracking_label",e,t,1),e,t,0,9527,9568,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <p>("),a.b(a.v(a.f("tracking_label",e,t,0))),a.b(")</p>"),a.b("\n"+n)}),e.pop())),a.b("\n"+n),a.s(a.d("access.source_detail",e,t,1),e,t,0,9632,9838,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("\n"+n),a.s(a.f("visitor",e,t,1),e,t,0,9651,9820,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("\t      "),a.s(a.f("search",e,t,1),e,t,0,9670,9716,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<small class="small-source">'),n.b(n.v(n.f("search",e,t,0))),n.b("</small>")}),e.pop()),a.b("\n"+n),a.b("\t      "),a.s(a.f("referrer",e,t,1),e,t,0,9748,9801,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<small class="small-source">'),n.b(n.v(n.d("referrer.host",e,t,0))),n.b("</small>")}),e.pop()),a.b("\n"+n)}),e.pop()),a.b("\n"+n)}),e.pop()),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.s(a.d("access.source_detail",e,t,1),e,t,0,9920,10242,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-source-detail openable mobile-option'),a.s(a.d("prefs.columns.source_detail",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.source_detail",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-key="'),a.b(a.v(a.d("plan.base.keywords",e,t,0))),a.b('">'),a.b("\n"+n),a.b(a.rp("<calls/_source_detail_col1",e,t,"    ")),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.s(a.f("visible_custom_panels",e,t,1),e,t,0,10296,10584,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <td class="log-column call-custom call-c'),a.b(a.v(a.f("panel_id",e,t,0))),a.b(" action-col openable "),a.s(a.f("hasValues",e,t,1),e,t,1,0,0,"")||a.b("empty-column"),a.b(" mobile-option"),a.s(a.f("visible",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.f("section_visible",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b(a.rp("<calls/_custom_column2",e,t,"      ")),a.b("    </td>"),a.b("\n"+n)}),e.pop()),a.s(a.d("access.csr",e,t,1),e,t,0,10628,10880,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-csr action-col openable mobile-option'),a.s(a.d("prefs.columns.csr",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.csr",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b(a.rp("<calls/_call_row_sale_column3",e,t,"    ")),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.d("access.audio",e,t,1),e,t,0,10916,13133,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-audio action-col mobile-option'),a.s(a.d("prefs.columns.audio",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.audio",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.s(a.f("has_audio",e,t,1),e,t,0,11138,12538,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="audio-wrapper">'),a.b("\n"+n),a.s(a.f("can_playback",e,t,1),e,t,0,11194,11500,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a href="/calls/'),a.b(a.v(a.f("id",e,t,0))),a.b('/playback"'),a.b("\n"+n),a.b('         data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('         data-audio-mp3="'),a.b(a.v(a.f("audio",e,t,0))),a.b('.mp3"'),a.b("\n"+n),a.b('         data-audio-wav="'),a.b(a.v(a.f("audio",e,t,0))),a.b('"'),a.b("\n"+n),a.b('         data-action="playback"'),a.b("\n"+n),a.b('         class="noborder-small action audio audio-player font-headphones">'),a.b("\n"+n),a.b('        <span class="text">audio</span>'),a.b("\n"+n),a.b("      </a>"),a.b("\n"+n)}),e.pop()),a.b('      <span class="duration" data-placement="left" data-container="#calls" title="'),a.b(a.v(a.d("Call.properties.ring_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("ring_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.talk_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("talk_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.hold_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("hold_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.duration.label",e,t,0))),a.b(": "),a.b(a.v(a.f("duration",e,t,0))),a.b(' seconds" data-placement="left">'),a.b("\n"+n),a.b('        <i class="'),a.b(a.v(a.f("time_icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.f("call_length",e,t,0))),a.b("\n"+n),a.b("      </span>"),a.b("\n"+n),a.s(a.d("recordings.0",e,t,1),e,t,0,11952,12199,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="container">'),a.b("\n"+n),a.b('          <a title="'),a.b(a.v(a.f("talk_time",e,t,0))),a.b(' seconds recorded" target="_blank" data-action="toggleAudio" class="additional-audio pull-left" data-container="#calls" href="'),a.b(a.v(a.f("audio",e,t,0))),a.b('"><i class="font-headphones-2"></i></a>'),a.b("\n"+n)}),e.pop()),a.s(a.f("recordings",e,t,1),e,t,0,12240,12460,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <a title="'),a.b(a.v(a.f("len",e,t,0))),a.b(' seconds recorded after call" target="_blank" data-action="toggleAudio" class="additional-audio pull-left" data-container="#calls" href="'),a.b(a.v(a.f("url",e,t,0))),a.b('"><i class="font-headphones-2"></i></a>'),a.b("\n"+n)}),e.pop()),a.b("      "),a.s(a.d("recordings.0",e,t,1),e,t,0,12499,12505,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("</div>")}),e.pop()),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("has_audio",e,t,1),e,t,1,0,0,"")||(a.s(a.f("can_playback",e,t,1),e,t,0,12595,12781,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("in_progress",e,t,1),e,t,0,12618,12652,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <p>in progress</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("isChat",e,t,1),e,t,1,0,0,"")||a.s(a.f("in_progress",e,t,1),e,t,1,0,0,"")||(a.b("        <p>no audio</p>"),a.b("\n"+n))}),e.pop()),a.b('      <span class="duration" title="'),a.b(a.v(a.d("Call.properties.ring_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("ring_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.talk_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("talk_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.duration.label",e,t,0))),a.b(": "),a.b(a.v(a.f("duration",e,t,0))),a.b(' seconds" data-placement="left">'),a.b("\n"+n),a.b('        <i class="'),a.b(a.v(a.f("time_icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.f("call_length",e,t,0))),a.b("\n"+n),a.b("      </span>"),a.b("\n"+n)),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.d("access.metrics",e,t,1),e,t,0,13173,14265,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-metrics openable'),a.s(a.d("prefs.columns.metrics",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.metrics",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <div class="source-detail">'),a.b("\n"+n),a.b('      <div class="source-info activity-date">'),a.b("\n"+n),a.b('        <span><i class="font-calendar hidden-xs"></i> '),a.b(a.v(a.f("call_date_formated",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="source-info activity-time">'),a.b("\n"+n),a.b('        <span title="Ring time: '),a.b(a.v(a.f("ring_time",e,t,0))),a.b(" seconds, talk time: "),a.b(a.v(a.f("talk_time",e,t,0))),a.b(" seconds, total time: "),a.b(a.v(a.f("duration",e,t,0))),a.b(' seconds" data-placement="left">'),a.b("\n"+n),a.b('          <i class="font-time hidden-xs"></i> '),a.b(a.v(a.f("call_time",e,t,0))),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="source-info activity-status">'),a.b("\n"+n),a.b("        <span>"),a.b("\n"+n),a.b('          <i class="'),a.b(a.v(a.f("status_icon",e,t,0))),a.b('"></i> <span>'),a.b(a.v(a.f(":call_status",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("        </span>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="source-info activity-transfer">'),a.b("\n"+n),a.b("        <span>"),a.b("\n"+n),a.s(a.f("view_transfers",e,t,1),e,t,0,14085,14195,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <i class="font-share-alt"></i> <span class="hidden-xs">transferred @</span> '),a.b(a.v(a.f("duration",e,t,0))),a.b("\n"+n)}),e.pop()),a.b("        </span>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"),a.b("\n"+n),a.s(a.d("access.receiving_number",e,t,1),e,t,0,14317,15017,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-receiving-number openable mobile-option'),a.s(a.d("prefs.columns.receiving_number",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.receiving_number",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.s(a.f("isAgent",e,t,1),e,t,1,0,0,"")||a.b(a.rp("<calls/_call_agent4",e,t,"    ")),a.b('    <a class="search" data-field="business_number" data-search="'),a.b(a.v(a.f("business_number",e,t,0))),a.b('">'),a.b(a.v(a.f("business_number_format",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("    <h6>"),a.b(a.v(a.f("business_label",e,t,0))),a.b("</h6>"),a.b("\n"+n),a.s(a.f("hasCallFlow",e,t,1),e,t,0,14805,14990,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.d("call_path.0",e,t,1),e,t,0,14826,14969,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a class="call_path search" data-field="call_path.route_name" data-id="'),a.b(a.v(a.f("route_id",e,t,0))),a.b('">'),a.b(a.v(a.f("route_name",e,t,0))),a.b(' <i class="font-random"></i></a>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("\n"),a.b("\n"+n),a.s(a.f("agency_all",e,t,1),e,t,0,15065,15126,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-actions mobile-option"></td>'),a.b("\n"+n)}),e.pop()),a.s(a.f("agency_all",e,t,1),e,t,1,0,0,"")||a.s(a.d("access.actions",e,t,1),e,t,0,15181,20352,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <td class="log-column call-actions'),a.s(a.f("more_actions",e,t,1),e,t,0,15235,15248,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" more-actions")}),e.pop()),a.b(" openable mobile-option"),a.s(a.d("prefs.columns.actions",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.d("prefs.sections.actions",e,t,1),e,t,1,0,0,"")||a.b(" hidden-section"),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <div class="action-box">'),a.b("\n"+n),a.s(a.f("can_email",e,t,1),e,t,0,15487,15912,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="action '),a.s(a.f("emails_count",e,t,1),e,t,0,15526,15537,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("has_emailed")}),e.pop()),a.b('"'),a.b("\n"+n),a.b('       data-action="email"'),a.b("\n"+n),a.b('       data-placement="left"'),a.b("\n"+n),a.b('       data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('       title="'),a.b(a.v(a.d("Call.actions.secondary.email.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('      <span class="'),a.b(a.v(a.d("Call.actions.secondary.email.icon",e,t,0))),a.b(' a-icon"'),a.s(a.f("emails_count",e,t,1),e,t,0,15772,15802,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-badge="'),n.b(n.v(n.f("emails_count",e,t,0))),n.b('"')}),e.pop()),a.b("></span>"),a.b("\n"+n),a.b('      <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.email.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("can_flag",e,t,1),e,t,0,15944,16255,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="action"'),a.b("\n"+n),a.b('       data-action="flag"'),a.b("\n"+n),a.b('       data-placement="left"'),a.b("\n"+n),a.b('       data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('       title="'),a.b(a.v(a.d("Call.actions.secondary.flag.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('      <span class="'),a.b(a.v(a.d("Call.actions.secondary.flag.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('      <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.flag.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("can_remind",e,t,1),e,t,0,16288,16807,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("hide_remind_action",e,t,1),e,t,1,0,0,"")||(a.b('     <a class="action '),a.s(a.f("reminders_count",e,t,1),e,t,0,16361,16372,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("has_emailed")}),e.pop()),a.b('"'),a.b("\n"+n),a.b('        data-action="reminder"'),a.b("\n"+n),a.b('        data-placement="left"'),a.b("\n"+n),a.b('        data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('        title="'),a.b(a.v(a.d("Call.actions.secondary.reminder.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('       <span class="'),a.b(a.v(a.d("Call.actions.secondary.reminder.icon",e,t,0))),a.b(' a-icon"'),a.s(a.f("reminders_count",e,t,1),e,t,0,16627,16660,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-badge="'),n.b(n.v(n.f("reminders_count",e,t,0))),n.b('"')}),e.pop()),a.b("></span>"),a.b("\n"+n),a.b('       <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.reminder.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("     </a>"),a.b("\n"+n))}),e.pop()),a.s(a.f("can_stripe",e,t,1),e,t,0,16842,17161,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a class="action"'),a.b("\n"+n),a.b('       data-action="stripe"'),a.b("\n"+n),a.b('       data-placement="left"'),a.b("\n"+n),a.b('       data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('       title="'),a.b(a.v(a.d("Call.actions.secondary.stripe.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('      <span class="'),a.b(a.v(a.d("Call.actions.secondary.stripe.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('      <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.stripe.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("salesforce",e,t,1),e,t,0,17198,17772,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="salesforce action"'),a.b("\n"+n),a.b('           data-action="salesforce"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           href="'),a.b(a.v(a.d("salesforce.url",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           target="_blank"'),a.b("\n"+n),a.b('           title="Salesforce '),a.b(a.v(a.d("salesforce.reference",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <span class="font-salesforce a-icon"></span>'),a.b("\n"+n),a.b('          <span class="text">'),a.b("\n"+n),a.s(a.d("salesforce.reference",e,t,1),e,t,0,17573,17621,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            "),a.b(a.v(a.d("salesforce.reference",e,t,0))),a.b("\n"+n)}),e.pop()),a.s(a.d("salesforce.reference",e,t,1),e,t,1,0,0,"")||(a.b("            Add"),a.b("\n"+n)),a.b("          </span>"),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("msdynamics_record",e,t,1),e,t,0,17816,18137,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="msdynamics action"'),a.b("\n"+n),a.b('           data-action="msdynamics"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           href="https://'),a.b(a.v(a.f("msdynamics_url",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           target="_blank"'),a.b("\n"+n),a.b('           title="Microsoft Dynamics">'),a.b("\n"+n),a.b('          <span class="font-ms-dynamics a-icon"></span>'),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("mailchimp",e,t,1),e,t,0,18180,18443,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="mailchimp action"'),a.b("\n"+n),a.b('           data-action="mailchimp"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           target="_blank"'),a.b("\n"+n),a.b('           title="Mailchimp">'),a.b("\n"+n),a.b('          <span class="font-mailchimp a-icon"></span>'),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("hubspot",e,t,1),e,t,0,18476,18910,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="hubspot action"'),a.b("\n"+n),a.b('           data-action="hubspot"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           href="'),a.b(a.v(a.d("hubspot.profile_url",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           target="_blank"'),a.b("\n"+n),a.b('           title="'),a.b(a.v(a.d("Call.actions.secondary.hubspot.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <span class="'),a.b(a.v(a.d("Call.actions.secondary.hubspot.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('          <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.hubspot.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("marketo",e,t,1),e,t,0,18941,19367,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="marketo action"'),a.b("\n"+n),a.b('           data-action="marketo"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           href="'),a.b(a.v(a.d("marketo.url",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           target="_blank"'),a.b("\n"+n),a.b('           title="'),a.b(a.v(a.d("Call.actions.secondary.marketo.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <span class="'),a.b(a.v(a.d("Call.actions.secondary.marketo.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('          <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.marketo.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("visible_custom_actions",e,t,1),e,t,0,19413,19723,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a class="action"'),a.b("\n"+n),a.b('         data-action="custom_'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('         data-placement="left"'),a.b("\n"+n),a.b('         title="'),a.s(a.f("description",e,t,1),e,t,0,19538,19553,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("description",e,t,0)))}),e.pop()),a.s(a.f("description",e,t,1),e,t,1,0,0,"")||a.b(a.v(a.f("name",e,t,0))),a.b('">'),a.b("\n"+n),a.b('        <span class="font-'),a.b(a.v(a.f("icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('        <span class="text">'),a.b(a.v(a.f("name",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("      </a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("_super",e,t,1),e,t,0,19768,20287,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <a class="infolog action"'),a.b("\n"+n),a.b('           data-action="infolog"'),a.b("\n"+n),a.b('           data-placement="left"'),a.b("\n"+n),a.b('           data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('           title="'),a.b(a.v(a.d("Call.actions.secondary.infolog.title",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <span class="'),a.b(a.v(a.d("Call.actions.secondary.infolog.icon",e,t,0))),a.b(' a-icon"></span>'),a.b("\n"+n),a.b('          <span class="text">'),a.b(a.v(a.d("Call.actions.secondary.infolog.label",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("        </a>"),a.b("\n"+n),a.b('        <a class="action call-xml" data-action="call-xml" style="display:none" href="/calls/'),a.b(a.v(a.f("id",e,t,0))),a.b('/calllog">'),a.b(a.v(a.d("Call.actions.secondary.call-xml.label",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b('      <div class="clear"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n)}),e.pop()),a.b("</tr>"),a.b("\n"),a.fl()},"partials":{"<call_primary_actions0":{"name":"call_primary_actions","partials":{},"subs":{}},"<calls/_source_detail_col1":{"name":"calls/_source_detail_col","partials":{},"subs":{}},"<calls/_custom_column2":{"name":"calls/_custom_column","partials":{},"subs":{}},"<calls/_call_row_sale_column3":{"name":"calls/_call_row_sale_column","partials":{},"subs":{}},"<calls/_call_agent4":{"name":"calls/_call_agent","partials":{},"subs":{}}},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/call_stats"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field total-text"'),
a.s(a.f("text_log",e,t,1),e,t,0,42,64,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="display:block"')}),e.pop()),a.b(">"),a.b("\n"+n),a.b("  <label>Total</label>"),a.b("\n"+n),a.b("  <span>"),a.b(a.v(a.f("total_text",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.s(a.f("text_log",e,t,1),e,t,1,0,0,"")||(a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>"),a.b(a.v(a.d("Call.properties.ring_time.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b("  <span>"),a.b(a.v(a.d("ring_time.total_text",e,t,0))),a.b("</span><br/>"),a.b("\n"+n),a.b('  <span class="hint">mean '),a.b(a.v(a.d("ring_time.mean",e,t,0))),a.b(" \xb1"),a.b(a.v(a.d("ring_time.std",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>"),a.b(a.v(a.d("Call.properties.talk_time.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b("  <span>"),a.b(a.v(a.d("talk_time.total_text",e,t,0))),a.b("</span></br>"),a.b("\n"+n),a.b('  <span class="hint">mean '),a.b(a.v(a.d("talk_time.mean",e,t,0))),a.b(" \xb1"),a.b(a.v(a.d("talk_time.std",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>"),a.b(a.v(a.d("Call.properties.hold_time.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b("  <span>"),a.b(a.v(a.d("hold_time.total_text",e,t,0))),a.b("</span></br>"),a.b("\n"+n),a.b('  <span class="hint">mean '),a.b(a.v(a.d("hold_time.mean",e,t,0))),a.b(" \xb1"),a.b(a.v(a.d("hold_time.std",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <label>"),a.b(a.v(a.d("Call.properties.duration.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b("  <span>"),a.b(a.v(a.d("minutes.total_text",e,t,0))),a.b("</span></br>"),a.b("\n"+n),a.b('  <span class="hint">mean '),a.b(a.v(a.d("minutes.mean",e,t,0))),a.b(" \xb1"),a.b(a.v(a.d("minutes.std",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_analytics"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.t(a.d("Call.panels.caller_session.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.f("total_visitors",e,t,0))),a.b(" possible visitors for call</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.d("call.id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"),a.b("\n"+n),a.b('  <div class="standard-table-container">'),a.b("\n"+n),a.b('  <div class="standard-table-parent container-fluid">'),a.b("\n"+n),a.b('  <div class="table-responsive">'),a.b("\n"+n),a.b('  <table class="table table-striped table-hover table-condensed standard-table table-mobile" style="margin-bottom:0">'),a.b("\n"+n),a.b("<thead>"),a.b("\n"+n),a.b("<tr>"),a.b("\n"+n),a.b("  <th></th>"),a.b("\n"+n),a.b("  <th>"),a.b(a.v(a.d("Call.properties.webvisit.properties.referrer_host.label",e,t,0))),a.b("</th>"),a.b("\n"+n),a.b("  <th>"),a.b(a.v(a.d("Call.properties.webvisit.properties.keywords.label",e,t,0))),a.b("</th>"),a.b("\n"+n),a.b("  <th>"),a.b(a.v(a.d("Call.properties.webvisit.properties.location_host.label",e,t,0))),a.b("</th>"),a.b("\n"+n),a.b("  <th>"),a.b(a.v(a.d("Call.properties.likelihood.name",e,t,0))),a.b("</th>"),a.b("\n"+n),a.b("  <th>"),a.b("\n"+n),a.b("  </th>"),a.b("\n"+n),a.b("</tr>"),a.b("\n"+n),a.b("</thead>"),a.b("\n"+n),a.b("<tbody>"),a.b("\n"+n),a.s(a.f("visitors",e,t,1),e,t,0,795,4038,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("<tr "),a.s(a.f("selected",e,t,1),e,t,0,813,835,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('class="active-visitor"')}),e.pop()),a.b(">"),a.b("\n"+n),a.b("  <td>"),a.b("\n"+n),a.s(a.f("selected",e,t,1),e,t,1,0,0,"")||(a.b('    <a data-id="'),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('" data-call="'),a.b(a.v(a.d("call.id",e,t,0))),a.b("\" class='btn btn-default toggle-visitor use-visitor'>"),a.b(a.v(a.d("Call.actions.use.label",e,t,0))),a.b("</a>"),a.b("\n"+n)),a.s(a.f("selected",e,t,1),e,t,0,1048,1201,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <a data-id="'),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('" data-call="'),a.b(a.v(a.d("call.id",e,t,0))),a.b("\" class='btn btn-default toggle-visitor remove-visitor'>"),a.b(a.v(a.d("Call.actions.do_not_use.label",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("google_analytics",e,t,1),e,t,1,0,0,"")||(a.b('    <a class="lookup-campaign font-analytics" style="float:right" title="'),a.b(a.v(a.d("Call.actions.lookup_campaign.title",e,t,0))),a.b('" data-id="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('" data-url="/calls/'),a.b(a.v(a.d("call.id",e,t,0))),a.b('/lookup_campaign"'),a.s(a.f("selected",e,t,1),e,t,1,0,0,"")||a.b(' style="display:none"'),a.b("></a>"),a.b("\n"+n),a.b("    <br/>"),a.b("\n"+n)),a.b("  </td>"),a.b("\n"+n),a.b('  <td style="text-overflow:ellipsis" class="mobile-primary"><input type="text" readonly class="flat-input" value="'),a.b(a.v(a.d("visitor.ref",e,t,0))),a.b('"/><span class="mobile-info" style="font-size:80%;color:#888;float:right">'),a.b(a.v(a.f("likelihood",e,t,0))),a.b('%</span><div class="clear"></div></td>'),a.b("\n"+n),a.b('  <td style="text-overflow:ellipsis" class="mobile-secondary"><span class="mobile-info"><b>Visitor URL:</b> '),a.b(a.v(a.d("visitor.url",e,t,0))),a.b("<br/><b>Keywords:</b> </span>"),a.b(a.v(a.d("visitor.detail.table.keywords",e,t,0))),a.b("\n"+n),a.b('    <span class="mobile-info">'),a.b("\n"+n),a.b("      <br/><br/>"),a.b("\n"+n),a.s(a.f("selected",e,t,1),e,t,1,0,0,"")||(a.b('      <a data-id="'),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('" data-call="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('" class=\'toggle-visitor use-visitor\' style="font-size:120%">'),a.b(a.v(a.d("Call.actions.use.label",e,t,0))),a.b("</a>"),a.b("\n"+n)),a.s(a.f("selected",e,t,1),e,t,0,2210,2374,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a data-id="'),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('" data-call="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('" class=\'toggle-visitor remove-visitor\' style="font-size:120%">'),a.b(a.v(a.d("Call.actions.do_not_use.label",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("    </span>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b('  <td style="text-overflow:ellipsis"><input type="text" readonly class="flat-input" value="'),a.b(a.v(a.d("visitor.url",e,t,0))),a.b('"/></td>'),a.b("\n"+n),a.b("  <td>"),a.b(a.v(a.f("likelihood",e,t,0))),a.b("\n"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b("  <td>"),a.b("\n"+n),a.b('    <a data-id="'),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('" data-call="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('" class="button edit-button detail-visitor" target="_blank" href="/reports/visitor?id='),a.b(a.v(a.d("visitor.id",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.actions.detail.label",e,t,0))),a.b("</a>"),a.b("\n"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b("</tr>"),a.b("\n"+n),a.s(a.f("google_analytics",e,t,1),e,t,0,2788,4016,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <tr>"),a.b("\n"+n),a.b('    <td colspan="6">'),a.b("\n"+n),a.b("      <table>"),a.b("\n"+n),a.b("        <thead>"),a.b("\n"+n),a.b("          <tr>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.campaign.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>Ad Group</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.source.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.medium.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.keyword.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.ad_match_type.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.ad_content.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>Ad Position</td>"),a.b("\n"+n),a.b("            <td>Ad Network</td>"),a.b("\n"+n),a.b("            <td>"),a.b(a.v(a.d("Call.properties.paid.properties.ad_format.label",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("            <td>Ad Targeting Type</td>"),a.b("\n"+n),a.b("          </tr>"),a.b("\n"+n),a.b("        </thead>"),a.b("\n"+n),a.b("        <tbody>"),a.b("\n"+n),a.b("        <tr>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("campaign",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("adgroup",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("source",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("medium",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("keyword",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_match_type",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_content",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_slot",e,t,0))),a.b(" "),a.b(a.v(a.f("ad_slot_position",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_network",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_format",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("          <td>"),a.b(a.v(a.f("ad_targeting_type",e,t,0))),a.b("</td>"),a.b("\n"+n),a.b("        </tr>"),a.b("\n"+n),a.b("        </tbody>"),a.b("\n"+n),a.b("      </table>"),a.b("\n"+n),a.b("    </td>"),a.b("\n"+n),a.b("  </tr>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("</tbody>"),a.b("\n"+n),a.b("</table>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("<footer>"),a.b("\n"+n),a.b('  <a class=\'button check-google-analytics\' style="color:#fff" data-id="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.actions.check-google-analytics.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.check-google-analytics.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("</footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_history"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>Caller History: <small>"),a.b(a.v(a.d("history.total_entries",e,t,0))),a.b(" calls from "),a.b(a.v(a.d("call.source",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('<table class="table table-hover table-striped table-condensed" data-account="'),a.b(a.v(a.d("call.account_id",e,t,0))),a.b('">'),a.b("\n"+n),a.b("  <thead>"),a.b("\n"+n),a.b("    <tr>"),a.b("\n"+n),a.s(a.d("prefs.columns.audio",e,t,1),e,t,0,344,396,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <th class="span1 col-audio">Audio</th>'),a.b("\n"+n)}),e.pop()),a.s(a.d("prefs.columns.metrics",e,t,1),e,t,0,453,509,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <th class="span1 col-metrics">Metrics</th>'),a.b("\n"+n)}),e.pop()),a.s(a.d("prefs.columns.csr",e,t,1),e,t,0,564,613,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <th class="span1 col-csr">Sale</th>'),a.b("\n"+n)}),e.pop()),a.b('      <th class="span2 col-tags">Tags</th>'),a.b("\n"+n),a.b('      <th class="span8 col-notes">Notes</th>'),a.b("\n"+n),a.b("    </tr>"),a.b("\n"+n),a.b("  </thead>"),a.b("\n"+n),a.b("  <tbody>"),a.b("\n"+n),a.s(a.d("history.calls",e,t,1),e,t,0,777,2689,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <tr>"),a.b("\n"+n),a.s(a.d("prefs.columns.audio",e,t,1),e,t,0,817,1344,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <td class="call-audio action-col">'),a.b("\n"+n),a.s(a.f("audio",e,t,1),e,t,0,877,1260,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="audio-wrapper">'),a.b("\n"+n),a.b('          <a href="/calls/'),a.b(a.v(a.f("id",e,t,0))),a.b('/playback"'),a.b("\n"+n),a.b('             data-audio-mp3="'),a.b(a.v(a.f("audio",e,t,0))),a.b('.mp3"'),a.b("\n"+n),a.b('             data-audio-wav="'),a.b(a.v(a.f("audio",e,t,0))),a.b('"'),a.b("\n"+n),a.b('             data-action="playback"'),a.b("\n"+n),a.b('             class="noborder-small action audio audio-player font-headphones" auto" target="_blank">'),a.b("\n"+n),a.b('            <span class="text">audio</span>'),a.b("\n"+n),a.b("          </a>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("audio",e,t,1),e,t,1,0,0,"")||(a.b("        no audio"),a.b("\n"+n)),a.b("      </td>"),a.b("\n"+n)}),e.pop()),a.s(a.d("prefs.columns.metrics",e,t,1),e,t,0,1401,2160,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <td class="call-metrics">'),a.b("\n"+n),a.b('        <div class="source-detail" style="width:100%">'),a.b("\n"+n),a.b('          <div class="source-info">'),a.b("\n"+n),a.b('            <span class="hint"><i class="icon-calendar"></i> '),a.b(a.v(a.f("call_date",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="source-info">'),a.b("\n"+n),a.b('            <span class="hint"><i class="icon-time"></i> '),a.b(a.v(a.f("call_time",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="source-info">'),a.b("\n"+n),a.b('            <span title="'),a.b(a.v(a.d("Call.properties.ring_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("ring_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.talk_time.label",e,t,0))),a.b(": "),a.b(a.v(a.f("talk_time",e,t,0))),a.b(" seconds, "),a.b(a.v(a.d("Call.properties.duration.label",e,t,0))),a.b(": "),a.b(a.v(a.f("duration",e,t,0))),a.b(' seconds" class="hint" data-placement="left">'),a.b("\n"+n),a.b('              <i class="'),a.b(a.v(a.f("time_icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.f("call_length",e,t,0))),a.b("\n"+n),a.b("            </span>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </td>"),a.b("\n"+n)}),e.pop()),a.s(a.d("prefs.columns.csr",e,t,1),e,t,0,2215,2567,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <td class="call-csr">'),a.b("\n"+n),a.s(a.f("sale",e,t,1),e,t,0,2263,2537,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <div>"),a.b("\n"+n),a.b("            <strong>"),a.b(a.v(a.f("name",e,t,0))),a.b("</strong>"),a.b("\n"+n),a.b('            <br style="clear:both"/>'),a.b("\n"+n),a.b("            <span>"),a.s(a.f("value",e,t,1),e,t,0,2383,2494,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.s(n.f("conversion",e,t,1),e,t,0,2398,2451,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b('<i style="font-size:10px" class="font-thumbs-up"></i>')}),e.pop()),n.b(": <strong>"),n.b(n.v(n.f("value",e,t,0))),n.b("</strong>")}),e.pop()),a.b("</span>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop()),a.b("        </td>"),a.b("\n"+n)}),e.pop()),a.b("      <td>"),a.b("\n"+n),a.b("        "),a.b(a.v(a.f("tag_list",e,t,0))),a.b("\n"+n),a.b("      </td>"),a.b("\n"+n),a.b("      <td>"),a.b("\n"+n),a.b("        "),a.b(a.v(a.f("notes",e,t,0))),a.b("\n"+n),a.b("      </td>"),a.b("\n"+n),a.b("    </tr>"),a.b("\n"+n)}),e.pop()),a.b("  </tbody>"),a.b("\n"+n),a.s(a.d("history.has_more",e,t,1),e,t,0,2742,2820,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <tfoot>"),a.b("\n"+n),a.b("    <tr>"),a.b("\n"+n),a.b('      <td colspan="5">'),a.b("\n"+n),a.b("      </td>"),a.b("\n"+n),a.b("    </tr>"),a.b("\n"+n),a.b("  </tfoot>"),a.b("\n"+n)}),e.pop()),a.b("</table>"),a.b("\n"+n),a.b("<form>"),a.b("\n"+n),a.b('  <div class="form-actions">'),a.b("\n"+n),a.b('    <a class="close">close</a>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_messages"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<form id="email_call_'),a.b(a.v(a.f("id",e,t,0))),a.b('" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" action="'),a.b(a.v(a.f("call_notifications_path",e,t,0))),a.b('" method="POST" class="validatable">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h3>"),a.b(a.t(a.d("Call.panels.caller_messages.label",e,t,0))),a.b(" <small>"),a.b(a.t(a.d("Call.panels.caller_messages.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.b('    <input id="call_notification_call_id_'),a.b(a.v(a.f("id",e,t,0))),a.b('" name="call_notification[call_id]" type="hidden" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('    <input id="call_notification_type_'),a.b(a.v(a.f("id",e,t,0))),a.b('" name="call_notification[type]" type="hidden" value="email">'),a.b("\n"+n),a.b('    <div class="field">'),a.b("\n"+n),a.b('      <label for="call_notification_to_'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.to.label",e,t,0))),a.b(' <i class="font-help" title="'),a.b(a.v(a.d("Call.properties.emails.properties.to.title",e,t,0))),a.b('"></i></label>'),a.b("\n"+n),a.b('      <input id="call_notification_to_'),a.b(a.v(a.f("id",e,t,0))),a.b('" type="text" class="input-xxlarge text" name="call_notification[to]"/>'),a.b("\n"+n),a.b('      <div class="more-addrs">'),a.b("\n"+n),a.b('        <a data-type="cc" data-name="CC" data-desc="'),a.b(a.v(a.d("Call.properties.emails.properties.cc.title",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.cc.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('        <a data-type="bcc" data-name="BCC" data-desc="'),a.b(a.v(a.d("Call.properties.emails.properties.bcc.title",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.bcc.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="field">'),a.b("\n"+n),a.b('      <label for="call_notification_subject_'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.subject.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <input id="call_notification_subject_'),a.b(a.v(a.f("id",e,t,0))),a.b('" name="call_notification[subject]" type="text" class="input-xxlarge text" value="'),a.b(a.v(a.f("email_subject",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <label for="call_notification_message_'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.message.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('    <textarea cols="40" id="call_notification_message_'),a.b(a.v(a.f("id",e,t,0))),a.b('" name="call_notification[message]" rows="20" class="text input-xxlarge"></textarea>'),a.b("\n"+n),a.b("    <p>"),a.b("\n"+n),a.b('      <label><input type="checkbox" name="call_notification[include_call]"/> '),a.b(a.t(a.d("Call.properties.emails.properties.include_call.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <span class="hint">'),a.b(a.t(a.d("Call.properties.emails.properties.include_call.hint",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </p>"),a.b("\n"+n),a.b('    <div id="sent_mails_for_'),a.b(a.v(a.f("id",e,t,0))),a.b('"> </div>'),a.b("\n"+n),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <input type="submit" class="button callout" value="'),a.b(a.v(a.d("Call.actions.send_call.label",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b('      <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_messages_emails"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.d("emails.0",e,t,1),e,t,0,13,56,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("<h4>Past emails related to this call</h4>"),a.b("\n"+n)}),e.pop()),a.b("<ul>"),a.b("\n"+n),a.s(a.f("emails",e,t,1),e,t,0,88,289,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <li>"),a.b("\n"+n),a.b("    <strong>To:</strong> "),a.b(a.v(a.f("to_emails",e,t,0))),a.b(", <strong>From</strong> "),a.b(a.v(a.f("from",e,t,0))),a.b(", <strong>On</strong>: "),a.b(a.v(a.f("created_at",e,t,0))),a.b("\n"+n),a.b("    <cite></cite><br>"),a.b("\n"+n),a.b("    <strong>"),a.b(a.v(a.f("subject",e,t,0))),a.b("</strong>"),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.f("body",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("  </li>"),a.b("\n"+n)}),e.pop()),a.b("</ul>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_profile"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<form class="form-inline" action="/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/modify" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" method="POST" novalidate="novalidate">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.t(a.d("Call.panels.caller_profile.label",e,t,0))),a.b(" <small>"),a.b(a.t(a.d("Call.panels.caller_profile.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.s(a.f("callbacks",e,t,1),e,t,0,369,661,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="callback-history" id="called-history-'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b("      <ul>"),a.b("\n"+n),a.b("        <li>"),a.b(a.v(a.d("user.name",e,t,0))),a.b(" called "),a.b(a.v(a.f("to_number",e,t,0))),a.b(" at "),a.b(a.v(a.f("called_at",e,t,0))),a.b(" for "),a.b(a.v(a.f("duration",e,t,0))),a.b(" seconds.  "),a.s(a.f("recording_url",e,t,1),e,t,0,552,609,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a target="_blank" href="'),n.b(n.v(n.f("recording_url",e,t,0))),n.b('">recording</a>')}),e.pop()),a.b(" </li>"),a.b("\n"+n),a.b("      </ul>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.name.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="caller_name text" type="text" name="call[name]" value="'),a.b(a.v(a.d("caller.name",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.email.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="caller_email text" type="email" name="call[email]" value="'),a.b(a.v(a.d("caller.email",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.contact_number.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="caller_number text" type="tel" name="call[number]" value="'),a.b(a.v(a.d("caller.alternative_number",e,t,0))),a.b('" style="width:100%"/><br/>'),a.b("\n"+n),a.b("          <cite>"),a.b(a.v(a.f("caller_number",e,t,0))),a.b(' <i class="font-question" title="'),a.b(a.v(a.d("Call.properties.alternative_number.title",e,t,0))),a.b('"></i> </cite>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.street.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="text" type="text" name="call[street]" value="'),a.b(a.v(a.d("caller.address.street",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("    "),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.city.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="text" type="text" name="call[city]" value="'),a.b(a.v(a.d("caller.address.city",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.state.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="text" type="text" name="call[state]" value="'),a.b(a.v(a.d("caller.address.state",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.country.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="text" type="text" name="call[country]" value="'),a.b(a.v(a.d("caller.address.country",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>"),a.b(a.t(a.d("Call.properties.postal_code.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input class="text" type="text" name="call[postal_code]" value="'),a.b(a.v(a.d("caller.address.postal_code",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.s(a.f("support_allowed",e,t,1),e,t,0,3474,3694,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("caller_custom_fields",e,t,1),e,t,0,3508,3660,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("            "),a.b(a.t(a.f("field_partial",e,t,0))),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,1,0,0,"")||a.s(a.d("caller_custom_fields.0",e,t,1),e,t,0,3770,4062,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px">'),a.b("\n"+n),a.b("          <label>Custom fields</label>"),a.b("\n"+n),a.b('          <div class="form-control textselect" style="width:100%"><i class="font-lock"></i> '),a.b(a.v(a.d("Call.extra.support_access_required",e,t,0))),a.b("</div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.s(a.f("extended_lookup",e,t,1),e,t,0,4158,7575,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="well">'),a.b("\n"+n),a.b('      <div class="row">'),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.phone_type.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.phone_type",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.carrier.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.carrier",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          Social Media"),a.b("\n"+n),a.b("          <p>"),a.b("\n"+n),a.s(a.d("extended_lookup.facebook",e,t,1),e,t,0,4685,4874,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <a target="_blank" href="'),a.b(a.v(a.d("extended_lookup.facebook",e,t,0))),a.b("\" class='social-icon font-facebook' title=\""),a.b(a.v(a.d("Call.properties.extended_lookup.properties.facebook.label",e,t,0))),a.b('"></a>'),a.b("\n"+n)}),e.pop()),a.s(a.d("extended_lookup.linkedin",e,t,1),e,t,0,4945,5134,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <a target="_blank" href="'),a.b(a.v(a.d("extended_lookup.linkedin",e,t,0))),a.b("\" class='social-icon font-linkedin' title=\""),a.b(a.v(a.d("Call.properties.extended_lookup.properties.linkedin.label",e,t,0))),a.b('"></a>'),a.b("\n"+n)}),e.pop()),a.s(a.d("extended_lookup.twitter",e,t,1),e,t,0,5204,5390,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('            <a target="_blank" href="'),a.b(a.v(a.d("extended_lookup.twitter",e,t,0))),a.b("\" class='social-icon font-twitter' title=\""),a.b(a.v(a.d("Call.properties.extended_lookup.properties.twitter.label",e,t,0))),a.b('"></a>'),a.b("\n"+n)}),e.pop()),a.b("          </p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.language.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.language",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.education.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.education",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.age.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d("extended_lookup.age",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.home_owner_status.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.home_owner_status",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.household_income.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.household_income",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.marital_status.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.marital_status",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.length_of_residence.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.length_of_residence",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.market_value.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.market_value",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.occupation.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.occupation",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-sm-2">'),a.b("\n"+n),a.b("          "),a.b(a.t(a.d("Call.properties.extended_lookup.properties.presence_of_children.label",e,t,0))),a.b("\n"+n),a.b("          <p><strong>"),a.b(a.v(a.d(":extended_lookup.presence_of_children",e,t,0))),a.b("</strong></p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("      <sup class='pull-right'>"),a.b(a.t(a.d("Call.properties.extended_lookup.label",e,t,0))),a.b(" <i class='font-asterisk' title=\""),a.b(a.v(a.d("Call.properties.extended_lookup.accuracy",e,t,0))),
a.b('"></i></sup>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("hide_tags",e,t,1),e,t,1,0,0,"")||(a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="row">'),a.b("\n"+n),a.b('        <div class="col-xs-12">'),a.b("\n"+n),a.b("          <label>"),a.s(a.d("scoring_settings.tags_name",e,t,1),e,t,0,7742,7772,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("scoring_settings.tags_name",e,t,0)))}),e.pop()),a.s(a.d("scoring_settings.tags_name",e,t,1),e,t,1,0,0,"")||a.b(a.t(a.d("Call.properties.tag_list.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input type="text" name="call[tag_list]" class="tag-list" value="'),a.b(a.v(a.f("tags",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)),a.b(" "),a.b("\n"+n),a.b("    <footer>"),a.b("\n"+n),a.b('      <a class="button callout save-profile"><div class="indicator-loop"><i class="save"></i></div><span>'),a.b(a.v(a.d("Call.actions.save_changes.label",e,t,0))),a.b("</span></a>"),a.b("\n"+n),a.b('      <a class="button save-profile-close outlined"><div class="indicator-loop"><i class="save"></i></div><span>'),a.b(a.v(a.d("Call.actions.save_and_close.label",e,t,0))),a.b("</span></a>"),a.b("\n"+n),a.b("    </footer>"),a.b("\n"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.s(a.f("show_notes",e,t,1),e,t,0,8453,9221,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("scoring_settings.notes",e,t,0))),a.b(" <small>"),a.b(a.t(a.d("Call.properties.notes.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.s(a.d("scoring_settings.notes_on",e,t,1),e,t,0,8618,8653,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<calls/_edit_comment0",e,t,"    "))}),e.pop()),a.b('    <div class="notes-section">'),a.b("\n"+n),a.s(a.d("caller.notes",e,t,1),e,t,0,8739,8775,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<calls/_comment1",e,t,"        "))}),e.pop()),a.b("    </div>"),a.b("\n"+n),a.b('    <a style="margin-left:25px" class="button outlined load-more-notes" data-offset="'),a.b(a.v(a.d("caller.notes_next_offset",e,t,0))),a.b('">load more notes</a>'),a.b("\n"),a.b("\n"+n),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <img class="loader" src=\'/images/spinner.gif\' style="visibility:hidden"/>'),a.b("\n"+n),a.b('      <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('      <div class="clear"></div>'),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n)}),e.pop()),a.b("</form>"),a.b("\n"),a.fl()},"partials":{"<calls/_edit_comment0":{"name":"calls/_edit_comment","partials":{},"subs":{}},"<calls/_comment1":{"name":"calls/_comment","partials":{},"subs":{}}},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_sale"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<form id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-sale" action="/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/sale" method="post" novalidate="novalidate">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.f("saleColumnName",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.caller_sale.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.b("    "),a.b(a.t(a.f("auth_form_tag_token",e,t,0))),a.b("\n"+n),a.b('    <div style="display:none"><input type="hidden" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="call_id" name="id"/></div>'),a.b("\n"),a.b("\n"+n),a.s(a.d("scoring_settings.agent_tag_on",e,t,1),e,t,0,478,1120,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="field">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("scoring_settings.agent_tag",e,t,0))),a.b("</label>"),a.b("\n"+n),a.s(a.d("scoring_settings.use_tag_list",e,t,1),e,t,0,597,861,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <select id="who-'),a.b(a.v(a.f("id",e,t,0))),a.b('-sold" name="name" style="height:28px;min-width:200px">'),a.b("\n"+n),a.b("        <option></option>"),a.b("\n"+n),a.s(a.d("scoring_settings.agent_tag_list",e,t,1),e,t,0,754,800,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <option>"),a.b(a.v(a.d(".",e,t,0))),a.b("</option>"),a.b("\n"+n)}),e.pop()),a.b("      </select>"),a.b("\n"+n)}),e.pop()),a.s(a.d("scoring_settings.use_tag_list",e,t,1),e,t,1,0,0,"")||(a.b('          <input style="min-width:200px" type="text" class=\'text\' id="who-'),a.b(a.v(a.f("id",e,t,0))),a.b('-sold" name="name" value="'),a.b(a.v(a.d("sale.name",e,t,0))),a.b('"/>'),a.b("\n"+n)),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.d("scoring_settings.scoring_on",e,t,1),e,t,0,1191,1687,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="field">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("scoring_settings.scoring_name",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="star" data-rating="'),a.b(a.v(a.d("sale.score",e,t,0))),a.b('"></div>'),a.b("\n"+n),a.b('      <div style="visibility:hidden;height:1px;">'),a.b("\n"+n),a.b('        <select id="service_rep_call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-score" name="score">'),a.b("\n"+n),a.b('          <option value="1">1</option>'),a.b("\n"+n),a.b('          <option value="2">2</option>'),a.b("\n"+n),a.b('          <option value="3">3</option>'),a.b("\n"+n),a.b('          <option value="4">4</option>'),a.b("\n"+n),a.b('          <option value="5">5</option>'),a.b("\n"+n),a.b("        </select>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.d("scoring_settings.converted_on",e,t,1),e,t,0,1758,2255,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="field converted">'),a.b("\n"+n),a.b("      <label>"),a.b(a.v(a.d("scoring_settings.converted_name",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('      <div class="boot-switch" data-on-label="Yes" data-off-label="No" data-on-color="success">'),a.b("\n"+n),a.b('        <input type="hidden" name="conversion" '),a.s(a.d("sale.conversion",e,t,1),e,t,0,2013,2022,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('value="1"')}),e.pop()),a.b("  "),a.s(a.d("sale.conversion",e,t,1),e,t,1,0,0,"")||a.b('value="0"'),a.b("/>"),a.b("\n"+n),a.b('        <input id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-sale_converted" type="checkbox" '),a.s(a.d("sale.conversion",e,t,1),e,t,0,2179,2186,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("checked")}),e.pop()),a.b(' name="conversion"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b('    <div class="field" id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-sale_value" style="display:none">'),a.b("\n"+n),a.b('      <div style="width:160px;max-width:50%;float:left">'),a.b("\n"+n),a.s(a.d("scoring_settings.converted_amount_on",e,t,1),e,t,0,2469,2948,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <label>"),a.b(a.v(a.d("scoring_settings.converted_amount",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        $ <input type="number" step="0.01" class="text" name="value" value="'),a.s(a.d("sale.value",e,t,1),e,t,0,2622,2636,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("sale.value",e,t,0)))}),e.pop()),a.b('" style="width:calc(100% - 18px)"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div style="width:150px;max-width:50%;float:left">'),a.b("\n"+n),a.b("        <label>date</label>"),a.b("\n"+n),a.b('        <input type="text" class="text date-picker" name="sale_date" value="'),a.s(a.d("sale.sale_date",e,t,1),e,t,0,2880,2898,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("sale.sale_date",e,t,0)))}),e.pop()),a.b('" style="width:100%"/>'),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="clear"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.s(a.f("support_allowed",e,t,1),e,t,0,3166,3393,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("sale_custom_fields",e,t,1),e,t,0,3198,3361,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px;width:100%">'),a.b("\n"+n),a.b("            "),a.b(a.t(a.f("field_partial",e,t,0))),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("support_allowed",e,t,1),e,t,1,0,0,"")||a.s(a.d("sale_custom_fields.0",e,t,1),e,t,0,3467,3770,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px;padding:0 10px;width:100%">'),a.b("\n"+n),a.b("          <label>Custom fields</label>"),a.b("\n"+n),a.b('          <div class="form-control textselect" style="width:100%"><i class="font-lock"></i> '),a.b(a.v(a.d("Call.extra.support_access_required",e,t,0))),a.b("</div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"),a.b("\n"+n),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <input type="button" class="button callout" value="'),a.b(a.v(a.d("Call.actions.save_changes.label",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b('      <a class="button activebutton delete-sale pull-right outlined" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.actions.delete-sale.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_session"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.t(a.d("Call.panels.caller_session.label",e,t,0))),a.b(" <small>"),a.b(a.t(a.d("Call.panels.caller_session.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.d("call.id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.s(a.f("session",e,t,1),e,t,0,221,4469,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="row">'),a.b("\n"+n),a.b('    <div class="col-md-6">'),a.b("\n"+n),a.b("      <p>"),a.b("\n"+n),a.b("        <small>"),a.b(a.v(a.d("Call.properties.likelihood.label",e,t,0))),a.b(" "),a.b(a.v(a.d("session.score",e,t,0))),a.b("% <i class='font-info' title=\""),a.b(a.v(a.d("Call.properties.likelihood.title",e,t,0))),a.b('"></i></small>'),a.b("\n"+n),a.s(a.f("hasGAaccess",e,t,1),e,t,0,453,623,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        "),a.s(a.d("session.google_explorer",e,t,1),e,t,0,490,586,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<a target="_blank" href="'),n.b(n.v(n.d("session.google_explorer",e,t,0))),n.b('">'),n.b(n.v(n.d("Call.actions.google_explorer.label",e,t,0))),n.b("</a>")}),e.pop()),a.b("\n"+n)}),e.pop()),a.b('        <a class="pull-right" data-id="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('" data-action="caller_analytics" href="#callNav=caller_analytics&callId='),a.b(a.v(a.d("call.id",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.actions.caller_analytics.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n),a.b("      "),a.s(a.d("session.referral_url",e,t,1),e,t,0,861,1029,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<strong>"),n.b(n.v(n.d("Call.properties.paid.properties.source.label",e,t,0))),n.b("</strong><input class='text' style='width:100%;border:0' type=\"text\" readonly value=\""),n.b(n.v(n.d("session.referral_url",e,t,0))),n.b('"/>')}),e.pop()),a.b("\n"+n),a.s(a.d("session.paths",e,t,1),e,t,0,1079,1125,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<calls/_session_path_entry0",e,t,"        "))}),e.pop()),a.s(a.f("show_more",e,t,1),e,t,0,1164,1452,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <a class=\"show-more-toggle\" style='cursor:pointer'>"),a.b(a.v(a.d("Call.panels.caller_session.show_more",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("        <div class=\"show-more\" style='display:none'>"),a.b("\n"+n),a.s(a.d("session.morePaths",e,t,1),e,t,0,1354,1408,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<calls/_session_path_entry1",e,t,"            "))}),e.pop()),a.b("        </div>"),a.b("\n"+n)}),e.pop()),a.b("      <!--<strong>Most Recent URL</strong><input class='text' style='width:100%;border:0' type=\"text\" readonly value=\""),a.b(a.v(a.d("session.last_url",e,t,0))),a.b('"/>-->'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-6">'),a.b("\n"+n),a.b("      <h3>"),a.b(a.v(a.d("Call.panels.caller_session.advertising_data",e,t,0))),a.b(' <span class="pull-right">'),a.b(a.v(a.d("session.webproperty",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.s(a.d("session.paid",e,t,1),e,t,0,1793,2585,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="table-responsive">'),a.b("\n"+n),a.b('        <table class="table">'),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.campaign.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.campaign",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.ad_group.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.ad_group",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.keyword.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.keyword",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.source.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.source",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.medium.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.medium",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><th>"),a.b(a.v(a.d("Call.properties.paid.properties.ad_content.label",e,t,0))),a.b("</th><td>"),a.b(a.v(a.d("session.paid.ad_content",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          </tr>"),a.b("\n"+n),a.b("        </table>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b("      <p>"),a.b("\n"+n),a.b('        <a class="cookies">'),a.b(a.v(a.d("Call.panels.caller_session.cookies",e,t,0))),a.b(" "),a.b(a.v(a.f("total_cookies",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n),a.b('      <div class="listed-cookies" style="display:none">'),a.b("\n"+n),a.b("        <ul>"),a.b("\n"+n),a.s(a.d("session.cookies",e,t,1),e,t,0,2809,2925,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <li><strong>"),a.b(a.v(a.f("name",e,t,0))),a.b('</strong>: <input type="text" class="text" readonly value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"/></li>'),a.b("\n"+n)}),e.pop()),a.b("        </ul>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <small class="pull-right">'),a.b(a.v(a.d("session.ip",e,t,0))),a.b("</small>"),a.b("\n"+n),a.b("      <strong>"),a.b(a.v(a.d("session.browser",e,t,0))),a.b(" "),a.s(a.d("session.mobile",e,t,1),e,t,0,3081,3133,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("Call.properties.webvisit.properties.mobile.label",e,t,0)))}),e.pop()),a.b("</strong>"),a.b("\n"+n),a.b('      <small style="word-wrap: break-word;white-space: nowrap;overflow: hidden;display: inline-block;width: 100%;">'),a.b(a.v(a.d("session.ua",e,t,0))),a.b("</small>"),a.b("\n"+n),a.s(a.f("unbounce",e,t,1),e,t,0,3319,3797,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <h3>"),a.b(a.v(a.d("Call.properties.unbounce.label",e,t,0))),a.b("</h3>"),a.b("\n"+n),a.b('      <div class="table-responsive">'),a.b("\n"+n),a.b('        <table class="table">'),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.unbounce.properties.variant.name",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("unbounce.variant",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.unbounce.properties.page.name",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("unbounce.page",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.unbounce.properties.session.name",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("unbounce.session",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        </table>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("vwo",e,t,1),e,t,0,3825,4368,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <h3>"),a.b(a.v(a.d("Call.properties.vwo.label",e,t,0))),a.b("</h3>"),a.b("\n"+n),a.b('      <div class="table-responsive">'),a.b("\n"+n),a.b('        <table class="table">'),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.vwo.properties.account.label",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("vwo.aid",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.vwo.properties.name.label",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("vwo.exp_name",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.vwo.properties.var_name.label",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("vwo.var_name",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("          <tr><td>"),a.b(a.v(a.d("Call.properties.vwo.properties.uuid.label",e,t,0))),a.b("</td><td>"),a.b(a.v(a.d("vwo.uuid",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        </table>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b('      <div class="map-session" style="width:100%;height:300px;"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n)}),e.pop()),a.s(a.f("session",e,t,1),e,t,1,0,0,"")||(a.b("<strong>"),a.b(a.v(a.d("Call.panels.caller_session.no_data",e,t,0))),a.b("</strong>"),a.b("\n"+n)),a.b("  <footer>"),a.b("\n"+n),a.b('    <a class="button pull-right close-button outlined">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('    <a class="button check-google-analytics" data-id="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.actions.check-google-analytics.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.check-google-analytics.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{"<calls/_session_path_entry0":{"name":"calls/_session_path_entry","partials":{},"subs":{}},"<calls/_session_path_entry1":{"name":"calls/_session_path_entry","partials":{},"subs":{}}},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/caller_transcription"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.caller_transcription.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.caller_transcription.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card player_ui">'),a.b("\n"+n),a.b('  <div class="row">'),a.b("\n"+n),a.s(a.f("mp3_audio",e,t,1),e,t,0,258,694,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="full-player">'),a.b("\n"+n),a.b('      <div class="inner-player-section">'),a.b("\n"+n),a.b('        <audio id="audio-call-'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="audio-player">'),a.b("\n"+n),a.b('          <source type="audio/mpeg" src="'),a.b(a.v(a.f("mp3_audio",e,t,0))),a.b('" />'),a.b("\n"+n),a.b('          <source type="audio/wav" src="'),a.b(a.v(a.f("audio",e,t,0))),a.b('" />'),a.b("\n"+n),a.b("        </audio>"),a.b("\n"+n),a.b("        <div class='box live-transcript' data-id=\""),a.b(a.v(a.f("id",e,t,0))),a.b("\" style='display:none'></div>"),a.b("\n"+n),a.b('        <div class="wave-surfer" id="call-wave-'),a.b(a.v(a.f("id",e,t,0))),a.b('"></div>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.d("spotted.0",e,t,1),e,t,0,725,965,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="keywords">'),a.b("\n"+n),a.b('    <i class="font-radio-checked" title="Keyword Spots"></i>'),a.b("\n"+n),a.s(a.f("spotted",e,t,1),e,t,0,828,913,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <span class="jump tap-token" data-position="'),a.b(a.v(a.f("start",e,t,0))),a.b('">'),a.b(a.v(a.f("keyword",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="clear"></div>'),a.b("\n"+n)}),e.pop()),a.b('  <div class="talk_time">'),a.b("\n"+n),a.s(a.f("rightSpeaker",e,t,1),e,t,0,1027,1274,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <div>"),a.b("\n"+n),a.b('      <div class="right_talk_time"><span>'),a.b(a.v(a.f("rightSpeaker",e,t,0))),a.b(":</span> <span>"),a.b(a.v(a.f("right_talk_time_string",e,t,0))),a.b("</span></div>"),a.b("\n"+n),a.b('      <div class="left_talk_time"><span>'),a.b(a.v(a.f("leftSpeaker",e,t,0))),a.b(":</span> <span>"),a.b(a.v(a.f("left_talk_time_string",e,t,0))),a.b("</span></div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n),a.s(a.f("mp3_audio",e,t,1),e,t,0,1315,2039,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("<footer>"),a.b("\n"+n),a.s(a.f("can_download_links",e,t,1),e,t,0,1348,1977,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="control dropdown" style="display:inline-block">'),a.b("\n"+n),a.b('    <a class="dropdown-toggle download-link" data-toggle="dropdown"><i class="font-download"></i> <span class=\'text\'>Download</span> <i class="font-caret-down"></i></a>'),a.b("\n"+n),a.b('    <ul class="dropdown-menu">'),a.b("\n"+n),a.b('      <li><a href="'),a.b(a.v(a.f("audio",e,t,0))),a.b('">WAV</a></li>'),a.b("\n"+n),a.b('      <li><a href="'),a.b(a.v(a.f("mp3_audio",e,t,0))),a.b('">MP3</a></li>'),a.b("\n"+n),a.b("    </ul>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.s(a.f("can_share_audio",e,t,1),e,t,0,1742,1802,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <a class='font-share share-audio-for-call'>Share</a>"),a.b("\n"+n)}),e.pop()),a.s(a.f("can_delete_audio",e,t,1),e,t,0,1846,1955,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <a class=\"pull-right delete-audio\"><i class='font-trash'></i> <span class='text'>Delete...</span></a>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b('  <div class="clear"></div>'),a.b("\n"+n),a.b("</footer>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.s(a.f("mp3_audio",e,t,1),e,t,0,2091,5323,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<form id="remove_audio_request" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"'),a.b("\n"+n),a.b('        method="post"'),a.b("\n"+n),a.b('        style="display:none;margin-top:35px"'),a.b("\n"+n),a.b('        action="/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/delete_audio" autocomplete="off">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h3>Remove Call Audio</h3>"),a.b("\n"+n),a.b('    <div class="card">'),a.b("\n"+n),a.b('      <p><strong><i class="font-warning"></i> You will not be able to recover the recording once it has been deleted.</strong></p>'),a.b("\n"+n),a.b('      <input type="hidden" name="_method" value="DELETE"/>'),a.b("\n"+n),a.s(a.f("transcription_text",e,t,1),e,t,0,2598,2925,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="checkbox">'),a.b("\n"+n),a.b('        <input class="checkbox" type="checkbox" id="remove_audio_request_remove_transcriptions" name="remove_transcriptions"><label for="remove_audio_request_remove_transcriptions" style="display:inline-block">Also remove the call transcription</label><div class="clear"></div>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b('      <div class="">'),a.b("\n"+n),a.b("        <label>Password</label>"),a.b("\n"+n),a.b('        <input id="remove_audio_request_password" disabled type="password" name="password" class="text" style="width:50%"/>'),a.b("\n"+n),a.b('        <span class="hint">enter your login password to authenticate deleting audio files</span>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="checkbox">'),a.b("\n"+n),a.b('        <input class="checkbox" type="checkbox" value="1" name="yes_terms" id="remove_audio_request_yes_terms"><label for="remove_audio_request_yes_terms" style="display:inline-block"><strong>I understand that this can not be reversed</strong></label><div class="clear"></div>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("      <footer>"),a.b("\n"+n),a.b('        <input type="submit" name="commit" class="button activebutton" disabled value="Delete Audio"/>'),a.b("\n"+n),a.b('        <button class="button cancel-delete-audio">Cancel</button>'),a.b("\n"+n),a.b("      </footer>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"+n),a.b("  <script>"),a.b("\n"+n),a.b('    $(".delete-audio").click(function(e) { e.preventDefault();'),a.b("\n"+n),a.b('      $("#remove_audio_request").toggle();'),a.b("\n"+n),a.b('      if ($("#remove_audio_request").length) {'),a.b("\n"+n),a.b('        $("#remove_audio_request_password").prop("disabled", false);'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    $("#remove_audio_request_yes_terms").on("click", function() {'),a.b("\n"+n),a.b('      $("#remove_audio_request input[name=commit]").prop("disabled", !$(this).prop("checked"));'),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    $(".cancel-delete-audio").click(function(e) { e.preventDefault();'),a.b("\n"+n),a.b('      $("#remove_audio_request").hide();'),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    $("#remove_audio_request").submit(function(e) {'),a.b("\n"+n),a.b("      e.preventDefault();"),a.b("\n"+n),a.b('      var form = $("#remove_audio_request");'),a.b("\n"+n),a.b("      clearErrors(form);"),a.b("\n"+n),a.b('      if ($("#remove_audio_request input[name=commit]").prop("disabled")) {'),a.b("\n"+n),a.b("        return;"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b('      if (!$("#remove_audio_request_password").val().length) { return; }'),a.b("\n"+n),a.b("      var data = form.serialize();"),a.b("\n"+n),a.b('      bootbox.dialog({message: "<h3>Processing your request</h3>" + ProgressBarHtml});'),a.b("\n"+n),a.b('      $.post(form.attr("action"), data, function(res) {'),a.b("\n"+n),a.b('        ctmFlash("Delete request received.  Processing your request");'),a.b("\n"+n),a.b('        $("#remove_audio_request").hide();'),a.b("\n"+n),a.b('        $("#call-edit-panel-" + form.attr("data-id")).html("<div class=\'field\'><h3>Audio Deleting</h3><div class=\'card\'><p>Audio deletion is in progress.  It may take a few minutes to complete your request.</p></div></div>");'),a.b("\n"+n),a.b("      }).fail(function(xhr) {"),a.b("\n"+n),a.b("        formResponse(form, xhr.responseJSON);"),a.b("\n"+n),a.b("      }).always(function() {"),a.b("\n"+n),a.b("        bootbox.hideAll();"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  </script>"),a.b("\n"+n)}),e.pop()),a.s(a.f("hasChannels",e,t,1),e,t,0,5354,5466,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>Transcription</h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div class="message-thread channels-thread">'),a.b("\n"+n)}),e.pop()),a.s(a.f("has_outline",e,t,1),e,t,0,5503,6763,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("hasChannels",e,t,1),e,t,0,5526,6408,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("text_outline",e,t,1),e,t,0,5552,6384,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="message '),a.b(a.v(a.f("direction",e,t,0))),a.b('_message first-message last-message">'),a.b("\n"+n),a.b('            <div class="page-header">'),a.b("\n"+n),a.b('              <span class="agent-initials button-background" title="'),a.b(a.v(a.f("speaker",e,t,0))),a.b('">'),a.s(a.f("initials",e,t,1),e,t,0,5766,5778,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b('<span class="agent-pic"'),a.s(a.f("pic_url",e,t,1),e,t,0,5877,5919,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' style="background-image:url('),n.b(n.v(n.f("pic_url",e,t,0))),n.b(')"')}),e.pop()),a.b("></span></span>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b('            <div class="bubble">'),a.b("\n"+n),a.b("              <p>"),a.b("\n"+n),a.s(a.f("words",e,t,1),e,t,0,6043,6184,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                  <a data-position="'),a.b(a.v(a.f("offset",e,t,0))),a.b('" title="Confidence '),a.b(a.v(a.f("score",e,t,0))),a.b('%" class="jump word_'),a.b(a.v(a.f("confidence",e,t,0))),a.b('">'),a.b(a.v(a.f("text",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b("              </p>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b('            <span class="timestamp"><a class="jump" data-position="'),a.b(a.v(a.f("offset",e,t,0))),a.b('">'),a.b(a.v(a.f("start_fmt",e,t,0))),a.b(" - "),a.b(a.v(a.f("end_fmt",e,t,0))),a.b("</small></a></span>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("hasChannels",e,t,1),e,t,1,0,0,"")||a.s(a.f("text_outline",e,t,1),e,t,0,6473,6718,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="panel">'),a.b("\n"+n),a.b('            <h4><a class="jump" data-position="'),a.b(a.v(a.f("offset",e,t,0))),a.b('">'),a.b(a.v(a.f("speaker",e,t,0))),a.b(":"),a.b(a.v(a.f("gender",e,t,0))),a.b(" <small>@ "),a.b(a.v(a.f("start_fmt",e,t,0))),a.b(" - "),a.b(a.v(a.f("end_fmt",e,t,0))),a.b("</small></a></h4>"),a.b("\n"+n),a.b('            <p style="text-indent:10px">'),a.b(a.v(a.f("text",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("has_outline",e,t,1),e,t,1,0,0,"")||(a.b('    <div class="field"><h3>Transcription</h3><div class="clear"></div>'),a.b("\n"+n),a.b('    <div class="card"><p>'),a.b("\n"+n),a.s(a.f("transcription_text",e,t,1),e,t,0,6925,6957,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    "),a.b(a.v(a.f("transcription_text",e,t,0))),a.b("\n"+n)}),e.pop()),a.s(a.f("transcription_text",e,t,1),e,t,1,0,0,"")||(a.b("    <b>No transcription available</b>"),a.b("\n"+n)),a.b("    </p></div></div>"),a.b("\n"+n)),a.s(a.f("hasChannels",e,t,1),e,t,0,7133,7155,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/chat"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.chat.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.chat.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="clear"></div>'),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('<div class="messages">'),a.b("\n"+n),a.b('<form class="new-message" id="message" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('  <!--<div class="message-load-more" style="width:100%;text-align:center;margin-top:30px"><a><i class="font-refresh"></i> load more</a></div> -->'),a.b("\n"),a.b("\n"+n),a.b('  <div class="message-thread">'),a.b("\n"+n),a.s(a.f("thread",e,t,1),e,t,0,419,449,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<chat_message0",e,t,"      "))}),e.pop()),a.s(a.f("thread",e,t,1),e,t,1,0,0,"")||(a.b('    <div class="progress">'),a.b("\n"+n),a.b('      <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('        <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <!--<h3><span class="hidden-xs">'),a.b(a.v(a.d("user.first_name",e,t,0))),a.b(" "),a.b(a.v(a.d("user.last_name",e,t,0))),a.b(" </span></h3> -->"),a.b("\n"+n),a.b('  <div class="new-msg-input" style="padding-bottom:9px !important">'),a.b("\n"+n),a.b("    <!--"),a.b("\n"+n),a.b('  \t<div class="textfield">'),a.b("\n"+n),a.b('\t\t\t<label for="message_body" style="display:none">&nbsp;</label>'),a.b("\n"+n),a.b('      <div class="message-compose">'),a.b("\n"+n),a.b('\t\t\t<textarea class="text string message_body" id="message_body" name="message[body]" placeholder="'),a.b(a.v(a.d("Call.panels.chat.extra.type_message_here",e,t,0))),a.b('"></textarea>'),a.b("\n"+n),a.b('      <input type="text" class="responses-picker" style="display:none"/>'),a.b("\n"+n),
a.b('      <a class="save-new-button send-chat-button button minimal disabled" title="'),a.b(a.v(a.d("Call.actions.send_message.label",e,t,0))),a.b('"><i class="font-reply"></i></a>'),a.b("\n"+n),a.b('      <a class="file-attachment-toggle" title="'),a.b(a.v(a.d("Call.actions.add_attachment.label",e,t,0))),a.b('"><i class="font-caret-right"></i><i class="font-attachment"></i></a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="file-attachment-container" style="display:none;margin-top:15px">'),a.b("\n"+n),a.b('      <input accept="image/jpeg,image/png,image/gif" class="message_upload" id="message_upload" name="message[upload]" type="file">'),a.b("\n"+n),a.b('      <span class="hint"><br>'),a.b(a.v(a.d("Call.panels.chat.extra.accepted_formats",e,t,0))),a.b("<br>"),a.b(a.v(a.d("Call.panels.chat.extra.max_file_size",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <span class="pull-right" style="display:none"><a title="'),a.b(a.v(a.d("Call.actions.phone.transfer.desc",e,t,0))),a.b('" class="transfer-chat-button" style="margin-top:19px;display:inline-block">'),a.b("\n"+n),a.b('      <i class="'),a.b(a.v(a.d("Call.actions.phone.transfer.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.phone.transfer.label",e,t,0))),a.b("\n"+n),a.b("    </a> |"),a.b("\n"+n),a.b('    <a title="'),a.b(a.v(a.d("Call.actions.phone.party.desc",e,t,0))),a.b('" class="chat-party-button" style="margin-top:19px;display:inline-block">'),a.b("\n"+n),a.b('      <i class="'),a.b(a.v(a.d("Call.actions.phone.party.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.phone.party.label",e,t,0))),a.b(' <span class="chat-total"></span>'),a.b("\n"+n),a.b("    </a></span>"),a.b("\n"+n),a.b('    <a class="danger-color end-chat-button" style="margin-top:19px;display:inline-block;margin-right:5px">'),a.b("\n"+n),a.b('      <i class="font-cancel-circle"></i> '),a.b(a.v(a.d("Call.actions.end_chat.label",e,t,0))),a.b("..."),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n),a.b('    <a class="responses-button" style="margin-top:19px;display:inline-block">'),a.b("\n"+n),a.b('      <i class="font-bubble-2"></i> '),a.b(a.v(a.d("Call.actions.responses.label",e,t,0))),a.b("..."),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n),a.b('    <a class="leave-chat-button pull-right" style="margin-top:19px;display:inline-block;margin-right:5px">'),a.b("\n"+n),a.b('      <i class="font-signout" title="'),a.b(a.v(a.d("Call.actions.leave_chat.desc",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.leave_chat.label",e,t,0))),a.b("\n"+n),a.b("    </a>"),a.b("\n"+n),a.b('    <a class="chat-audio-toggle pull-right" style="margin-top:19px;display:inline-block;margin-right:5px"><i title="'),a.b(a.v(a.d("Call.actions.chat_audio.desc",e,t,0))),a.b('" class="font-volume-high"></i></a>'),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("    -->"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <div class="chat-session-ended" style="text-align:center;display:none;margin-top:20px">'),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.d("Call.panels.chat.extra.chat_session_ended",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.b("\n"+n),a.b("<div>"),a.b("\n"+n),a.b("  <p style='text-align:center;margin:10px 0'>Email Transcription</p>"),a.b("\n"+n),a.b("  <p style='text-align:center;margin:10px 0' class='send-transcript'>"),a.b("\n"+n),a.b("    <input type='text' class='text transcription-email' name='email'/ placeholder='name@email.com'>"),a.b("\n"+n),a.b('    <button class="email-transcript button outlined" style="margin-left: 10px">'),a.b("\n"+n),a.b('      <i class="font-spinner-2 icon-loop-repeat" style="display:none;"></i>'),a.b("\n"+n),a.b("      Send"),a.b("\n"+n),a.b("    </button>"),a.b("\n"+n),a.b("  </p>"),a.b("\n"+n),a.b("  <p style='text-align:center;margin:10px 0' class=\"confirmation\"></p>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("  $('.email-transcript').on('click', function() {"),a.b("\n"+n),a.b("    to_address = $('.transcription-email').val();"),a.b("\n"+n),a.b('    if (to_address == "") {'),a.b("\n"+n),a.b("      $('.confirmation').html(\"Please enter an email address to send transcription to.\");"),a.b("\n"+n),a.b('      $(\'.confirmation\').css("color", "red");'),a.b("\n"+n),a.b("      return;"),a.b("\n"+n),a.b("    }"),a.b("\n"),a.b("\n"+n),a.b('    data = {"email":to_address};'),a.b("\n"+n),a.b("    $('.email-transcript i').show();"),a.b("\n"+n),a.b("    $.post('/api/v1/chat/"),a.b(a.v(a.f("id",e,t,0))),a.b("/send_transcription', data, function(res) {"),a.b("\n"+n),a.b("      $('.email-transcript i').hide();"),a.b("\n"+n),a.b("      $('.transcription-email').val('');"),a.b("\n"+n),a.b('      $(\'.confirmation\').css("color", "black");'),a.b("\n"+n),a.b("      $('.confirmation').html(\"Chat Transcription Email Queued\");"),a.b("\n"+n),a.b("    })"),a.b("\n"+n),a.b("  });"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{"<chat_message0":{"name":"chat_message","partials":{},"subs":{}}},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/custom"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<form id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-custom" action="/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/custom" method="post" novalidate="novalidate">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("panel.name",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("panel.description",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.s(a.f("panel_frame_url",e,t,1),e,t,0,322,459,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <iframe class="panel_frame_url" style="border:none;width:100%;height:100%;min-height:800px" src="'),a.b(a.v(a.f("panel_frame_url",e,t,0))),a.b('"></iframe>'),a.b("\n"+n)}),e.pop()),a.s(a.f("panel_frame_url",e,t,1),e,t,1,0,0,"")||(a.b("    "),a.b(a.t(a.f("auth_form_tag_token",e,t,0))),a.b("\n"+n),a.b('    <div style="display:none"><input type="hidden" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="call_id" name="id"/></div>'),a.b("\n"),a.b("\n"+n),a.b('    <div class="row"><div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.s(a.d("panel.custom_fields",e,t,1),e,t,0,748,859,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="padding:0 10px">'),a.b("\n"+n),a.b("      "),a.b(a.t(a.f("field_partial",e,t,0))),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("    </div></div>"),a.b("\n"),a.b("\n"+n),a.b('    <footer class="form-actions" style="margin-top:0">'),a.b("\n"+n),a.b('      <input type="button" class="button callout" value="'),a.b(a.v(a.d("Call.actions.save_changes.label",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n)),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/custom_action"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<form id="call-'),a.b(a.v(a.f("id",e,t,0))),a.b('-custom" action="/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/custom" method="post" novalidate="novalidate">'),a.b("\n"+n),a.b('  <div class="field">'),a.b("\n"+n),a.b("    <h3>"),a.b(a.v(a.d("panel.name",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("panel.description",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"+n),a.b("    "),a.s(a.d("panel.custom_fields.0",e,t,1),e,t,1,0,0,"")||(a.b("<p>"),a.b(a.v(a.d("Call.panels.custom_action.message",e,t,0))),a.b("</p>")),a.b("\n"+n),a.b("    "),a.b(a.t(a.f("auth_form_tag_token",e,t,0))),a.b("\n"+n),a.b('    <div style="display:none"><input type="hidden" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="call_id" name="id"/></div>'),a.b("\n"),a.b("\n"+n),a.b('    <div class="row"><div class="row" style="margin-left:-10px;margin-right:-10px">'),a.b("\n"+n),a.s(a.d("panel.custom_fields",e,t,1),e,t,0,644,755,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="col-xs-12 col-md-6 col-lg-3" style="padding:0 10px">'),a.b("\n"+n),a.b("      "),a.b(a.t(a.f("field_partial",e,t,0))),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.b("    </div></div>"),a.b("\n"),a.b("\n"+n),a.b('    <footer class="form-actions"'),a.s(a.d("panel.custom_fields.0",e,t,1),e,t,1,0,0,"")||a.b(' style="margin-top:0"'),a.b(">"),a.b("\n"+n),a.b('      <input type="button" class="button callout" value="'),a.b(a.v(a.d("Call.panels.custom_action.confirm",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/dash"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="dash">'),a.b("\n"+n),a.b('  <div class="row">'),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b("      X Available (hover over get agent names)"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b("      X Active (hover over get agent names this is here but I have to refresh for accurate count can this be realtime)"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b("      X In Queue (Basically ringing by not answered)"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b("      X Abandoned (for the day)"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b("      X Idle (Avg Idle time for available sitting there for the day)"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/desk_com_add_case"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>Add a new Desk.com Case</h3>"),a.b("\n"+n),a.b('<form id="desk-customer-form">'),a.b("\n"+n),a.s(a.f("customer_id",e,t,1),e,t,0,82,153,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <input type="hidden" name="customer_id" value="'),a.b(a.v(a.f("customer_id",e,t,0))),a.b('"/>'),a.b("\n"+n)}),e.pop()),a.b('  <div class="case_creation desk-open-new-case">'),a.b("\n"+n),a.b("    <small>New Case</small>"),a.b("\n"+n),a.b('    <div class="panel">'),a.b("\n"+n),a.b('      <input type="hidden" name="case[message[direction]]" value="out"/>'),a.b("\n"+n),a.b('      <input type="hidden" name="case[message[status]]" value="pending"/>'),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Type</label>"),a.b("\n"+n),a.b('        <select name="case[type]">'),a.b("\n"+n),a.b('          <option value="email">Email</option>'),a.b("\n"+n),a.b('          <option value="phone">Phone</option>'),a.b("\n"+n),a.b("        </select>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Subject</label>"),a.b("\n"+n),a.b('        <input style="width:100%" type="text" name="case[subject]" class="text" placeholder="Enter subject here"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>To</label>"),a.b("\n"+n),a.b('        <input style="width:100%" type="text" name="case[message[to]]" class="text" value="'),a.b(a.v(a.f("email",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Body</label>"),a.b("\n"+n),a.b('        <textarea style="width:100%;min-height:160px" name="case[message[body]]" class="text"></textarea>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Labels</label>"),a.b("\n"+n),a.b('        <input class="rct labels-multipick" name="case[labels]" type="text" style="width:100%;"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Groups</label>"),a.b("\n"+n),a.b('        <input class="rct groups-multipick" name="case[group]" type="text" style="width:100%;"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Notes</label>"),a.b("\n"+n),a.b('        <textarea style="width:100%;min-height:160px" name="case[note[body]]" class="text"></textarea>'),a.b("\n"+n),a.b('        <input type="hidden" name="case[note[user]]" value="'),a.b(a.v(a.d("desk_call_details.user",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.s(a.f("desk_case_custom_fields",e,t,1),e,t,0,1776,1979,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <label>"),a.b(a.v(a.f("label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input type="text" data-custom-field="true" data-type="'),a.b(a.v(a.d("data.type",e,t,0))),a.b('" style="width:80%" name="case[custom_fields['),a.b(a.v(a.f("name",e,t,0))),a.b(']]" class="text" value=""/>'),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/desk_com_add_customer"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>Add a new Desk.com Customer and open a Case</h3>"),a.b("\n"+n),a.b('<form id="desk-customer-form">'),a.b("\n"+n),a.b('  <div class="customer_selection desk-customer-details">'),a.b("\n"+n),a.b("    <small>New Customer</small>"),a.b("\n"+n),a.b('    <div class="panel">'),a.b("\n"+n),a.s(a.f("customer_id",e,t,1),e,t,0,219,298,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <input type="hidden" name="customer_id" value="'),a.b(a.v(a.f("customer_id",e,t,0))),a.b('"/>'),a.b("\n"+n)}),e.pop()),a.b('      <div class="field col-md-6">'),a.b("\n"+n),a.b("        <label>First Name</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:80%" name="customer[first_name]" class="text" value="'),a.b(a.v(a.f("first_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Last Name</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:80%" name="customer[last_name]" class="text" value="'),a.b(a.v(a.f("last_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field col-md-6">'),a.b("\n"+n),a.b("        <label>Email</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:80%" name="customer[email]" class="text" value="'),a.b(a.v(a.f("email",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Phone Number</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:80%" name="customer[phone]" class="text" value="'),a.b(a.v(a.f("caller_number",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field col-md-12">'),a.b("\n"+n),a.b("        <label>Company</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:80%" name="customer[company]" class="text" value="'),a.b(a.v(a.f("company",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Customer Background/Notes</label>"),a.b("\n"+n),a.b('        <textarea name="customer[background]" style="width:100%" class="text">'),a.b(a.v(a.f("background",e,t,0))),a.b("</textarea>"),a.b("\n"+n),a.s(a.f("desk_customer_custom_fields",e,t,1),e,t,0,1338,1545,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <label>"),a.b(a.v(a.f("label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input type="text" data-custom-field="true" data-type="'),a.b(a.v(a.d("data.type",e,t,0))),a.b('" style="width:80%" name="customer[custom_fields['),a.b(a.v(a.f("name",e,t,0))),a.b(']]" class="text" value=""/>'),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="case_creation desk-open-new-case">'),a.b("\n"+n),a.b("    <small>New Case</small>"),a.b("\n"+n),a.b('    <div class="panel">'),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Type</label>"),a.b("\n"+n),a.b('        <select name="case[type]">'),a.b("\n"+n),a.b('          <option value="email">Email</option>'),a.b("\n"+n),a.b('          <option value="phone">Phone</option>'),a.b("\n"+n),a.b("        </select>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>Subject</label>"),a.b("\n"+n),a.b('        <input style="width:100%" type="text" name="case[subject]" class="text" placeholder="Enter subject here"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b("        <label>To</label>"),a.b("\n"+n),a.b('        <input style="width:100%" type="text" name="case[message[to]]" class="text" value="'),a.b(a.v(a.f("email",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Body</label>"),a.b("\n"+n),a.b('        <textarea style="width:100%;min-height:160px" name="case[message[body]]" class="text"></textarea>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.s(a.f("desk_case_custom_fields",e,t,1),e,t,0,2507,2710,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <label>"),a.b(a.v(a.f("label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('          <input type="text" data-custom-field="true" data-type="'),a.b(a.v(a.d("data.type",e,t,0))),a.b('" style="width:80%" name="case[custom_fields['),a.b(a.v(a.f("name",e,t,0))),a.b(']]" class="text" value=""/>'),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/desk_com_add_note"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>Add a new Note to Case</h3>"),a.b("\n"+n),a.b('<form id="desk-new-note-form">'),a.b("\n"+n),a.s(a.f("customer_id",e,t,1),e,t,0,81,152,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <input type="hidden" name="customer_id" value="'),a.b(a.v(a.f("customer_id",e,t,0))),a.b('"/>'),a.b("\n"+n)}),e.pop()),a.b('  <div class="case_creation desk-open-new-case">'),a.b("\n"+n),a.b('    <div class="field">'),a.b("\n"+n),a.b("        <label>Notes</label>"),a.b("\n"+n),a.b('        <textarea style="width:100%;min-height:160px" name="body" class="text"></textarea>'),a.b("\n"+n),a.b('        <input type="hidden" name="case_id" value="'),a.b(a.v(a.f("desk_com_case_id",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/desk_com_change_agent"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>Update Agent On Case</h3>"),a.b("\n"+n),a.b('<form id="desk-update-agent-form">'),a.b("\n"+n),a.b('  <div class="case_creation desk-open-new-case">'),a.b("\n"+n),a.b('    <div class="field">'),a.b("\n"+n),a.b("        <label>Update Agent</label>"),a.b("\n"+n),a.b('        <input class="rct agent-multipick" name="case[assigned_user]" type="text" style="width:100%;"/>'),a.b("\n"+n),a.b('        <input type="hidden" name="case_id" value="'),a.b(a.v(a.f("desk_com_case_id",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/desk_com_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.desk_com_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.desk_com_panel.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div class="search-filters" class="col-lg-12">'),a.b("\n"+n),a.b('    <div style="margin-bottom:30px">'),a.b("\n"+n),a.b('      <div style="position:relative;height:30px;width:100%;display:inline-block;max-width:500px">'),a.b("\n"+n),a.b('        <select name="search_type" class="desk_com_search_type">'),a.b("\n"+n),a.b('          <option value="customer">Customer Name</option>'),a.b("\n"+n),a.b('          <option value="ticket">Ticket Name</option>'),a.b("\n"+n),a.b("        </select>"),a.b("\n"+n),a.b('        <input name="filter" type="text" class="text text-filter" placeholder="Search Customers" style="border-radius:0;float:left;margin:0;width:calc(100% - 32px);height:30px;padding-right:25px;border-radius:0px"/>'),a.b("\n"+n),a.b('        <i class="clear-search font-remove-circle" style="position:absolute;top:30px;right:40px;cursor:pointer"></i>'),a.b("\n"+n),a.b('        <button type="button" class="button callout search-now" style="float:right"><i class="font-search"></i></button>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="row desk_com_results">'),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="button add-new-customer">New Customer</a>'),a.b("\n"+n),a.b('    <a class="close button outlined">Close</a>'),a.b("\n"+n),a.b('    <div class="clear"></div>'),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/do_not_call"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.do_not_call.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.do_not_call.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b("  <p>"),a.b(a.t(a.d("Call.panels.do_not_call.message",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b('  <div style="display:none"><input type="hidden" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="call_id" name="id"/></div>'),a.b("\n"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <div class="button callout do-not-call-button">'),a.b(a.v(a.d("Call.panels.do_not_call.confirm",e,t,0))),a.b("</div>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/dynamics_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("  #contact_information {"),a.b("\n"+n),a.b("    height: auto;"),a.b("\n"+n),a.b("    overflow: auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field {"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field>label{ "),a.b("\n"+n),a.b("    margin-right: 5px;"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("  } "),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field>input {"),a.b("\n"+n),a.b("    margin-right: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_selector, #contact_selector>label  {"),a.b("\n"+n),a.b("    display: inline;"),a.b("\n"+n),a.b("    visibility: hidden;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.dynamics_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.dynamics_panel.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div id="contact_information"></div>'),a.b("\n"+n),a.b('  <div class="progress" style="margin: 50px auto;">'),a.b("\n"+n),a.b('    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('      <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b('  $.get("/integrations/dynamics/record/"+'),a.b(a.v(a.d("call.id",e,t,0))),a.b(", function(records) {"),a.b("\n"+n),a.b("    updateFields(records)"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  function updateFields(records) {"),a.b("\n"+n),a.b('    $("#contact_information").empty();'),a.b("\n"+n),a.b('    var info = ""'),a.b("\n"+n),a.b("    records.forEach(function(record, v) {"),a.b("\n"+n),a.b("      for (var key in record) {"),a.b("\n"+n),a.b("        var value = (record[key] != null) ? record[key] : ''; "),a.b("\n"+n),a.b("        if (record) {"),a.b("\n"+n),a.b('          info += \'<div class="msdynamics_field col-md-4"><label for="\' + escapeHtml(humanize(key)) + \'">\' + escapeHtml(humanize(key)) + \':</label><input class="text" type="text" name="\' + escapeHtml(humanize(key)) + \'" value="\' + escapeHtml(value) + \'"/></div>\';'),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      };"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    $(".progress").hide();'),a.b("\n"+n),a.b('    $("#contact_information").append(info);'),a.b("\n"+n),a.b('    $(".update_contact").show()'),a.b("\n"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/flag_call"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b("        <h3>Feedback and Adjustments</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b("          <form>"),a.b("\n"+n),a.b('            <div id="spam-block-section">'),a.b("\n"+n),a.s(a.f("is_spam",e,t,1),e,t,1,0,0,"")||(a.b('              <button class=\'button activebutton\' id="report-spammer"> <i class="font-spam"></i> Mark as Spam </button> <i class="font-help" title="This activity was from a spammer.  Marking this call will help block future calls from similar people or automated systems"></i><br/>'),a.b("\n"+n)),a.s(a.f("is_spam",e,t,1),e,t,0,727,1026,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                <strong>This contact was reported as a spammer</strong>"),a.b("\n"+n),a.b('                <button class=\'button outlined\' id="unmark-spammer"> <i class="font-spam"></i> Not Spam </button> <i class="font-help" title="Unmarking will remove this contact from the spam database."></i><br/>'),a.b("\n"+n)}),e.pop()),a.b("            </div>"),a.b("\n"+n),a.b("              <hr>"),a.b("\n"+n),a.s(a.f("can_exclude",e,t,1),e,t,0,1107,1971,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("              "),a.b("\n"+n),a.s(a.f("excluded",e,t,1),e,t,0,1156,1402,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                      <label><strong><input type="checkbox" name="exclude" value="include"/> Include this activity <i class="font-help" title="This activity is currently excluded from your reports"></i></strong></label><br/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("excluded",e,t,1),e,t,1,0,0,"")||(a.b('                      <label><strong><input type="checkbox" name="exclude" value="exclude"/> Exclude this activity <i class="font-help" title="This activity will be removed from the log and will not appear in reports"></i></strong></label><br/>'),a.b("\n"+n),a.b('                      <div style="display:none;margin-bottom:10px;margin-left:5px" class="exclude-related"><label><input type="checkbox" name="exclude_related" value="1"/> Exclude past activities from this contact</label></div>'),a.b("\n"+n))}),e.pop()),a.b("\n"+n),a.s(a.f("can_redact",e,t,1),e,t,0,2018,2785,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                <label><strong><input type="checkbox" name="redact" value="redact"/> Redact content of this activity <i class="font-help" title="This activity will be kept but the fields containing content will be deleted"></i></strong></label><br/>'),a.b("\n"+n),a.b('                  <div style="display:none;margin-bottom:10px;margin-left:5px" class="redact-related"><label><input type="checkbox" name="redact_related" value="1"/> Redact past activities from this contact</label></div>'),a.b("\n"+n),a.b('                  <div class="well redact-confirm" style="display:none">'),a.b("\n"+n),a.b('                    <label><input type="checkbox" class="redact-confirm-box"/> I understand that redaction will permanently delete identifying information about this contact.</label>'),a.b("\n"+n),a.b("                  </div>"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("can_block",e,t,1),e,t,0,2830,4094,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("              "),a.b("\n"+n),a.s(a.f("caller_number_blocked",e,t,1),e,t,0,2892,3139,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                      <label><strong><input type="checkbox" name="block" value="unblock"/> Unblock this contact <i class="font-help" title="The phone number ('),a.b(a.v(a.f("caller_number",e,t,0))),a.b(') is currently blocked"></i></strong></label><br/>'),a.b("\n"+n)}),e.pop()),a.s(a.f("caller_number_blocked",e,t,1),e,t,1,0,0,"")||(a.b('                      <label><strong><input type="checkbox" name="block" value="block"/> Block this contact <i class="font-help" title="Block the phone number '),a.b(a.v(a.f("caller_number",e,t,0))),a.b('"></i></strong></label><br/>'),a.b("\n"+n),a.b('                      <div style="display:none;margin-left:5px" class="name-block"><label><input type="checkbox" name="block_name" value="block_by_name"/> Block contacts by '),a.s(a.f("cnam",e,t,1),e,t,0,3600,3615,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("CNAM ("),n.b(n.v(n.f("cnam",e,t,0))),n.b(")")}),e.pop()),a.s(a.f("cnam",e,t,1),e,t,1,0,0,"")||a.b("name match"),a.b("</label></div>"),a.b("\n"+n),a.b('                      <div class="well cnam-block" style="display:none">Blocking by CNAM can block unintended contacts, as more than one phone number can have the exact same CNAM.</div>'),a.b("\n"+n),a.b('                      <div style="display:none;margin-left:5px" class="agency-block"><label><input type="checkbox" name="agency_all" value="yes"/> Block agency wide</label></div>'),a.b("\n"+n)),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("isCall",e,t,1),e,t,0,4135,7833,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('              <h4 style="margin-top:15px">Rate the audio quality for this call:</h4>'),a.b("\n"+n),a.b('              <div style="margin-left:5px">'),a.b("\n"+n),a.b('                <input id="great-quality" type="radio" name="quality" value="5"/>'),a.b("\n"+n),a.b("                <label for=\"great-quality\"><span style=\"opacity:0.5;margin-right:5px\"><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i></span> Great</label>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b('              <div style="margin-left:5px">'),a.b("\n"+n),a.b('                <input id="good-quality" type="radio" name="quality" value="4"/>'),a.b("\n"+n),a.b("                <label for=\"good-quality\"><span style=\"opacity:0.5;margin-right:5px\"><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i><i class='font-star' style=\"visibility:hidden\"></i></span> Good</label>"),a.b("\n"+n),
a.b("              </div>"),a.b("\n"+n),a.b('              <div style="margin-left:5px">'),a.b("\n"+n),a.b('                <input id="okay-quality" type="radio" name="quality" value="3"/>'),a.b("\n"+n),a.b("                <label for=\"okay-quality\"><span style=\"opacity:0.5;margin-right:5px\"><i class='font-star'></i><i class='font-star'></i><i class='font-star'></i><i class='font-star' style=\"visibility:hidden\"></i><i class='font-star' style=\"visibility:hidden\"></i></span> Okay</label>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b('              <div style="margin-left:5px">'),a.b("\n"+n),a.b('                <input id="not-good-quality" type="radio" name="quality" value="2"/>'),a.b("\n"+n),a.b("                <label for=\"not-good-quality\"><span style=\"opacity:0.5;margin-right:5px\"><i class='font-star'></i><i class='font-star'></i><i class='font-star' style=\"visibility:hidden\"></i><i class='font-star' style=\"visibility:hidden\"></i><i class='font-star' style=\"visibility:hidden\"></i></span> Not Good</label>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b('              <div style="margin-left:5px">'),a.b("\n"+n),a.b('                <input id="inaudible-quality" type="radio" name="quality" value="1"/>'),a.b("\n"+n),a.b('                <label for="inaudible-quality"><span style="opacity:0.5;margin-right:5px"><i class=\'font-star\'></i><i class=\'font-star\' style="visibility:hidden"></i><i class=\'font-star\' style="visibility:hidden"></i><i class=\'font-star\' style="visibility:hidden"></i><i class=\'font-star\' style="visibility:hidden"></i></span> Inaudible</label>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("              "),a.b("\n"+n),a.b('            <div class="quality-issues" style="padding-top:10px;display:none">'),a.b("\n"+n),a.b("              <label>Call quality issues:</label>"),a.b("\n"+n),a.b('              <select name="issues" style="width:100%">'),a.b("\n"+n),a.b("                <option>None</option>"),a.b("\n"+n),a.b('                <option value="imperfect-audio">Imperfect audio quality: Choppy, echoed, or garbled audio during conversation.</option>'),a.b("\n"+n),a.b('                <option value="dropped-call">Dropped call: Call initially connected but was dropped.</option>'),a.b("\n"+n),a.b('                <option value="incorrect-caller-id">Incorrect caller ID: Call connected but caller ID displayed \u2018Unknown\u2019 or an incorrect number.</option>'),a.b("\n"+n),a.b('                <option value="post-dial-delay">Post dial delay: Call connected but there was a long delay between dialing the phone number and the start of ringing.</option>'),a.b("\n"+n),a.b('                <option value="digits-not-captured">DTMF tones not captured: Failed to capture digit input on phone menus.</option>'),a.b("\n"+n),a.b('                <option value="unsolicited-call">Unsolicited call: Received telemarketer, wrong number, automated or other type of unsolicited call.</option>'),a.b("\n"+n),a.b('                <option value="audio-latency">Audio latency: Call participants can hear each other but with significant audio delay.</option>'),a.b("\n"+n),a.b('                <option value="one-way-audio">One way audio: Only one party could hear the audio during the conversation.</option>'),a.b("\n"+n),a.b("              </select>"),a.b("\n"+n),a.b("            </div><br/>"),a.b("\n"+n)}),e.pop()),a.b("          </form>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <button id="send-button-feedback" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('" style="display:none" class="button activebutton pull-left"></button>'),a.b("\n"+n),a.b('        <a class="button action-cancel">Close</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/google_linked_check"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<div>"),a.b("\n"+n),a.b("  <h3>Check Analytics</h3>"),a.b("\n"+n),a.b('  <div style="padding:10px 5px 0">'),a.b("\n"+n),a.b('  <h4 style="font-size:115%">1. Sent Events <small>events successfully sent to Google Analytics</small></h4>'),a.b("\n"+n),a.b('  <div class="panel">'),a.b("\n"+n),a.s(a.d("events.0",e,t,1),e,t,0,216,682,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <ul>"),a.b("\n"+n),a.s(a.f("events",e,t,1),e,t,0,243,656,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <li>"),a.b("\n"+n),a.b("          <h4>"),a.b(a.v(a.f("uacode",e,t,0))),a.b("</h4>"),a.b("\n"+n),a.b("          <ul>"),a.b("\n"+n),a.s(a.f("adwords",e,t,1),e,t,0,326,607,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("              <li>AdWords: "),a.b(a.v(a.f("customer_id",e,t,0))),a.b(" Auto Tagging: "),a.s(a.f("auto_tagging",e,t,1),e,t,0,401,441,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('<strong style="color:green">Yes</strong>')}),e.pop()),a.s(a.f("auto_tagging",e,t,1),e,t,1,0,0,"")||a.b('<strong style="color:red">No</strong> <small>improve tracking by enabling this in AdWords</small>'),a.b("</li>"),a.b("\n"+n)}),e.pop()),a.b("          </ul>"),a.b("\n"+n),a.b("        </li>"),a.b("\n"+n)}),e.pop()),a.b("    </ul>"),a.b("\n"+n)}),e.pop()),a.s(a.d("events.0",e,t,1),e,t,1,0,0,"")||(a.b("    No events sent."),a.b("\n"+n)),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div style="padding:10px 5px 0">'),a.b("\n"+n),a.b('  <h4 style="font-size:115%">2. Detected Events <small>events successfully detected within Google Analytics</small></h4>'),a.b("\n"+n),a.b('  <div class="panel">'),a.b("\n"+n),a.s(a.f("ga_events",e,t,1),e,t,0,966,1763,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="table-responsive">'),a.b("\n"+n),a.b('      <table class="table table-striped table-condensed">'),a.b("\n"+n),a.b("        <tr><th>ga:sourceMedium</th><td>"),a.b(a.v(a.f("ga_sourceMedium",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:eventAction</th><td>"),a.b(a.v(a.f("ga_eventAction",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:eventCategory</th><td>"),a.b(a.v(a.f("ga_eventCategory",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:eventLabel</th><td>"),a.b(a.v(a.f("ga_eventLabel",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:eventValue</th><td>"),a.b(a.v(a.f("ga_eventValue",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:date</th><td>"),a.b(a.v(a.f("ga_date",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:dateHour</th><td>"),a.b(a.v(a.f("ga_dateHour",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <!--"),a.b("\n"+n),a.b("        <tr><th>ga:sessionCount</th><td>"),a.b(a.v(a.f("ga_sessionCount",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:users</th><td>"),a.b(a.v(a.f("ga_users",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        <tr><th>ga:pageviews</th><td>"),a.b(a.v(a.f("ga_pageviews",e,t,0))),a.b("</td></tr>"),a.b("\n"+n),a.b("        -->"),a.b("\n"+n),a.b("      </table>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("ga_events",e,t,1),e,t,1,0,0,"")||(a.b("    No events detected."),a.b("\n"+n)),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div style="padding:10px 5px 0">'),a.b("\n"+n),a.b('  <h4 style="font-size:115%">3. Analytics Goal <small>whether a goal was found to match call events in Google Analytics as conversions</small></h4>'),a.b("\n"+n),a.b('  <div class="panel">'),a.b("\n"+n),a.s(a.f("goal_detected",e,t,1),e,t,0,2085,2317,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <strong style="color:green">Yes</strong>, a goal has been detected. If you are having conversion tracking issues, make sure the configured goal matches the event that was sent, by reviewing the fields in the table above.'),a.b("\n"+n)}),e.pop()),a.s(a.f("goal_detected",e,t,1),e,t,1,0,0,"")||(a.b('      <strong style="color:red">No</strong>, a goal has not been detected. Check the help articles on setting up a Goal in Google Analytics to match the event category "Calls".'),a.b("\n"+n)),a.b("  </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/header_table"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<tr class="topline">'),a.b("\n"+n),a.s(a.f("headers",e,t,1),e,t,0,35,345,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  "),a.s(a.f("allowed",e,t,1),e,t,0,50,330,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<th scope="col" class="col-'),a.b(a.v(a.f("col",e,t,0))),a.b(" "),a.s(a.f("custom",e,t,1),e,t,0,96,106,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("col-custom")}),e.pop()),a.b(" "),a.b(a.v(a.f("classes",e,t,0))),a.s(a.f("on",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.f("sort",e,t,1),e,t,0,163,172,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" sortable")}),e.pop()),a.b('" data-dir="'),a.b(a.v(a.f("sort",e,t,0))),a.b('">'),a.b("\n"+n),a.b("    <a"),a.s(a.f("sort",e,t,1),e,t,0,219,257,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-action="sort" data-col="'),n.b(n.v(n.f("col",e,t,0))),n.b('"')}),e.pop()),a.b('><i class="'),a.b(a.v(a.f("icon",e,t,0))),a.b('"></i><span>'),a.b(a.t(a.f("label",e,t,0))),a.b("</span></a>"),a.b("\n"+n),a.b("  </th>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("</tr>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/hubspot_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b('  [data-action="hubspot_panel"] iframe {'),a.b("\n"+n),a.b("    height: 320px;"),a.b("\n"+n),a.b("    width: 100%;"),a.b("\n"+n),a.b("    border: none;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.hubspot_panel.label",e,t,0))),a.b("<small>"),a.b(a.v(a.d("Call.panels.hubspot_panel.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.s(a.f("hubspot_portal_id",e,t,1),e,t,0,275,457,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("hubspot_contact_id",e,t,1),e,t,0,301,431,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <iframe src="https://app.hubspot.com/contact-timeline-embed/'),a.b(a.v(a.f("hubspot_portal_id",e,t,0))),a.b("/login?id="),a.b(a.v(a.f("hubspot_contact_id",e,t,0))),a.b('"></iframe>'),a.b("\n"+n)}),e.pop())}),e.pop()),a.s(a.f("hubspot_portal_id",e,t,1),e,t,1,0,0,"")||(a.b("  <p><strong>Hubspot setting not found.</strong></p>"),a.b("\n"+n)),a.s(a.f("hubspot_contact_id",e,t,1),e,t,1,0,0,"")||(a.b("  <p><strong>Contact record not found.</strong></p>"),a.b("\n"+n)),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/listen"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b('        <h3 class="live-header">Live Listen</h3>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <div class="live-detail field">'),a.b("\n"+n),a.b("          Connecting to live call..."),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <a class="button callout action-close">Disconnect</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/live_call"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.s(a.f("in_progress",e,t,1),e,t,0,36,188,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <h3>"),a.b(a.v(a.d("Call.panels.live_call.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.live_call.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n)}),e.pop()),a.s(a.f("in_progress",e,t,1),e,t,1,0,0,"")||(a.b("  <h3>"),a.b(a.v(a.d("Call.panels.non_live_call.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.non_live_call.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n)),a.b('  <div class="card">'),a.b("\n"+n),a.b('    <div class="btn-group">'),a.b("\n"+n),a.s(a.f("in_progress",e,t,1),e,t,0,468,1271,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <button type="button" class="btn btn-default live-listen" title="Listen to the live call audio"><i class=""></i> <span class=\'text hidden-xs\'>Connecting</span></button>'),a.b("\n"+n),a.b('      <button type="button" class="btn btn-default barge" title="'),a.b(a.v(a.d("Call.columns.barge.title",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.columns.barge.icon",e,t,0))),a.b("\"></i> <span class='hidden-xs'>"),a.b(a.v(a.d("Call.columns.barge.label",e,t,0))),a.b("</span></button>"),a.b("\n"+n),a.b('      <button type="button" class="btn btn-default whisper" title="'),a.b(a.v(a.d("Call.columns.coach.title",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.columns.coach.icon",e,t,0))),a.b("\"></i> <span class='hidden-xs'>"),a.b(a.v(a.d("Call.columns.coach.label",e,t,0))),a.b("</span></button>"),a.b("\n"+n),a.b('      <button type="button" class="btn btn-default drop" title="'),a.b(a.v(a.d("Call.columns.drop.title",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.columns.drop.icon",e,t,0))),a.b("\"></i> <span class='hidden-xs'>"),a.b(a.v(a.d("Call.columns.drop.label",e,t,0))),a.b("</span></button>"),a.b("\n"+n)}),e.pop()),a.s(a.f("in_progress",e,t,1),e,t,1,0,0,"")||a.s(a.f("isCall",e,t,1),e,t,0,1320,1537,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('        <button type="button" class="list-group-item call-insights" title="'),a.b(a.v(a.d("Call.columns.call_insights.title",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.columns.call_insights.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.columns.call_insights.label",e,t,0))),a.b("</button>"),a.b("\n"+n)}),e.pop()),a.b('     <!--<button type="button" class="list-group-item" '),a.s(a.d("phone_settings.allow_chat",e,t,1),e,t,1,0,0,"")||a.b("disabled"),a.b(' title="'),a.b(a.v(a.d("Call.actions.chat.title",e,t,0))),a.b('"><i class="'),a.b(a.v(a.d("Call.actions.chat.icon",e,t,0))),a.b('"></i> '),a.b(a.v(a.d("Call.actions.chat.label",e,t,0))),a.b("</button> -->"),a.b("\n"+n),a.b("      <div class='box live-transcript' data-id=\""),a.b(a.v(a.f("id",e,t,0))),a.b("\" style='display:none'></div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div id="live-panel-'),a.b(a.v(a.f("id",e,t,0))),a.b('" class="well" style="margin-top:10px;padding:5px">'),a.b("\n"+n),a.b('      <p class="message"></p>'),a.b("\n"+n),a.b('      <div class="detail"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("    <!-- embedded frame to activate live call connectivity -->"),a.b("\n"+n),a.b('    <iframe id="live-call-'),a.b(a.v(a.f("id",e,t,0))),a.b('" style="width:1px;height:1px;position:absolute;border:none;visibility:hidden" src="/calls/'),a.b(a.v(a.f("id",e,t,0))),a.b('/live_call"></iframe>'),a.b("\n"+n),a.s(a.f("live",e,t,1),e,t,0,2287,2431,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div id="live-outline" class="message-thread channels-thread" style="max-height: calc(100vh - 190px );overflow: auto;">'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <a class="close-button button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('      <div class="clear"></div>'),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/loader_rows"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("rows",e,t,1),e,t,0,9,494,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<tr class="calls-loader placeholder-row call call-row wide-call">'),a.b("\n"+n),a.s(a.f("headers",e,t,1),e,t,0,90,475,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.s(a.f("allowed",e,t,1),e,t,0,105,460,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <td class="placeholder-column log-column col-'),a.b(a.v(a.f("col",e,t,0))),a.b(" "),a.s(a.f("custom",e,t,1),e,t,0,174,184,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("col-custom")}),e.pop()),a.b(" "),a.b(a.v(a.f("classes",e,t,0))),a.s(a.f("on",e,t,1),e,t,1,0,0,"")||a.b(" hidden-col"),a.s(a.f("sort",e,t,1),e,t,0,241,250,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" sortable")}),e.pop()),a.b('">'),a.b("\n"+n),a.b('      <div class="placeholder-box-1 shimmer-animation"></div>'),a.b("\n"+n),a.b('      <div class="placeholder-box-2 shimmer-animation"></div>'),a.b("\n"+n),a.b('      <div class="placeholder-box-3 shimmer-animation"></div>'),a.b("\n"+n),a.b("    </td>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("</tr>"),a.b("\n"+n)}),e.pop()),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/mailchimp"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("  .form-error {"),a.b("\n"+n),a.b("    color: red;"),a.b("\n"+n),a.b("    display: none;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .submit-success {"),a.b("\n"+n),a.b("    color: green;"),a.b("\n"+n),a.b("    text-align: center;"),a.b("\n"+n),a.b("    padding-bottom: 10px;"),a.b("\n"+n),a.b("    display: none;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b("        <h3>Add/Remove from Mailchimp List</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <div class="progress">'),a.b("\n"+n),a.b('          <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('            <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="field">'),a.b("\n"+n),a.b('          <div class="field list-selection">'),a.b("\n"+n),a.b('            <label for="mailchimp-list">Select a list to manage <span class="form-error list-error">Select a list and try again.</span></label>'),a.b("\n"+n),a.b('            <input type="text" class="text standard-width mailchimp-list" name="list"/>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field action-selection">'),a.b("\n"+n),a.b('            <label for="add-remove-action">Add or remove contact? <span class="form-error add-remove-error">Select whether to add or remove the email from the list.</span></label>'),a.b("\n"+n),a.b('            <select class="add-remove-action standard-width" name="add-remove">'),a.b("\n"+n),a.b('              <option value=""></option>'),a.b("\n"+n),a.b('              <option value="add">Add</option>'),a.b("\n"+n),a.b('              <option value="remove">Remove</option>'),a.b("\n"+n),a.b("            </select>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b('          <div class="field contact-email">'),a.b("\n"+n),a.b('            <label for="mailchimpemail">Email Address <span class="form-error mailchimp-email-error"></span></label>'),a.b("\n"+n),a.b('            <input type="text" class="text standard-width mailchimp-email" name="mailchimp-email"/>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <div class="form-error general-error">Something went wrong. Please check the <a href="/api_logs" target="_blank">API Logs</a> for more information.</div>'),a.b("\n"+n),a.b('        <div class="submit-success"></div>'),a.b("\n"+n),a.b('        <button class="button pull-left action-submit" id="submit-button">Save</button>'),a.b("\n"+n),a.b('        <a class="button action-cancel" id="cancel-button">Cancel</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>  "),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b('  setupMultiPicker($("input.mailchimp-list"), "mailchimp-list", "Select a Mailchimp list...", true,'),a.b("\n"+n),a.b('  {url: "/integrations/mailchimp/lists", idurl: "/integrations/mailchimp/lists?selected_list='),a.b(a.v(a.f("list",e,t,0))),a.b('" });'),a.b("\n"),a.b("\n"+n),a.b('  $(\'.add-remove-action\').select2({"dropdownAutoWidth": true, "placeholder": "Add or Remove?"});'),a.b("\n"),a.b("\n"+n),a.b('  $.get("/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/", function(res) {'),a.b("\n"+n),a.b('    email = res["caller"]["email"];'),a.b("\n"+n),a.b("    $('.mailchimp-email').val(email);"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('.action-submit').on('click', function() {"),a.b("\n"+n),a.b("    $('.progress').show();"),a.b("\n"+n),a.b("    var list = $('.mailchimp-list').select2('data');"),a.b("\n"+n),a.b("    var addremove = $('.add-remove-action').select2('data');"),a.b("\n"+n),a.b("    var email = $('.mailchimp-email').val();"),a.b("\n"+n),a.b("    var errors = false;"),a.b("\n"+n),a.b("    $('.form-error').hide();"),a.b("\n"+n),a.b("    $('.submit-success').hide();"),a.b("\n"+n),a.b('    if ((list == null) || (addremove == null) || (email == null) || (email == "")) {'),a.b("\n"+n),a.b("      errors = true;"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("    if (list == null) {"),a.b("\n"+n),a.b("      $('.list-error').show();"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("    if (addremove == null) {"),a.b("\n"+n),a.b("      $('.add-remove-error').show();"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b('    if (email == null || email == "") {'),a.b("\n"+n),a.b('      var errortext = (addremove == null) ? "Enter an email to add/remove" : "Enter an email to "+addremove[\'id\'];'),a.b("\n"+n),a.b("      $('.mailchimp-email-error').html(errortext).show();"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("    if (!errors) {"),a.b("\n"+n),a.b('      var url = "/integrations/mailchimp/"+list["id"];'),a.b("\n"+n),a.b('      if (addremove["id"] == "add") {'),a.b("\n"+n),a.b('        url += "/add";'),a.b("\n"+n),a.b("      } else {"),a.b("\n"+n),a.b('        url += "/remove";'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b('      data = {activity_id: "'),a.b(a.v(a.f("id",e,t,0))),a.b('", email: email}'),a.b("\n"+n),a.b("      $.post(url, data, function(res) {"),a.b("\n"+n),a.b('        if ((addremove["id"] == "add" && res.status == 200) || (addremove["id"] == "remove" && res.status == 204)) {'),a.b("\n"+n),a.b('          status = (addremove["id"] == "add") ? "added to" : "removed from";'),a.b("\n"+n),a.b('          $(\'.submit-success\').html("\'"+email+"\' successfully "+status+" \'"+list["text"]+"\'").show();'),a.b("\n"+n),a.b("        } else {"),a.b("\n"+n),a.b("          $('.general-error').show();"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("        $('.progress').hide();"),a.b("\n"+n),a.b("      })"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('.progress').hide();"),a.b("\n"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/no_calls_template"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<tr class="no-calls" style="background:none !important;border:none !important;cursor:default">'),a.b("\n"+n),a.b('  <td colspan="'),a.b(a.v(a.f("column_count",e,t,0))),a.b('" style="background:none !important;border:none !important">'),a.b("\n"+n),a.b("    <h1>No Results"),a.s(a.f("message",e,t,1),e,t,0,217,237,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("<p>"),n.b(n.t(n.f("message",e,t,0))),n.b("</p>")}),e.pop()),a.b("</h1>"),a.b("\n"+n),a.b("  </td>"),a.b("\n"+n),a.b("</tr>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/on_hold"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("#modal-frame .hold-dialog .modal-body {"),a.b("\n"+n),a.b("  padding: 20px 4px;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".hold-dialog .modal-body .transfer-btn {"),a.b("\n"+n),a.b("  width: calc(33.33% - 14px);"),a.b("\n"+n),a.b("  margin: 0 7px;"),a.b("\n"+n),a.b("  padding: 30px 10px;"),a.b("\n"+n),a.b("  height: 162px;"),a.b("\n"+n),a.b("  white-space: inherit;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".hold-dialog .modal-body .transfer-btn i {"),a.b("\n"+n),a.b("  font-size: 60px;"),a.b("\n"+n),a.b("  display: block;"),a.b("\n"+n),a.b("  margin-bottom: 5px;"),a.b("\n"+n),a.b("  color: #888;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("#transfer_to_me_action {"),a.b("\n"+n),a.b("  width: calc(100% - 14px);"),a.b("\n"+n),a.b("  height: 100px;"),a.b("\n"+n),a.b("  margin: 0 7px;"),a.b("\n"+n),a.b("  margin-bottom: 14px;"),a.b("\n"+n),a.b("  font-size: 20px;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("#transfer_to_me_action i {"),a.b("\n"+n),a.b("  color: #888;"),a.b("\n"+n),a.b("  font-size: 46px;"),a.b("\n"+n),a.b("  vertical-align: middle;"),a.b("\n"+n),a.b("  margin-right: 3px;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".hold-dialog .modal-footer .button {"),a.b("\n"+n),a.b("  height: 28px;"),a.b("\n"+n),a.b("  line-height: 28px;"),a.b("\n"+n),a.b("  top: 2px;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("#modal-frame .hold-dialog .modal-footer {"),a.b("\n"+n),a.b("  text-align: left;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("#transfer_to_number_container .phone-picker.phone-picker-2 {"),a.b("\n"+n),a.b("  width: 300px;"),a.b("\n"+n),a.b("  display: inline-block;"),a.b("\n"+n),a.b("  max-width: calc(100% - 80px);"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("@media (max-width: 639px) {"),a.b("\n"+n),a.b("  #modal-frame .hold-dialog .modal-body {"),a.b("\n"+n),a.b("    padding: 17px 0;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .hold-dialog .modal-body .transfer-btn {"),a.b("\n"+n),a.b("    font-size: 90%;"),a.b("\n"+n),a.b("    height: 112px;"),a.b("\n"+n),a.b("    padding: 16px 5px;"),a.b("\n"+n),a.b("    width: calc(33.33% - 10px);"),a.b("\n"+n),a.b("    margin: 0 5px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .hold-dialog .modal-body .transfer-btn i {"),a.b("\n"+n),a.b("    font-size: 40px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #transfer_to_me_action {"),a.b("\n"+n),a.b("    font-size: 90%;"),a.b("\n"+n),a.b("    width: calc(100% - 10px);"),a.b("\n"+n),a.b("    margin: 0 5px;"),a.b("\n"+n),a.b("    margin-bottom: 10px;"),a.b("\n"+n),a.b("    font-size: 15px;"),a.b("\n"+n),a.b("    height: 85px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #transfer_to_me_action i {"),a.b("\n"+n),a.b("    font-size: 38px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #modal-frame .hold-dialog .modal-footer {"),a.b("\n"+n),a.b("    padding-left: 0;"),a.b("\n"+n),a.b("    padding-right: 0;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="modal fade hold-dialog">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="bootbox-close-button close" data-dismiss="modal" aria-hidden="true" style="margin-top: -10px;">\xd7</button>'),a.b("\n"+n),a.b("        <h3>Take Caller off Hold</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <button class="btn btn-default" id="transfer_to_me_action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <i class="font-phone"></i>'),a.b("\n"+n),a.b("          Answer Call"),a.b("\n"+n),a.b("        </button>"),a.b("\n"+n),a.b('        <button class="btn transfer-btn btn-default" id="transfer_to_agent_action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <i class="font-user"></i>'),a.b("\n"+n),a.b("          Transfer to Agent"),a.b("\n"+n),a.b('        </button><button class="btn transfer-btn btn-default" id="transfer_to_phone_number_action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <i class="font-phone-outgoing"></i>'),a.b("\n"+n),a.b("          Transfer to Number"),a.b("\n"+n),a.b('        </button><button class="btn transfer-btn btn-default" id="transfer_to_queue_action" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b("\n"+n),a.b('          <i class="font-tree"></i>'),a.b("\n"+n),a.b("          Transfer to Queue"),a.b("\n"+n),a.b("        </button>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer" style="display:none">'),a.b("\n"+n),a.b('        <div id="transfer_to_agent_container" style="display:none"><input type="text" class="text" id="transfer_to_agent_picker" name="transfer_to_agent" style="width:300px;max-width:calc(100% - 80px)"/> <div class="button callout" id="transfer_to_agent_button">Transfer</div></div>'),a.b("\n"+n),a.b('        <div id="transfer_to_number_container" style="display:none"><input type="text" class="text" id="transfer_to_phone_number_input" name="transfer_to_number" style="width:300px"/> <div class="button callout" id="transfer_to_number_button">Transfer</div></div>'),a.b("\n"+n),a.b('        <div id="transfer_to_queue_container" style="display:none"><input type="text" class="text" id="transfer_to_queue_picker" name="transfer_to_queue" style="width:300px;max-width:calc(100% - 80px)"/> <div class="button callout" id="transfer_to_queue_button">Transfer</div></div>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/reminder_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>Callback Reminder</h3>"),a.b("\n"+n),a.b('  <div class="card">'),a.b("\n"),a.b("\n"+n),a.b('    <label for="remind-at">'),a.b(a.v(a.d("Call.panels.reminder_panel.panel.remind_at.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('    <input class="remind_at text" name="remind-at" style="width:400px" type="text"/>'),a.b("\n"+n),a.b('    <label for="timezone">'),a.b(a.v(a.d("Call.panels.reminder_panel.panel.timezone.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('    <select class="timezone" name="timezone"></select>'),a.b("\n"+n),a.b('    <label for="message">'),a.b(a.v(a.d("Call.panels.reminder_panel.panel.message.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('    <input class="message text" name="message" style="width:400px" type="text"/>'),a.b("\n"),a.b("\n"+n),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <a class="button save" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.save.short_label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('      <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b("  var dpOpts = {"),a.b("\n"+n),a.b("    showTime: true,"),a.b("\n"+n),a.b("    format: 'yyyy-mm-dd H:i',"),a.b("\n"+n),a.b("    startDate: '0d'"),a.b("\n"+n),a.b("  };"),a.b("\n"),a.b("\n"+n),a.b("  var d = new Date();"),a.b("\n"),a.b("\n"+n),a.b("  var year = d.getFullYear()"),a.b("\n"+n),a.b("  var month = d.getMonth()+1;"),a.b("\n"+n),
a.b("  month = (month<10 ? '0' : '') + month;"),a.b("\n"+n),a.b("  var day = (d.getDate()<10 ? '0' : '') + d.getDate();"),a.b("\n"+n),a.b("  var hour = (d.getHours()<10 ? '0' : '') + d.getHours();"),a.b("\n"+n),a.b("  var minute = (d.getMinutes()<10 ? '0' : '') + d.getMinutes();"),a.b("\n"),a.b("\n"+n),a.b("  var now = year + '-' + month + '-' + day + \" \" + hour + \":\" + minute"),a.b("\n"),a.b("\n"+n),a.b('  $(".remind_at").val(now);'),a.b("\n"),a.b("\n"+n),a.b("  $(\".save\").on('click', function() {"),a.b("\n"+n),a.b("    var data = {"),a.b("\n"+n),a.b('             "call_id": "'),a.b(a.v(a.d("call.id",e,t,0))),a.b('",'),a.b("\n"+n),a.b("             \"remind_at\": $('.remind_at').val(),"),a.b("\n"+n),a.b("             \"timezone\": $('.timezone :selected').val(),"),a.b("\n"+n),a.b('             "contact_id": "'),a.b(a.v(a.d("call.caller.uid",e,t,0))),a.b('",'),a.b("\n"+n),a.b("             \"message\": $('.message').val()"),a.b("\n"+n),a.b("           };"),a.b("\n"),a.b("\n"+n),a.b("    $.post('/api/v1/accounts/"),a.b(a.v(a.d("call.account_id",e,t,0))),a.b("/reminders/new', data, function() {"),a.b("\n"+n),a.b('      ctmFlash("Reminder saved.",)'),a.b("\n"+n),a.b("      $('.remind_at').val('');"),a.b("\n"+n),a.b("      $('.message').val('');"),a.b("\n"+n),a.b("    })"),a.b("\n"+n),a.b("  })"),a.b("\n"),a.b("\n"+n),a.b('  $(".remind_at").datepicker(dpOpts);'),a.b("\n"),a.b("\n"+n),a.b('  var timezones = [{"timezone":"UTC", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Abidjan", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Accra", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Algiers", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Bissau", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Cairo", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Casablanca", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Ceuta", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/El_Aaiun", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Johannesburg", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Juba", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Khartoum", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Lagos", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Maputo", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Monrovia", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Nairobi", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Ndjamena", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Tripoli", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Tunis", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Africa/Windhoek", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Adak", "offset":"-10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Anchorage", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Araguaina", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Buenos_Aires", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Catamarca", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Cordoba", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Jujuy", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/La_Rioja", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Mendoza", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Rio_Gallegos", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Salta", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/San_Juan", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/San_Luis", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Tucuman", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Argentina/Ushuaia", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Asuncion", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Atikokan", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Bahia", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Bahia_Banderas", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Barbados", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Belem", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Belize", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Blanc-Sablon", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Boa_Vista", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Bogota", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Boise", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Cambridge_Bay", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Campo_Grande", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Cancun", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Caracas", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Cayenne", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Chicago", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Chihuahua", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Costa_Rica", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Creston", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Cuiaba", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Curacao", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Danmarkshavn", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Dawson", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Dawson_Creek", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Denver", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Detroit", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Edmonton", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Eirunepe", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/El_Salvador", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Fort_Nelson", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Fortaleza", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Glace_Bay", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Godthab", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Goose_Bay", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Grand_Turk", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Guatemala", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Guayaquil", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Guyana", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Halifax", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Havana", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Hermosillo", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Indianapolis", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Knox", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Marengo", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Petersburg", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Tell_City", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Vevay", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Vincennes", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Indiana/Winamac", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Inuvik", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Iqaluit", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Jamaica", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Juneau", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Kentucky/Louisville", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Kentucky/Monticello", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/La_Paz", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Lima", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Los_Angeles", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Maceio", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Managua", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Manaus", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Martinique", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Matamoros", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Mazatlan", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Menominee", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Merida", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Metlakatla", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Mexico_City", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Miquelon", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Moncton", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Monterrey", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Montevideo", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Nassau", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/New_York", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Nipigon", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Nome", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Noronha", "offset":"-02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/North_Dakota/Beulah", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/North_Dakota/Center", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/North_Dakota/New_Salem", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Ojinaga", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Panama", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Pangnirtung", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Paramaribo", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Phoenix", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Port_of_Spain", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Port-au-Prince", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Porto_Velho", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Puerto_Rico", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Punta_Arenas", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Rainy_River", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Rankin_Inlet", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Recife", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Regina", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Resolute", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Rio_Branco", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Santarem", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Santiago", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Santo_Domingo", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Sao_Paulo", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Scoresbysund", "offset":"-01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Sitka", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/St_Johns", "offset":"-03:30"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Swift_Current", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Tegucigalpa", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Thule", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Thunder_Bay", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Tijuana", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Toronto", "offset":"-05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Vancouver", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Whitehorse", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Winnipeg", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Yakutat", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"America/Yellowknife", "offset":"-07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Casey", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Davis", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/DumontDUrville", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Macquarie", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Mawson", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Palmer", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Rothera", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Syowa", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Troll", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Antarctica/Vostok", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Almaty", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Amman", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Anadyr", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Aqtau", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Aqtobe", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Ashgabat", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Atyrau", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Baghdad", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Baku", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Bangkok", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Barnaul", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Beirut", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Bishkek", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Brunei", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Chita", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Choibalsan", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Colombo", "offset":"+05:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Damascus", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Dhaka", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Dili", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Dubai", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Dushanbe", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Famagusta", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Gaza", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Hebron", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Ho_Chi_Minh", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Hong_Kong", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Hovd", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Irkutsk", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Jakarta", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Jayapura", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Jerusalem", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kabul", "offset":"+04:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kamchatka", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Karachi", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kathmandu", "offset":"+05:45"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Khandyga", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kolkata", "offset":"+05:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Krasnoyarsk", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kuala_Lumpur", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Kuching", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Macau", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Magadan", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Makassar", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Manila", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Novokuznetsk", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Novosibirsk", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Omsk", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Oral", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Pontianak", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Pyongyang", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Qatar", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Qyzylorda", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Riyadh", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Sakhalin", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Samarkand", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Seoul", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Shanghai", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Singapore", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Srednekolymsk", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Taipei", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Tashkent", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Tbilisi", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Tehran", "offset":"+03:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Thimphu", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Tokyo", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Tomsk", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Ulaanbaatar", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Urumqi", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Ust-Nera", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Vladivostok", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Yakutsk", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Yangon", "offset":"+06:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Yekaterinburg", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Yerevan", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Azores", "offset":"-01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Bermuda", "offset":"-04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Canary", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Cape_Verde", "offset":"-01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Faroe", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Madeira", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Reykjavik", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/South_Georgia", "offset":"-02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Atlantic/Stanley", "offset":"-03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Adelaide", "offset":"+09:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Brisbane", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Broken_Hill", "offset":"+09:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Currie", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Darwin", "offset":"+09:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Eucla", "offset":"+08:45"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Hobart", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Lindeman", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Lord_Howe", "offset":"+10:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Melbourne", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Perth", "offset":"+08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Australia/Sydney", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Astrakhan", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Athens", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Belgrade", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Berlin", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Brussels", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Bucharest", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Budapest", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Chisinau", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Copenhagen", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Dublin", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Gibraltar", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Helsinki", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Istanbul", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Kaliningrad", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Kiev", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Kirov", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Lisbon", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/London", "offset":"+00:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Luxembourg", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Madrid", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Malta", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Minsk", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Monaco", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Moscow", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Asia/Nicosia", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Oslo", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Paris", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Prague", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Riga", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Rome", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Samara", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Saratov", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Simferopol", "offset":"+03:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Sofia", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Stockholm", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Tallinn", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Tirane", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Ulyanovsk", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Uzhgorod", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Vienna", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Vilnius", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Volgograd", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Warsaw", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Zaporozhye", "offset":"+02:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Europe/Zurich", "offset":"+01:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Chagos", "offset":"+06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Christmas", "offset":"+07:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Cocos", "offset":"+06:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Kerguelen", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Mahe", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Maldives", "offset":"+05:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Mauritius", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Indian/Reunion", "offset":"+04:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Apia", "offset":"+13:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Auckland", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Bougainville", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Chatham", "offset":"+12:45"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Chuuk", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Easter", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Efate", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Enderbury", "offset":"+13:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Fakaofo", "offset":"+13:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Fiji", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Funafuti", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Galapagos", "offset":"-06:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Gambier", "offset":"-09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Guadalcanal", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Guam", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Honolulu", "offset":"-10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Kiritimati", "offset":"+14:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Kosrae", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Kwajalein", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Majuro", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Marquesas", "offset":"-09:30"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Nauru", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Niue", "offset":"-11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Norfolk", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Noumea", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Pago_Pago", "offset":"-11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Palau", "offset":"+09:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Pitcairn", "offset":"-08:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Pohnpei", "offset":"+11:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Port_Moresby", "offset":"+10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Rarotonga", "offset":"-10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Tahiti", "offset":"-10:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Tarawa", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Tongatapu", "offset":"+13:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Wake", "offset":"+12:00"},'),a.b("\n"+n),a.b('                   {"timezone":"Pacific/Wallis", "offset":"+12:00"}];'),a.b("\n"),a.b("\n"+n),a.b("  timezones.forEach(function(tz) {"),a.b("\n"+n),a.b("    var selected = ((CTM.zone.name == tz.timezone) || (CTM.zone.iso == tz.timezone)) ? 'selected' : '';"),a.b("\n"+n),a.b('    var option = "<option value=\'"+tz.timezone+"\' "+selected+">(GMT"+tz.offset+") "+tz.timezone+"</option>";'),a.b("\n"+n),a.b("    $('.timezone').append(option);"),a.b("\n"+n),a.b("  });"),a.b("\n"+n),a.b('  $(\'.timezone\').select2({"width":"400px"});'),
a.b("\n"),a.b("\n"+n),a.b("})();"),a.b("\n"+n),a.b("  </script>"),a.b("\n"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/salesforce_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.salesforce_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.salesforce_panel.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.s(a.d("sforce.0",e,t,1),e,t,0,219,630,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('  <div class="row">'),a.b("\n"+n),a.s(a.f("sforce",e,t,1),e,t,0,255,476,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <div class="col-xs-12 col-md-6 col-lg-3" style="margin-bottom:10px">'),a.b("\n"+n),a.b("        <label>"),a.b(a.v(a.f("key",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        <input class="text disabled" type="text" readonly value="'),a.b(a.v(a.f("value",e,t,0))),a.b('" style="width:100%"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n)}),e.pop()),a.b("  </div>"),a.b("\n"+n),a.b('  <a class="load-history" data-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.actions.load_history.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('  <div id="salesforce-lead-task-history"></div>'),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.s(a.f("sforce",e,t,1),e,t,1,0,0,"")||(a.b("    <p><strong>"),a.b(a.v(a.d("Call.panels.salesforce_panel.extra.record_not_found",e,t,0))),a.b("</strong></p>"),a.b("\n"+n)),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.s(a.d("salesforce.reference",e,t,1),e,t,0,819,1033,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a href="'),a.b(a.v(a.d("salesforce.url",e,t,0))),a.b('" class="button" target="_blank">'),a.b(a.v(a.d("Call.actions.open_record.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('      <a class="button activebutton unlink-sf-action outlined">'),a.b(a.v(a.d("Call.actions.unlink_record.label",e,t,0))),a.b("</a>"),a.b("\n"+n)}),e.pop()),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/scripts_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.scripts_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("call_script.name",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.f("id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card"'),a.s(a.d("call_script.use_iframe",e,t,1),e,t,0,209,225,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-iframe="1"')}),e.pop()),a.b(">"),a.b("\n"+n),a.b('  <div class="row">'),a.b("\n"+n),a.s(a.d("call_script.use_iframe",e,t,1),e,t,1,0,0,"")||(a.b("    <p>"),a.b("\n"+n),a.b("      "),a.b(a.t(a.d("call_script.infoscript",e,t,0))),a.b("\n"+n),a.b("    </p>"),a.b("\n"+n)),a.s(a.d("call_script.use_iframe",e,t,1),e,t,0,421,569,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <iframe style="min-height:600px;height:100%;width:100%;border:0px;display:block" border="0" src="'),a.b(a.t(a.d("call_script.remote_url",e,t,0))),a.b('"></iframe>'),a.b("\n"+n)}),e.pop()),a.s(a.d("call_script.remote_url",e,t,1),e,t,0,628,1134,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('      <a class="button" target="_blank" href="'),a.b(a.v(a.d("call_script.remote_url",e,t,0))),a.b('">'),a.b(a.v(a.d("Call.actions.open_link.label",e,t,0))),a.b("</a> "),a.b("\n"+n),a.s(a.d("call_script.pop_url",e,t,1),e,t,0,771,1105,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("        <script>"),a.b("\n"+n),a.b('          var w = "'),a.b(a.v(a.d("call_script.pop_width",e,t,0))),a.b('";'),a.b("\n"+n),a.b('          var h = "'),a.b(a.v(a.d("call_script.pop_height",e,t,0))),a.b('";'),a.b("\n"+n),a.b('          var remote = "'),a.b(a.t(a.d("call_script.remote_url",e,t,0))),a.b('";'),a.b("\n"+n),a.b('          window.open(remote, "Call Script","toolbars=0,menubar=0,location=0,resizable=1,scrollbars=1,status=0,width=" + w + ",height=" + h);'),a.b("\n"+n),a.b("        </script>"),a.b("\n"+n)}),e.pop())}),e.pop()),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/sendgrid_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("  #contact_information {"),a.b("\n"+n),a.b("    height: auto;"),a.b("\n"+n),a.b("    overflow: auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field {"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field>label{ "),a.b("\n"+n),a.b("    margin-right: 5px;"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("  } "),a.b("\n"+n),a.b("  #contact_information>div.msdynamics_field>input {"),a.b("\n"+n),a.b("    margin-right: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_selector, #contact_selector>label  {"),a.b("\n"+n),a.b("    display: inline;"),a.b("\n"+n),a.b("    visibility: hidden;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<form id="sendgrid_form" class="validatable">'),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.sendgrid_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.sendgrid_panel.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card sendgrid">'),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b('        <input type="hidden" name="call_notification[call_id]" value="'),a.b(a.v(a.d("call.id",e,t,0))),a.b('"> '),a.b("\n"+n),a.b('        <label for="call_notification_to">'),a.b(a.t(a.d("Call.properties.emails.properties.to.label",e,t,0))),a.b(' <i class="font-help" title="'),a.b(a.v(a.d("Call.properties.emails.properties.to.title",e,t,0))),a.b('"></i></label>'),a.b("\n"+n),a.b('        <input id="call_notification_to" type="text" class="input-xxlarge text" name="call_notification[to]"/>'),a.b("\n"+n),a.b('        <div class="more-addrs">'),a.b("\n"+n),a.b('          <a data-type="cc" data-name="CC" data-desc="'),a.b(a.v(a.d("Call.properties.emails.properties.cc.title",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.cc.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('          <a data-type="bcc" data-name="BCC" data-desc="'),a.b(a.v(a.d("Call.properties.emails.properties.bcc.title",e,t,0))),a.b('">'),a.b(a.t(a.d("Call.properties.emails.properties.bcc.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field email_from">'),a.b("\n"+n),a.b('        <label for="call_notification_from_address">'),a.b(a.t(a.d("Call.panels.sendgrid_panel.properties.from_address.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        <input type="text" class="input-xxlarge text standard-width sendgrid_from_address" name="call_notification[from_address]" />'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field email_from">'),a.b("\n"+n),a.b('        <label for="call_notification_from_name">'),a.b(a.t(a.d("Call.panels.sendgrid_panel.properties.from_name.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        <input type="text" class="input-xxlarge text standard-width sendgrid_from_name" name="call_notification[from_name]" />'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b('        <label for="call_notification_message">'),a.b(a.t(a.d("Call.panels.sendgrid_panel.properties.message.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        <textarea class="input-xxlarge text standard-width sendgrid_message" name="call_notification[message]"></textarea>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field">'),a.b("\n"+n),a.b('        <label for="call_notification_template">'),a.b(a.t(a.d("Call.panels.sendgrid_panel.properties.template.label",e,t,0))),a.b("</label>"),a.b("\n"+n),a.b('        <input type="text" class="input-xxlarge text standard-width sendgrid_template" name="call_notification[template]" />'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('    <footer class="form-actions">'),a.b("\n"+n),a.b('      <a class="send_sendgrid_email button">Send Email</a>'),a.b("\n"+n),a.b('      <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</form>"),a.b("\n"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b('  setupMultiPicker($(".sendgrid_template"), "template", "'),a.b(a.v(a.d("TriggerSendgrid.properties.template.placeholder",e,t,0))),a.b('", true,'),a.b("\n"+n),a.b("    {url: '/integrations/sendgrid/allowed_templates', idurl: '/integrations/sendgrid/allowed_templates' });"),a.b("\n"),a.b("\n"+n),a.b("  $('.sendgrid_from_name').val(CTM.first_name+\" \"+CTM.last_name);"),a.b("\n"+n),a.b("  $('.sendgrid_from_address').val(CTM.email);"),a.b("\n"),a.b("\n"+n),a.b("  if (!CTM.sendgrid.allow_change_from) {"),a.b("\n"+n),a.b('    $(".email_from").hide();'),a.b("\n"+n),a.b('    console.log("DONT ALLOW CHANGE");'),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/sf_lead"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>Matching Record Found</h3>"),a.b("\n"+n),a.b('<div class="panel">'),a.b("\n"+n),a.b('  <div class="well">'),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.d("record.FirstName",e,t,0))),a.b(" "),a.b(a.v(a.d("record.LastName",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.d("record.Email",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("    <p>"),a.b(a.v(a.d("record.Phone",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b('    <a target="_blank" href="'),a.b(a.v(a.f("instance_url",e,t,0))),a.b("/"),a.b(a.v(a.d("record.Id",e,t,0))),a.b('">view</a>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("  <h4>Append Call to matching Record?</h4>"),a.b("\n"+n),a.b('  <form action="/salesforce/appendtask" method="post" style="margin-bottom:0" class="sf-append">'),a.b("\n"+n),a.b('    <input type="submit" class="button" value="Add to existing record"/>'),a.b("\n"+n),a.b("  </form>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b('<div class="panel">'),a.b("\n"+n),a.b("  <h4>Create a new lead.</h4>"),a.b("\n"+n),a.b('  <form action="/salesforce/createnew" method="post" style="margin-bottom:0" class="sf-create">'),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="field col-sm-6">'),a.b("\n"+n),a.b("        <label>First Name</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="FirstName" value="'),a.b(a.v(a.d("call.first_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Last Name</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="LastName" value="'),a.b(a.v(a.d("call.last_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field col-sm-6">'),a.b("\n"+n),a.b("        <label>Phone Number</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:100%" class="text" name="Phone" value="'),a.b(a.v(a.d("call.caller_number",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Email</label>"),a.b("\n"+n),a.b('        <input type="text" style="width:100%" class="text" name="Email" value="'),a.b(a.v(a.d("call.email",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <input type="submit" class="button" value="Add New Lead"/>'),a.b("\n"+n),a.b("  <form>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/sf_lead_add"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<h3>No Match Found</h3>"),a.b("\n"+n),a.b('<div class="panel">'),a.b("\n"+n),a.b("  <h4>Create a new lead.</h4>"),a.b("\n"+n),a.b('  <form action="/salesforce/createnew" method="post" style="margin-bottom:0" class="sf-create">'),a.b("\n"+n),a.b('    <div class="row">'),a.b("\n"+n),a.b('      <div class="field col-md-5">'),a.b("\n"+n),a.b("        <label>First Name</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="FirstName" value="'),a.b(a.v(a.d("call.first_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Last Name</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="LastName" value="'),a.b(a.v(a.d("call.last_name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="field col-md-5">'),a.b("\n"+n),a.b("        <label>Phone Number</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="Phone" value="'),a.b(a.v(a.d("call.caller_number",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("        <label>Email</label>"),a.b("\n"+n),a.b('        <input type="text" class="text" name="Email" value="'),a.b(a.v(a.d("call.email",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <input type="submit" class="button" value="Add New Lead"/>'),a.b("\n"+n),a.b("  <form>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/shopify_customer_data"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("customers",e,t,1),e,t,0,14,5026,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('<div class="panel">'),a.b("\n"+n),a.b('  <div style="width:50px;float:left;margin-right:10px">'),a.b("\n"+n),a.b('    <span class="agent-initials button-background" style="width:50px;height:50px;line-height:50px;font-size:18px">'),a.s(a.f("initials",e,t,1),e,t,0,218,230,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div style="width:calc(100% - 60px);float:left"></div>'),a.b("\n"+n),a.b('  <h3 style="border-bottom:1px solid #eee;margin-left:75px;">'),a.b("\n"+n),a.b('    <a target="_blank" href="https://'),a.b(a.v(a.f("store",e,t,0))),a.b("/admin/customers/"),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.v(a.f("full_name",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("  </h3>"),a.b("\n"+n),a.b('  <div class="row">'),a.b("\n"+n),a.b('    <div class="col-md-6">'),a.b("\n"+n),a.s(a.f("email",e,t,1),e,t,0,602,1046,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <p>"),a.b("\n"+n),a.b('        <i class="font-envelope"></i>'),a.b("\n"+n),a.b('        <span class="email">'),a.b(a.v(a.f("email",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b('        <span style="display:block;margin-left: 10px">verified email? '),a.s(a.f("verified_email",e,t,1),e,t,0,785,788,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Yes")}),e.pop()),a.s(a.f("verified_email",e,t,1),e,t,1,0,0,"")||a.b("No"),a.b("</span>"),a.b("\n"+n),a.b('        <span style="display:block;margin-left: 10px">accepts marketing? '),a.s(a.f("accepts_marketing",e,t,1),e,t,0,950,953,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Yes")}),e.pop()),a.s(a.f("accepts_marketing",e,t,1),e,t,1,0,0,"")||a.b("No"),a.b("</span>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("total_spent",e,t,1),e,t,0,1104,1234,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <p>"),a.b("\n"+n),a.b('        <i class="font-office"></i>'),a.b("\n"+n),a.b('        <span class="company">Total Spent: '),a.b(a.v(a.f("total_spent",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n)}),e.pop()),a.b("      <p>"),a.b("\n"+n),a.b('        <i class="font-office"></i>'),a.b("\n"+n),a.b('        <span class="company">Tax Exempt?: '),a.s(a.f("tax_exempt",e,t,1),e,t,0,1379,1380,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Y")}),e.pop()),a.s(a.f("tax_exempt",e,t,1),e,t,1,0,0,"")||a.b("N"),a.b("</span>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n),a.s(a.f("note",e,t,1),e,t,0,1478,1605,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("      <p>"),a.b("\n"+n),a.b('        <i class="font-office"></i>'),a.b("\n"+n),a.b('        <span class="company">Customer Note: '),a.b(a.v(a.f("note",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("      </p>"),a.b("\n"+n)}),e.pop()),a.b('      <div class="orders">'),a.b("\n"+n),a.b('        <a class="shopify_orders_toggle" data-call-id="'),a.b(a.v(a.f("call_id",e,t,0))),a.b('" data-customer-id="'),a.b(a.v(a.f("id",e,t,0))),a.b('"><i class="font-zoom-in"></i>Orders: '),a.b(a.v(a.d("orders.length",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="col-md-4">'),a.b("\n"+n),a.b('      <div class="addresses" style="margin-bottom: 25px;">'),a.b("\n"+n),a.b("        <h4>Addresses</h4>"),a.b("\n"+n),a.s(a.f("addresses",e,t,1),e,t,0,1980,2952,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div style="border-bottom: solid white 1px; border-top: solid white 1px; padding:10px 0px 10px;">'),a.b("\n"+n),a.b("            <p><b>Default:</b> "),a.s(a.f("default",e,t,1),e,t,0,2132,2133,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Y")}),e.pop()),a.s(a.f("default",e,t,1),e,t,1,0,0,"")||a.b("N"),a.b("</p>"),a.b("\n"+n),a.s(a.f("company",e,t,1),e,t,0,2199,2259,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Company:</b> "),a.b(a.v(a.f("company",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("address1",e,t,1),e,t,0,2297,2359,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Address1:</b> "),a.b(a.v(a.f("address1",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("address2",e,t,1),e,t,0,2398,2460,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Address2:</b> "),a.b(a.v(a.f("address2",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("city",e,t,1),e,t,0,2495,2549,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>City:</b> "),a.b(a.v(a.f("city",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("province",e,t,1),e,t,0,2584,2646,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Province:</b> "),a.b(a.v(a.f("province",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("country",e,t,1),e,t,0,2684,2744,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Country:</b> "),a.b(a.v(a.f("country",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("zip",e,t,1),e,t,0,2777,2829,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Zip:</b> "),a.b(a.v(a.f("zip",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("phone",e,t,1),e,t,0,2860,2916,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("            <p><b>Phone:</b> "),a.b(a.v(a.f("phone",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.b("          </div>"),a.b("\n"+n)}),e.pop()),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <div class="customer_order_history hide" style="">'),a.b("\n"+n),a.b("    <h4> Last Three Orders for "),a.b(a.v(a.f("full_name",e,t,0))),a.b(" </h4>"),a.b("\n"+n),a.s(a.f("orders",e,t,1),e,t,0,3119,4905,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="box">'),a.b("\n"+n),a.b('      <h4><a target="_blank" href="https://'),a.b(a.v(a.f("store",e,t,0))),a.b("/admin/orders/"),a.b(a.v(a.f("id",e,t,0))),a.b('"><b>Order #'),a.b(a.v(a.f("order_number",e,t,0))),a.b("</b></a></h4>"),a.b("\n"+n),a.b('      <div class="row">'),a.b("\n"+n),a.b('        <div class="col-md-6">'),a.b("\n"+n),a.b("          <p><b>Price:</b> "),a.b(a.v(a.f("total_price",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("          <p><b>Tax:</b> "),a.b(a.v(a.f("total_tax",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("          <p><b>Order Processed At:</b> "),a.b(a.v(a.f("processed_at",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="col-md-6">'),a.b("\n"+n),a.b("          <p><b>Processing Method:</b> "),a.b(a.v(a.f("processing_method",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("          <p><b>Financial Status:</b> "),a.b(a.v(a.f("financial_status",e,t,0))),a.b("</p>"),a.b("\n"+n),a.s(a.f("cancelled_at",e,t,1),e,t,0,3663,3790,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p><b>Cancelled At:</b>"),a.b(a.v(a.f("cancelled_at",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("          <p><b>Cancelled Reason:</b>"),a.b(a.v(a.f("cancelled_reason",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("note",e,t,1),e,t,0,3827,3877,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("          <p><b>Notes:</b>"),a.b(a.v(a.f("note",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="row">'),a.b("\n"+n),a.b('        <div class="col-sm-12">'),a.b("\n"+n),a.b('          <h4 style="margin-top: 10px;">Line Items</h4>'),a.b("\n"+n),a.s(a.f("line_items",e,t,1),e,t,0,4052,4846,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('          <div class="box">'),a.b("\n"+n),a.b('            <div class="row">'),a.b("\n"+n),a.b('              <div class="col-md-6">'),a.b("\n"+n),a.s(a.f("sku",e,t,1),e,t,0,4172,4232,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                <p><b>Sku:</b> "),a.b(a.v(a.f("sku",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.b("                <p><b>Title:</b> "),a.b(a.v(a.f("title",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Quantity:</b> "),a.b(a.v(a.f("quantity",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Requires Shipping:</b> "),a.b(a.v(a.f("requires_shipping",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b('              <div class="col-md-6">'),a.b("\n"+n),a.b("                <p><b>Price:</b> "),a.b(a.v(a.f("price",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Total Discount:</b> "),a.b(a.v(a.f("total_discount",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Fulfillment Status:</b> "),a.s(a.f("fulfillment_status",e,t,1),e,t,0,4651,4673,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("fulfillment_status",e,t,0)))}),e.pop()),a.s(a.f("fulfillment_status",e,t,1),e,t,1,0,0,"")||a.b("This item has not been fulfilled"),a.b("</p>"),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n)}),e.pop()),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("orders",e,t,1),e,t,1,0,0,"")||(a.b("      <p><b>This customer has not placed any orders.</b></p>"),a.b("\n"+n)),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("customers",e,t,1),e,t,1,0,0,"")||(a.s(a.f("search",e,t,1),e,t,0,5069,5145,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("  <p>No customers matching that name were found. Try another search.</p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("search",e,t,1),e,t,1,0,0,"")||(a.b("  <p>Not seeing what you need? Search for customers above.</p>"),a.b("\n"+n))),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/shopify_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>Shopify <small>customer history</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div class="search-filters" class="col-lg-12">'),a.b("\n"+n),a.b('    <div style="margin-bottom:10px">'),a.b("\n"+n),a.b('      <div style="position:relative;height:30px;width:100%;display:inline-block;max-width:500px">'),a.b("\n"+n),a.b('        <form class="shopify_search_form">'),a.b("\n"+n),a.b('          <input name="shop_q" type="text" class="text text-filter" placeholder="Search for Customers" style="border-radius:0;float:left;margin:0;width:calc(100% - 32px);height:30px;padding-right:25px;border-radius:0px"/>'),a.b("\n"+n),a.b('          <i class="clear-search font-remove-circle" style="position:absolute;top:9px;right:40px;cursor:pointer"></i>'),a.b("\n"+n),a.b('          <button type="submit" class="button callout search-now" style="float:right"><i class="font-search"></i></button>'),a.b("\n"+n),a.b("        </form>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <div class="shopify_search_results">'),a.b("\n"+n),a.b("    "),a.b(a.t(a.f("shopify_customer_data",e,t,0))),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">Close</a><br/>'),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/stripe_payment"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("/**"),a.b("\n"+n),a.b(" * The CSS shown here will not be introduced in the Quickstart guide, but shows"),a.b("\n"+n),a.b(" * how you can use CSS to style your Element's container."),a.b("\n"+n),a.b(" */"),a.b("\n"+n),a.b(".StripeElement {"),a.b("\n"+n),a.b("  background-color: white;"),a.b("\n"+n),a.b("  height: 40px;"),a.b("\n"+n),a.b("  padding: 10px 12px;"),a.b("\n"+n),a.b("  border-radius: 4px;"),a.b("\n"+n),a.b("  border: 1px solid transparent;"),a.b("\n"+n),a.b("  box-shadow: 0 1px 3px 0 #e6ebf1;"),a.b("\n"+n),a.b("  -webkit-transition: box-shadow 150ms ease;"),a.b("\n"+n),a.b("  transition: box-shadow 150ms ease;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b(".StripeElement--focus {"),a.b("\n"+n),a.b("  box-shadow: 0 1px 3px 0 #cfd7df;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b(".StripeElement--invalid {"),a.b("\n"+n),a.b("  border-color: #fa755a;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b(".StripeElement--webkit-autofill {"),a.b("\n"+n),a.b("  background-color: #fefde5 !important;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b("h4 {"),a.b("\n"+n),a.b("  padding-top: 10px;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".alert {"),a.b("\n"+n),a.b("  color: red;"),a.b("\n"+n),a.b("  font-size: .8em;"),a.b("\n"+n),a.b("  font-weight: 800;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".first-half {"),a.b("\n"+n),a.b("  padding: 0 15px 0 0;"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b(".second-half {"),a.b("\n"+n),a.b("  padding: 0;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b("label {"),a.b("\n"+n),a.b("  margin: 10px 0 -5px 0;"),a.b("\n"+n),a.b("}"),a.b("\n"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close action-cancel" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b("        <h3>Caller Payment <small class='pull-right'> Recording Stopped <i class=\"font-circle alert\"></i></small></h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body">'),a.b("\n"+n),a.b('        <div class="progress">'),a.b("\n"+n),a.b('          <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('            <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"),a.b("\n"+n),a.b('        <form method="post" id="payment-form" style="display:none;">'),a.b("\n"+n),a.b('            <label for="customer[email]">'),a.b("\n"+n),a.b("              Email Address"),a.b("\n"+n),a.b("            </label>"),a.b("\n"+n),a.b('            <input type="text" class="text full" id="customer-email" name="customer[email]" value="'),a.b(a.v(a.d("caller.email",e,t,0))),a.b('"/>'),a.b("\n"),a.b("\n"+n),a.b('            <div class="customer-information" style="display:none;">'),a.b("\n"+n),a.b('              <label for="customer[phone]">'),a.b("\n"+n),a.b("                Phone Number"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="customer-phone" name="customer[phone]" value="'),a.b(a.v(a.f("caller_number_format",e,t,0))),a.b('"/>'),a.b("\n"),a.b("\n"+n),a.b('              <label for="customer[name]">'),a.b("\n"+n),a.b("                Full Name"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="customer-name" name="customer[name]" value="'),a.b(a.v(a.d("caller.name",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("            "),a.b("\n"+n),a.b('              <label for="customer[line1]">'),a.b("\n"+n),a.b("                Street Address"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="customer-line1" name="customer[line1]" value="'),a.b(a.v(a.d("caller.address.steet",e,t,0))),a.b('"/>'),a.b("\n"),a.b("\n"+n),a.b('              <label for="customer[line2]">'),a.b("\n"+n),a.b("                Street Address (Cont.)"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="customer-line2" name="customer[line2]"/>'),a.b("\n"+n),a.b("              "),a.b("\n"+n),a.b('              <div class="col-md-6 first-half">'),a.b("\n"+n),a.b('                <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="customer[city]">'),a.b("\n"+n),a.b("                  City"),a.b("\n"+n),a.b("                </label>"),a.b("\n"+n),a.b('                <input type="text" class="text full" id="customer-city" name="customer[city]" value="'),a.b(a.v(a.d("caller.address.city",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"),a.b("\n"+n),a.b('              <div class="col-md-6 second-half">'),a.b("\n"+n),a.b('                <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="customer[state]">'),a.b("\n"+n),a.b("                  State"),a.b("\n"+n),a.b("                </label>"),a.b("\n"+n),a.b('                <input type="text" class="text full" id="customer-state" name="customer[state]" value="'),a.b(a.v(a.d("caller.address.state",e,t,0))),a.b('"/> '),a.b("\n"+n),a.b("              </div>"),a.b("\n"),a.b("\n"+n),a.b('              <div class="col-md-6 first-half">'),a.b("\n"+n),a.b('                <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="customer[zip]">'),a.b("\n"+n),a.b("                  Postal Code"),a.b("\n"+n),a.b("                </label>"),a.b("\n"+n),a.b('                <input type="text" class="text full" id="customer-zip" name="customer[zip]" value="'),a.b(a.v(a.d("caller.address.zip",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"),a.b("\n"+n),a.b('              <div class="col-md-6 second-half">'),a.b("\n"+n),a.b('                <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="customer[country]">'),a.b("\n"+n),a.b("                  Country"),a.b("\n"+n),a.b("                </label>"),a.b("\n"+n),a.b('                <input type="text" class="text full" id="customer-country" name="customer[country]" value="'),a.b(a.v(a.d("caller.address.country",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("            "),a.b("\n"+n),a.b('            <div class="col-md-6 first-half">'),a.b("\n"+n),a.b('              <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="amount">'),a.b("\n"+n),a.b('                Charge amount <span id="amount-error" class="alert"></span>'),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="amount" name="amount"/>'),a.b("\n"+n),a.b("            </div>"),a.b("\n"),a.b("\n"+n),a.b('            <div class="col-md-6 second-half">'),a.b("\n"+n),a.b('              <label style="clear:both; float:left; width:100%; padding-bottom: 2px" for="description">'),a.b("\n"+n),a.b("                Description"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),
a.b('              <input type="text" class="text full" id="description" name="description"/>'),a.b("\n"+n),a.b("            </div>"),a.b("\n"),a.b("\n"+n),a.b('            <label for="card-element">'),a.b("\n"+n),a.b("              Credit or debit card"),a.b("\n"+n),a.b("            </label>"),a.b("\n"+n),a.b("            "),a.b("\n"+n),a.b('            <div id="card-element">'),a.b("\n"+n),a.b("              <!-- A Stripe Element will be inserted here. -->"),a.b("\n"+n),a.b("            </div>"),a.b("\n"),a.b("\n"+n),a.b('            <label for="convert-activity">'),a.b("\n"+n),a.b("              Convert activity?"),a.b("\n"+n),a.b("            </label>"),a.b("\n"+n),a.b('            <input type="checkbox" id="convert-activity" checked name="convert-activity"/>'),a.b("\n"),a.b("\n"+n),a.b('            <div class="convert-amount">'),a.b("\n"+n),a.b('              <label for="conversion-amount">'),a.b("\n"+n),a.b("                Conversion amount:"),a.b("\n"+n),a.b("              </label>"),a.b("\n"+n),a.b('              <input type="text" class="text full" id="conversion-amount" checked name="conversion-amount"/>'),a.b("\n"+n),a.b("            </div>"),a.b("\n"),a.b("\n"+n),a.b("            <!-- Used to display form errors. -->"),a.b("\n"+n),a.b('            <div id="card-errors" role="alert"></div>'),a.b("\n"),a.b("\n"+n),a.b("        </form>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <button class="button pull-left" id="submit-button">Submit Payment</button>'),a.b("\n"+n),a.b('        <a class="button action-cancel" id="cancel-button">Cancel</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>  "),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("  //Get all the account stripe information from the database."),a.b("\n"+n),a.b('  $.get("/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b('/stripe_payments", function(d) {'),a.b("\n"+n),a.b("    prepareStripe(d.stripe_publishable_key, function() {"),a.b("\n"+n),a.b('      if ((d.require_customer_data) && ("'),a.b(a.v(a.f("caller",e,t,0))),a.b('" == "")) {'),a.b("\n"+n),a.b('        $.get("/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('.json", function(call) {'),a.b("\n"+n),a.b("          if (call.caller) {"),a.b("\n"+n),a.b("            var caller = call.caller;"),a.b("\n"+n),a.b("            $('#customer-email').val(caller.email);"),a.b("\n"+n),a.b("            $('#customer-name').val(caller.name);"),a.b("\n"+n),a.b("            $('#customer-line1').val(caller.address.street);"),a.b("\n"+n),a.b("            $('#customer-city').val(caller.address.city);"),a.b("\n"+n),a.b("            $('#customer-state').val(caller.address.state);"),a.b("\n"+n),a.b("            $('#customer-zip').val(caller.address.postal_code);"),a.b("\n"+n),a.b("            $('#customer-country').val(caller.address.country);"),a.b("\n"+n),a.b("            showPaymentForm();"),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("        }).fail(function(err) {"),a.b("\n"+n),a.b("          $('.progress').hide();"),a.b("\n"+n),a.b('          $("#payment-form").html("Error loading.  Please try again");'),a.b("\n"+n),a.b("        });"),a.b("\n"+n),a.b("      } else {"),a.b("\n"+n),a.b("        showPaymentForm();"),a.b("\n"+n),a.b("      }"),a.b("\n"),a.b("\n"+n),a.b("      $('#amount').val(d.default_amount)"),a.b("\n"+n),a.b("      $('#conversion-amount').val(d.default_amount)"),a.b("\n"+n),a.b("      $('#description').val(d.default_description)"),a.b("\n"+n),a.b("      if (d.require_customer_data) {"),a.b("\n"+n),a.b("        $('.customer-information').show();"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b('      if ("'),a.b(a.v(a.f("caller",e,t,0))),a.b('" != "") {'),a.b("\n"+n),a.b("        showPaymentForm();"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    })"),a.b("\n"+n),a.b("  }).fail(function(d) {"),a.b("\n"+n),a.b("    $('.progress').hide();"),a.b("\n"+n),a.b('    $("#payment-form").html("Error loading.  Please try again");'),a.b("\n"+n),a.b("    console.log(d)"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  function showPaymentForm() {"),a.b("\n"+n),a.b("    $('#payment-form').show(250, function() {"),a.b("\n"+n),a.b("      $('.progress').hide();"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function prepareStripe(stripeToken, callback) {"),a.b("\n"),a.b("\n"+n),a.b("    var stripe = Stripe(stripeToken);"),a.b("\n"+n),a.b("    // Create an instance of Elements."),a.b("\n"+n),a.b("    var elements = stripe.elements();"),a.b("\n"),a.b("\n"+n),a.b("    var style = {"),a.b("\n"+n),a.b("      base: {"),a.b("\n"+n),a.b("        color: '#32325d',"),a.b("\n"+n),a.b("        fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',"),a.b("\n"+n),a.b("        fontSmoothing: 'antialiased',"),a.b("\n"+n),a.b("        fontSize: '16px',"),a.b("\n"+n),a.b("        '::placeholder': {"),a.b("\n"+n),a.b("          color: '#aab7c4'"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      },"),a.b("\n"+n),a.b("      invalid: {"),a.b("\n"+n),a.b("        color: '#fa755a',"),a.b("\n"+n),a.b("        iconColor: '#fa755a'"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    };"),a.b("\n"),a.b("\n"+n),a.b("    // Create an instance of the card Element."),a.b("\n"+n),a.b("    var card = elements.create('card', {style: style});"),a.b("\n"),a.b("\n"+n),a.b("    // Add an instance of the card Element into the `card-element` <div>."),a.b("\n"+n),a.b("    card.mount('#card-element');"),a.b("\n"),a.b("\n"+n),a.b("    // Handle real-time validation errors from the card Element."),a.b("\n"+n),a.b("    card.addEventListener('change', function(event) {"),a.b("\n"+n),a.b("      var displayError = document.getElementById('card-errors');"),a.b("\n"+n),a.b("      if (event.error) {"),a.b("\n"+n),a.b("        displayError.textContent = event.error.message;"),a.b("\n"+n),a.b("      } else {"),a.b("\n"+n),a.b("        displayError.textContent = '';"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"),a.b("\n"+n),a.b("    // Handle form submission."),a.b("\n"+n),a.b("    $('.action-cancel').click(restartRecording);"),a.b("\n"),a.b("\n"+n),a.b("    var submitButton = document.getElementById('submit-button');"),a.b("\n"+n),a.b("    submitButton.addEventListener('click', function(event) { event.preventDefault();"),a.b("\n"),a.b("\n"+n),a.b("      if ($('#amount').val() == '') {"),a.b("\n"+n),a.b('        console.log("amount can\'t be empty");'),a.b("\n"+n),a.b('        $("#amount-error").html("Amount can\'t be empty.");'),a.b("\n"+n),a.b("        return;"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      $('.progress').show(250, function() {"),a.b("\n"+n),a.b("        $('#payment-form').hide();"),a.b("\n"+n),a.b("      });"),a.b("\n"),a.b("\n"+n),a.b("      stripe.createToken(card).then(function(result) {"),a.b("\n"+n),a.b("        if (result.error) {"),a.b("\n"+n),a.b("          // Inform the user if there was an error."),a.b("\n"+n),a.b("          var errorElement = document.getElementById('card-errors');"),a.b("\n"+n),a.b("          errorElement.textContent = result.error.message;"),a.b("\n"+n),a.b("        } else {"),a.b("\n"+n),a.b("          // Send the token to your server."),a.b("\n"+n),a.b("          stripeTokenHandler(result.token);"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b("    });"),a.b("\n"),a.b("\n"+n),a.b("    callback();"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function stripeTokenHandler(token) {"),a.b("\n"+n),a.b("    var form = document.getElementById('payment-form');"),a.b("\n"+n),a.b("    var hiddenInput = document.createElement('input');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('type', 'hidden');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('name', 'stripeToken');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('value', token.id);"),a.b("\n"+n),a.b("    form.appendChild(hiddenInput);"),a.b("\n"),a.b("\n"+n),a.b("    hiddenInput = document.createElement('input');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('type', 'hidden');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('name', 'call_id');"),a.b("\n"+n),a.b("    hiddenInput.setAttribute('value', "),a.b(a.v(a.f("id",e,t,0))),a.b(");"),a.b("\n"+n),a.b("    form.appendChild(hiddenInput);"),a.b("\n"),a.b("\n"+n),a.b("    submitPayment()"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function submitPayment() {"),a.b("\n"+n),a.b('    var url = "/stripe/charge";'),a.b("\n"),a.b("\n"+n),a.b("    $.ajax({"),a.b("\n"+n),a.b('      type: "POST",'),a.b("\n"+n),a.b("      url: url,"),a.b("\n"+n),a.b('      data: $("#payment-form").serialize(),'),a.b("\n"+n),a.b("      success: function(d) {"),a.b("\n"+n),a.b('        console.log("sent charge restartRecording");'),a.b("\n"+n),a.b("        restartRecording();"),a.b("\n"+n),a.b('        if ($("#convert-activity").is(":checked")) {'),a.b("\n"+n),a.b("          scoreCall();"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("        $('#modal-frame .modal').modal(\"hide\");"),a.b("\n"+n),a.b("      },"),a.b("\n"+n),a.b("      failure: function(d) {"),a.b("\n"+n),a.b("        $('#payment-form').show(250, function() {"),a.b("\n"+n),a.b("          $('.progress').hide();"),a.b("\n"+n),a.b("        });"),a.b("\n"+n),a.b("        var errorElement = document.getElementById('card-errors');"),a.b("\n"+n),a.b("        errorElement.textContent = d;"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  function restartRecording() {"),a.b("\n"+n),a.b('    console.log("restartRecording");'),a.b("\n"+n),a.b('    if ("'),a.b(a.v(a.f("call_status",e,t,0))),a.b('" == "in progress") {'),a.b("\n"+n),a.b('      $.get("/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/allows_recording", function(res) {'),a.b("\n"+n),a.b("        if (res.allowed) {"),a.b("\n"+n),a.b('          $.post("/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/recording_start").fail(function(d) {'),a.b("\n"+n),a.b('            console.log("An error occurred when restarting recording: "+d);'),a.b("\n"+n),a.b("          });"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function scoreCall() {"),a.b("\n"+n),a.b("    var scoreData = {"),a.b("\n"+n),a.b('      "id": '),a.b(a.v(a.f("id",e,t,0))),a.b(","),a.b("\n"+n),a.b('      "conversion": "1",'),a.b("\n"+n),a.b("      \"value\": $('#conversion-amount').val()"),a.b("\n"+n),a.b("    };"),a.b("\n"+n),a.b("    $.ajax({"),a.b("\n"+n),a.b('      type: "POST",'),a.b("\n"+n),a.b('      url: "/api/v1/accounts/'),a.b(a.v(a.f("account_id",e,t,0))),a.b("/calls/"),a.b(a.v(a.f("id",e,t,0))),a.b('/sale",'),a.b("\n"+n),a.b("      data: scoreData,"),a.b("\n"+n),a.b("      success: function(d) {"),a.b("\n"+n),a.b('        console.log("Scored")'),a.b("\n"+n),a.b("      },"),a.b("\n"+n),a.b("      failure: function(d) {"),a.b("\n"+n),a.b("        console.log(d)"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  $('#convert-activity').on('click', function() {"),a.b("\n"+n),a.b("    $('.convert-amount').toggle();"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('#amount').change(function() {"),a.b("\n"+n),a.b("    console.log($(this).val());"),a.b("\n"+n),a.b("    $('#conversion-amount').val($(this).val());"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/text_message"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.text_message.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.text_message.hint",e,t,0))),a.b("</small> <!--<small class='call-id'>Message ID: <span title=\""),a.b(a.v(a.f("id",e,t,0))),a.b('"><i class="font-search"></i><i class="font-caret-down"></i></span></small>--></h3>'),a.b("\n"+n),a.b('  <div class="clear"></div>'),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('<div class="messages">'),a.b("\n"+n),a.b('<form class="new-message" id="message">'),a.b("\n"+n),a.b('  <div class="message-load-more"><a><i class="font-refresh"></i> '),a.b(a.v(a.d("Call.actions.load_more.label",e,t,0))),a.b("</a></div>"),a.b("\n"),a.b("\n"+n),a.b('  <div class="message-thread">'),a.b("\n"+n),a.s(a.f("thread",e,t,1),e,t,0,517,554,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.rp("<text_message_thread0",e,t,"      "))}),e.pop()),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <h3 class="from-to-number-picker"><span class="hidden-xs" style="vertical-align:middle">'),a.b(a.v(a.d("user.first_name",e,t,0))),a.b(" "),a.b(a.v(a.d("user.last_name",e,t,0))),a.b(' </span><small style="display:inline-block;vertical-align:top;margin-top:-3px"><span style="display:inline-block;vertical-align:top"><input type="text" id="message_from_number" name="message[from_number]" value="'),a.b(a.v(a.f("tracking_number_sid",e,t,0))),a.b('" style="width:150px"/></span> <span class="to_number" '),a.s(a.f("to",e,t,1),e,t,0,1001,1021,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('style="display:none"')}),e.pop()),a.b('><i class="font-arrow-right" style="display:inline-block;vertical-align:top;padding:9px 3px"></i>'),a.b("\n"+n),a.b('    <span style="display:inline-block;vertical-align:top"><input type="tel" id="message_to_number" name="message[to_number]" value="'),a.b(a.v(a.f("to",e,t,0))),a.b('" class="phone text" placeholder="Recipient" style="display:inline-block;width:220px;font-size:100%"/></span></span>'),a.b("\n"+n),a.b("    </small></h3>"),a.b("\n"+n),a.b('  <div class="new-msg-input">'),a.b("\n"+n),a.b('    <input type="hidden" class="message-parent" name="message[parent_id]" value="'),a.b(a.v(a.f("id",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b('    <div class="message-send-progress" style="display:none"><span class="button-background"></span></div>'),a.b("\n"),a.b("\n"+n),a.b('  \t<div class="textfield">'),a.b("\n"+n),a.b('\t\t\t<label for="message_body" style="display:none">&nbsp;</label>'),a.b("\n"+n),a.b('\t\t\t<div class="message-compose">'),a.b("\n"+n),a.b('      <textarea class="text string message_body" maxlength="160" id="message_body" name="message[body]" placeholder="'),a.b(a.v(a.d("Call.panels.text_message.extra.type_message_here",e,t,0))),a.b('"></textarea>'),a.b("\n"+n),a.b('      <input type="text" class="responses-picker" style="display:none"/>'),a.b("\n"+n),a.b('      <a class="save-new-button button minimal" title="'),a.b(a.v(a.d("Call.actions.send_message.label",e,t,0))),a.b('"><i class="font-reply"></i></a>'),a.b("\n"+n),a.b('      <a class="file-attachment-toggle" title="'),a.b(a.v(a.d("Call.actions.add_attachment.label",e,t,0))),a.b('"><i class="font-caret-right"></i><i class="font-attachment"></i></a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('\t\t\t<span class="hint">&nbsp;160 characters left</span>'),a.b("\n"+n),a.b('      <div class="clear-break"></div>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="file-attachment-container" style="display:none;margin-top:15px">'),a.b("\n"+n),a.b('      <input accept="image/jpeg,image/png,image/gif,text/x-vcard,text/vcard,text/directory" class="message_upload" id="message_upload" name="message[upload]" type="file">'),a.b("\n"+n),a.b('      <span class="hint"><br>'),a.b(a.v(a.d("Call.panels.text_message.extra.accepted_formats",e,t,0))),a.b("<br>"),a.b(a.v(a.d("Call.panels.text_message.extra.max_file_size",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b("</form>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{"<text_message_thread0":{"name":"text_message_thread","partials":{},"subs":{}}},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/yes_no_modal"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="modal fade">'),a.b("\n"+n),a.b('  <div class="modal-dialog">'),a.b("\n"+n),a.b('    <div class="modal-content">'),a.b("\n"+n),a.b('      <div class="modal-header">'),a.b("\n"+n),a.b('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),a.b("\n"+n),a.b("        <h3>"),a.b(a.t(a.f("header",e,t,0))),a.b("</h3>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-body" style="max-height:400px">'),a.b("\n"+n),a.b("        <p>"),a.b(a.t(a.f("message",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="modal-footer">'),a.b("\n"+n),a.b('        <a href="#" class="button activebutton action-no">No</a>'),a.b("\n"+n),a.b('        <a href="#" class="button callout action-yes">Yes</a>'),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/zendesk"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>Zendesk <small>ticket information</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <div class="search-filters" class="col-lg-12">'),a.b("\n"+n),a.b('    <div style="margin-bottom:10px">'),a.b("\n"+n),a.b('      <div style="position:relative;height:30px;width:100%;display:inline-block;max-width:500px">'),a.b("\n"+n),a.b('        <form class="zendesk_search">'),a.b("\n"+n),a.b('          <select name="z_o" class="zendesk-search-options">'),a.b("\n"+n),a.b('            <option value="c" selected>Customer Name</option>'),a.b("\n"+n),a.b('            <option value="t">Ticket Subject</option>'),a.b("\n"+n),a.b("          </select>"),a.b("\n"+n),a.b('            <input name="z_q" type="text" class="text text-filter" placeholder="Search for Tickets or Customers" style="border-radius:0;float:left;margin:0;width:calc(100% - 32px);height:30px;padding-right:25px;border-radius:0px"/>'),a.b("\n"+n),a.b('            <i class="clear-search font-remove-circle" style="position:absolute;top:38px;right:40px;cursor:pointer"></i>'),a.b("\n"+n),a.b('            <button type="submit" class="button callout search-now" style="float:right"><i class="font-search"></i></button>'),a.b("\n"+n),a.b("        </form>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"),a.b("\n"+n),a.b('  <div class="zd_results" style="height:300px; overflow-y:scroll; margin-top: 40px;">'),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">Close</a><br/>'),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/zendesk_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b('<div class="field">'),a.b("\n"+n),a.b("<style>"),a.b("\n"+n),a.b("  #contact_information {"),a.b("\n"+n),a.b("    height: auto;"),a.b("\n"+n),a.b("    overflow: auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.zoho_field {"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.zoho_field>label{"),a.b("\n"+n),a.b("    margin-right: 5px;"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.zoho_field>input {"),a.b("\n"+n),a.b("    margin-right: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_selecter, #contact_selecter>label  {"),a.b("\n"+n),a.b("    display: inline;"),a.b("\n"+n),a.b("    visibility: hidden;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .progress {"),a.b("\n"+n),a.b("    margin: 50px auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .search_string {"),a.b("\n"+n),a.b("    width: 50%;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .search_ticket {"),a.b("\n"+n),a.b("    padding: 0 15px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  label.search_form_label {"),a.b("\n"+n),a.b("    padding-top: 10px 0;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .search_form > .search_button {"),a.b("\n"+n),a.b("    margin-top: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .search_form, .search_results {"),a.b("\n"+n),a.b("    padding: 10px 0;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .ticket_input {"),a.b("\n"+n),a.b("    width: 100%;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .ticket_field {"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("    min-height: 75px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .ticket-card > .tab-title {"),a.b("\n"+n),a.b("    padding: 0;"),a.b("\n"+n),a.b("    margin: 0;"),a.b("\n"+n),a.b("    margin-bottom: 20px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .form-actions {"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("    padding-bottom: 40px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .create_ticket_form > .mapping_row {"),a.b("\n"+n),a.b("    height: 50px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .create_ticket_form > .mapping_row > .col-md-9 > .col-md-12 > input {"),a.b("\n"+n),a.b("    width: 100%;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  table.search_results_table > tbody > tr {"),a.b("\n"+n),a.b("    display: table-row !important;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  footer.close_zendesk {"),a.b("\n"+n),a.b("    display: none;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b('  body[data-status="wrapup"] footer.close_zendesk {'),a.b("\n"+n),a.b("    display: block;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.zendesk_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.zendesk_panel.hint",e,t,0))),a.b("</small> <small class='call-id'>"),a.b(a.v(a.d("Call.extra.call_id",e,t,0))),a.b(": "),a.b(a.v(a.d("call.id",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('  <div class="card ticket-card">'),a.b("\n"+n),a.b('  <div class="tab-title">'),a.b("\n"+n),a.b('    <div class="title tab-selector selected" data-section="search_ticket">'),a.b("\n"+n),a.b("      Search Ticket"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <div class="title tab-selector" data-section="create_ticket">'),a.b("\n"+n),a.b("      Create Ticket"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('    <div class="tab-body">'),a.b("\n"+n),a.b('      <div class="body search_ticket">'),a.b("\n"+n),a.b('        <div class="search_form">'),a.b("\n"+n),a.b('          <label class="search_form_label" for="search_string">Query: </label>'),a.b("\n"+n),a.b('          <input type="text" name="search_string" class="text search_string"/>'),a.b("\n"+n),a.b('          <label class="search_form_label" for="ticket_choice">Ticket Statuses: </label>'),a.b("\n"+n),a.b('          <div class="search_status"></div>'),a.b("\n"+n),a.b('          <button class="search_button button callout">Search</button>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="search_results">'),a.b("\n"+n),a.b('          <table class="search_results_table">'),a.b("\n"+n),a.b("            <tr>"),a.b("\n"+n),a.b("              <th>Status</th>"),a.b("\n"+n),a.b("              <th>Title</th>"),a.b("\n"+n),a.b("              <th>Created At</th>"),a.b("\n"+n),a.b("              <th>Updated At</th>"),a.b("\n"+n),a.b("              <th>View Ticket</th>"),a.b("\n"+n),a.b("            </tr>"),a.b("\n"+n),a.b("          </table>"),a.b("\n"+n),a.b('            <div id="zendesk-search-progress" class="progress" style="display:none;">'),a.b("\n"+n),a.b('              <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('                <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("              </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="body view_ticket" style="display:none;">'),a.b("\n"+n),a.b("        View"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b('      <div class="body create_ticket" style="display:none;">'),a.b("\n"+n),a.b('        <a class="font-refresh refresh-form"> Reload Form</a>'),a.b("\n"+n),a.b('        <div class="create_ticket_form">'),a.b("\n"+n),a.b('          <div class="inputs"></div>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div class="clear"></div>'),a.b("\n"+n),a.b('        <footer class="form-actions">'),a.b("\n"+n),a.b('          <div class="col-md-12">'),a.b("\n"+n),a.b('            <button class="create_button button callout">Create Ticket <i class="font-spinner-2 icon-loop-repeat create-spinner" style="display: none;"></i></button>'),a.b("\n"+n),a.b('            <a href="" class="view_ticket_link" target="_blank" style="display:none;"><button class="view_button button callout">View Ticket</button></a>'),a.b("\n"+n),a.b("          </div>"),a.b("\n"+n),a.b("        </footer>"),a.b("\n"+n),a.b("      </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b('    <footer class="close_zendesk">'),a.b("\n"+n),a.b('      <button class="close_zendesk_button button callout">Close</button>'),a.b("\n"+n),a.b("    </footer>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"+n),a.b('<div class="initial_ticket_data" style="display:none;"></div>'),a.b("\n"),a.b("\n"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b("  $('.tab-selector').on('click', function() {"),a.b("\n"+n),a.b("    //Switch which tab is focused"),a.b("\n"+n),a.b("    $('.tab-selector').removeClass('selected');"),a.b("\n"+n),a.b("    $(this).addClass('selected');"),a.b("\n"),a.b("\n"+n),a.b("    //Switch which tab contents are visible"),a.b("\n"+n),a.b("    var section = $(this).data('section');"),a.b("\n"+n),a.b('    $(".body").hide();'),a.b("\n"+n),a.b('    $("."+section).show();'),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('.create_button').on('click', function() {"),a.b("\n"+n),a.b("    data = {};"),a.b("\n"+n),a.b("    var custom_data = [];"),a.b("\n"+n),a.b('    $(\'.create_button\').attr("disabled","disabled");'),a.b("\n"+n),a.b("    $('.create-spinner').show();"),a.b("\n"+n),a.b('    $(".mapping_row.field_row").each(function() {'),a.b("\n"+n),a.b("      var map_value = '';"),a.b("\n"+n),a.b("      var mapped = false;"),a.b("\n"+n),a.b('      var key = $(this).find(".zendesk_raw_title").val().toLowerCase();'),a.b("\n"+n),a.b('      if ($(this).find(":checkbox").length == 1) {'),a.b("\n"+n),a.b('        data[key] = $(this).find(":checkbox").is(":checked");'),a.b("\n"+n),a.b("        mapped = true;"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b('      map_value = $(this).find(".ctm_options :selected").val();'),a.b("\n"+n),a.b('      if (map_value == null || map_value == "") {'),a.b("\n"+n),a.b('        map_value = $(this).find(".ctm_options").val();'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      if (map_value != '' && mapped == false) {"),a.b("\n"+n),a.b("        data[key] = map_value;"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"),a.b("\n"+n),a.b("    $.post('/integrations/zendesk/create_ticket', {ticket_data: data, call_id: "),a.b(a.v(a.d("call.id",e,t,0))),a.b("}, function(res) {"),a.b("\n"+n),a.b("      $('.create_button').removeAttr(\"disabled\");"),a.b("\n"+n),a.b("      $('.create-spinner').hide();"),a.b("\n"),a.b("\n"+n),a.b('      if (res["created"] == true) {'),a.b("\n"+n),a.b('        ctmFlash("Ticket Created Successfully")'),a.b("\n"+n),a.b("        $('.create_button').hide();"),a.b("\n"+n),a.b("        $('.create_ticket_form').hide();"),a.b("\n"+n),a.b("        $('.view_ticket_link').attr(\"href\", 'https://"),a.b(a.v(a.f("api_domain",e,t,0))),a.b('.zendesk.com/tickets/\'+ JSON.parse(res["response"])["ticket"]["id"]);'),a.b("\n"+n),a.b("        $('.view_ticket_link').show();"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      else {"),a.b("\n"+n),a.b('        ctmFlash("Unable to create ticket.")'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b('    }, "json");'),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('.search_string').keypress(function(event){"),a.b("\n"+n),a.b("    var keycode = (event.keyCode ? event.keyCode : event.which);"),a.b("\n"+n),a.b("    if(keycode == '13'){"),a.b("\n"+n),a.b("      search();"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  $('.search_button').on('click', function() {"),a.b("\n"+n),a.b("    search();"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  function search() {"),a.b("\n"+n),a.b("    $('#zendesk-search-progress').show();"),a.b("\n"+n),a.b("    var data = {}"),a.b("\n"+n),a.b("    data.search_ticket_status = $('.ticket_choice').select2(\"val\");"),a.b("\n"+n),a.b("    data.search_string = $('.search_string').val();"),a.b("\n"+n),a.b("    $('.ticket_row').remove();"),a.b("\n"),a.b("\n"+n),a.b("    $.post('/integrations/zendesk/search_tickets', data, function(res) {"),a.b("\n"+n),a.b("      res.forEach(function(ticket) {"),a.b("\n"+n),a.b('        var created_at = new Date(ticket["created_at"]);'),a.b("\n"+n),a.b('        var updated_at = new Date(ticket["updated_at"]);'),a.b("\n"+n),a.b("        var date_options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };"),a.b("\n"),a.b("\n"+n),a.b('        var ticket_data = \'<tr class="ticket_row" data-ticket-id="\'+ escapeHtml(ticket["id"]) +\'">\' +'),a.b("\n"+n),a.b("                            '<td>'+ escapeHtml(ticket[\"status\"].charAt(0).toUpperCase() + ticket[\"status\"].slice(1)) +'</td>' +"),a.b("\n"+n),a.b("                            '<td>'+ escapeHtml(ticket[\"subject\"]) +'</td>' +"),a.b("\n"+n),a.b("                            '<td>'+ escapeHtml(created_at.toLocaleDateString(\"en-US\", date_options)) +'</td>' +"),a.b("\n"+n),a.b("                            '<td>'+ escapeHtml(updated_at.toLocaleDateString(\"en-US\", date_options)) +'</td>' +"),a.b("\n"+n),a.b("                            '<td><a href=\"https://"),a.b(a.v(a.f("api_domain",e,t,0))),a.b('.zendesk.com/tickets/\'+ escapeHtml(ticket["id"]) +\'" target="_blank">View</a></td>\' +'),a.b("\n"+n),a.b("                           '</tr>';"),a.b("\n"+n),a.b("        $('table.search_results_table').append(ticket_data);"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b("      $('#zendesk-search-progress').hide();"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function prepareTicketMetadata() {"),a.b("\n"+n),a.b('    $.get("/integrations/zendesk/ticket_metadata", function(data) {'),a.b("\n"+n),a.b("      var options;"),a.b("\n"+n),a.b("      var mapping_options;"),a.b("\n"+n),a.b('      var defaultFields = ["id", "url", "external_id", "type", "subject", "raw_subject", "description", "priority", "status", "recipient",'),a.b("\n"+n),a.b('                           "requester_id", "submitter_id", "assignee_id", "organization_id", "group_id", "collaborator_ids",'),a.b("\n"+n),a.b('                           "collaborators", "email_cc_ids", "follower_ids", "forum_topic_id", "problem_id", "has_incidents",'),a.b("\n"+n),a.b('                           "due_at", "tags", "via", "satisfaction_rating", "sharing_agreement_ids", "followup_ids", "via_followup_source_id",'),a.b("\n"+n),a.b('                           "macro_ids", "ticket_form_id", "brand_id", "allow_channelback", "allow_attachments", "is_public", "created_at",'),a.b("\n"+n),a.b('                           "updated_at"];'),a.b("\n"+n),a.b("      data.forEach(function(field) {"),a.b("\n"+n),a.b("        var field_title = escapeHtml(field['id']);"),a.b("\n"+n),a.b("        if (defaultFields.includes(field['raw_title'].toLowerCase())) {"),a.b("\n"+n),a.b("          field_title = escapeHtml(field['raw_title']);"),a.b("\n"+n),a.b("        }"),a.b("\n"),a.b("\n"+n),a.b('        if (field["system_field_options"] || field["custom_field_options"]) {'),a.b("\n"+n),a.b('          var value = ""'),a.b("\n"+n),a.b('          mapping_options = "<option></option>";'),a.b("\n"+n),a.b('          if (field["system_field_options"]) {'),a.b("\n"+n),a.b('            field["system_field_options"].forEach(function(option) {'),a.b("\n"+n),
a.b('              mapping_options += "<option value=\'"+option["value"]+"\'>"+escapeHtml(option["name"])+"</option>";'),a.b("\n"+n),a.b("            });"),a.b("\n"+n),a.b("          } else {"),a.b("\n"+n),a.b('            field["custom_field_options"].forEach(function(option) {'),a.b("\n"+n),a.b('              mapping_options += "<option value=\'"+option["value"]+"\'>"+escapeHtml(option["name"])+"</option>";'),a.b("\n"+n),a.b("            });"),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b('        if (field["type"] != "checkbox") {'),a.b("\n"+n),a.b('          options = "";'),a.b("\n"+n),a.b('          if (!field["system_field_options"] && !field["custom_field_options"]) {'),a.b("\n"+n),a.b('            options += \'<div class="col-md-12"><input type="text" class=" text field_\' + field_title + \' ctm_options"/>\' +'),a.b("\n"+n),a.b('                       \'<span class="hint" style="margin-top:2px">\' +'),a.b("\n"+n),a.b("                       '</span></div>';"),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("          else {"),a.b("\n"+n),a.b("            options += '<div class=\"col-md-12\"><select class=\"field_' + field_title + ' ctm_options ctm_field_map\">' + mapping_options + '</select></div>'"),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("        } else {"),a.b("\n"+n),a.b('          options = \'<div class="col-md-12"><input type="checkbox" class="field_\' + field_title + \' ctm_options"/></div>\''),a.b("\n"+n),a.b("        }"),a.b("\n"),a.b("\n"+n),a.b("        var selected_value = (field['ctm_field'] != null) ? field['ctm_field'] : \"\""),a.b("\n"+n),a.b("        var mapping_row = '<tr class=\"mapping_row field_row\">'+"),a.b("\n"+n),a.b('                        \'<td class="col-md-2" style="text-align: right">\'+'),a.b("\n"+n),a.b("                          '<span class=\"zendesk_field_title\">' + escapeHtml(field['title']) + '</span>';"),a.b("\n"+n),a.b("        if (defaultFields.includes(field['raw_title'].toLowerCase())) {"),a.b("\n"+n),a.b('          mapping_row += \'<input type="hidden" name="zendesk_raw_title" class="zendesk_raw_title" value="\' + field_title + \'"/>\';'),a.b("\n"+n),a.b("        } else {"),a.b("\n"+n),a.b('          mapping_row += \'<input type="hidden" name="zendesk_raw_title" class="zendesk_raw_title" value="\' + escapeHtml(field[\'id\']) + \'"/>\';'),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("        mapping_row +=  '</td>'+"),a.b("\n"+n),a.b("                        '<td class=\"col-md-9\">'+"),a.b("\n"+n),a.b("                          options"),a.b("\n"+n),a.b("                        '</td>'+"),a.b("\n"+n),a.b("                      '</tr>';"),a.b("\n"+n),a.b("        $('.create_ticket_form').append(mapping_row);"),a.b("\n"+n),a.b("      });"),a.b("\n"),a.b("\n"+n),a.b('      $(".progress").hide();'),a.b("\n"),a.b("\n"+n),a.b('      $(".ctm_field_map").each(function() {'),a.b("\n"+n),a.b('        if ((!$(this).hasClass("select2-hidden-accessible")) && (!$(this).hasClass("text"))) {'),a.b("\n"+n),a.b('          $(this).select2({placeholder: "", width: "100%"});'),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      })"),a.b("\n"),a.b("\n"+n),a.b("      $.get(`/integrations/zendesk/panel_mapping/"),a.b(a.v(a.d("call.id",e,t,0))),a.b("`, function (data) {"),a.b("\n"+n),a.b("        var atLeastOneShown = false;"),a.b("\n"+n),a.b("        if (data.length !== 0) {"),a.b("\n"+n),a.b("          $('.mapping_row').hide();"),a.b("\n"+n),a.b('          data["mapping_items"].forEach(function(field) {'),a.b("\n"+n),a.b("            if (field !== null) {"),a.b("\n"+n),a.b("              var el = $('.create_ticket_form').find('.field_'+field['zendesk_field_title'].split(' ')[0]);"),a.b("\n"+n),a.b("              var has_option = false;"),a.b("\n"+n),a.b("              el.find('option').each(function() {"),a.b("\n"+n),a.b("                if (this.value == field['ctm_field']) {"),a.b("\n"+n),a.b("                  has_option = true;"),a.b("\n"+n),a.b("                }"),a.b("\n"+n),a.b("              });"),a.b("\n"+n),a.b("              if (el.is(':checkbox')) {"),a.b("\n"+n),a.b("                if (field['ctm_field'] == \"true\") {"),a.b("\n"+n),a.b("                  el.prop('checked',true);"),a.b("\n"+n),a.b("                }"),a.b("\n"+n),a.b("              } else if (!has_option) {"),a.b("\n"+n),a.b("                el.val(field['ctm_field']);"),a.b("\n"+n),a.b("              } else {"),a.b("\n"+n),a.b("                el.val(field['ctm_field']).trigger('change');"),a.b("\n"+n),a.b("              }"),a.b("\n"+n),a.b("              if (field.visible == true) {"),a.b("\n"+n),a.b("                atLeastOneShown = true"),a.b("\n"+n),a.b("                el.parent().parent().parent().show();"),a.b("\n"+n),a.b("              }"),a.b("\n"+n),a.b("            }"),a.b("\n"+n),a.b("          });"),a.b("\n"+n),a.b("          if (!atLeastOneShown) {"),a.b("\n"+n),a.b("            $('.mapping_row').show();"),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b("    }).fail(function() {"),a.b("\n"+n),a.b('      bootbox.alert("Error accessing your Zendesk account.  Please check the integration logs to see why.");'),a.b("\n"+n),a.b("    });"),a.b("\n"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  $('.refresh-form').on('click',function(e) { e.preventDefault();"),a.b("\n"+n),a.b("    $('.create_ticket_form').empty();"),a.b("\n"+n),a.b("    prepareTicketMetadata();"),a.b("\n"+n),a.b("  })"),a.b("\n"),a.b("\n"+n),a.b("  prepareTicketMetadata();"),a.b("\n"),a.b("\n"),a.b("\n"+n),a.b("})();"),a.b("\n"),a.b("\n"+n),a.b("function textCounter(textarea, max) {"),a.b("\n"+n),a.b("  characters = textarea.value.length"),a.b("\n"+n),a.b("  $('.characters_remaining').html(characters + \"/\" + max);"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/zendesk_search_results_tickets"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("tickets",e,t,1),e,t,0,14,776,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="panel">'),a.b("\n"+n),a.b('        <div class="box">'),a.b("\n"+n),a.b('            <h4><a target="_blank" href="https://'),a.b(a.v(a.f("subdomain",e,t,0))),a.b("/agent/tickets/"),a.b(a.v(a.f("id",e,t,0))),a.b('"><b>Ticket #'),a.b(a.v(a.f("id",e,t,0))),a.b(":"),a.b(a.v(a.f("subject",e,t,0))),a.b("</b></a></h4>"),a.b("\n"+n),a.b('            <div class="row">'),a.b("\n"+n),a.b('                <div class="col-md-6">'),a.b("\n"+n),a.b("                <p><b>Priority:</b> "),a.b(a.v(a.f("priority",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Type:</b> "),a.b(a.v(a.f("type",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Created Via:</b> "),a.b(a.v(a.d("via.channel",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Created At:</b> "),a.b(a.v(a.f("created_at",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                </div>"),a.b("\n"+n),a.b('                <div class="col-md-6">'),a.b("\n"+n),a.b("                <p><b>Description:</b> "),a.b(a.v(a.f("description",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Status:</b> "),a.b(a.v(a.f("status",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                <p><b>Has Incidents:</b>"),a.b(a.v(a.f("has_incidents",e,t,0))),a.b("</p>"),a.b("\n"+n),a.b("                </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("tickets",e,t,1),e,t,1,0,0,"")||(a.b("    No Zendesk tickets were found matching this query. Please try another search."),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/zendesk_search_results_users"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.s(a.f("users",e,t,1),e,t,0,10,2222,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('    <div class="panel">'),a.b("\n"+n),a.b('        <div style="width:50px;float:left;margin-right:10px">'),a.b("\n"+n),a.b('            <span class="agent-initials button-background" style="width:50px;height:50px;line-height:50px;font-size:18px">'),a.s(a.f("initials",e,t,1),e,t,0,232,244,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.f("initials",e,t,0)))}),e.pop()),a.s(a.f("initials",e,t,1),e,t,1,0,0,"")||a.b('<i class="font-user"></i>'),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b('        <div style="width:calc(100% - 60px);float:left"></div>'),a.b("\n"+n),a.b('        <h3 style="border-bottom:1px solid #eee;margin-left:75px;">'),a.b("\n"+n),a.b('            <a target="_blank" href="https://'),a.b(a.v(a.f("subdomain",e,t,0))),a.b("/agent/users/"),a.b(a.v(a.f("id",e,t,0))),a.b('">'),a.b(a.v(a.f("name",e,t,0))),a.b("'s Tickets</a>"),a.b("\n"+n),a.b("        </h3>"),a.b("\n"+n),a.b('        <div class="row">'),a.b("\n"+n),a.b('            <div class="col-md-6">'),a.b("\n"+n),a.b("                <p>"),a.b("\n"+n),a.b('                    <i class="font-envelope"></i>'),a.b("\n"+n),a.s(a.f("email",e,t,1),e,t,0,765,843,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b('                    <span class="email">'),a.b(a.v(a.f("email",e,t,0))),a.b("</span>"),a.b("\n"+n)}),e.pop()),a.b('                    <span style="display:block;margin-left: 10px">verified user? '),a.s(a.f("verified",e,t,1),e,t,0,948,951,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Yes")}),e.pop()),a.s(a.f("verified",e,t,1),e,t,1,0,0,"")||a.b("No"),a.b("</span>"),a.b("\n"+n),a.b('                    <span style="display:block;margin-left: 10px">suspended? '),a.s(a.f("suspended",e,t,1),e,t,0,1091,1094,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Yes")}),e.pop()),a.s(a.f("suspended",e,t,1),e,t,1,0,0,"")||a.b("No"),a.b("</span>"),a.b("\n"+n),a.b('                    <span style="display:block;margin-left: 10px">shared phone number? '),a.s(a.f("shared_phone_number",e,t,1),e,t,0,1257,1260,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b("Yes")}),e.pop()),a.s(a.f("shared_phone_number",e,t,1),e,t,1,0,0,"")||a.b("No"),a.b("</span>"),a.b("\n"+n),a.b("                </p>"),a.b("\n"+n),a.s(a.f("time_zone",e,t,1),e,t,0,1426,1606,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                <p>"),a.b("\n"+n),a.b('                    <i class="font-office"></i>'),a.b("\n"+n),a.b('                    <span class="company">Time Zone: '),a.b(a.v(a.f("time_zone",e,t,0))),a.b("</span>"),a.b("\n"+n),a.b("                </p>"),a.b("\n"+n)}),e.pop()),a.b("            </div>"),a.b("\n"+n),a.b('            <div class="col-md-4">'),a.b("\n"+n),a.b('                <div class="addresses" style="margin-bottom: 25px;">'),a.b("\n"+n),a.s(a.f("details",e,t,1),e,t,0,1776,1973,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                    <h4>Customer Details:</h4>"),a.b("\n"+n),a.b("                    <p>"),a.b("\n"+n),a.b("                        "),a.b(a.v(a.f("details",e,t,0))),a.b("\n"+n),a.b("                    </p>"),a.b("\n"+n)}),e.pop()),a.s(a.f("phone",e,t,1),e,t,0,2016,2143,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("                    <h4>Phone:</h4>"),a.b("\n"+n),a.b("                    <p>"),a.b(a.v(a.f("phone",e,t,0))),a.b("</p>"),a.b("\n"+n)}),e.pop()),a.b("                </div>"),a.b("\n"+n),a.b("            </div>"),a.b("\n"+n),a.b("        </div>"),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n)}),e.pop()),a.s(a.f("users",e,t,1),e,t,1,0,0,"")||(a.b("    No Zendesk users were linked with this phone number. Please search by name or phone number in the box above."),a.b("\n"+n)),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["calls/zoho_panel"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<style>"),a.b("\n"+n),a.b("  #contact_information {"),a.b("\n"+n),a.b("    height: auto;"),a.b("\n"+n),a.b("    overflow: auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.zoho_field {"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_information>div.zoho_field>label{ "),a.b("\n"+n),a.b("    margin-right: 5px;"),a.b("\n"+n),a.b("    padding-top: 10px;"),a.b("\n"+n),a.b("  } "),a.b("\n"+n),a.b("  #contact_information>div.zoho_field>input {"),a.b("\n"+n),a.b("    margin-right: 10px;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  #contact_selecter, #contact_selecter>label  {"),a.b("\n"+n),a.b("    display: inline;"),a.b("\n"+n),a.b("    visibility: hidden;"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b("  .progress {"),a.b("\n"+n),a.b("    margin: 50px auto;"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("</style>"),a.b("\n"+n),a.b('<div class="field">'),a.b("\n"+n),a.b("  <h3>"),a.b(a.v(a.d("Call.panels.zoho_panel.label",e,t,0))),a.b(" <small>"),a.b(a.v(a.d("Call.panels.zoho_panel.hint",e,t,0))),a.b("</small></h3>"),a.b("\n"+n),a.b('<div class="card">'),a.b("\n"+n),a.b('  <select class="zoho_module"></select> '),a.b("\n"+n),a.b('  <div id="contact_selecter"><label for="contact_picker">Select which record to modify: </label><select id="contact_picker" name="contact_picker"></select></div>'),a.b("\n"+n),a.b('  <div id="contact_information"></div>'),a.b("\n"+n),a.b('  <div class="progress">'),a.b("\n"+n),a.b('    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">'),a.b("\n"+n),a.b('      <span class="sr-only">Loading</span>'),a.b("\n"+n),a.b("    </div>"),a.b("\n"+n),a.b("  </div>"),a.b("\n"+n),a.b('  <footer class="form-actions">'),a.b("\n"+n),a.b('    <a class="update_contact button" type="button" style="display: none;">'),a.b(a.v(a.d("Call.actions.insert_record.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('    <a class="view_in_zoho button outlined" type="button" style="display: none;" href="#" target="_blank">'),a.b(a.v(a.d("Call.actions.view_record.label",e,t,0))),a.b("</a>"),a.b("\n"+n),a.b('    <a class="close button outlined" style="font-size:12px">'),a.b(a.v(a.d("Call.actions.close.short_label",e,t,0))),a.b("</a><br/>"),a.b("\n"+n),a.b("  </footer>"),a.b("\n"+n),a.b("</div>"),a.b("\n"+n),a.b("</div>"),a.b("\n"),a.b("\n"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("  var zoho_contact_id = null;"),a.b("\n"+n),a.b("  var zoho_contacts = {};"),a.b("\n"),a.b("\n"+n),a.b('  $(".update_contact").on("click", function() {'),a.b("\n"+n),a.b("    var row = {}"),a.b("\n"+n),a.b('    var data = { "data": [] };'),a.b("\n"+n),a.b('    var zoho_module = $(".zoho_module option:selected").val();'),a.b("\n"+n),a.b('    row["id"] = zoho_contact_id;'),a.b("\n"+n),a.b('    $(".zoho_field").each(function(key, value) {'),a.b("\n"+n),a.b('      if (!$(this).find("input").attr("disabled")) {'),a.b("\n"+n),a.b('        var value = $(this).find("input").val();'),a.b("\n"+n),a.b('        row[$(this).find("input").attr("name")] = value;'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    data["data"].push(row);'),a.b("\n"),a.b("\n"+n),a.b('    var url = "/api/v1/zoho/'),a.b(a.v(a.d("call.account_id",e,t,0))),a.b('/"+zoho_module+"/upsert_contact";'),a.b("\n"),a.b("\n"+n),a.b("    $.post(url, data, function(res) {"),a.b("\n"+n),a.b("      if (res.status == 200 || res.status == 201) {"),a.b("\n"+n),a.b('        ctmFlash(zoho_module+" information sent to Zoho");'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      else {"),a.b("\n"+n),a.b("        response = JSON.parse(res.response)"),a.b("\n"+n),a.b("        zoho_code = response.data[0].code;"),a.b("\n"+n),a.b("        zoho_message = response.data[0].message;"),a.b("\n"+n),a.b('        ctmFlash("Unable to save "+zoho_module+" to Zoho. "+zoho_code+": "+zoho_message, "error");'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    });"),a.b("\n"),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  function search_zoho_contacts(data) {"),a.b("\n"+n),a.b("    $.post('/integrations/zoho/search_zoho_contact', data, function(res) {"),a.b("\n"+n),a.b("      if (res.length > 0) {"),a.b("\n"+n),a.b('        $(".update_contact").html("Update Zoho Record");'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      if (res.length > 1) {"),a.b("\n"+n),a.b("        prepareContactPicker(res);"),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("      updateFields(res)"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function prepareContactPicker(contacts) {"),a.b("\n"+n),a.b("    $(\"#contact_selecter\").css('visibility', 'visible');"),a.b("\n"+n),a.b("    $(\"#contact_selecter>label\").css('visibility', 'visible');"),a.b("\n"+n),a.b('    // var contact_picker = \'<select id="contact_picker" name="contact_picker"></select>\';'),a.b("\n"),a.b("\n"+n),a.b('    var options = "";'),a.b("\n"+n),a.b("    contacts.forEach(function(contact) {"),a.b("\n"+n),a.b("      zoho_contacts[contact.id] = contact;"),a.b("\n"+n),a.b("      options += '<option value=\"' + contact.id + '\">' + escapeHtml(contact.First_Name) + ' ' + escapeHtml(contact.Last_Name) + ' (' + contact.id + ')</option>';"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b('    // $("#contact_selecter").append(contact_picker);'),a.b("\n"+n),a.b('    $("#contact_picker").append(options).select2({dropdownAutoWidth: true}).bind("change", function() { '),a.b("\n"+n),a.b('      fillFields(zoho_contacts[$("#contact_picker option:selected").val()]); '),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b('  $(".zoho_module").on("change", function() {'),a.b("\n"+n),a.b('    $("#contact_information").empty();'),a.b("\n"+n),a.b('    $(".progress").show();'),a.b("\n"+n),a.b('    $(".view_in_zoho").hide();'),a.b("\n"+n),a.b("    var data = {"),a.b("\n"+n),a.b("              zoho_module: $(this).val(), "),a.b("\n"+n),a.b("              options: { "),a.b("\n"+n),a.b('                          first_name: "'),a.b(a.v(a.d("call.caller.name",e,t,0))),a.b('", '),a.b("\n"+n),a.b('                          phone: "'),a.b(a.v(a.d("call.caller_number_bare",e,t,0))),a.b('",'),a.b("\n"+n),a.b('                          email: "'),a.b(a.v(a.d("call.caller.email",e,t,0))),a.b('"'),a.b("\n"+n),a.b("                        }"),a.b("\n"+n),a.b("            };"),a.b("\n"),a.b("\n"+n),a.b("    search_zoho_contacts(data); "),a.b("\n"+n),a.b("  });"),a.b("\n"),a.b("\n"+n),a.b("  function updateFields(contact_data = null) {"),a.b("\n"+n),a.b('    $.get("/integrations/zoho/" + $(".zoho_module option:selected").val() + "/fields", function(res) {'),a.b("\n"+n),a.b('      $("#contact_information").empty();'),a.b("\n"+n),a.b('      var info = ""'),a.b("\n"+n),a.b("      res.forEach(function(field) {"),a.b("\n"+n),a.b("        if (field.display != false) { // != false because unmapped fields are null, which means they just don't display"),a.b("\n"+n),a.b('          var value = "";'),a.b("\n"+n),a.b('          var disabled = "";'),a.b("\n"+n),a.b("          if (contact_data) {"),a.b("\n"+n),a.b("            var crm_data = contact_data[0][field.zoho_field];"),a.b("\n"+n),a.b('            zoho_contact_id = contact_data[0]["id"];'),a.b("\n"+n),a.b('            if (typeof crm_data == "object" && crm_data != null) {'),a.b("\n"+n),a.b("              if (crm_data.hasOwnProperty('name')) {"),a.b("\n"+n),a.b("                value = crm_data.name;"),a.b("\n"+n),a.b("                id = crm_data.id;"),a.b("\n"+n),a.b("                disabled = \"disabled='disabled'\";"),a.b("\n"+n),a.b("                info += '<input type=\"hidden\" name=\"' + escapeHtml(field.zoho_field) + '\"/>';"),a.b("\n"+n),a.b("              }"),a.b("\n"+n),a.b("            }"),a.b("\n"+n),a.b("            else {"),a.b("\n"+n),a.b("              value = crm_data;"),a.b("\n"+n),a.b("            }"),a.b("\n"+n),a.b('            if (value == "null" || value == null) { value = ""; }'),a.b("\n"+n),a.b("          }"),a.b("\n"+n),a.b("          info += '<div class=\"zoho_field col-md-3\"><label for=\"' + escapeHtml(field.zoho_field) + '\">' + escapeHtml(field.name) + ':</label><input class=\"text\" type=\"text\" ' + disabled + ' name=\"' + escapeHtml(field.zoho_field) + '\"/></div>';"),a.b("\n"+n),a.b("        }"),a.b("\n"+n),a.b("      });"),a.b("\n"+n),a.b('      $(".progress").hide();'),a.b("\n"+n),a.b('      $("#contact_information").append(info);'),a.b("\n"+n),a.b('      $(".update_contact").show()'),a.b("\n"),a.b("\n"+n),a.b("      if (contact_data) {"),a.b("\n"+n),a.b("        fillFields(contact_data[0])"),a.b("\n"+n),a.b("      }"),a.b("\n"),a.b("\n"+n),a.b("    });"),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.b("  function fillFields(contact_data) {"),a.b("\n"+n),a.b("    zoho_contact_id = contact_data.id"),a.b("\n"+n),a.b('    $(".zoho_field").each(function() {'),a.b("\n"+n),a.b('      if (!$(this).find("input").attr("disabled")) {'),a.b("\n"+n),a.b('        $(this).find("input").val(contact_data[$(this).find("input").attr("name")]);'),a.b("\n"+n),a.b("      } else {"),a.b("\n"+n),a.b('        $(this).find("input").val(contact_data[$(this).find("input").attr("name")].name);'),a.b("\n"+n),a.b("      }"),a.b("\n"+n),a.b("    })"),a.b("\n"+n),a.b('    $(".view_in_zoho").show();'),a.b("\n"+n),a.b('    $(".view_in_zoho").attr(\'href\', "https://crm.zoho.com/crm/tab/"+$(".zoho_module option:selected").val()+"/"+contact_data.id);'),a.b("\n"+n),a.b("  }"),a.b("\n"),a.b("\n"+n),a.s(a.f("default_module",e,t,1),e,t,0,6188,6546,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    data = {"),a.b("\n"+n),a.b('              zoho_module: "'),a.b(a.v(a.d("default_module.api_name",e,t,0))),a.b('", '),a.b("\n"+n),a.b("              options: { "),a.b("\n"+n),a.b('                          first_name: "'),a.b(a.v(a.d("call.caller.name",e,t,0))),a.b('", '),a.b("\n"+n),a.b('                          phone: "'),a.b(a.v(a.d("call.caller_number_bare",e,t,0))),a.b('",'),a.b("\n"+n),a.b('                          email: "'),a.b(a.v(a.d("call.caller.email",e,t,0))),a.b('"'),a.b("\n"+n),a.b("                        }"),a.b("\n"+n),a.b("            };"),a.b("\n"+n),a.b("    search_zoho_contacts(data);"),a.b("\n"+n)}),e.pop()),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),$.fn.timeUnitPicker=function(e){function t(e){for(var t=1;t<a.length;t++)if(a[t].value==e)return t}function n(e,n,i){if(""==e)return e;e=parseInt(e);var r=t(n),s=t(i);if(s<r)for(var o=r;o>s;o--)e*=a[o].unit;else if(s>r)for(o=r+1;o<=s;o++)e=Math.floor(e/a[o].unit);return e}var a=[{},{"value":"seconds","label":"seconds","unit":1},{"value":"minutes","label":"minutes","unit":60},{"value":"hours","label":"hours","unit":60},{"value":"days","label":"days","unit":24}];return e=e||{},this.each(function(){function i(){var e=r.val();if(""!==e){e=parseInt(e);for(var i=l,c=t(l)+1;c<=t(d)&&(e>0&&e%a[c].unit==0);c++)e/=a[c].unit,i=a[c].value;m.val(e),h.val(i),""!==s&&m.attr("min",n(s,l,i)),""!==o&&m.attr("max",n(o,l,i))}else m.val("")}var r=$(this);if(!$(this).prev().hasClass("time-unit-picker")){var s=e.min||r.attr("min")||"0",o=e.max||r.attr("max");""!==s&&(s=parseInt(s)),""!==o&&(o=parseInt(o));var l=e.unit||r.attr("data-unit")||"seconds",c=e.minUnit||r.attr("data-min-unit"),d=e.maxUnit||r.attr("data-max-unit");if(t(l)||(l="minutes"),t(c)||(c=l),t(l)<t(c)&&(c=l),!t(d))if(""!==o)for(var u=o,p=t(d=l)+1;p<a.length&&(u>0&&u%a[p].unit==0);p++)u/=a[p].unit,d=a[p].value;else d=a[a.length-1].value;t(c)>t(d)&&(d=c),t(l)>t(d)&&(d=l);var f="";for(p=t(c);p<=t(d);p++)f=f+'<option value="'+a[p].value+'" data-unit="'+escapeHtml(a[p].unit)+'"'+(a[p].value==l?" selected":"")+">"+escapeHtml(I18n.t("datetime.distance_in_words.x_"+a[p].value,{"count":1e3}).replace("1000","").trim())+"</option>";r.before('<span class="time-unit-picker"><input type="number" size="5"'+(r.attr("readonly")?" readonly ":"")+(r.attr("disabled")?" disabled ":"")+"/><select"+(r.attr("readonly")||r.attr("disabled")?" disabled ":"")+">"+f+"</select></span>"),r.hide();var b=r.prev();b.addClass(r.attr("class"));var h=b.find("select"),m=b.find("input");m.attr("class",r.attr("class")),r.get(0).style.width&&(b.get(0).style.width=r.get(0).style.width),c==d&&h.attr("disabled",!0),""!==s&&m.attr("min",s),""!==o&&m.attr("max",o),r.change(function(){i()}),i();var v=h.val();return h.on("change",function(){var e=h.val();""!==s&&m.attr("min",n(s,l,e)),""!==o&&m.attr("max",n(o,l,e));var t=n(m.val(),v,e);v=e,m.val(t).trigger("input")}),m.on("input",function(){var e=n(m.val(),v,l);""!==e&&(""!==s&&e<s&&(e=s),""!==o&&e>o&&(e=o)),r.val(e)}),this}})};var PhoneCountryComboBox={"countries":[{"code":"US","prefix":"1"},{"code":"CA","prefix":"1"},{"code":"GB","prefix":"44"},{"code":"AF","prefix":"93"},{"code":"AL","prefix":"355"},{"code":"DZ","prefix":"213"},{"code":"AS","prefix":"1"},{"code":"AD","prefix":"376"},{"code":"AO","prefix":"244"},{"code":"AI","prefix":"1"},{"code":"AG","prefix":"1"},{"code":"AR","prefix":"54"},{"code":"AM","prefix":"374"},{"code":"AW","prefix":"297"},{"code":"AC","prefix":"247"},{"code":"AU","prefix":"61"},{"code":"AT","prefix":"43"},{"code":"AZ","prefix":"994"},{"code":"BS","prefix":"1"},{"code":"BH","prefix":"973"},{"code":"BD","prefix":"880"},{"code":"BB","prefix":"1"},{"code":"BY","prefix":"375"},{"code":"BE","prefix":"32"},{"code":"BZ","prefix":"501"},{"code":"BJ","prefix":"229"},{"code":"BM","prefix":"1"},{"code":"BT","prefix":"975"},{"code":"BO","prefix":"591"},{"code":"BA","prefix":"387"},{"code":"BW","prefix":"267"},{"code":"BR","prefix":"55"},{"code":"BN","prefix":"673"},{"code":"BG","prefix":"359"},{"code":"BF","prefix":"226"},{"code":"BI","prefix":"257"},{"code":"KH","prefix":"855"},{"code":"CM","prefix":"237"},{"code":"CV","prefix":"238"},{"code":"KY","prefix":"1"},{"code":"CF","prefix":"236"},{"code":"TD","prefix":"235"},{"code":"CL","prefix":"56"},{"code":"CN","prefix":"86"},{"code":"CO","prefix":"57"},{"code":"KM","prefix":"269"},{"code":"CG","prefix":"242"},{"code":"CD","prefix":"243"},{"code":"CR","prefix":"506"},{"code":"HR","prefix":"385"},{"code":"CU","prefix":"53"},{"code":"CY","prefix":"357"},{"code":"CZ","prefix":"420"},{"code":"DK","prefix":"45"},{"code":"DJ","prefix":"253"},{"code":"DM","prefix":"1"},{"code":"DO","prefix":"1"},{"code":"TL","prefix":"670"},{"code":"EC","prefix":"593"},{"code":"EG","prefix":"20"},{"code":"SV","prefix":"503"},{"code":"GQ","prefix":"240"},{"code":"ER","prefix":"291"},{"code":"EE","prefix":"372"},{"code":"ET","prefix":"251"},{"code":"FO","prefix":"298"},{"code":"FJ","prefix":"679"},{"code":"FI","prefix":"358"},{"code":"FR","prefix":"33"},{"code":"GF","prefix":"594"},{"code":"PF","prefix":"689"},{"code":"GA","prefix":"241"},{"code":"GM","prefix":"220"},{"code":"GE","prefix":"995"},{"code":"DE","prefix":"49"},{"code":"GH","prefix":"233"},{"code":"GI","prefix":"350"},{"code":"GR","prefix":"30"},{"code":"GL","prefix":"299"},{"code":"GD","prefix":"1"},{"code":"GP","prefix":"590"},{"code":"GU","prefix":"1"},{"code":"GT","prefix":"502"},{"code":"GN","prefix":"224"},{"code":"GW","prefix":"245"},{"code":"GY","prefix":"592"},{"code":"HT","prefix":"509"},{"code":"HN","prefix":"504"},{"code":"HK","prefix":"852"},{"code":"HU","prefix":"36"},{"code":"IS","prefix":"354"},{"code":"IN","prefix":"91"},{"code":"ID","prefix":"62"},{"code":"IR","prefix":"98"},{"code":"IQ","prefix":"964"},{"code":"IE","prefix":"353"},{"code":"IL","prefix":"972"},{"code":"IT","prefix":"39"},{"code":"CI","prefix":"225"},{"code":"JM","prefix":"1"},{"code":"JP","prefix":"81"},{"code":"JO","prefix":"962"},{"code":"KZ","prefix":"7"},{"code":"KE","prefix":"254"},{"code":"KP","prefix":"850"},{"code":"KW","prefix":"965"},{"code":"KG","prefix":"996"},{"code":"LA","prefix":"856"},{"code":"LV","prefix":"371"},{"code":"LB","prefix":"961"},{"code":"LS","prefix":"266"},{"code":"LR","prefix":"231"},{"code":"LY","prefix":"218"},{"code":"LI","prefix":"423"},{"code":"LT","prefix":"370"},{"code":"LU","prefix":"352"},{"code":"MO","prefix":"853"},{"code":"MK","prefix":"389"},{"code":"MG","prefix":"261"},{"code":"MW","prefix":"265"},{"code":"MY","prefix":"60"},{"code":"MV","prefix":"960"},{"code":"ML","prefix":"223"},{"code":"MT","prefix":"356"},{"code":"MH","prefix":"692"},{"code":"MQ","prefix":"596"},{"code":"MR","prefix":"222"},{"code":"MU","prefix":"230"},{"code":"MX","prefix":"52"},{"code":"FM","prefix":"691"},{"code":"MD","prefix":"498"},{"code":"MC","prefix":"377"},{"code":"MN","prefix":"976"},{"code":"ME","prefix":"382"},{"code":"MS","prefix":"1"},{"code":"MA","prefix":"212"},{"code":"MZ","prefix":"258"},{"code":"MM","prefix":"95"},{"code":"NA","prefix":"264"},{"code":"NP","prefix":"977"},{"code":"NL","prefix":"31"},{"code":"AN","prefix":"599"},{"code":"NC","prefix":"687"},{"code":"NZ","prefix":"64"},{"code":"NI","prefix":"505"},{"code":"NE","prefix":"227"},{"code":"NG","prefix":"234"},{"code":"MP","prefix":"1"},{"code":"NO","prefix":"47"},{"code":"OM","prefix":"968"},{"code":"PK","prefix":"92"},{"code":"PW","prefix":"680"},{"code":"PS","prefix":"970"},{"code":"PA","prefix":"507"},{"code":"PG","prefix":"675"},{"code":"PY","prefix":"595"},{"code":"PE","prefix":"51"},{"code":"PH","prefix":"63"},{"code":"PL","prefix":"48"},{"code":"PT","prefix":"351"},{"code":"PR","prefix":"1"},{"code":"QA","prefix":"974"},{"code":"RE","prefix":"262"},{"code":"RO","prefix":"40"},{"code":"RU","prefix":"7"},{"code":"RW","prefix":"250"},{"code":"WS","prefix":"685"},{"code":"SM","prefix":"378"},{"code":"SA","prefix":"966"},{"code":"SN","prefix":"221"},{"code":"RS","prefix":"381"},{"code":"SC","prefix":"248"},{"code":"SL","prefix":"232"},{"code":"SG","prefix":"65"},{"code":"SX","prefix":"1"},{"code":"sip","prefix":"sip"},{"code":"SK","prefix":"421"},{"code":"SI","prefix":"386"},{"code":"SB","prefix":"677"},{"code":"SO","prefix":"252"},{"code":"ZA","prefix":"27"},{"code":"KR","prefix":"82"},{"code":"SS","prefix":"211"},{"code":"ES","prefix":"34"},{"code":"LK","prefix":"94"},{"code":"KN","prefix":"1"},{"code":"LC","prefix":"1"},{"code":"PM","prefix":"508"},{"code":"VC","prefix":"1"},{"code":"SD","prefix":"249"},{"code":"SR","prefix":"597"},{"code":"SZ","prefix":"268"},{"code":"SE","prefix":"46"},{"code":"CH","prefix":"41"},{"code":"SY","prefix":"963"},{"code":"TW","prefix":"886"},{"code":"TJ","prefix":"992"},{"code":"TZ","prefix":"255"},{"code":"TH","prefix":"66"},{"code":"TG","prefix":"228"},{"code":"TO","prefix":"676"},{"code":"TT","prefix":"1"},{"code":"TN","prefix":"216"},{"code":"TR","prefix":"90"},{"code":"TM","prefix":"993"},{"code":"TC","prefix":"1"},{"code":"UG","prefix":"256"},{"code":"UA","prefix":"380"},{"code":"AE","prefix":"971"},{"code":"UY","prefix":"598"},{"code":"UZ","prefix":"998"},{"code":"VU","prefix":"678"},{"code":"VA","prefix":"379"},{"code":"VE","prefix":"58"},{"code":"VN","prefix":"84"},{"code":"VG","prefix":"1"},{"code":"VI","prefix":"1"},{"code":"YE","prefix":"967"},{"code":"ZM","prefix":"260"},{"code":"ZW","prefix":"263"}],"codes":{},"prefixes":{}};!function(){for(var e=PhoneCountryComboBox,t=0,n=e.countries.length;t<n;t++)e.codes[e.countries[t].code]=e.countries[t],e.prefixes[e.countries[t].prefix]=e.countries[t]}(),
/* ========================================================================
 * bootstrap-switch - v3.3.2
 * http://www.bootstrap-switch.org
 * ========================================================================
 * Copyright 2012-2013 Mattia Larentis
 *
 * ========================================================================
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================================
 */
function(){var e=[].slice;!function(t,n){"use strict";var a;a=function(){function e(e,n){var a;null==n&&(n={}),this.$element=t(e),this.options=t.extend({},t.fn.bootstrapSwitch.defaults,{"state":this.$element.is(":checked"),"size":this.$element.data("size"),"animate":this.$element.data("animate"),"disabled":this.$element.is(":disabled"),"readonly":this.$element.is("[readonly]"),"indeterminate":this.$element.data("indeterminate"),"inverse":this.$element.data("inverse"),"radioAllOff":this.$element.data("radio-all-off"),"onColor":this.$element.data("on-color"),"offColor":this.$element.data("off-color"),"onText":this.$element.data("on-text"),"offText":this.$element.data("off-text"),"labelText":this.$element.data("label-text"),"handleWidth":this.$element.data("handle-width"),"labelWidth":this.$element.data("label-width"),"baseClass":this.$element.data("base-class"),"wrapperClass":this.$element.data("wrapper-class")},n),this.$wrapper=t("<div>",{"class":(a=this,function(){var e;return(e=[""+a.options.baseClass].concat(a._getClasses(a.options.wrapperClass))).push(a.options.state?a.options.baseClass+"-on":a.options.baseClass+"-off"),null!=a.options.size&&e.push(a.options.baseClass+"-"+a.options.size),a.options.disabled&&e.push(a.options.baseClass+"-disabled"),a.options.readonly&&e.push(a.options.baseClass+"-readonly"),a.options.indeterminate&&e.push(a.options.baseClass+"-indeterminate"),a.options.inverse&&e.push(a.options.baseClass+"-inverse"),a.$element.attr("id")&&e.push(a.options.baseClass+"-id-"+a.$element.attr("id")),e.join(" ")})()}),this.$container=t("<div>",{"class":this.options.baseClass+"-container"}),this.$on=t("<span>",{"html":this.options.onText,"class":this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor}),this.$off=t("<span>",{"html":this.options.offText,"class":this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor}),this.$label=t("<span>",{"html":this.options.labelText,"class":this.options.baseClass+"-label"}),this.$element.on("init.bootstrapSwitch",function(t){return function(){return t.options.onInit.apply(e,arguments)}}(this)),this.$element.on("switchChange.bootstrapSwitch",function(t){return function(){return t.options.onSwitchChange.apply(e,arguments)}}(this)),this.$container=this.$element.wrap(this.$container).parent(),this.$wrapper=this.$container.wrap(this.$wrapper).parent(),this.$element.before(this.options.inverse?this.$off:this.$on).before(this.$label).before(this.options.inverse?this.$on:this.$off),this.options.indeterminate&&this.$element.prop("indeterminate",!0),this._init(),this._elementHandlers(),this._handleHandlers(),this._labelHandlers(),this._formHandler(),this._externalLabelHandler(),this.$element.trigger("init.bootstrapSwitch")}return e.prototype._constructor=e,e.prototype.state=function(e,t){return void 0===e?this.options.state:this.options.disabled||this.options.readonly?this.$element:this.options.state&&!this.options.radioAllOff&&this.$element.is(":radio")?this.$element:(this.options.indeterminate&&this.indeterminate(!1),e=!!e,this.$element.prop("checked",e).trigger("change.bootstrapSwitch",t),this.$element)},e.prototype.toggleState=function(e){return this.options.disabled||this.options.readonly?this.$element:this.options.indeterminate?(this.indeterminate(!1),this.state(!0)):this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",e)},e.prototype.size=function(e){return void 0===e?this.options.size:(null!=this.options.size&&this.$wrapper.removeClass(this.options.baseClass+"-"+this.options.size),e&&this.$wrapper.addClass(this.options.baseClass+"-"+e),this._width(),this._containerPosition(),this.options.size=e,this.$element)},e.prototype.animate=function(e){return void 0===e?this.options.animate:(e=!!e)===this.options.animate?this.$element:this.toggleAnimate()},e.prototype.toggleAnimate=function(){return this.options.animate=!this.options.animate,this.$wrapper.toggleClass(this.options.baseClass+"-animate"),this.$element},e.prototype.disabled=function(e){return void 0===e?this.options.disabled:(e=!!e)===this.options.disabled?this.$element:this.toggleDisabled()},e.prototype.toggleDisabled=function(){return this.options.disabled=!this.options.disabled,this.$element.prop("disabled",this.options.disabled),this.$wrapper.toggleClass(this.options.baseClass+"-disabled"),this.$element},e.prototype.readonly=function(e){return void 0===e?this.options.readonly:(e=!!e)===this.options.readonly?this.$element:this.toggleReadonly()},e.prototype.toggleReadonly=function(){return this.options.readonly=!this.options.readonly,this.$element.prop("readonly",this.options.readonly),this.$wrapper.toggleClass(this.options.baseClass+"-readonly"),this.$element},e.prototype.indeterminate=function(e){return void 0===e?this.options.indeterminate:(e=!!e)===this.options.indeterminate?this.$element:this.toggleIndeterminate()},e.prototype.toggleIndeterminate=function(){return this.options.indeterminate=!this.options.indeterminate,this.$element.prop("indeterminate",this.options.indeterminate),this.$wrapper.toggleClass(this.options.baseClass+"-indeterminate"),this._containerPosition(),this.$element},e.prototype.inverse=function(e){return void 0===e?this.options.inverse:(e=!!e)===this.options.inverse?this.$element:this.toggleInverse()},e.prototype.toggleInverse=function(){var e,t;return this.$wrapper.toggleClass(this.options.baseClass+"-inverse"),t=this.$on.clone(!0),e=this.$off.clone(!0),this.$on.replaceWith(e),this.$off.replaceWith(t),this.$on=e,this.$off=t,this.options.inverse=!this.options.inverse,this.$element},e.prototype.onColor=function(e){var t;return t=this.options.onColor,void 0===e?t:(null!=t&&this.$on.removeClass(this.options.baseClass+"-"+t),this.$on.addClass(this.options.baseClass+"-"+e),this.options.onColor=e,this.$element)},e.prototype.offColor=function(e){var t;return t=this.options.offColor,void 0===e?t:(null!=t&&this.$off.removeClass(this.options.baseClass+"-"+t),this.$off.addClass(this.options.baseClass+"-"+e),this.options.offColor=e,this.$element)},e.prototype.onText=function(e){return void 0===e?this.options.onText:(this.$on.html(e),this._width(),this._containerPosition(),this.options.onText=e,this.$element)},e.prototype.offText=function(e){return void 0===e?this.options.offText:(this.$off.html(e),this._width(),this._containerPosition(),this.options.offText=e,this.$element)},e.prototype.labelText=function(e){return void 0===e?this.options.labelText:(this.$label.html(e),this._width(),this.options.labelText=e,this.$element)},e.prototype.handleWidth=function(e){return void 0===e?this.options.handleWidth:(this.options.handleWidth=e,this._width(),this._containerPosition(),this.$element)},e.prototype.labelWidth=function(e){return void 0===e?this.options.labelWidth:(this.options.labelWidth=e,this._width(),this._containerPosition(),this.$element)},e.prototype.baseClass=function(){return this.options.baseClass},e.prototype.wrapperClass=function(e){return void 0===e?this.options.wrapperClass:(e||(e=t.fn.bootstrapSwitch.defaults.wrapperClass),this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" ")),this.$wrapper.addClass(this._getClasses(e).join(" ")),this.options.wrapperClass=e,this.$element)},e.prototype.radioAllOff=function(e){return void 0===e?this.options.radioAllOff:(e=!!e)===this.options.radioAllOff?this.$element:(this.options.radioAllOff=e,this.$element)},e.prototype.onInit=function(e){return void 0===e?this.options.onInit:(e||(e=t.fn.bootstrapSwitch.defaults.onInit),this.options.onInit=e,this.$element)},e.prototype.onSwitchChange=function(e){return void 0===e?this.options.onSwitchChange:(e||(e=t.fn.bootstrapSwitch.defaults.onSwitchChange),this.options.onSwitchChange=e,this.$element)},e.prototype.destroy=function(){var e;return(e=this.$element.closest("form")).length&&e.off("reset.bootstrapSwitch").removeData("bootstrap-switch"),this.$container.children().not(this.$element).remove(),this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch"),this.$element},e.prototype._width=function(){var e,t,n;return(e=this.$on.add(this.$off)).add(this.$label).css("width",""),t="auto"===this.options.handleWidth?Math.max(this.$on.width(),this.$off.width()):this.options.handleWidth,e.css("width",t+"px"),this.$label.css("width",(n=this,function(e,a){return"auto"!==n.options.labelWidth?n.options.labelWidth+"px":a<t?t+"px":a+"px"})),this._handleWidth=t,this._labelWidth=this.options.labelWidth,this.$container.css("width",2*this._handleWidth+this._labelWidth+"px"),this.$wrapper.css("width",this._handleWidth+this._labelWidth+"px")},e.prototype._containerPosition=function(e,t){var n;if(null==e&&(e=this.options.state),this.$container.css("margin-left",(n=this,function(){var t;return t=[0,"-"+n._handleWidth+"px"],n.options.indeterminate?"-"+n._handleWidth/2+"px":e?n.options.inverse?t[1]:t[0]:n.options.inverse?t[0]:t[1]})),t)return setTimeout(function(){return t()},50)},e.prototype._init=function(){var e,t,a;return this.$hidden=this.$container.closest(".boot-switch").find("input[type=hidden]"),this.$element.removeAttr("name"),this.$element.is(":checked")?this.$hidden.val(1):this.$hidden.val(0),a=this,e=function(){return a._width(),a._containerPosition(null,function(){if(a.options.animate)return a.$wrapper.addClass(a.options.baseClass+"-animate")})},this.$wrapper.is(":visible")?e():t=n.setInterval(function(a){return function(){if(a.$wrapper.is(":visible"))return e(),n.clearInterval(t)}}(this),50)},e.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":(e=this,function(n,a){var i;if(n.preventDefault(),n.stopImmediatePropagation(),(i=e.$element.is(":checked"))?e.$hidden.val(1):e.$hidden.val(0),e._containerPosition(i),i!==e.options.state)return e.options.state=i,e.$wrapper.toggleClass(e.options.baseClass+"-off").toggleClass(e.options.baseClass+"-on"),a?void 0:(e.$element.is(":radio")&&t("[name='"+e.$element.attr("name")+"']").not(e.$element).prop("checked",!1).trigger("change.bootstrapSwitch",!0),e.$element.trigger("switchChange.bootstrapSwitch",[i]))}),"focus.bootstrapSwitch":function(e){return function(t){return t.preventDefault(),e.$wrapper.addClass(e.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(e){return function(t){return t.preventDefault(),e.$wrapper.removeClass(e.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(e){return function(t){if(t.which&&!e.options.disabled&&!e.options.readonly)switch(t.which){case 37:return t.preventDefault(),t.stopImmediatePropagation(),e.state(!1);case 39:return t.preventDefault(),t.stopImmediatePropagation(),e.state(!0)}}}(this)});var e},e.prototype._handleHandlers=function(){var e;return this.$on.on("click.bootstrapSwitch",(e=this,function(t){return t.preventDefault(),t.stopPropagation(),e.state(!1),e.$element.trigger("focus.bootstrapSwitch")})),this.$off.on("click.bootstrapSwitch",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.state(!0),e.$element.trigger("focus.bootstrapSwitch")}}(this))},e.prototype._labelHandlers=function(){return this.$label.on({"mousedown.bootstrapSwitch":(e=this,function(t){if(!(e._dragStart||e.options.disabled||e.options.readonly))return t.preventDefault(),t.stopPropagation(),e._dragStart=(t.pageX||t.originalEvent.touches[0].pageX)-parseInt(e.$container.css("margin-left"),10),e.options.animate&&e.$wrapper.removeClass(e.options.baseClass+"-animate"),e.$element.trigger("focus.bootstrapSwitch")}),"mousemove.bootstrapSwitch":function(e){return function(t){var n;if(null!=e._dragStart&&(t.preventDefault(),n=(t.pageX||t.originalEvent.touches[0].pageX)-e._dragStart,(e._dragEnd||!(Math.abs(n-parseInt(e.$container.css("margin-left"),10))<10))&&!(n<-e._handleWidth||n>0)))return e._dragEnd=n,e.$container.css("margin-left",e._dragEnd+"px")}}(this),"mouseup.bootstrapSwitch":function(e){return function(t){var n;if(e._dragStart)return t.preventDefault(),e.options.animate&&e.$wrapper.addClass(e.options.baseClass+"-animate"),e._dragEnd?(n=e._dragEnd>-e._handleWidth/2,e._dragEnd=!1,e.state(e.options.inverse?!n:n)):e.state(!e.options.state),e._dragStart=!1}}(this),"mouseleave.bootstrapSwitch":function(e){return function(){return e.$label.trigger("mouseup.bootstrapSwitch")}}(this)});var e},e.prototype._externalLabelHandler=function(){var e,t;return(e=this.$element.closest("label")).on("click",(t=this,function(n){if(n.preventDefault(),n.stopImmediatePropagation(),n.target===e[0])return t.toggleState()}))},e.prototype._formHandler=function(){var e;if(!(e=this.$element.closest("form")).data("bootstrap-switch"))return e.on("reset.bootstrapSwitch",function(){return n.setTimeout(function(){return e.find("input").filter(function(){return t(this).data("bootstrap-switch")}).each(function(){return t(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",!0)},e.prototype._getClasses=function(e){var n,a,i,r;if(!t.isArray(e))return[this.options.baseClass+"-"+e];for(a=[],i=0,r=e.length;i<r;i++)n=e[i],a.push(this.options.baseClass+"-"+n);return a},e}(),t.fn.bootstrapSwitch=function(){var n,i,r;return i=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],r=this,this.each(function(){var e,s;if((s=(e=t(this)).data("bootstrap-switch"))||e.data("bootstrap-switch",s=new a(this,i)),"string"==typeof i)return r=s[i].apply(s,n)}),r},t.fn.bootstrapSwitch.Constructor=a,t.fn.bootstrapSwitch.defaults={"state":!0,"size":null,"animate":!0,"disabled":!1,"readonly":!1,"indeterminate":!1,"inverse":!1,"radioAllOff":!1,"onColor":"primary","offColor":"default","onText":"ON","offText":"OFF","labelText":"&nbsp;","handleWidth":"auto","labelWidth":"auto","baseClass":"bootstrap-switch","wrapperClass":"wrapper","onInit":function(){},"onSwitchChange":function(){}}}(window.jQuery,window)}.call(this),$.fn.countryPicker=function(e){this.countries={"Africa":[["Algeria","DZ"],["Angola","AO"],["Benin","BJ"],["Botswana","BW"],["Burkina Faso","BF"],["Burundi","BI"],["Cabo Verde","CV"],["Cameroon","CM"],["Central African Republic","CF"],["Chad","TD"],["Comoros","KM"],["Congo","CG"],["Congo (Democratic Republic)","CD"],["C\xf4te d'Ivoire","CI"],["Djibouti","DJ"],["Egypt","EG"],["Equatorial Guinea","GQ"],["Eritrea","ER"],["Ethiopia","ET"],["Gabon","GA"],["Gambia","GM"],["Ghana","GH"],["Guinea","GN"],["Guinea-Bissau","GW"],["Kenya","KE"],["Lesotho","LS"],["Liberia","LR"],["Libya","LY"],["Madagascar","MG"],["Malawi","MW"],["Mali","ML"],["Mauritania","MR"],["Mauritius","MU"],["Mayotte","YT"],["Morocco","MA"],["Mozambique","MZ"],["Namibia","NA"],["Niger","NE"],["Nigeria","NG"],["R\xe9union","RE"],["Rwanda","RW"],["Saint Helena, Ascension and Tristan da Cunha","SH"],["Sao Tome and Principe","ST"],["Senegal","SN"],["Seychelles","SC"],["Sierra Leone","SL"],["Somalia","SO"],["South Africa","ZA"],["South Sudan","SS"],["Sudan","SD"],["Swaziland","SZ"],["Tanzania","TZ"],["Togo","TG"],["Tunisia","TN"],["Uganda","UG"],["Western Sahara","EH"],["Zambia","ZM"],["Zimbabwe","ZW"]],"Asia":[["Afghanistan","AF"],["Bahrain","BH"],["Bangladesh","BD"],["Bhutan","BT"],["British Indian Ocean Territory","IO"],["Brunei Darussalam","BN"],["Cambodia","KH"],["China","CN"],["Christmas Island","CX"],["Cocos (Keeling) Islands","CC"],["Hong Kong","HK"],["India","IN"],["Indonesia","ID"],["Iran","IR"],["Iraq","IQ"],["Israel","IL"],["Japan","JP"],["Jordan","JO"],["Kazakhstan","KZ"],["Kuwait","KW"],["Kyrgyzstan","KG"],["Lao People's Democratic Republic","LA"],["Lebanon","LB"],["Macao","MO"],["Malaysia","MY"],["Maldives","MV"],["Mongolia","MN"],["Myanmar","MM"],["Nepal","NP"],["North Korea","KP"],["Oman","OM"],["Pakistan","PK"],["Philippines","PH"],["Qatar","QA"],["Russia","RU"],["Saudi Arabia","SA"],["Singapore","SG"],["South Korea","KR"],["Sri Lanka","LK"],["State of Palestine","PS"],["Syrian Arab Republic","SY"],["Taiwan","TW"],["Tajikistan","TJ"],["Thailand","TH"],["Timor-Leste","TL"],["Turkey","TR"],["Turkmenistan","TM"],["United Arab Emirates","AE"],["Uzbekistan","UZ"],["Viet Nam","VN"],["Yemen","YE"]],"Antarctica":[["Antarctica","AQ"],["Bouvet Island","BV"],["French Southern Territories","TF"],["South Georgia and the South Sandwich Islands","GS"]],"Europe":[["\xc5land Islands","AX"],["Albania","AL"],["Andorra","AD"],["Armenia","AM"],["Austria","AT"],["Azerbaijan","AZ"],["Belarus","BY"],["Belgium","BE"],["Bosnia and Herzegovina","BA"],["Bulgaria","BG"],["Croatia","HR"],["Cyprus","CY"],["Czech Republic","CZ"],["Denmark","DK"],["Estonia","EE"],["Faroe Islands","FO"],["Finland","FI"],["France","FR"],["Georgia","GE"],["Germany","DE"],["Gibraltar","GI"],["Greece","GR"],["Guernsey","GG"],["Hungary","HU"],["Iceland","IS"],["Ireland","IE"],["Isle of Man","IM"],["Italy","IT"],["Jersey","JE"],["Latvia","LV"],["Liechtenstein","LI"],["Lithuania","LT"],["Luxembourg","LU"],["Macedonia","MK"],["Malta","MT"],["Moldova","MD"],["Monaco","MC"],["Montenegro","ME"],["Netherlands","NL"],["Norway","NO"],["Poland","PL"],["Portugal","PT"],["Romania","RO"],["San Marino","SM"],["Serbia","RS"],["Slovakia","SK"],["Slovenia","SI"],["Spain","ES"],["Sweden","SE"],["Switzerland","CH"],["Svalbard and Jan Mayen","SJ"],["Ukraine","UA"],["United Kingdom","GB"],["Vatican City","VA"]],"North America":[["American Samoa","AS"],["Anguilla","AI"],["Antigua and Barbuda","AG"],["Bahamas","BS"],["Barbados","BB"],["Belize","BZ"],["Bermuda","BM"],["Canada","CA"],["Cayman Islands","KY"],["Costa Rica","CR"],["Cuba","CU"],["Dominica","DM"],["Dominican Republic","DO"],["El Salvador","SV"],["Greenland","GL"],["Grenada","GD"],["Guadeloupe","GP"],["Guatemala","GT"],["Haiti","HT"],["Honduras","HN"],["Jamaica","JM"],["Martinique","MQ"],["Mexico","MX"],["Montserrat","MS"],["Nicaragua","NI"],["Panama","PA"],["Puerto Rico","PR"],["Saint Barth\xe9lemy","BL"],["Saint Kitts and Nevis","KN"],["Saint Lucia","LC"],["Saint Martin","MF"],["Saint Pierre and Miquelon","PM"],["Saint Vincent and the Grenadines","VC"],["Sint Maarten","SX"],["Trinidad and Tobago","TT"],["Turks and Caicos Islands","TC"],["US Minor Outlying Islands","UM"],["United States","US"],["Virgin Islands (British)","VG"],["Virgin Islands (U.S.)","VI"]],"Oceania":[["Australia","AU"],["Cook Islands","CK"],["Fiji","FJ"],["French Polynesia","PF"],["Guam","GU"],["Heard Island and McDonald Islands","HM"],["Kiribati","KI"],["Marshall Islands","MH"],["Micronesia","FM"],["Nauru","NR"],["New Caledonia","NC"],["New Zealand","NZ"],["Niue","NU"],["Norfolk Island","NF"],["Northern Mariana Islands","MP"],["Palau","PW"],["Papua New Guinea","PG"],["Pitcairn","PN"],["Samoa","WS"],["Solomon Islands","SB"],["Tokelau","TK"],["Tonga","TO"],["Tuvalu","TV"],["Vanuatu","VU"],["Wallis and Futuna","WF"]],"South America":[["Argentina","AR"],["Aruba","AW"],["Bolivia","BO"],["Bonaire, Sint Eustatius and Saba","BQ"],["Brazil","BR"],["Chile","CL"],["Colombia","CO"],["Cura\xe7ao","CW"],["Ecuador","EC"],["Falkland Islands (Malvinas)","FK"],["French Guiana","GF"],["Guyana","GY"],["Netherlands Antilles","AN"],["Paraguay","PY"],["Peru","PE"],["Suriname","SR"],["Uruguay","UY"],["Venezuela","VE"]]};var t=this;return e=e||{},this.each(function(){var n=$(this);if("close"===e){if(!n.prev().hasClass("country-picker"))return;return n.prev().remove(),void n.show()}if(!n.prev().hasClass("country-picker")){var a=[];for(var i in t.countries)t.countries.hasOwnProperty(i)&&a.push('<optgroup label="'+i+'">'+$.map(t.countries[i],function(e){return'<option value="'+e[1]+'">'+e[0]+"</option>"}).join("")+"</optgroup>");var r="1"==n.attr("data-allow-blank")||!!e.allowBlank;n.before('<span class="country-picker"><select'+(n.attr("readonly")||n.attr("disabled")?" disabled ":"")+">"+(r?"<option></option>":"")+a.join("")+"</select></span>"),n.hide();var s=n.prev(),o=s.find("select");s.addClass(n.attr("class")),o.addClass(n.attr("class")),n.get(0).style.width&&(s.get(0).style.width=n.get(0).style.width);var l=!1;return o.select2({"allowClear":r}).on("change",function(){n.val($(this).val()),l||(l=!0,n.trigger("change"),l=!1)}),n.on("change",function(){l||(l=!0,o.val($(this).val()).trigger("change"),l=!1)}).trigger("change"),this}})};var PhoneCountryNames=null;$.fn.phoneCountry=function(e,t){return this.each(function(){function n(e,t,n){if("1"==e){var o=a(e,t=t.split(""));$(r+" option").removeAttr("selected").prop("selected",!1),$(r).find("option[data-country="+o+"]").prop("selected",!0),t=t.join("")}else"353"==e?7==t.length?t="00"+t:8==t.length&&(t="0"+t):"32"==e&&8==t.length&&(t="0"+t);i.val(t),n&&s.trigger("change")}function a(e,t){var n=[];n.push(t[0]),n.push(t[1]),n.push(t[2]),n=n.join("");var a="US";for(var i in PhoneOverlays[1]){-1!=PhoneOverlays[1][i].indexOf(n)&&(a=i);break}return a}var i=$(this),r=i.attr("data-country-code"),s=$(r),o=null;if("string"!=typeof e){var l=s.attr("data-selected");l&&(s.find("option").removeAttr("selected"),s.find("option").each(function(){$(this).text()==l?$(this).attr("selected","selected"):$(this).removeAttr("selected")})),e&&e.width&&(o=e.width),s&&0!=s.length||console.error("data-country-code='"+r+"' not found on input for country picker"),$(r+" option").each(function(){var e=$(this).html().split("+");$(this).attr("data-country",$.trim(e[0]))}),n($(r).val(),i.val()),o&&$(r).css({"width":o+"px"}),e&&e.noSelect2||$(r).select2({"formatResult":PhoneCountryFormatVal,"formatSelection":PhoneCountryFormatVal,"dropdownAutoWidth":!0,"matcher":PhoneCountryMatcher}),$(r).on("change",function(){var e=$(this).find("option:selected").attr("data-country"),t=PhoneFormatList[e];t.match(/^d/)&&(t=" "+t),t=t.replace(/d/g,"9"),i.mask(t)});var c=$(r).find("option:selected").attr("data-country"),d=PhoneFormatList[c];return d&&(d.match(/^d/)&&(d=" "+d),d=d.replace(/d/g,"9"),i.mask(d)),this}switch(e){case"set":n(t[0],t[1],!0)}})},$.fn.phoneCountryCombo=function(e){function t(e){var t=PhoneFormatList[e];return t.match(/^d/)&&(t=" "+t),t=t.replace(/d/g,"9")}if(e&&e.iso_country)var n=e.iso_country;else n="undefined"!=typeof CTM&&CTM.country?CTM.country:"US";return this.each(function(){function a(e){$(e).val();setTimeout(function(){var a=$(e).find("option:selected"),i=$(a).attr("data-display"),r=$(a).attr("data-country");p.removeAttr("selected");var s=u.unmask().val();if("1"==r){var o=i.replace(/\D/g,"").split(""),l=[];l.push(o[0]),l.push(o[1]),l.push(o[2]),l=l.join("");var c="US";-1!=PhoneOverlays[1].CA.indexOf(l)?c="CA":-1!=PhoneOverlays[1].PR.indexOf(l)?c="PR":-1!=PhoneOverlays[1].DO.indexOf(l)&&(c="DO"),p.find("option").removeAttr("selected"),$(p.find("option[data-country="+c+"]")[0]).attr("selected","selected"),d.find("input.combobox.phone").val(i),p.trigger("change")}else r&&($(p.find("option[value="+r+"]")[0]).attr("selected","selected"),d.find("input.combobox.phone").val(i),p.select2("val",r));var f=p.find("option:selected").attr("data-country");f||(f=n);var b=t(f);i=i?i.replace(new RegExp("^\\+?"+r),""):"",0==$.trim(i).length&&(i=s),u.unmask().val(i).mask(b,{"completed":function(){$(e).trigger("mask.completed"),$(e).trigger("change")}}),$(e).trigger("change")},10)}var i=$(this);if("refresh"!=e){var r=i.attr("data-countries");if(r){var s=JSON.parse(r);d=$("<div class='phone-picker'></div>");if(i.before(d),i=i.detach(),d.append(i),i.val())var o=i.find("option:selected").attr("data-country");else o=n;var l=i.attr("data-country-name");l||(l="country");var c=Mustache.to_html('<select class="country" name="'+l+'">{{#countries}}<option value="{{country_prefix}}" data-country="{{country_code}}">{{country_code}} +{{country_prefix}}</option>{{/countries}}</select>',{"countries":s});i.before(c),(p=i.prev("select")).find("option[data-country='"+o+"']").prop("selected",!0),i.combobox({"enablePhoneMask":o});u=(d=i.closest(".combobox-container")).find("input.phone");i.on("selected",function(){a(this)}),p.select2({"formatResult":PhoneCountryFormatValNoFlag,"formatSelection":PhoneCountryFormatValNoFlag}).on("change",function(){var e=t($(this).find("option:selected").attr("data-country")),n=d.find("input.combobox.phone");n.val(""),n.unmask().mask(e,{"completed":function(){i.trigger("mask.completed"),$(i).trigger("change")}})}),a(i)}}else{var d,u=(d=i.closest(".phone-picker")).find("input.phone"),p=i.prev("select");a(i)}})},$.fn.phoneCountryComboBox=function(e,t){var n=e&&"string"!=typeof e&&e.version?e.version:2,a=this.map(function(){function a(e){var t=o.data("userInputControl"),n=o.data("countryInputPicker");if((e=$.trim(e)).match(/^\+[0-9]+/)){function a(e){n.val(e.country),t.val(e.basenumber),o.val("+"+e.prefix+e.basenumber),n.select2("container").find(".select2-chosen i.country").attr("data-code",e.country);var a=function(i,r){e.country&&r.toUpperCase()!=e.country.toUpperCase()?n.off("updated.results",a):(setTimeout(function(){t.val(e.basenumber),setTimeout(function(){t.trigger("paste.mask"),o.val("+"+e.prefix+e.basenumber)},100)},0),n.off("updated.results",a))};n.on("updated.results",a),n.trigger("change")}if(e="+"+e.replace(/\D/g,""),void 0!==PhoneCountryComboBox){for(var i=PhoneCountryComboBox.countries,r=0;r<i.length;r++)if(e.match("^\\+"+i[r].prefix)){a({"country":i[r].code,"basenumber":e.substring(i[r].prefix.length+1),"prefix":i[r].prefix});break}}else $.get("/receiving_numbers/check_rate",{"number":e},a)}else if(e.match(/@/)){n.val("sip");var s=function(){setTimeout(function(){t.val(e)},100),n.off("updated.results",s)};n.on("updated.results",s),n.trigger("change"),t.unmask(),t.data("format.mask.on",!1),t.val("")}}function i(t,n){var a=u.select2("container").find(".select2-chosen i.country");if(a.length&&a.attr("data-code")){var r=a.attr("data-code");r.match(/sip/i)&&(r="SIP");var s=PhoneFormatList[r].replace(/d/g,"9");if(u.data("countryCode")!=r||t){u.data("countryCode",r),H?n||d.val(""):H=!0;var o=d.val();"SIP"!=r?(d.mask(s,{"allowPartial":e&&e.allowPartial}),d.removeAttr("placeholder"),d.data("format.mask.on",!0),d.data("format.mask",s)):(d.removeAttr("placeholder"),d.data("format.mask.on",!1),d.unmask());var l=d.val();"SIP"==r&&o!=l&&n&&d.val(o)}u.trigger("updated.results",r)}else{var c=u.data("country.timeout");c||(c=setTimeout(function(){i(t,n),u.data("country.timeout",null)},300),u.data("country.timeout",c))}}function r(t){var n=u.select2("container").find(".select2-chosen i.country").attr("data-code");if((d.data("format.mask.on")||"sip:"==n)&&void 0===t||void 0!==t&&!t)d.unmask(),d.data("format.mask.on",!1),d.attr("placeholder",""),d.focus(),d.select();else{try{d.mask(d.data("format.mask"),{"allowPartial":e&&e.allowPartial})}catch(a){}d.removeAttr("placeholder"),d.data("format.mask.on",!0)}}function s(){if(u){var e=u.select2("data");if(e){if("sip:"==e.text)var t=d.val();else{t=null;try{t=d.val()?"+"+u.select2("data").text.replace(/\D/g,"")+d.val().replace(/\D/g,""):""}catch(n){console.log(n),t=""}}o.val(t)}else setTimeout(s,10)}}var o=$(this);if("close"===e){if(!o.closest(".phone-picker").length)return o;o.removeClass("phone combobox"),o.closest(".phone-picker").before(o).remove(),o.css({"display":""}),o.removeAttr("tabIndex");var l=$(o.get(0).outerHTML),c=o.val();return o.replaceWith(l),l.val(c),l}if("valid"===e)return(d=o.data("userInputControl")).valid();if(n>=3&&o.closest(".phone-picker").length)return o;if("string"==typeof e){if(!o.data("isComboBoxPicker"))return null;switch(e){case"search.off":var d=o.data("userInputControl"),u=o.data("countryInputPicker");return void o.closest(".phone-picker.phone-picker-2").find(".combobox-button").hide();case"search.on":d=o.data("userInputControl"),u=o.data("countryInputPicker");return void o.closest(".phone-picker.phone-picker-2").find(".combobox-button").show();case"focus":return(d=o.data("userInputControl")).is(":focus")||d.focus(),this;case"keyinput":var p=t[0]||"",f=!1;function b(){if(""==p)(a=jQuery.Event("keydown.mask")).which=8,d.trigger(a);else for(var e=p.split(""),t=0,n=e.length;t<n;++t){var a,i=e[t];(a=jQuery.Event("keypress.mask")).which=i.charCodeAt(0),setTimeout(function(){d.trigger(a)},t)}}return(d=o.data("userInputControl")).is(":focus")||(d.focus(),f=!0),f?setTimeout(b,20):b(),this;case"digits":if(void 0===t){d=o.data("userInputControl");var h=(u=o.data("countryInputPicker")).select2("container").find(".select2-chosen i.country").attr("data-prefix"),m=d.val().replace(/\D/g,"");return m.length?(1!=parseInt(h)&&39!=parseInt(h)&&m.match(/^0/)&&(m=m.replace(/^0/,"")),[h,m].join("")):""}(d=o.data("userInputControl")).val(t[0]);case"set":a(t);break;case"val":if(void 0===t){d=o.data("userInputControl");var v=(u=o.data("countryInputPicker")).select2("container").find(".select2-chosen i.country").attr("data-code"),g=d.val();return 1!=parseInt(v)&&g.match(/^0/)&&(g=g.replace(/^0/,"")),[v,g]}d=o.data("userInputControl");(u=o.data("countryInputPicker")).val(t[0]),t[1]&&d.val(t[1]);var _=function(e,n){if(t[0]&&n.toUpperCase()!=t[0].toUpperCase())return console.log("skip for later:",t[0],n),void u.off("updated.results",_);setTimeout(function(){d.val(t[1]),o.trigger("ctm.change")},0),u.off("updated.results",_)};return u.on("updated.results",_),u.trigger("change"),[t[0],t[1]]}return o}var y="on"==o.attr("data-label"),w=$("<div class='"+(void 0!==PhoneCountryComboBox?"":"loading ")+" phone-picker phone-picker-2'></div>");w.attr("style","max-width:100%;"+(o.attr("style")||"")),w.addClass((o.attr("class")||"").replace(/(text|string|combobox)/g,""));var k=o.attr("style");o.removeAttr("style"),o.before(w),o=o.detach(),w.append("<div class='inner'></div>").find(".inner").html(o),o.css({"max-width":"calc(100% - 70px)","height":"28px","left":"-2px","display":"inline-block"});var C=o.attr("data-country-name");C||(C="country");var x=o.attr("data-id");if(x||(x=""),e&&e.iso_country)var T=new String(e.iso_country).toUpperCase();else if(o.attr("data-country"))T=o.attr("data-country");else T="undefined"!=typeof CTM&&CTM.country?CTM.country:"US";var S=o.val();if(n>=3&&S.match(/@/)&&(T="SIP"),n>=3&&void 0!==PhoneCountryComboBox&&S&&("+"==S[0]||e&&"string"!=typeof e&&e.noPlus)){e.noPlus&&"+"!=S[0]&&S.match(/^\D*[23456789](?:\D*\d){9}\D*$/)&&(S="1"+S),S="+"+S.replace(/\D/g,"");var M=!1;for(var j in PhoneOverlays[1])if(S.match(new RegExp("^\\+1("+PhoneOverlays[1][j].join("|")+")"))){T=j,S=S.substring(2),M=!0;break}if(!M)for(var E=PhoneCountryComboBox.countries,A=0;A<E.length;A++)if(S.match("^\\+"+E[A].prefix)){T=E[A].code,S=S.substring(E[A].prefix.length+1);break}}var P=o.attr("name"),I="_id";if(P&&(I=P.match(/\[/)?P.replace(/\[(\w+)\]/,"[$1_id]"):P+"_id"),n>=3&&(C=""),window.PhoneCountryComboBox){var D=PhoneCountryComboBox.countries;e&&e.countries&&(D=D.filter(function(t){return-1!=e.countries.indexOf(t.code)})),o.before('<select name="'+C+'" class="country country-picker"'+(o.attr("readonly")||o.attr("disabled")?" disabled ":"")+">"+D.map(function(e){return'<option value="'+e.code+'"'+(T==e.code.toUpperCase()?" selected":"")+">"+e.code+" +"+e.prefix+"</option>"}).join(" ")+"</select>")}else o.before("<input type='text' value='"+T+"' class='country country-picker' name='"+C+"'/>");o.after('<input type="hidden" name="'+I+'" class="selected_id" value="'+x+'"/>'),o.after('<div class="chzn-container combobox-container"><input class="combobox phone" autocomplete="off" autocorrect="off" autocapitalize="off" type="tel" spellcheck="false"/><div class="combobox-button" type="button" tabindex="-1"><i class="font-search toggle-mask"></i></div></div>');u=o.prev(".country-picker");var R=o.next(".combobox-container"),L=(d=R.find("input.phone"),R.find(".combobox-button")),N=R.next(".selected_id");if(y){var O=R.closest(".phone-picker");O.addClass("with-label"),R.after("<span class='picker-label'></span>");var F=O.find(".picker-label"),z=o.attr("data-label-value");z&&F.text(z)}o.addClass("phone combobox text"),d.addClass("text phone-input-control"),o.attr("readonly")&&d.attr("readonly",!0),o.attr("disabled")&&d.attr("disabled",!0),d.attr("autocomplete","phonenumber"),o.data("userInputControl",d),o.data("countryInputPicker",u),o.data("isComboBoxPicker",!0),S&&o.attr("data-country-value")?S=S.replace(new RegExp("^\\+"+o.attr("data-country-value")),""):S&&S.match(/^\+1/)&&(S=S.replace(/^\+1/,""));S&&(d.val(S),setTimeout(function(){d.trigger("paste.mask")},100));var H=!1,U=0,B="closed",q={"shortnames":!0,"hideLoader":!0,"formatters":{"formatResult":PhoneCountryFormatVal,"formatSelection":PhoneCountryFormatVal,"dropdownAutoWidth":!0,"matcher":PhoneCountryMatcher},"placement":e?e.placement:null,"onSelectionInit":function(){++U>1&&w.removeClass("loading"),i()}};if(void 0!==PhoneCountryComboBox){var G=u.select2({"formatResult":PhoneCountryFormatVal,"formatSelection":PhoneCountryFormatVal,"dropdownAutoWidth":!0,"matcher":PhoneCountryMatcher});i()}else G=setupMultiPicker(u,"country",!1,!0,q);var W={"hideLoader":!0,"showMissing":!1,"onSelectionInit":function(e){++U>1&&(w.removeClass("loading"),setTimeout(function(){i(!0,!0)},100)),e&&e.id&&(d.val(e.id),
setTimeout(function(){d.trigger("paste.mask")},100))},"formatNoMatches":function(){var e=u.select2("container").find(".select2-chosen i.country").attr("data-code");return"No <i class='country "+(e?e.replace(":",""):"")+"' style='display:inline'><i class='i'></i> "+(e&&PhoneCountryNames[e]||"")+"</i> numbers found"},"filters":{"searchOptions":function(){var e=u.select2("container").find(".select2-chosen i.country");if("sip:"==e.attr("data-code"))var t="sip";else t=e.attr("data-prefix");return{"country_code":t}}},"searchFromInput":function(){var e=u.select2("container").find(".select2-chosen i.country").attr("data-code"),t="";return d.data("format.mask.on")?"sip:"==e?(t=d.val().replace(/_+/g,""),d.trigger("change")):t=d.val().replace(/\D/g,""):t=d.val(),t},"placement":e?e.placement:null};if(e&&"object"==typeof e&&"none"==e.dropdown)L.hide();else var V=setupMultiPicker(o,"receiving_number","",!0,W);var Q=o.prev(".combobox.phone").find(".select2-input");Q.on("focus",function(){d.unmask(),d.data("format.mask.on",!1),d.attr("placeholder",""),d.focus(),Q.closest(".select2-search").hide()}),G.on("change",function(){i()});var Y,K,J,Z,X=!1,ee="",te=null;V&&L.mousedown(function(e){e.preventDefault(),ne=!0;Q.val();Q.val(""),ee=d.val(),Q.trigger("input"),ne=!1,X=!1,V.select2("open")}),V&&V.on("select2-open",function(){te=new Date,B="opened",r(!1)}).on("select2-close",function(){B="closed",r(!0),X||""==ee||(d.val(ee),d.trigger("change"),ee="",X=!1)}).on("select2-selecting",function(){X=!0}),d.keydown(function(e){V&&40==e.keyCode&&"opened"!=B&&L.is(":visible")?L.trigger("mousedown"):!V||40!=e.keyCode&&38!=e.keyCode&&27!=e.keyCode&&13!=e.keyCode&&10!=e.keyCode||"opened"!=B?13!=e.keyCode&&10!=e.keyCode?d.data("format.mask.on")?N.val(" "):(Q.val(d.val()),Q.trigger("input")):d.trigger("change"):V.data("select2").search.trigger(e)}),d.on("mousedown touchstart",function(e){J=(new Date).getTime(),Y=e.pageX?e.pageX:e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0]?e.originalEvent.touches[0].pageX:0,K=e.pageY?e.pageY:e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0]?e.originalEvent.touches[0].pageY:0}).on("mouseup touchend",function(t){var n=this;n.focus();var a=t.pageX?t.pageX:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0].pageX:0,i=t.pageY?t.pageY:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0].pageY:0,r=(new Date).getTime();if(n.selectionEnd<=n.selectionStart||a==Y&&i==K&&r-J<500&&(!Z||r-Z>=1e3)){var s=n.value.match(/_|$/);n.selectionEnd>=s.index||e&&e.alwaysSelectEnd?n.setSelectionRange(s.index,s.index):(s=n.value.match(/^[^0-9]*/),n.selectionStart<s.index+s[0].length&&n.setSelectionRange(s.index+s[0].length,s.index+s[0].length))}Z=r,t.preventDefault()}),d.blur(function(){d.val().match(/^[^0-9]*$/)&&d.val("")}),setTimeout(s,0),d.on("change",function(){s()});var ne=!1;return V&&V.on("change",function(e){if(!ne&&e.added&&e.added.digits){var t=e.added.digits;if(d.val(t),d.trigger("change"),d.trigger("paste"),n<3){console.log("check added id: ",e.added.id),e.added.id&&parseInt(e.added.id)>0&&(console.log("set id value:",e.added.id),N.val(e.added.id)),y&&e.added.text&&F.text(e.added.text.replace(e.added.extra,""));try{ne=!0,V.val("")}catch(e){}finally{ne=!1}}o.trigger("ctm.change"),setTimeout(function(){d.focus()},50)}}),o.on("change",function(e){te&&((new Date).getTime()+100-te.getTime()<100||(a(e.added.extra),e.added.id&&parseInt(e.added.id)>0&&N.val(e.added.id),d.data("format.mask.on")&&setTimeout(function(){d.trigger("paste.mask")},100),o.trigger("ctm.change")))}),d.on("change",function(){te&&((new Date).getTime()+100-te.getTime()<100||o.trigger("ctm.change"))}),d.on("paste",function(e){var t=null;e.originalEvent&&e.originalEvent.clipboardData&&((t=e.originalEvent.clipboardData.getData("text"))&&a(t))}),k?o.attr("style",k):o.removeAttr("style",k),o.hide(),o});return 1==a.length?a[0]:a},$.fn.phoneCountryPicker=function(){var e=this.map(function(){var e=$(this),t=e.val(),n="",a=e.attr("data-default")||(o&&o["default"]?o["default"]:null),i=!!e.data("allow-blank");i?n='<option value="">( Allow Any Country  )</option>':a&&PhoneCountryComboBox.codes[a]&&(n='<option value="">Default ('+PhoneCountryComboBox.codes[a].code+" +"+PhoneCountryComboBox.codes[a].prefix+")</option>");var r=!1;e.attr("data-full")?r="1"==e.attr("data-full"):o&&o.full&&(r=o.full),e.before('<select class="country country-picker">'+n+PhoneCountryComboBox.countries.map(function(e){var n=r?e.code+" +"+e.prefix:e.code;return"SIP"==e.code?"":'<option value="'+n+'"'+(t==n?" selected":"")+">"+e.code+" +"+e.prefix+"</option>"}).join(" ")+"</select>");var s=e.prev(".country-picker");s.attr("style","max-width:100%;"+(e.attr("style")||"")),s.attr("id",e.attr("id")),s.attr("name",e.attr("name"));var o={"allowClear":i,"formatResult":PhoneCountryFormatVal,"formatSelection":PhoneCountryFormatVal,"dropdownAutoWidth":!0,"matcher":PhoneCountryMatcher};console.log("picker init with: ",o);var l=s.select2(o);return l.on("change",function(){e.val(l.select2("val"))}),e.remove(),s});return 1==e.length?e[0]:e},$.fn.stateRegionPicker=function(e){this.regions={"ca":[["Alberta","AB"],["British Columbia","BC"],["Manitoba","MB"],["New Brunswick","NB"],["Newfoundland/Labrador","NL"],["Nova Scotia","NS"],["Ontario","ON"],["Prince Edward Island","PE"],["Quebec","QC"],["Saskatchewan","SK"],["Northwest Territories","NT"],["Nunavut","NU"],["Yukon","YT"]],"us":[["Alabama","AL"],["Alaska","AK"],["Arizona","AZ"],["Arkansas","AR"],["California","CA"],["Colorado","CO"],["Connecticut","CT"],["Delaware","DE"],["Florida","FL"],["Georgia","GA"],["Hawaii","HI"],["Idaho","ID"],["Illinois","IL"],["Indiana","IN"],["Iowa","IA"],["Kansas","KS"],["Kentucky","KY"],["Louisiana","LA"],["Maine","ME"],["Maryland","MD"],["Massachusetts","MA"],["Michigan","MI"],["Minnesota","MN"],["Mississippi","MS"],["Missouri","MO"],["Montana","MT"],["Nebraska","NE"],["Nevada","NV"],["New Hampshire","NH"],["New Jersey","NJ"],["New Mexico","NM"],["New York","NY"],["North Carolina","NC"],["North Dakota","ND"],["Ohio","OH"],["Oklahoma","OK"],["Oregon","OR"],["Pennsylvania","PA"],["Rhode Island","RI"],["South Carolina","SC"],["South Dakota","SD"],["Tennessee","TN"],["Texas","TX"],["Utah","UT"],["Vermont","VT"],["Virginia","VA"],["Washington","WA"],["West Virginia","WV"],["Wisconsin","WI"],["Wyoming","WY"],["District of Columbia","DC"],["American Samoa","AS"],["Guam","GU"],["North Mariana Islands","MP"],["Puerto Rico","PR"],["United States Minor Outlying Islands","UM"],["Virgin Islands","VI"]]};var t=this;return e=e||{},this.each(function(){var n=$(this);if("close"===e){if(!n.prev().hasClass("state-region-picker"))return;return n.prev().remove(),void n.show()}if(!n.prev().hasClass("state-region-picker")){n.before('<span class="state-region-picker"><select'+(n.attr("readonly")||n.attr("disabled")?" disabled ":"")+'><option value="">Non-US/Canada</option><optgroup label="Canada">'+$.map(t.regions.ca,function(e){return'<option value="'+e[1]+'">'+e[0]+"</option>"}).join("")+'</optgroup><optgroup label="United States">'+$.map(t.regions.us,function(e){return'<option value="'+e[1]+'">'+e[0]+"</option>"}).join("")+'</optgroup></select><input type="text" class="text"'+(n.attr("readonly")?" readonly ":"")+(n.attr("disabled")?" disabled ":"")+"/></span>"),n.hide();var a=n.prev(),i=a.find("select"),r=a.find("input");a.addClass(n.attr("class")),i.addClass(n.attr("class")),n.hasClass("extra_height")||r.addClass("standard_height"),r.addClass(n.attr("class")),n.get(0).style.width&&(a.get(0).style.width=n.get(0).style.width);var s=!1;return i.select2({"dropdownCssClass":"wider"}).on("change",function(){$(this).val()?(a.removeClass("custom-region"),n.val($(this).val())):(a.addClass("custom-region"),n.val(r.val())),s||(s=!0,n.trigger("change"),s=!1)}),r.on("input",function(){s||n.val($(this).val())}),n.on("change",function(){if(!s){s=!0;for(var e=$(this).val(),n=!1,a=0;a<t.regions.ca.length;a++)if(t.regions.ca[a][1]==e){n=!0;break}if(!n)for(a=0;a<t.regions.us.length;a++)if(t.regions.us[a][1]==e){n=!0;break}r.val(n?"":e),i.val(n?e:"").trigger("change"),s=!1}}).trigger("change"),this}})};var filtered=!1,durationLabel=null,talkTimeLabel=null,ringTimeLabel=null;window.wasOpened=!1;var builtin_date_ranges=["today","yesterday","last7","last30","lastmonth","thismonth","schedule"],ctmFilterExcluded={"page":1,"excluded":0,"converted":0,"reported":1,"stats":"on","form_entries":0,"entries_per_page":30,"filter_visitor_data":0,"has_audio":0,"is_new_caller":0,"group_callers":0,"per_page":30,"with_time":1,"exclude_fields":"transcription_text,chat_messages","date_operator":"range","call_score_min":0,"call_score_max":5,"talk_time_min":"","talk_time_max":"","ring_time_min":"","ring_time_max":"","duration_min":"","duration_max":"","talk_time_operator":"greater_than_equal","ring_time_operator":"greater_than_equal","duration_operator":"greater_than_equal","converted_amount_min":"","converted_amount_max":"","converted_amount_operator":"greater_than_equal","multi_tags_operator":"includes","multi_agents_operator":"includes","transfer_from_operator":"includes","transfer_to_operator":"includes","multi_sources_operator":"includes","multi_tracking_numbers_operator":"includes","multi_receiving_numbers_operator":"includes","filter_accounts_operator":"includes","direction_operator":"includes","range":window.location.pathname.match(/\/reports\/view_source/)?"last30":"alltime","direction":["inbound","outbound","form"],"call_status_operator":"includes","call_status":[],"call_score_tag_operator":"includes","call_score_tag":[],"call_score_operator":"range","keypress_operator":"includes","keypress":[],"schedule":0,"order":"metrics","sort_dir":"DESC","interval":"day","by":"source"};window.text_log?ctmFilterExcluded.direction=["msg_inbound","msg_outbound"]:window.chat_log?ctmFilterExcluded.direction=["chat"]:window.form_log?ctmFilterExcluded.direction=["form"]:CTM.enable_chat?ctmFilterExcluded.direction=["inbound","outbound","form","chat"]:ctmFilterExcluded.direction=["inbound","outbound","form"],$(function(){var e=$("#report-date-selection");e.find("[data-type=duration], [data-type=number], [data-type=float], [data-type=date]").each(function(e,t){ctmFilterExcluded[t.name]="";var n=t.name.match("^custom_min\\[(.+)\\]$");n&&(ctmFilterExcluded["custom_operator["+n[1]+"]"]="greater_than_equal")}),e.find("[data-type=rating]").each(function(e,t){var n=t.name.match("^custom_min\\[(.+)\\]$");n?(ctmFilterExcluded["custom_operator["+n[1]+"]"]="greater_than_equal",ctmFilterExcluded[t.name]=""):ctmFilterExcluded[t.name]="5"}),e.find("[data-type=picker]").each(function(e,t){ctmFilterExcluded[t.name]="";var n=t.name.match("^custom\\[(.+)\\]$");n&&(ctmFilterExcluded["custom_operator["+n[1]+"]"]="includes")}),e.find("[data-type=text], [data-type=email], [data-type=phone], [data-type=url], [data-type=region], [data-type=country]").each(function(e,t){ctmFilterExcluded[t.name]="";var n=t.name.match("^custom\\[(.+)\\]$");n&&(ctmFilterExcluded["custom_operator["+n[1]+"]"]="includes")}),e.find("[data-type=bool]").each(function(e,t){var n=t.name.match("^custom\\[(.+)\\]$");n&&(ctmFilterExcluded["custom_operator["+n[1]+"]"]="")})}),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||c.defaults,this.rules=d.normal,this.options.gfm&&(this.options.tables?this.rules=d.tables:this.rules=d.gfm)}function t(e,t){if(this.options=t||c.defaults,this.links=e,this.rules=u.normal,this.renderer=this.options.renderer||new n,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=u.breaks:this.rules=u.gfm:this.options.pedantic&&(this.rules=u.pedantic)}function n(e){this.options=e||{}}function a(e){this.tokens=[],this.token=null,this.options=e||c.defaults,this.options.renderer=this.options.renderer||new n,this.renderer=this.options.renderer,this.renderer.options=this.options}function i(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(e){return e.replace(/&([#\w]+);/g,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function s(e,t){return e=e.source,t=t||"",function n(a,i){return a?(i=(i=i.source||i).replace(/(^|[^\[])\^/g,"$1"),e=e.replace(a,i),n):new RegExp(e,t)}}function o(){}function l(e){for(var t,n,a=1;a<arguments.length;a++)for(n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function c(t,n,r){if(r||"function"==typeof n){r||(r=n,n=null);var s,o,d=(n=l({},c.defaults,n||{})).highlight,u=0;try{s=e.lex(t,n)}catch(f){return r(f)}o=s.length;var p=function(e){if(e)return n.highlight=d,r(e);var t;try{t=a.parse(s,n)}catch(f){e=f}return n.highlight=d,e?r(e):r(null,t)};if(!d||d.length<3)return p();if(delete n.highlight,!o)return p();for(;u<s.length;u++)!function(e){"code"!==e.type?--o||p():d(e.text,e.lang,function(t,n){return t?p(t):null==n||n===e.text?--o||p():(e.text=n,e.escaped=!0,void(--o||p()))})}(s[u])}else try{return n&&(n=l({},c.defaults,n)),a.parse(e.lex(t,n),n)}catch(f){if(f.message+="\nPlease report this to https://github.com/chjj/marked.",(n||c.defaults).silent)return"<p>An error occurred:</p><pre>"+i(f.message+"",!0)+"</pre>";throw f}}var d={"newline":/^\n+/,"code":/^( {4}[^\n]+\n*)+/,"fences":o,"hr":/^( *[-*_]){3,} *(?:\n+|$)/,"heading":/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,"nptable":o,"lheading":/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,"blockquote":/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,"list":/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,"html":/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,"def":/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,"table":o,"paragraph":/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,"text":/^[^\n]+/,"bullet":/(?:[*+-]|\d+\.)/,"item":/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/};d.item=s(d.item,"gm")(/bull/g,d.bullet)(),d.list=s(d.list)(/bull/g,d.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+d.def.source+")")(),d.blockquote=s(d.blockquote)("def",d.def)(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",d.html=s(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)(),d.paragraph=s(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)(),d.normal=l({},d),d.gfm=l({},d.normal,{"fences":/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/,"paragraph":/^/,"heading":/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),d.gfm.paragraph=s(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|"+d.list.source.replace("\\1","\\3")+"|")(),d.tables=l({},d.gfm,{"nptable":/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,"table":/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=d,e.lex=function(t,n){return new e(n).lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,n){var a,i,r,s,o,l,c,u,p;for(e=e.replace(/^ +$/gm,"");e;)if((r=this.rules.newline.exec(e))&&(e=e.substring(r[0].length),r[0].length>1&&this.tokens.push({"type":"space"})),r=this.rules.code.exec(e))e=e.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({"type":"code","text":this.options.pedantic?r:r.replace(/\n+$/,"")});else if(r=this.rules.fences.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"code","lang":r[2],"text":r[3]||""});else if(r=this.rules.heading.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"heading","depth":r[1].length,"text":r[2]});else if(t&&(r=this.rules.nptable.exec(e))){for(e=e.substring(r[0].length),l={"type":"table","header":r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),"align":r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),"cells":r[3].replace(/\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].split(/ *\| */);this.tokens.push(l)}else if(r=this.rules.lheading.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"heading","depth":"="===r[2]?1:2,"text":r[1]});else if(r=this.rules.hr.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"hr"});else if(r=this.rules.blockquote.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,t,!0),this.tokens.push({"type":"blockquote_end"});else if(r=this.rules.list.exec(e)){for(e=e.substring(r[0].length),s=r[2],this.tokens.push({"type":"list_start","ordered":s.length>1}),a=!1,p=(r=r[0].match(this.rules.item)).length,u=0;u<p;u++)c=(l=r[u]).length,~(l=l.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&u!==p-1&&(s===(o=d.bullet.exec(r[u+1])[0])||s.length>1&&o.length>1||(e=r.slice(u+1).join("\n")+e,u=p-1)),i=a||/\n\n(?!\s*$)/.test(l),u!==p-1&&(a="\n"===l.charAt(l.length-1),i||(i=a)),this.tokens.push({"type":i?"loose_item_start":"list_item_start"}),this.token(l,!1,n),this.tokens.push({"type":"list_item_end"});this.tokens.push({"type":"list_end"})}else if(r=this.rules.html.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":this.options.sanitize?"paragraph":"html","pre":!this.options.sanitizer&&("pre"===r[1]||"script"===r[1]||"style"===r[1]),"text":r[0]});else if(!n&&t&&(r=this.rules.def.exec(e)))e=e.substring(r[0].length),this.tokens.links[r[1].toLowerCase()]={"href":r[2],"title":r[3]};else if(t&&(r=this.rules.table.exec(e))){for(e=e.substring(r[0].length),l={"type":"table","header":r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),"align":r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),"cells":r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(t&&(r=this.rules.paragraph.exec(e)))e=e.substring(r[0].length),this.tokens.push({"type":"paragraph","text":"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),this.tokens.push({"type":"text","text":r[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var u={"escape":/^\\([\\`*{}\[\]()#+\-.!_>])/,"autolink":/^<([^ >]+(@|:\/)[^ >]+)>/,"url":o,"tag":/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,"link":/^!?\[(inside)\]\(href\)/,"reflink":/^!?\[(inside)\]\s*\[([^\]]*)\]/,"nolink":/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,"strong":/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,"em":/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,"code":/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,"br":/^ {2,}\n(?!\s*$)/,"del":o,"text":/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,"_inside":/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,"_href":/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/};u.link=s(u.link)("inside",u._inside)("href",u._href)(),u.reflink=s(u.reflink)("inside",u._inside)(),u.normal=l({},u),u.pedantic=l({},u.normal,{"strong":/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,"em":/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),u.gfm=l({},u.normal,{"escape":s(u.escape)("])","~|])")(),"url":/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,"del":/^~~(?=\S)([\s\S]*?\S)~~/,"text":s(u.text)("]|","~]|")("|","|https?://|")()}),u.breaks=l({},u.gfm,{"br":s(u.br)("{2,}","*")(),"text":s(u.gfm.text)("{2,}","*")()}),t.rules=u,t.output=function(e,n,a){return new t(n,a).output(e)},t.prototype.output=function(e){for(var t,n,a,r,s="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),s+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(n=":"===r[1].charAt(6)?this.mangle(r[1].substring(7)):this.mangle(r[1]),a=this.mangle("mailto:")+n):a=n=i(r[1]),s+=this.renderer.link(a,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),s+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):i(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,s+=this.outputLink(r,{"href":r[2],"title":r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){s+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,s+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),s+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),s+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),s+=this.renderer.codespan(i(r[2],!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),s+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),s+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),s+=this.renderer.text(i(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(r[0].length),a=n=i(r[1]),s+=this.renderer.link(a,null,n);return s},t.prototype.outputLink=function(e,t){var n=i(t.href),a=t.title?i(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,a,this.output(e[1])):this.renderer.image(n,a,i(e[1]))},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026"):e},t.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",a=e.length,i=0;i<a;i++)t=e.charCodeAt(i),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},n.prototype.code=function(e,t,n){if(this.options.highlight){var a=this.options.highlight(e,t);null!=a&&a!==e&&(n=!0,e=a)}return t?'<pre><code class="'+this.options.langPrefix+i(t,!0)+'">'+(n?e:i(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:i(e,!0))+"\n</code></pre>"},n.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},n.prototype.html=function(e){return e},n.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},n.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},n.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},n.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},n.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},n.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},n.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},n.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},n.prototype.strong=function(e){return"<strong>"+e+"</strong>"},n.prototype.em=function(e){return"<em>"+e+"</em>"},n.prototype.codespan=function(e){return"<code>"+e+"</code>"},n.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},n.prototype.del=function(e){return"<del>"+e+"</del>"},n.prototype.link=function(e,t,n){if(this.options.sanitize){try{var a=decodeURIComponent(r(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(s){return""}if(0===a.indexOf("javascript:")||0===a.indexOf("vbscript:"))return""}var i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+=">"+n+"</a>"},n.prototype.image=function(e,t,n){var a='<img src="'+e+'" alt="'+n+'"';return t&&(a+=' title="'+t+'"'),a+=this.options.xhtml?"/>":">"},n.prototype.text=function(e){return e},a.parse=function(e,t,n){return new a(t,n).parse(e)},a.prototype.parse=function(e){this.inline=new t(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var n="";this.next();)n+=this.tok();return n},a.prototype.next=function(){return this.token=this.tokens.pop()},a.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},a.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},a.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,a,i="",r="";for(n="",e=0;e<this.token.header.length;e++)({"header":!0,"align":this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{"header":!0,"align":this.token.align[e]});for(i+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",a=0;a<t.length;a++)n+=this.renderer.tablecell(this.inline.output(t[a]),{"header":!1,"align":this.token.align[a]});r+=this.renderer.tablerow(n)}return this.renderer.table(i,r);case"blockquote_start":for(r="";"blockquote_end"!==this.next().type;)r+=this.tok();return this.renderer.blockquote(r);case"list_start":r="";for(var s=this.token.ordered;"list_end"!==this.next().type;)r+=this.tok();return this.renderer.list(r,s);case"list_item_start":for(r="";"list_item_end"!==this.next().type;)r+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(r);case"loose_item_start":for(r="";"list_item_end"!==this.next().type;)r+=this.tok();return this.renderer.listitem(r);case"html":var o=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(o);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},o.exec=o,c.options=c.setOptions=function(e){return l(c.defaults,e),c},c.defaults={"gfm":!0,"tables":!0,"breaks":!1,"pedantic":!1,"sanitize":!1,"sanitizer":null,"mangle":!0,"smartLists":!1,"silent":!1,"highlight":null,"langPrefix":"lang-","smartypants":!1,"headerPrefix":"","renderer":new n,"xhtml":!1},c.Parser=a,c.parser=a.parse,c.Renderer=n,c.Lexer=e,c.lexer=e.lex,c.InlineLexer=t,c.inlineLexer=t.output,c.parse=c,"undefined"!=typeof module&&"object"==typeof exports?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):this.MarkDownFormatter=c}.call(function(){return this||("undefined"!=typeof window?window:global)}()),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/bool"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="bool">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,118,151,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="hidden" class="custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,245,261,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,316,336,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"/>'),a.b("\n"+n),a.b('<input type="checkbox" class="custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,521,537,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,592,612,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,728,746,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly disabled")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,785,805,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b('  var selector = "'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,921,941,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]";'),a.b("\n"+n),a.b('  var box = $(selector + "[type=checkbox]");'),a.b("\n"+n),a.b('  var hidden = $(selector + "[type=hidden]");'),a.b("\n"+n),a.b("  var value = hidden.val();"),a.b("\n"+n),a.b('  hidden.val("0");'),a.b("\n"+n),a.b("  box.prop(\"checked\", (value === 'true' || value === '1' || value === 'on'));"),a.b("\n"+n),a.b('  var name = box.attr("name");'),a.b("\n"+n),a.b("  var container = box.parent();"),a.b("\n"+n),a.b("  var inputState = function() {"),a.b("\n"+n),a.b('    if (box.prop("checked")) {'),a.b("\n"+n),a.b('      hidden.removeAttr("name");'),a.b("\n"+n),a.b("    } else {"),a.b("\n"+n),a.b('      hidden.attr("name", name);'),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b('  box.bootstrapSwitch().on("switchChange.bootstrapSwitch", inputState);'),a.b("\n"+n),a.b('  container.find(".bootstrap-switch").addClass("custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,1631,1647,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('");'),a.b("\n"+n),a.b('  box.attr("name", name);'),a.b("\n"+n),a.b("  inputState();"),a.b("\n"+n),a.b("})();"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/country"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="country">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,121,154,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="text" style="width:100%" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,270,286,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.s(a.d("field.standard_height",e,t,1),e,t,1,0,0,"")||a.b(" extra_height"),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,406,426,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,560,569,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,608,628,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b('  $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,731,751,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").countryPicker({allowBlank: true});'),a.b("\n"+n),a.b("})();"),a.b("\n"+n),a.b("</script>"),a.b("\n"),
a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/date"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="date">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,118,151,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="text" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,248,264,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,319,339,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,473,491,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly disabled")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,530,550,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b("try {"),a.b("\n"+n),a.b('  $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,659,679,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").datepicker({'),a.b("\n"+n),a.b("    showTime: true,"),a.b("\n"+n),a.b("    format: 'yyyy-mm-dd H:i',"),a.b("\n"+n),a.b("    defaultTime: [0,0,0],"),a.b("\n"+n),a.b("    autoclose: true"),a.b("\n"+n),a.b("  });"),a.b("\n"+n),a.b("} catch(e) {"),a.b("\n"+n),a.b("  console.log(e);"),a.b("\n"+n),a.b("}"),a.b("\n"+n),a.b("})();"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/duration"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="duration">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,122,155,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="number" min="0" max="31536000" style="width:100%" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,296,312,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,367,387,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,521,530,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,569,589,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("$(function() {"),a.b("\n"+n),a.b('  $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,693,713,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").timeUnitPicker();'),a.b("\n"+n),a.b("});"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/email"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="email">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,119,152,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="email" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,250,266,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,321,341,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,475,484,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,523,543,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/float"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="float">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,119,152,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="number" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,251,267,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" step="0.1" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,333,353,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,487,496,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,535,555,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/number"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="number">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,120,153,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="number" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,252,268,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" min="0" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,331,351,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,485,494,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,533,553,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/phone"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="phone">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,119,152,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="tel" class="text custom_field" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,251,271,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,405,423,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly disabled")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,462,482,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("$(function() {"),a.b("\n"+n),a.b('  $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,586,606,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").phoneCountryComboBox({version:3});'),a.b("\n"+n),a.b('  var picker = $("input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,794,814,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]");'),a.b("\n"+n),a.b('  picker.closest(".phone-picker").addClass("custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,1,0,0,"")||a.b(" extra_height"),a.s(a.d("field.standard_height",e,t,1),e,t,0,1063,1079,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('");'),a.b("\n"+n),a.b("});"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/picker"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="picker">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,120,153,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<select class="custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,1,0,0,"")||a.b(" extra_height"),a.s(a.d("field.standard_height",e,t,1),e,t,0,299,315,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,370,390,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,506,515,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,554,574,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b(">"),a.b("\n"+n),a.b("  <option></option>"),a.b("\n"+n),a.s(a.f("picker_values",e,t,1),e,t,0,635,720,"{{ }}")&&(a.rs(e,t,function(e,t,a){a.b("    <option "),a.s(a.f("value",e,t,1),e,t,0,658,675,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b('value="'),n.b(n.v(n.f("value",e,t,0))),n.b('"')}),e.pop()),a.b(" "),a.b(a.v(a.f("selected",e,t,0))),a.b(">"),a.b(a.v(a.f("label",e,t,0))),a.b("</option>"),a.b("\n"+n)}),e.pop()),a.b("</select>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("  (function() {"),a.b("\n"+n),a.b('    $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' select[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,835,855,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").select2({allowClear:true});'),a.b("\n"+n),a.b('    if ("'),a.b(a.v(a.d("field.read_only",e,t,0))),a.b('" == "true") {'),a.b("\n"+n),a.b('      $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' select[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,1090,1110,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b("\\\"]\").select2('disable');"),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b("  })();"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/rating"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="rating">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,120,153,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<select class="custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,1,0,0,"")||a.b(" extra_height"),a.s(a.d("field.standard_height",e,t,1),e,t,0,299,315,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,370,390,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,506,524,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly disabled")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,563,583,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b(">"),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating0",e,t,0))),a.b(" value>"),a.b(a.v(a.d("ReportFilter.extra.no_rating",e,t,0))),a.b("</option>"),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating1",e,t,0))),a.b(' value="1">\u2605</option>'),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating2",e,t,0))),a.b(' value="2">\u2605\u2605</option>'),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating3",e,t,0))),a.b(' value="3">\u2605\u2605\u2605</option>'),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating4",e,t,0))),a.b(' value="4">\u2605\u2605\u2605\u2605</option>'),a.b("\n"+n),a.b("  <option"),a.b(a.v(a.d("ratings.rating5",e,t,0))),a.b(' value="5">\u2605\u2605\u2605\u2605\u2605</option>'),a.b("\n"+n),a.b("</select>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/region"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="region">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,120,153,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="text" style="width:100%" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,1,0,0,"")||a.b(" extra_height"),a.s(a.d("field.standard_height",e,t,1),e,t,0,334,350,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,405,425,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,559,568,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,607,627,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("(function() {"),a.b("\n"+n),a.b('  $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,730,750,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]").stateRegionPicker();'),a.b("\n"+n),a.b("})();"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/text"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="text">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,118,151,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="text" style="width:100%" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,267,283,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,338,358,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,492,501,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,540,560,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b("/>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/textarea"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="textarea">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,122,155,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<textarea style="width:100%" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,262,278,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,333,353,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" '),a.s(a.d("field.read_only",e,t,1),e,t,0,470,479,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,518,538,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b(">"),a.b(a.v(a.f("value",e,t,0))),a.b("</textarea>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),this.HoganTemplates||(this.HoganTemplates={}),this.HoganTemplates["custom_fields/url"]=new Hogan.Template({"code":function(e,t,n){var a=this;return a.b(n=n||""),a.b("<label"),a.s(a.d("field.id",e,t,1),e,t,0,19,48,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' data-field-id="'),n.b(n.v(n.d("field.id",e,t,0))),n.b('"')}),e.pop()),a.b(' data-field-type="url">'),a.b(a.v(a.d("field.name",e,t,0))),a.s(a.d("field.required",e,t,1),e,t,0,117,150,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' <span style="color:red">*</span>')}),e.pop()),a.b("</label>"),a.b("\n"+n),a.b('<input type="url" class="text custom_field'),a.s(a.d("field.standard_height",e,t,1),e,t,0,246,262,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" standard_height")}),e.pop()),a.b('" name="'),a.s(a.d("field.input_name",e,t,1),e,t,0,317,337,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('" value="'),a.b(a.v(a.f("value",e,t,0))),a.b('"'),a.s(a.d("field.read_only",e,t,1),e,t,0,471,480,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(" readonly")}),e.pop()),a.s(a.d("field.required",e,t,1),e,t,0,519,539,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(' required="required"')}),e.pop()),a.b(' style="width:100%"/><span style="display:none;position:relative;width:0;left:-22px;font-size:16px;vertical-align:middle;text-align:right"><a target="_blank" href=""></a></span>'),a.b("\n"+n),a.b("<script>"),a.b("\n"+n),a.b("$(function() {"),a.b("\n"+n),a.b('  var input = $("'),a.b(a.v(a.d("field.selector",e,t,0))),a.b(' input[name=\\"'),a.s(a.d("field.input_name",e,t,1),e,t,0,830,850,"{{ }}")&&(a.rs(e,t,function(e,t,n){n.b(n.v(n.d("field.input_name",e,t,0)))}),e.pop()),a.s(a.d("field.input_name",e,t,1),e,t,1,0,0,"")||(a.b("custom_field["),a.b(a.v(a.d("field.api_name",e,t,0))),a.b("]")),a.b('\\"]");'),a.b("\n"+n),a.b('  var link = input.parent().find("a");'),a.b("\n"+n),a.b("  function update() {"),a.b("\n"+n),a.b("    if (!!input.val()) {"),a.b("\n"+n),a.b('      input.css({"padding-right":"24px"});'),a.b("\n"+n),a.b('      link.parent().css({display:"inline-block"});'),a.b("\n"+n),a.b("    } else {"),a.b("\n"+n),a.b('      input.css({"padding-right":""});'),a.b("\n"+n),a.b('      link.parent().css({display:"none"});'),a.b("\n"+n),a.b("    }"),a.b("\n"+n),a.b('    link.attr("href", input.val());'),a.b("\n"+n),a.b("  }"),a.b("\n"+n),a.b('  input.on("input", update);'),a.b("\n"+n),a.b("  update();"),a.b("\n"+n),a.b("});"),a.b("\n"+n),a.b("</script>"),a.b("\n"),a.fl()},"partials":{},"subs":{}},"",Hogan,{}),$(function(){$(".save-to-multiple-button").click(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).hasClass("agency"),n=$(this).closest(".card").closest(".field"),a=n.find(":input").serialize(),i=n.find("h3").html().replace(/<small>.*<\/small>/,""),r=window.location.pathname.split("/");r.pop(),r.pop(),bootbox.dialog({"title":"Save "+i+"<small>All properties from the section will be saved to each selected record below.</small>","message":'<div id="selection-loader">'+ProgressBarHtml+'</div><iframe id="selection-box" src="'+r.join("/")+"?head=0&crossAccount="+(t?"1":"0")+'&selection=1&callback=_MultipleSelection_" style="width:100%;height:420px;border:0;"></iframe>',"buttons":{"cancel":{"label":"Cancel","className":"button activebutton outlined pull-left"},"ok":{"label":CTM.localize("Object","actions.save_to_multiple.label"),"className":"button callout pull-right","callback":function(){var e=$(".bootbox.modal").data("ids");bootbox.confirm("This operation will overwrite everything in the section: "+i+" for the "+e.length+" selected records",function(t){t&&$.post("/api/v1/accounts/"+CTM.account+"/batch_update",{"fields":a,"ids":e},function(){bootbox.alert({"title":"Update Received","message":"Your update is in progress changes should take effect in a few seconds."})})})}}}})})}),$(function(){function e(){$("table .inline-form").each(function(){initInlineEdit($(this))})}$("#body").on("table.page.change",function(){e()}),e()}),$.sayUploadDefaults={"lang":"en-US","voice":"alice","noPastRecordings":!1,"noSystemRecordings":!1,"afterCallback":function(){}},$.sayUploadLanguages=[{"name":"Danish","id":"da","dialects":[{"name":"Denmark","id":"DK","voices":["alice","Naja","Mads"]}]},{"name":"German","id":"de","dialects":[{"name":"","id":"","voices":["man","woman"]},{"name":"Germany","id":"DE","voices":["alice","Hans","Vicki","Marlene"]}]},{"name":"English","id":"en","dialects":[{"name":"","id":"","voices":["man","woman"]},{"name":"Australia","id":"AU","voices":["alice","Russell","Nicole"]},{"name":"Canada","id":"CA","voices":["alice"]},{"name":"United Kingdom","id":"GB","voices":["man","woman","alice","Emma","Brian","Amy"]},{"name":"India","id":"IN","voices":["alice","Raveena"]},{"name":"United States","id":"US","voices":["alice","Joanna","Salli","Kimberly","Kendra","Justin","Joey","Ivy"]},{"name":"Welsh","id":"","voices":["Geraint"]}]},{"name":"Catalan","id":"ca","dialects":[{"name":"Spain","id":"ES","voices":["alice"]}]},{"name":"Spanish","id":"es","dialects":[{"name":"","id":"","voices":["man","woman"]},{"name":"Spain","id":"ES","voices":["alice"]},{"name":"Mexico","id":"MX","voices":["alice"]},{"name":"United States","id":"US","voices":["Miguel","Penelope"]},{"name":"Castilian","id":"","voices":["Conchita","Enrique"]}]},{"name":"Finnish","id":"fi","dialects":[{"name":"Finland","id":"FI","voices":["alice"]}]},{"name":"French","id":"fr","dialects":[{"name":"","id":"","voices":["man","woman","Celine","Mathieu"]},{"name":"Canada","id":"CA","voices":["alice","Chantal"]},{"name":"France","id":"FR","voices":["alice"]}]},{"name":"Italian","id":"it","dialects":[{"name":"","id":"","voices":["man","woman","Carla","Giorgio"]},{"name":"Italy","id":"IT","voices":["alice"]}]},{"name":"Japanese","id":"ja","dialects":[{"name":"Japan","id":"JP","voices":["alice","Mizuki"]}]},{"name":"Korean","id":"ko","dialects":[{"name":"Korea","id":"KR","voices":["alice"]}]},{"name":"Norwegian","id":"nb","dialects":[{"name":"Norway","id":"NO","voices":["alice"]}]},{"name":"Dutch","id":"nl","dialects":[{"name":"Netherlands","id":"NL","voices":["alice"]}]},{"name":"Polish","id":"pl","dialects":[{"name":"Poland","id":"PL","voices":["alice","Jacek"]}]},{"name":"Portuguese","id":"pt","dialects":[{"name":"","id":"","voices":["Cristiano","Ines"]},{"name":"Brazil","id":"BR","voices":["alice","Ricardo","Vitoria"]},{"name":"Portugal","id":"PT","voices":["alice"]}]},{"name":"Russian","id":"ru","dialects":[{"name":"Russia","id":"RU","voices":["alice"]}]},{"name":"Swedish","id":"sv","dialects":[{"name":"Sweden","id":"SE","voices":["alice"]}]},{"name":"Chinese","id":"zh","dialects":[{"name":"PRC","id":"CN","voices":["alice"]},{"name":"Hong Kong","id":"HK","voices":["alice"]},{"name":"Taiwan","id":"TW","voices":["alice"]}]},{"name":"Welsh","id":"cy","dialects":[{"name":"","id":"","voices":["Gwyneth"]}]},{"name":"Digits & Waits (DTMF)","id":"dtmf","dialects":[{"name":"","id":"","voices":["alice"]}]}],$.sayUploadVoices=[{"name":"Generic Man","id":"man"},{"name":"Generic Woman","id":"woman"},{"name":"Awesome Alice","id":"alice"},{"name":"Joanna","id":"Joanna"},{"name":"Salli","id":"Salli"},{"name":"Kimberly","id":"Kimberly"},{"name":"Kendra","id":"Kendra"},{"name":"Justin","id":"Justin"},{"name":"Joey","id":"Joey"},{"name":"Ivy","id":"Ivy"},{"name":"Raveena","id":"Raveena"},{"name":"Emma","id":"Emma"},{"name":"Brian","id":"Brian"},{"name":"Amy","id":"Amy"},{"name":"Russell","id":"Russell"},{"name":"Nicole","id":"Nicole"},{"name":"Vicki","id":"Vicki"},{"name":"Marlene","id":"Marlene"},{"name":"Hans","id":"Hans"},{"name":"Naja","id":"Naja"},{"name":"Mads","id":"Mads"},{"name":"Geraint","id":"Geraint"},{"name":"Conchita","id":"Conchita"},{"name":"Enrique","id":"Enrique"},{"name":"Miguel","id":"Miguel"},{"name":"Pen\xe9lope","id":"Penelope"},{"name":"Chantal","id":"Chantal"},{"name":"C\xe9line","id":"Celine"},{"name":"Mathieu","id":"Mathieu"},{"name":"Carla","id":"Carla"},{"name":"Giorgio","id":"Giorgio"},{"name":"Ricardo","id":"Ricardo"},{"name":"Vit\xf3ria","id":"Vitoria"},{"name":"Cristiano","id":"Cristiano"},{"name":"In\xeas","id":"Ines"},{"name":"Mizuki","id":"Mizuki"},{"name":"Gwyneth","id":"Gwyneth"},{"name":"Jacek","id":"Jacek"}],$.sayUploadNameCache={},$.sayUploadNameLoading={},$.fn.sayUpload=function(e){function t(t,n,a,i,r){u||(u=!0,setTimeout(function(){u=!1},1e3),p={},r(0),p.disconnect||(p.disconnect=[]),p.disconnect.push(function(){r(100),e&&"function"==typeof e.afterCallback&&(console.log("afterCallback"),e.afterCallback())}),t.contentWindow.postMessage({"action":"play","message":n,"voice":a,"language":i,"user":CTM.user},window.location.origin),r(80))}function n(e){return!!e.val().match(/^\s*play:/)}function a(e){return!!e.val().match(/^\s*say:/)}function i(e){return!!e.val().match(/^\s*dtmf:/)}function r(e,t){var r,o,l,c,d,u,p=e.closest("div.say_upload"),b=p.find("input.hidden");if(n(e))b.val(e.val());else if(!t&&i(e))l=(o=(r=e.val()).split(":")).shift(),c="en",d=CTM.default_speech_choice.voice,r=l+":"+(u=o.join("").toLowerCase().replace(/[^w\d]/gi,"")),p.find("select[name=lang]").select2("val","dtmf").trigger("change"),p.find("select[name=voice]").select2("val","alice"),h=!0,b.val(r),e.val(u);else if(!t&&a(e)){l=(o=(r=e.val()).split(":")).shift(),c=o.shift(),d=o.shift(),u=o.join(":"),h=!1;var m=f.find(function(e){return e.id==(d||"").split("-")[0]})||f.find(function(e){return e.id==CTM.default_speech_choice.lang.split("-")[0]})||f.find(function(e){return"en"==e.id}),v=m.dialects.find(function(e){return e.id==((d||"").split("-")[1]||"")})||m.dialects.find(function(e){return e.id==(CTM.default_speech_choice.lang||"").split("-")[1]})||m.dialects.find(function(e){return!!e.voices.find(function(e){return e==c})})||m.dialects.find(function(e){return!!e.voices.find(function(e){return e==CTM.default_speech_choice.voice})})||m.dialects[0],g=v.voices.find(function(e){return e==c});!g&&c&&"alice"!=c&&"man"!=c&&"woman"!=c&&(m=f.find(function(e){return!!e.dialects.find(function(e){return!!e.voices.find(function(e){return e==c})})}))&&(g=(v=m.dialects.find(function(e){return!!e.voices.find(function(e){return e==c})})).voices.find(function(e){return e==c})),g||(g=v.voices.find(function(e){return e==CTM.default_speech_choice.voice})||v.voices[0]),p.find("select[name=lang]").select2("val",m.id+(v.id?"-"+v.id:"")).trigger("change"),p.find("select[name=voice]").select2("val",g),h=!0,b.val(r),e.val(u)}else s(e,b,p)}function s(e,t,n){var a=n.find("select[name=voice]").val(),i=n.find("select[name=lang]").val(),r=f.find(function(e){return e.id==(i||"").split("-")[0]})||f.find(function(e){return e.id==CTM.default_speech_choice.lang.split("-")[0]})||f.find(function(e){return"en"==e.id}),s=r.dialects.find(function(e){return e.id==((i||"").split("-")[1]||"")})||r.dialects.find(function(e){return e.id==(CTM.default_speech_choice.lang||"").split("-")[1]})||r.dialects.find(function(e){return!!e.voices.find(function(e){return e==a})})||r.dialects.find(function(e){return!!e.voices.find(function(e){return e==CTM.default_speech_choice.voice})})||r.dialects[0],o=s.voices.find(function(e){return e==a});if(!o&&a&&"alice"!=a&&"man"!=a&&"woman"!=a&&(r=f.find(function(e){return!!e.dialects.find(function(e){return!!e.voices.find(function(e){return e==a})})}))&&(o=(s=r.dialects.find(function(e){return!!e.voices.find(function(e){return e==a})})).voices.find(function(e){return e==a})),o||(o=s.voices.find(function(e){return e==CTM.default_speech_choice.voice})||s.voices[0]),n.find("select[name=lang]").select2("val",r.id+(s.id?"-"+s.id:"")),n.find("select[name=voice]").select2("val",o),h)if("dtmf"==r.id){var l=e.val().toLowerCase().replace(/[^w\d]/gi,"");t.val("dtmf:"+l),e.val(l)}else t.val("say:"+o+":"+n.find("select[name=lang]").val()+":"+e.val())}function o(e){var t=e.match(/\/act.\d*\/.*-/);return t?e.substring(e.indexOf(t[0])+t[0].length).replace(/_wav$/,".wav").replace(/_mp3$/,".mp3").replace(/_aif$/,".aif").replace(/_ulaw$/,".ulaw").replace(/_gsm$/,".gsm"):(t=e.match(/\/([^\/]*)\.mp3$/))&&t.length>=2?humanize(t[1]):"Recorded Audio"}function l(e){e.closest("div.say_upload").find("a.remove").css({"visibility":e.val()?"visible":"hidden"})}function c(t,n,a){for(var i in void 0===n&&(n="function"==typeof e.mustache?e.mustache():e.mustache),a=a||"",n)"object"==typeof n[i]&&(t=c(t,n[i],a+i+".")),t=t.replace(new RegExp("{{"+a+i+"}}","g"),"function"==typeof n[i]?n[i]():n[i]);return t}function d(e){var t=e.closest("div.say_upload");if(n(e)){t.find(".audio-player").css({"display":"inline-block"}),e.hide(),
t.find(".audio-player audio").attr("src",e.val().replace(/^play:/,"").replace(/http:/,"https:"));var s=t.find(".audio-player .audio-name span.say_upload_file");if(e.attr("data-name"))s.text(e.attr("data-name"));else{var l=e.val().match("^play:(.*)$")[1],c=$.sayUploadNameCache[l],d=function(n){e.attr("data-name")||(n.id?(s.text(n.name),e.attr("data-id",n.id)):s.text(n.name),t.find(".settings-panel").hide(),t.find(".say_upload a.remove").hide())},u=function(){e.attr("data-name")||(s.find(".inline-form").length&&(s=s.find(".inline-form > .desc")),s.text(o(e.val())))};if(c)d(c);else{if($.sayUploadNameLoading[l]||($.sayUploadNameLoading[l]=[]),$.sayUploadNameLoading[l].push([d,u]),$.sayUploadNameLoading[l].length>1)return;$.ajax({"url":"/audio_messages.json?recording_url="+encodeURI(l),"success":function(t){var n=null;for(n=t&&t.audio_messages&&t.audio_messages.length&&t.audio_messages[0].name?{"name":t.audio_messages[0].name,"id":t.audio_messages[0].id}:{"name":o(e.val())},$.sayUploadNameCache[l]=n;$.sayUploadNameLoading[l].length;)$.sayUploadNameLoading[l].pop()[0](n)},"error":function(){for(;$.sayUploadNameLoading[l].length;)$.sayUploadNameLoading[l].pop()[1]()}})}}t.find(".settings-panel").hide(),t.find(".say_upload a.remove").hide()}else a(e)||i(e),t.find(".audio-player").hide(),e.show(),t.find(".settings-panel").show(),t.find(".say_upload a.remove").show();r(e),t.find("a.remove").css({"visibility":e.val()?"visible":"hidden"})}var u=!1;e||(e={});var p={},f=$.sayUploadLanguages,b=$.sayUploadVoices,h=!1;return this.each(function(){function i(){return m.hasClass("readonly")||r.attr("readonly")}var r=$(this);r.attr("placeholder")||r.attr("placeholder","Leave blank for no message");var o=f.map(function(e){return e.dialects.map(function(t){return'<option value="'+e.id+(t.id?"-"+t.id:"")+'" data-description="'+escapeHtml(t.name)+'">'+escapeHtml(e.name)+"</option>"}).join("")}).join(""),u=r.attr("name")?"name='"+r.attr("name")+"' ":"";r.before("<div class='say_upload guide-say-upload'><input type='hidden' "+u+"class='text hidden'/><a title='Upload an audio file' class='upload'><i class='font-cloud-upload'></i></a><a title='Record your own audio' class='record'><i class='font-mic'></i></a><a title='Listen to this message' class='listen'><i class='font-play'></i></a><a title='Remove this message' class='remove'><i class='font-close'></i></a><div class='progress-indicator'></div><div class='settings-panel'><span class='contents'><select name='lang' style='max-width:calc(56% - 5px);margin-right:5px;white-space:nowrap;vertical-align:top'>"+o+'</select><select name=\'voice\' style=\'max-width:42%;white-space:nowrap;vertical-align:top\'></select><span class=\'hint dtmfnotes\' style=\'display:inline-block;margin:2px\'>Play DTMF tones. Valid characters are 0-9 and w, where each w is a 0.5s wait/pause.</span></span></div><div class=\'audio-player\'><span class=\'audio-name\'><span class="say_upload_file">...</span> <div class="btn-group"><a class="dropdown-toggle" data-toggle="dropdown" style="margin:0"><i class="font-caret-down"></i></a><ul class="dropdown-menu"><li><a data-action="rename"><i class="font-pencil"></i> Rename</a></li><li><a data-action="download"><i class="font-download"></i> Download</a></li></ul></div></span><audio preload=\'none\'></audio></div></div>');var m=r.prev();e["class"]&&m.addClass(e["class"]),r.attr("readonly")&&m.addClass("readonly"),"admin"!=CTM.role&&"agency_admin"!=CTM.role||m.addClass("admin"),m.append("<iframe class='playback-frame' style='width:1px;height:1px;visibility:hidden;border:0;position:absolute' src='/calls/say_upload'></iframe>");var v=m.find(".playback-frame").get(0);v.contentWindow.addEventListener("message",function(e){if(e.origin===window.location.origin)switch(e.data.action){case"start":p.start&&p.start.forEach(function(t){t(e.data.CallSid)});break;case"error":p.error&&p.error.forEach(function(t){t(e.data)});break;case"disconnect":p.disconnect&&p.disconnect.forEach(function(t){t(e.data.CallSid)})}}),r.addClass("text"),r.detach(),m.prepend(r),r.removeAttr("name");var g=m.find("input[type=hidden]"),_=m.find(".progress-indicator"),y=m.find(".settings-panel");i()&&y.find("select").attr("disabled",!0),y.find("select[name=voice]").select2({"dropdownCssClass":"wider"}),y.find("select[name=lang]").select2({"dropdownCssClass":"wider"});var w=!1;m.find("a.listen").click(function(a){if(a.preventDefault(),!w){w=!0,setTimeout(function(){w=!1},800);var i="man"!=(f=y.find("select[name=voice]").val())&&"woman"!=f&&"alice"!=f;if(n(g)||i){var s=m.find(".audio-player audio"),o=function(){m.find("a.listen i").removeClass("font-stop").addClass("font-play"),s.get(0).pause(),s.get(0).currentTime=0},l=function(){var e=s.get(0).currentTime/s.get(0).duration*100;_.css("width",e+"%"),e>=99&&setTimeout(function(){_.css({"width":0})},500)};if(s.attr("src")&&s.attr("src").length>1&&s.get(0).currentTime>0)s.get(0).pause(),s.attr("src",""),o();else{m.find("a.listen i").removeClass("font-play").addClass("font-stop");var d=g.val().replace(/play:/,"").replace(/http:/,"https:");if(i&&!n(g))!(u=r.val())&&e&&e.placeholder&&(u="function"==typeof e.placeholder?e.placeholder():e.placeholder),u&&e&&e.mustache&&(u=c(u)),d="/text_to_speech/say?voice_id="+f+"&text="+encodeURIComponent(u);s.attr("src",d),s.get(0).addEventListener("ended",o),s.get(0).addEventListener("timeupdate",l),s.get(0).play()}}else{var u;if(!(u=$.trim(r.val()))&&e&&e.placeholder&&(u="function"==typeof e.placeholder?e.placeholder():e.placeholder),u&&e&&e.mustache&&(u=c(u)),0==u.length)return void r.focus();var p=y.find("select[name=lang]").val(),f=y.find("select[name=voice]").val();t(v,u,f,p,function(e){_.css("width",e+"%"),100==e&&setTimeout(function(){_.css("width",0)},800)},function(){$.get("/api/v1/accounts/"+CTM.account+"/lookup.json",{"object_type":"tracking_number","per_page":0},function(e){0==e.total&&ctmFlash("You must purchase at least one tracking number before using the text-to-speech feature.","warning")},"json").fail(function(){ctmFlash("Sorry please try again.","error")})})}}}),m.find("a[data-action]").click(function(){var e=$(this).attr("data-action");if("rename"==e){if(!r.attr("data-id"))return;var t=m.find(".audio-name .say_upload_file"),n=t.text();t.html('<span class="inline-form" data-save="/audio_messages/'+r.attr("data-id")+'/save_name?f=1"><span class="desc">'+escapeHtml(n)+'</span><span class="inline-edit-icon"></span></span>'),m.find(".audio-name").addClass("editing"),initInlineEdit(t.find(".inline-form"),function(e){t.text(e),m.find(".audio-name").removeClass("editing"),r.attr("data-name",e)}),t.find(".inline-edit-icon").click()}else"download"==e&&(window.location=m.find("audio[src]").attr("src"))}),y.find("select[name=lang]").change(function(){var e=$(this).val(),t=f.find(function(t){return t.id==(e||"").split("-")[0]})||f.find(function(e){return e.id==CTM.default_speech_choice.lang.split("-")[0]})||f.find(function(e){return"en"==e.id}),n=t.dialects.find(function(t){return t.id==((e||"").split("-")[1]||"")})||t.dialects.find(function(e){return e.id==(CTM.default_speech_choice.lang||"").split("-")[1]})||t.dialects.find(function(e){return!!e.voices.find(function(e){return e==T})})||t.dialects.find(function(e){return!!e.voices.find(function(e){return e==CTM.default_speech_choice.voice})})||t.dialects[0];if(y.find("select[name=voice]").html(n.voices.map(function(e){return'<option value="'+e+'">'+escapeHtml(b.find(function(t){return t.id==e}).name)+"</option>"}).join("")),y.find("select[name=voice]").select2("destroy"),y.find("select[name=voice]").select2({"dropdownCssClass":"wider"}),"dtmf"==t.id?(y.find("select[name=voice]").select2("container").hide(),y.find(".dtmfnotes").show()):(y.find("select[name=voice]").select2("container").show(),y.find(".dtmfnotes").hide()),!i()&&h){var a=r.closest("div.say_upload"),o=a.find("input.hidden");s(r,o,a)}}),y.find("select[name=voice]").change(function(){if(!i()&&h){var e=r.closest("div.say_upload"),t=e.find("input.hidden");s(r,t,e)}});var k=!1;m.find("a.record").click(function(t){if(t.preventDefault(),!i()&&!k){k=!0,setTimeout(function(){k=!1},800);var n=bootbox.dialog({"title":"<h3>Audio Recording <small>record your own audio</small></h3>","message":'<div class="row"><div class="col-md-12"><ul class="nav nav-tabs recording-action" role="tablist"><li class="active"><a data-action="record-computer">Record from Computer</a></li><li><a data-action="record-phone"><span class="hidden-xs">Record from </span>Phone</a></li></ul><div class="tab-content"><div class="tab-pane box flushbox active record-computer" style="padding:20px"><form class="form-horizontal"> <div style="margin-bottom:10px"><p>Click the Start Recording button to start capturing your recording.</p></div><a class="button callout start-capture-browser-audio"><i class="font-mic5"></i> Start Recording</a><a class="button activebutton stop-capture-browser-audio" style="display:none"><i class="font-mic-off"></i> Stop Recording</a><div class="feedback"></div><span class="hint">max. recording length: 300 seconds</span></form></div><div class="tab-pane box flushbox record-phone" style="display:none;padding:20px"><form class="form-horizontal"> <div style="margin-bottom:10px"> <label>Your Phone Number</label><br/><input type="text" placeholder="Enter the phone number with country code." class="combobox phone recording_number" style="width:300px"/><p class="phone-recording-progress"></p><span class="hint">max. recording length: 50 seconds</span></div><a class="button callout capture-phone-audio">Call To Start Recording</a></form></div></div></div></div>',"buttons":{"cancel":{"label":"Cancel","className":"btn-default"}},"onEscape":function(){}}),a=function(e,t){n.find(".phone-recording-progress").html(t.message).removeClass("error messages")},s=!1,o=function(e,t){s||(s=!0,setTimeout(function(){s=!1},3e3),d=!1,c&&(clearTimeout(c),c=null),n.find(".phone-recording-progress").html("").removeClass("error messages"),n.find(".capture-phone-audio").show(),n.find(".phone-recording-progress").html("Preview your audio recording before saving."),n.find(".phone-recording-progress").after("<p><audio src='"+t.url+"' controls preload='none'></audio><a class='use-audio button'>use audio</a></p>"),n.find(".use-audio").click(function(e){e.preventDefault(),n.modal("hide"),r.val("play:"+t.url.replace(/http:/,"https:")),r.removeAttr("data-name"),r.removeAttr("data-id"),r.trigger("change")}))},l=function(e,t){d=!1,c&&(clearTimeout(c),c=null),n.find(".capture-phone-audio").show(),n.find(".phone-recording-progress").html(t.message).addClass("error messages")};n.on("shown.bs.modal",function(){n.find(".recording_number").phoneCountryComboBox({"iso_country":"US"}),$(window).on("ctm.recording.progress",a),$(window).on("ctm.recording.complete",o),$(window).on("ctm.recording.error",l)}),n.on("hidden.bs.modal",function(){$(window).off("ctm.recording.progress",a),$(window).off("ctm.recording.complete",o),$(window).off("ctm.recording.error",l),c&&(clearTimeout(c),c=null,d=!1),n.find(".capture-phone-audio").show()});var c=null,d=!1;n.on("click",".capture-phone-audio",function(e){if(e.preventDefault(),!d){d=!0,$(".capture-phone-audio").hide(),c=setTimeout(function(){d=!1,c&&(clearTimeout(c),c=null),$(".capture-phone-audio").show()},16e3);var t=n.find(".recording_number").phoneCountryComboBox("digits");n.find(".phone-recording-progress").html("Validating your input...").removeClass("error messages"),$.post("/audio_messages.json",{"audio_message":{"speakable_type":"Account","speakable_id":CTM.account,"number_to_call":t}},function(){n.find(".phone-recording-progress").html("Starting to dial your phone number now...").removeClass("error messages")},"json").fail(function(){n.find(".phone-recording-progress").html("Unable to dial the number. Please verify your number and try again.").addClass("error messages"),c&&(clearTimeout(c),c=null),$(".capture-phone-audio").show(),d=!1})}}),n.on("click",".recording-action a",function(e){e.preventDefault();var t=$(this).attr("data-action");n.find(".recording-action li").removeClass("active"),$(this).closest("li").addClass("active"),"record-computer"==t?(n.find(".record-computer").show(),n.find(".record-phone").hide()):(n.find(".record-computer").hide(),n.find(".record-phone").show())}),n.on("click",".start-capture-browser-audio",function(t){t.preventDefault(),n.find(".stop-capture-browser-audio").show(),n.find(".start-capture-browser-audio").hide(),n.find(".feedback").html("<p>Starting recording engine, please wait... Make sure you have a microphone and speakers connected.</p>"),(p={}).disconnect||(p.disconnect=[]),p.error||(p.error=[]),p.start||(p.start=[]),p.disconnect.push(function(){n.find(".stop-capture-browser-audio").hide(),n.find(".start-capture-browser-audio").show(),n.find(".feedback").html("<p>Recording completed.</p>"),e&&"function"==typeof e.afterCallback&&(console.log("afterCallback"),e.afterCallback())}),p.error.push(function(){n.find(".feedback").html("<p>Something did not work. Please check your headset, speakers, and internet connection.</p>")}),p.start.push(function(){n.find(".feedback").html("<p>Recording will start after the beep.</p>"),setTimeout(function(){n.find(".feedback").html("<p>Recording.</p>")},3e3)}),v.contentWindow.postMessage({"action":"record","user":CTM.user},window.location.origin)}),n.on("click",".stop-capture-browser-audio",function(e){e.preventDefault(),p.disconnect||(p.disconnect=[]),p.disconnect.push(function(e){function t(){$.get("/audio_recording/lookup/"+e,function(e){"found"==e.status?(n.find(".feedback").html("<p class='alert alert-success'>Preview your audio recording before saving.</p><audio src='"+e.url+"' controls preload='none'></audio><br/><a class='use-audio button callout'>use audio</a>"),n.find(".use-audio").click(function(t){t.preventDefault(),n.modal("hide"),r.val("play:"+e.url.replace(/http:/,"https:")),r.removeAttr("data-name"),r.removeAttr("data-id"),r.trigger("change")})):n.find(".feedback").html("<p>Something did not work &mdash; unable to capture your recording.</p>")}).fail(function(){a<2&&(a++,setTimeout(t,1e3))})}n.find(".stop-capture-browser-audio").hide(),n.find(".start-capture-browser-audio").show(),n.find(".feedback").html("<p>Saving your recording...</p>");var a=0;setTimeout(t,1e3)}),v.contentWindow.postMessage({"action":"stop","user":CTM.user},window.location.origin)})}}),m.find("a.remove").click(function(e){e.preventDefault(),i()||(r.val(""),r.focus(),d(r))});var C=!1;if(m.find("a.upload").click(function(t){function n(t){function n(e){let t="";return e.id&&(t+=" data-id='"+escapeHtml(e.id)+"'"),e.name&&(t+=" data-name='"+escapeHtml(e.name)+"'"),"<tr><td style='line-height:36px;width:60px'><a class='button use-audio edit-button' data-url='"+escapeHtml(e.url)+"'>use</a></td><td><div class='field' style='display:inline-block;padding:0;margin:0;width:100%'><input type='text'"+t+" class='audio-input' value='play:"+escapeHtml(e.url)+"' readonly='readonly'/></div></td></tr>"}function a(t){return'<div class="row">  <div class="col-md-12"> <ul class="nav nav-tabs recording-action" role="tablist"><li class="active"><a data-action="upload-file">Upload<span class="hidden-xs"> a New Audio File</span></a></li>'+(e.noPastRecordings?"":'<li><a data-action="past-recording"><span class="hidden-xs">Past Recordings</span><span class="hidden-sm hidden-md hidden-lg">Previous</span></a></li>')+(e.noSystemRecordings?"":'<li><a data-action="system-music">System<span class="hidden-xs"> Recordings</span></a></li>')+'</ul><div class="tab-content"><div class="tab-pane box flushbox upload-file active" style="padding:20px"><form class="form-horizontal"> <div class="form-group"> <div class="col-md-12"> <input name="file-name" type="file" style="font-size:inherit"> </div><div class="col-md-12"><div class="error messages audio-upload-error"></div></div><div class="col-md-7"><span class="hint">Supported Audio Formats: MP3, WAV, AIFF, GSM, \u03bc-law</span></div><div class="col-md-5"><span class="hint">Audio Size Limit: 7 MB</span></div><div class="col-md-12"><h4 style="line-height:150%"><br/><b>Tip:</b> if the uploaded audio file does not play in your browser correctly, try converting the file to a different format.</h4></div></div></form></div><div class="tab-pane box flushbox past-recording" style="display:none"><table class="table standard-table table-striped table-click table-hover">'+t+'</table><div id="paging"><a id="previous"></a><a id="next"    ></a></div><br/><a href="/audio_messages">Manage recordings <i class="font-chevron-right" style="font-size:90%"></i></a></div><div class="tab-pane box flushbox system-music" style="display:none"><table class="table standard-table table-striped table-click table-hover">'+c+"</table></div></div></div></div>"}function i(e){e.find("input.audio-input").sayUpload({"class":"borderless"}),e.find(".use-audio").click(function(t){t.preventDefault(),e.modal("hide");var n=$(this).closest("tr").find("input.audio-input");r.val("play:"+$(this).attr("data-url").replace(/http:/,"https:")),r.attr("data-name",n.attr("data-name")),n.attr("data-id")?r.attr("data-id",n.attr("data-id")):r.removeAttr("data-id"),r.trigger("change")})}function s(e,t){var n=t.next_page,a=t.previous_page;a?e.find("#previous").html('<i class="font-chevron-left" style="font-size:90%"></i> previous &nbsp;').attr("data-url",a):e.find("#previous").html("").attr("data-url",""),n?e.find("#next").html('next <i class="font-chevron-right" style="font-size:90%"></i>').attr("data-url",n):e.find("#next").html("").attr("data-url","")}function o(e){e.closest(".recording-action").find("li").removeClass("active"),e.closest("li").addClass("active"),"upload-file"==e.attr("data-action")?(p.find(".upload-file").show(),p.find(".system-music").hide(),p.find(".past-recording").hide(),p.find(".upload-button").removeClass("disabled")):"past-recording"==e.attr("data-action")?(p.find(".upload-file").hide(),p.find(".system-music").hide(),p.find(".past-recording").show(),p.find(".upload-button").addClass("disabled")):(p.find(".upload-file").hide(),p.find(".past-recording").hide(),p.find(".system-music").show(),p.find(".upload-button").addClass("disabled"))}var l=(t.messages||[]).reverse().map(n).join("");var c=[{"url":"https://ctm-audio.s3.amazonaws.com/US_ringback_tone.mp3","name":"US Ring Tone"},{"url":"https://ctm-audio.s3.amazonaws.com/UK_ringback_tone.mp3","name":"UK Ring Tone"},{"url":"/audio/system/classical.mp3","name":"Random Classical"},{"url":"/audio/system/ambient.mp3","name":"Random Ambient"},{"url":"/audio/system/electronica.mp3","name":"Random Electronica"},{"url":"/audio/system/guitars.mp3","name":"Random Guitars"},{"url":"/audio/system/rock.mp3","name":"Random Rock"},{"url":"/audio/system/soft-rock.mp3","name":"Random Soft Rock"}].map(n).join(""),u=a(l),p=bootbox.dialog({"title":"<h3>Audio Recording <small>upload an audio file</small></h3>","message":u,"onEscape":function(){},"buttons":{"cancel":{"label":"Cancel","className":"btn-default"},"success":{"label":"Upload Audio","className":"upload-button btn-success","callback":function(){$(".audio-upload-error").html("");var e=$(".modal-dialog input[name=file-name]").get(0).files[0];if(!e)return $(".audio-upload-error").html("Please choose a file to upload"),!1;if(e.size>7340032)return $(".audio-upload-error").html("The selected file is too large to upload."),!1;if(!e.type.match(/audio/))return $(".audio-upload-error").html("Invalid content type: "+e.type),!1;if(-1==["audio/mp3","audio/mpeg","audio/wav","audio/wave","audio/x-wav","audio/aiff","audio/x-aifc","audio/x-aiff","audio/x-gsm","audio/gsm","audio/ulaw"].indexOf(e.type))return $(".audio-upload-error").html("Invalid content type:"+e.type),!1;var t=new FileReader;t.onload=function(){var n=MagicType(new Uint8Array(t.result));if(!n)return _.html("Invalid content type.  Make sure to upload a mp3 or wav file").addClass("error"),!1;if(-1==["audio/mp3","audio/mpeg","audio/wav","audio/wave","audio/x-wav","audio/aiff","audio/x-aifc","audio/x-aiff","audio/x-gsm","audio/gsm","audio/ulaw"].indexOf(n.mime))return _.html("Invalid content type:"+n.mime+". Please ensure you are uploading a correctly formatted MP3 or WAV file.").addClass("error"),!1;$.get("/audio_messages/upload.json",function(t){function n(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);_.css("width",t+"%")}else _.html("...")}function a(){if(!u){u=!0,_.html("Uploaded"),setTimeout(function(){_.html(""),_.css("width",0)},1e3);var t=decodeURIComponent(c.getResponseHeader("Location"));r.val("play:"+t),d(r);var n=document.createElement("audio");n.src=t;var a=!1;n.addEventListener("timeupdate",function(){n.pause(),a||(a=!0,$.post("/audio_messages/save_recording_url.json",{"name":e.name,"url":t,"duration":n.duration},"json"))},!0),n.play()}}function i(){_.html("Upload failed.").addClass("error").css("width","100%")}function s(){_.html("The upload was canceled by the user, or the browser dropped the connection.").addClass("error").css("width","100%")}var o=new FormData,l="uploads/act."+CTM.account+"/"+t.token+"-"+e.name.replace(/[^0-9a-zA-Z]+/g,"_");o.append("key",l),o.append("acl","public-read"),o.append("Content-Type",e.type),o.append("AWSAccessKeyId",t.access_key),o.append("policy",t.policy),o.append("signature",t.signature),o.append("file",e);var c=new XMLHttpRequest,u=!1;c.upload.addEventListener("progress",n,!1),c.addEventListener("load",a,!1),c.addEventListener("error",i,!1),c.addEventListener("abort",s,!1),c.open("POST","https://"+t.bucket+".s3.amazonaws.com/",!0),c.send(o)},"json")},t.onerror=function(){_.html("Error reading your file.  Please try again.").addClass("error").css("width","100%")},t.readAsArrayBuffer(e)}}}});p.on("shown.bs.modal",function(){p.find("#next").click(function(e){e.preventDefault(),url=e.target.attributes["data-url"].value,$.get(url,function(e){l=e.messages.reverse().map(n).join(""),p.find(".past-recording > table > tbody").html(l),p.find(".system-music > table > tbody").html(c),i(p),s(p,e)})}),p.find("#previous").click(function(e){url=e.target.attributes["data-url"].value,$.get(url,function(e){l=e.messages.reverse().map(n).join(""),p.find(".past-recording > table > tbody").html(l),p.find(".system-music > table > tbody").html(c),i(p),s(p,e)})}),i(p),s(p,t)}),p.on("click",".recording-action a",function(e){e.preventDefault(),o($(this))}),p.on("click",".system-music a",function(e){e.preventDefault()})}t.preventDefault(),i()||C||(C=!0,setTimeout(function(){C=!1},800),e.noPastRecordings?n([]):$.get("/audio_messages/list_recordings.json",function(e){n(e)}).fail(function(){n([])}))}),a(r))var x=r.val().split(":"),T=(x.shift(),x.shift()),S=x.shift(),M=(x.join(":"),S),j=T;M=M||e.lang||r.attr("attr-lang")||CTM.default_speech_choice.lang,j=j||e.voice||r.attr("attr-voice")||CTM.default_speech_choice.voice,h=!1,y.find("select[name=lang]").select2("val",M).trigger("change"),y.find("select[name=voice]").select2("val",j),h=!0,d(r),r.on("change",function(){d(r)}),r.on("input",function(){l(r)}),l(r),m.find("[title]").tooltip({"delay":{"show":800,"hide":100}})})},ZendeskApiClient.prototype.get=function(e,t){return sendRequest(buildRequestOptions(this,{"method":"GET","url":e}),t)},ZendeskApiClient.prototype.put=function(e,t){return sendRequest(buildRequestOptions(this,{"method":"PUT","url":e,"headers":{"Content-Type":"application/json"}}),t)},ZendeskApiClient.prototype.post=function(e,t){return sendRequest(buildRequestOptions(this,{"method":"POST","url":e,"headers":{"Content-Type":"application/json"}}),t)},ZendeskApiClient.prototype["delete"]=function(e,t){return sendRequest(buildRequestOptions(this,{"method":"DELETE","url":e}),t)},
/*! twilio-client.js 1.9.7

The following license applies to all parts of this software except as
documented below.

    Copyright (C) 2015-2019 Twilio, inc.
 
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
 
        http://www.apache.org/licenses/LICENSE-2.0
 
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

This software includes rtcpeerconnection-shim under the following (BSD 3-Clause) license.

    Copyright (c) 2017 Philipp Hancke. All rights reserved.

    Copyright (c) 2014, The WebRTC project authors. All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      * Redistributions of source code must retain the above copyright
        notice, this list of conditions and the following disclaimer.

      * Redistributions in binary form must reproduce the above copyright
        notice, this list of conditions and the following disclaimer in
        the documentation and/or other materials provided with the
        distribution.

      * Neither the name of Philipp Hancke nor the names of its contributors may
        be used to endorse or promote products derived from this software
        without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes backoff under the following (MIT) license.

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

 */
function(e){var t=function(){function e(t,n,a){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={"exports":{}};t[s][0].call(d.exports,function(e){return i(t[s][1][e]||e)},d,d.exports,e,t,n,a)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}return e}()({"1":[function(e,t){"use strict";t.exports=WebSocket},{}],"2":[function(e,t){"use strict";t.exports={"XMLHttpRequest":XMLHttpRequest}},{}],"3":[function(e,t,n){"use strict";function a(){s=new i,Object.getOwnPropertyNames(i.prototype).concat(Object.getOwnPropertyNames(r.prototype)).filter(function(e){return"function"==typeof i.prototype[e]}).filter(function(e){return"destroy"!==e}).forEach(function(e){i[e]=i.prototype[e].bind(s)})}var i=e("./twilio/device")["default"],r=e("events").EventEmitter,s=void 0;Object.defineProperty(i,"instance",{"get":function(){return s},"set":function(e){null===e&&(s=null)}}),i.destroy=function(){s.destroy(),a()},a(),Object.getOwnPropertyNames(s).filter(function(e){return"function"!=typeof i.prototype[e]}).forEach(function(e){Object.defineProperty(i,e,{"get":function(){return s[e]},"set":function(t){s[e]=t}})}),n.Device=i,n.PStream=e("./twilio/pstream").PStream,n.Connection=e("./twilio/connection").Connection},{"./twilio/connection":5,"./twilio/device":7,"./twilio/pstream":14,"events":45}],"4":[function(e,t,n){"use strict";var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{"value":!0});var r=e("events"),s=e("./errors"),o=e("./outputdevicecollection"),l=e("./shims/mediadevices"),c=e("./tslog"),d=e("./util"),u=e("./shims/mediadeviceinfo"),p={"audioinput":"Audio Input","audiooutput":"Audio Output"},f=function(e){function t(t,n,a,i){var r=e.call(this)||this;r.availableInputDevices=new Map,r.availableOutputDevices=new Map,r._audioConstraints=null,r._inputDevice=null,r._inputStream=null,r._isPollingInputVolume=!1,r._unknownDeviceIndexes={"audioinput":{},"audiooutput":{}},r._removeLostInput=function(e){if(!r.inputDevice||r.inputDevice.deviceId!==e.deviceId)return!1;r._replaceStream(null),r._inputDevice=null,r._maybeStopPollingVolume();var t=r.availableInputDevices.get("default")||Array.from(r.availableInputDevices.values())[0];return t&&r.setInputDevice(t.deviceId),!0},r._removeLostOutput=function(e){var t=r.speakerDevices["delete"](e),n=r.ringtoneDevices["delete"](e);return t||n},r._updateAvailableDevices=function(){return r._mediaDevices?r._mediaDevices.enumerateDevices().then(function(e){r._updateDevices(e.filter(function(e){return"audiooutput"===e.kind}),r.availableOutputDevices,r._removeLostOutput),r._updateDevices(e.filter(function(e){return"audioinput"===e.kind}),r.availableInputDevices,r._removeLostInput);var t=r.availableOutputDevices.get("default")||Array.from(r.availableOutputDevices.values())[0];[r.speakerDevices,r.ringtoneDevices].forEach(function(e){!e.get().size&&r.availableOutputDevices.size&&e.set(t.deviceId)})}):Promise.reject("Enumeration not supported")},i=Object.assign({"AudioContext":"undefined"!=typeof AudioContext&&AudioContext,"setSinkId":"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},i),r._getUserMedia=a,r._log=new c["default"](i.logLevel||c.LogLevel.Warn),r._mediaDevices=i.mediaDevices||l,r._onActiveInputChanged=n;var s=!(!i.AudioContext&&!i.audioContext),d=!(!r._mediaDevices||!r._mediaDevices.enumerateDevices),u="function"==typeof i.setSinkId;return r.isOutputSelectionSupported=d&&u,r.isVolumeSupported=s,i.enabledSounds&&r._addEnabledSounds(i.enabledSounds),r.isVolumeSupported&&(r._audioContext=i.audioContext||i.AudioContext&&new i.AudioContext,r._audioContext&&(r._inputVolumeAnalyser=r._audioContext.createAnalyser(),r._inputVolumeAnalyser.fftSize=32,r._inputVolumeAnalyser.smoothingTimeConstant=.3)),r.ringtoneDevices=new o["default"]("ringtone",r.availableOutputDevices,t,r.isOutputSelectionSupported),r.speakerDevices=new o["default"]("speaker",r.availableOutputDevices,t,r.isOutputSelectionSupported),r.addListener("newListener",function(e){"inputVolume"===e&&r._maybeStartPollingVolume()}),r.addListener("removeListener",function(e){"inputVolume"===e&&r._maybeStopPollingVolume()}),r.once("newListener",function(){r.isOutputSelectionSupported||r._log.warn("Warning: This browser does not support audio output selection."),r.isVolumeSupported||r._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")}),d&&r._initializeEnumeration(),r}return i(t,e),Object.defineProperty(t.prototype,"audioConstraints",{"get":function(){return this._audioConstraints},"enumerable":!0,"configurable":!0}),Object.defineProperty(t.prototype,"inputDevice",{"get":function(){return this._inputDevice},"enumerable":!0,"configurable":!0}),Object.defineProperty(t.prototype,"inputStream",{"get":function(){return this._inputStream},"enumerable":!0,"configurable":!0}),t.prototype._maybeStartPollingVolume=function(){var e=this;if(this.isVolumeSupported&&this._inputStream&&(this._updateVolumeSource(),!this._isPollingInputVolume&&this._inputVolumeAnalyser)){var t=this._inputVolumeAnalyser.frequencyBinCount,n=new Uint8Array(t);this._isPollingInputVolume=!0;var a=function(){if(e._isPollingInputVolume){if(e._inputVolumeAnalyser){e._inputVolumeAnalyser.getByteFrequencyData(n);var t=d.average(n);e.emit("inputVolume",t/255)}requestAnimationFrame(a)}};requestAnimationFrame(a)}},t.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),delete this._inputVolumeSource),this._isPollingInputVolume=!1))},t.prototype._unbind=function(){if(!this._mediaDevices)throw new s.NotSupportedError("Enumeration is not supported");this._mediaDevices.removeEventListener&&(this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices))},t.prototype.setAudioConstraints=function(e){return this._audioConstraints=Object.assign({},e),delete this._audioConstraints.deviceId,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},t.prototype.setInputDevice=function(e){return d.isFirefox()?Promise.reject(new s.NotSupportedError("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(e,!1)},t.prototype.unsetAudioConstraints=function(){return this._audioConstraints=null,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},t.prototype.unsetInputDevice=function(){var e=this;return this.inputDevice?this._onActiveInputChanged(null).then(function(){e._replaceStream(null),e._inputDevice=null,e._maybeStopPollingVolume()}):Promise.resolve()},t.prototype._addEnabledSounds=function(e){function t(t,n){return void 0!==n&&(e[t]=n),e[t]}var n=this;Object.keys(e).forEach(function(e){n[e]=t.bind(null,e)})},t.prototype._getUnknownDeviceIndex=function(e){var t=e.deviceId,n=e.kind,a=this._unknownDeviceIndexes[n][t];return a||(a=Object.keys(this._unknownDeviceIndexes[n]).length+1,this._unknownDeviceIndexes[n][t]=a),a},t.prototype._initializeEnumeration=function(){var e=this;if(!this._mediaDevices)throw new s.NotSupportedError("Enumeration is not supported");this._mediaDevices.addEventListener&&(this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.addEventListener("deviceinfochange",this._updateAvailableDevices)),this._updateAvailableDevices().then(function(){e.isOutputSelectionSupported&&Promise.all([e.speakerDevices.set("default"),e.ringtoneDevices.set("default")])["catch"](function(t){e._log.warn("Warning: Unable to set audio output devices. "+t)})})},t.prototype._replaceStream=function(e){this._inputStream&&this._inputStream.getTracks().forEach(function(e){e.stop()}),this._inputStream=e},t.prototype._setInputDevice=function(e,t){var n=this;if("string"!=typeof e)return Promise.reject(new s.InvalidArgumentError("Must specify the device to set"));var a=this.availableInputDevices.get(e);if(!a)return Promise.reject(new s.InvalidArgumentError("Device not found: "+e));if(this._inputDevice&&this._inputDevice.deviceId===e&&this._inputStream){if(!t)return Promise.resolve();this._inputStream.getTracks().forEach(function(e){e.stop()})}var i={"audio":Object.assign({"deviceId":{"exact":e}},this.audioConstraints)};return this._getUserMedia(i).then(function(e){return n._onActiveInputChanged(e).then(function(){n._replaceStream(e),n._inputDevice=a,n._maybeStartPollingVolume()})})},t.prototype._updateDevices=function(e,t,n){var a=this,i=e.map(function(e){return e.deviceId}),r=Array.from(t.values()).map(function(e){return e.deviceId}),s=[],o=d.difference(r,i);o.forEach(function(e){var a=t.get(e);a&&(t["delete"](e),n(a)&&s.push(a))});var l=!1;e.forEach(function(e){var n=t.get(e.deviceId),i=a._wrapMediaDeviceInfo(e);n&&n.label===i.label||(t.set(e.deviceId,i),l=!0)}),(l||o.length)&&(null!==this.inputDevice&&"default"===this.inputDevice.deviceId&&(this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale."),this._setInputDevice(this.inputDevice.deviceId,!0)),this.emit("deviceChange",s))},t.prototype._updateVolumeSource=function(){this._inputStream&&this._audioContext&&this._inputVolumeAnalyser&&(this._inputVolumeSource&&this._inputVolumeSource.disconnect(),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser))},t.prototype._wrapMediaDeviceInfo=function(e){var t={"deviceId":e.deviceId,"groupId":e.groupId,"kind":e.kind,"label":e.label};if(!t.label)if("default"===t.deviceId)t.label="Default";else{var n=this._getUnknownDeviceIndex(e);t.label="Unknown "+p[t.kind]+" Device "+n}return new u(t)},t}(r.EventEmitter);f||(f={}),n["default"]=f},{"./errors":10,"./outputdevicecollection":13,"./shims/mediadeviceinfo":27,"./shims/mediadevices":28,"./tslog":31,"./util":32,"events":45}],"5":[function(e,t,n){"use strict";function a(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{"value":!0});var o=e("events"),l=e("./device"),c=e("./errors"),d=e("./rtc/candidate"),u=e("./statsMonitor"),p=e("./tslog"),f=e("./util"),b=e("backoff"),h=e("./constants"),m=e("./rtc").PeerConnection,v=e("./rtc/sdp").getPreferredCodecInfo,g={"factor":1.1,"initialDelay":1,"maxDelay":3e4,"randomisationFactor":.5},_=70,y=500,w=160,k=10,C=5e3,x={"disconnect":!0,"info":{"code":31003,"message":"Connection with Twilio was interrupted.","twilioError":new c.MediaErrors.ConnectionError}},T={"audioInputLevel":"audio-input-level","audioOutputLevel":"audio-output-level","bytesReceived":"bytes-received","bytesSent":"bytes-sent","jitter":"jitter","mos":"mos","packetsLostFraction":"packet-loss","rtt":"rtt"},S={"max":"high-","maxDuration":"constant-","min":"low-"},M=!1,$=function(e){function t(n,i){var r=e.call(this)||this;r.parameters={},r._inputVolumeStreak=0,r._isAnswered=!1,r._latestInputVolume=0,r._latestOutputVolume=0,r._log=new p["default"](p.LogLevel.Off),r._metricsSamples=[],r._outputVolumeStreak=0,r._soundcache=new Map,r._status=t.State.Pending,r.options={"debug":!1,"enableRingingState":!1,"mediaStreamFactory":m,"offerSdp":null,"shouldPlayDisconnect":function(){return!0}},r.sendHangup=!0,r.toString=function(){return"[Twilio.Connection instance]"},r._emitWarning=function(e,t,n,a,i){var s=e+"warning"+(i?"-cleared":"-raised");if("constant-audio-input-level"!==t||!r.isMuted()){var o=i?"info":"warning";"constant-audio-output-level"===t&&(o="info");var l={"threshold":n};if(a&&(a instanceof Array?l.values=a.map(function(e){return"number"==typeof e?Math.round(100*e)/100:a}):l.value=a),r._publisher.post(o,s,t,{"data":l},r),"constant-audio-output-level"!==t){var c=i?"warning-cleared":"warning";r.emit(c,t)}}},r._onAnswer=function(e){r._isAnswered||(r._setCallSid(e),r._isAnswered=!0,r._maybeTransitionToOpen())},r._onCancel=function(e){var n=e.callsid;r.parameters.CallSid===n&&(r._status=t.State.Closed,r.emit("cancel"),r.pstream.removeListener("cancel",r._onCancel))},r._onHangup=function(e){if(e.callsid&&(r.parameters.CallSid||r.outboundConnectionId)){if(e.callsid!==r.parameters.CallSid&&e.callsid!==r.outboundConnectionId)return}else if(e.callsid)return;if(r._log.info("Received HANGUP from gateway"),e.error){var t={"code":e.error.code||31e3,"connection":r,"message":e.error.message||"Error sent from gateway in HANGUP","twilioError":new c.GeneralErrors.ConnectionError};r._log.error("Received an error from the gateway:",t),r.emit("error",t)}r.sendHangup=!1,r._publisher.info("connection","disconnected-by-remote",null,r),r._disconnect(null,!0),r._cleanupEventListeners()},r._onMediaFailure=function(e){var n=t.MediaFailure,a=n.ConnectionDisconnected,i=n.ConnectionFailed,s=n.IceGatheringFailed,o=n.LowBytes,l=e===i||e===s;if(!r.options.enableIceRestart&&l||!f.isChrome(window,window.navigator)&&e===i)return r.mediaStream.onerror(x);if(r.options.enableIceRestart)if(r._status!==t.State.Reconnecting){var d=r.mediaStream.version.pc,u=d&&"disconnected"===d.iceConnectionState,p=r._monitor.hasActiveWarning("bytesSent","min")||r._monitor.hasActiveWarning("bytesReceived","min");if(e===o&&u||e===a&&p||l){var b={"code":53405,"message":"Media connection failed.","twilioError":new c.MediaErrors.ConnectionError};r._log.warn("ICE Connection disconnected."),r._publisher.warn("connection","error",b,r),r._publisher.info("connection","reconnecting",null,r),r._mediaReconnectStartTime=Date.now(),r._status=t.State.Reconnecting,r._mediaReconnectBackoff.reset(),r._mediaReconnectBackoff.backoff(),r.emit("reconnecting",b)}}else if(l){if(Date.now()-r._mediaReconnectStartTime>g.maxDelay)return r._log.info("Exceeded max ICE retries"),r.mediaStream.onerror(x);r._mediaReconnectBackoff.backoff()}},r._onMediaReconnected=function(){r._status===t.State.Reconnecting&&(r._log.info("ICE Connection reestablished."),r._publisher.info("connection","reconnected",null,r),r._status=t.State.Open,r.emit("reconnected"))},r._onRinging=function(e){if(r._setCallSid(e),r._status===t.State.Connecting||r._status===t.State.Ringing){var n=!!e.sdp;r.options.enableRingingState?(r._status=t.State.Ringing,r._publisher.info("connection","outgoing-ringing",{"hasEarlyMedia":n},r),r.emit("ringing",n)):n&&r._onAnswer(e)}},r._onRTCSample=function(e){var t=s({},e,{"inputVolume":r._latestInputVolume,"outputVolume":r._latestOutputVolume});r._codec=t.codecName,r._metricsSamples.push(t),r._metricsSamples.length>=k&&r._publishMetrics(),r.emit("sample",e)},r._reemitWarning=function(e,t){var n=/^audio/.test(e.name)?"audio-level-":"network-quality-",a=S[e.threshold.name]+T[e.name];r._emitWarning(n,a,e.threshold.value,e.values||e.value,t)},r._reemitWarningCleared=function(e){r._reemitWarning(e,!0)},r._isUnifiedPlanDefault=n.isUnifiedPlanDefault,r._soundcache=n.soundcache,r.message=i&&i.twimlParams||{},r.customParameters=new Map(Object.entries(r.message).map(function(e){var t=e[0],n=e[1];return[t,String(n)]})),Object.assign(r.options,i),r.options.callParameters&&(r.parameters=r.options.callParameters),r._direction=r.parameters.CallSid?t.CallDirection.Incoming:t.CallDirection.Outgoing,r._log.setLogLevel(r.options.debug?p.LogLevel.Debug:r.options.warnings?p.LogLevel.Warn:p.LogLevel.Off),r._mediaReconnectBackoff=b.exponential(g),r._mediaReconnectBackoff.on("ready",function(){return r.mediaStream.iceRestart()});var o=r._publisher=n.publisher;r._direction===t.CallDirection.Incoming&&o.info("connection","incoming",null,r);var h=r._monitor=new(r.options.StatsMonitor||u["default"]);return h.on("sample",r._onRTCSample),h.disableWarnings(),setTimeout(function(){return h.enableWarnings()},C),h.on("warning",function(e,n){"bytesSent"!==e.name&&"bytesReceived"!==e.name||r._onMediaFailure(t.MediaFailure.LowBytes),r._reemitWarning(e,n)}),h.on("warning-cleared",function(e){r._reemitWarningCleared(e)}),r.mediaStream=new(r.options.MediaStream||r.options.mediaStreamFactory)(n.audioHelper,n.pstream,n.getUserMedia,{"codecPreferences":r.options.codecPreferences,"debug":r.options.debug,"dscp":r.options.dscp,"enableIceRestart":r.options.enableIceRestart,"forceAggressiveIceNomination":r.options.forceAggressiveIceNomination,"isUnifiedPlan":r._isUnifiedPlanDefault,"maxAverageBitrate":r.options.maxAverageBitrate,"warnings":r.options.warnings}),r.on("volume",function(e,t){r._inputVolumeStreak=r._checkVolume(e,r._inputVolumeStreak,r._latestInputVolume,"input"),r._outputVolumeStreak=r._checkVolume(t,r._outputVolumeStreak,r._latestOutputVolume,"output"),r._latestInputVolume=e,r._latestOutputVolume=t}),r.mediaStream.onvolume=function(e,t,n,a){h.addVolumes(n/255*32767,a/255*32767),r.emit("volume",e,t)},r.mediaStream.onpcconnectionstatechange=function(e){var t="debug",n=r.mediaStream.getRTCDtlsTransport();"failed"===e&&(t=n&&"failed"===n.state?"error":"warning"),r._publisher.post(t,"pc-connection-state",e,null,r)},r.mediaStream.onicecandidate=function(e){var t=new d.RTCLocalIceCandidate(e).toPayload();r._publisher.debug("ice-candidate","ice-candidate",t,r)},r.mediaStream.oniceconnectionstatechange=function(e){var t="failed"===e?"error":"debug";r._publisher.post(t,"ice-connection-state",e,null,r)},r.mediaStream.onicegatheringfailure=function(e){r._publisher.warn("ice-gathering-state",e,null,r),r._onMediaFailure(t.MediaFailure.IceGatheringFailed)},r.mediaStream.onicegatheringstatechange=function(e){r._publisher.debug("ice-gathering-state",e,null,r)},r.mediaStream.onsignalingstatechange=function(e){r._publisher.debug("signaling-state",e,null,r)},r.mediaStream.ondisconnected=function(e){r._log.info(e),r._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{"message":e},r),r.emit("warning","ice-connectivity-lost"),r._onMediaFailure(t.MediaFailure.ConnectionDisconnected)},r.mediaStream.onfailed=function(){r._onMediaFailure(t.MediaFailure.ConnectionFailed)},r.mediaStream.onconnected=function(){r._status===t.State.Reconnecting&&r._onMediaReconnected()},r.mediaStream.onreconnected=function(e){r._log.info(e),r._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{"message":e},r),r.emit("warning-cleared","ice-connectivity-lost"),r._onMediaReconnected()},r.mediaStream.onerror=function(e){!0===e.disconnect&&r._disconnect(e.info&&e.info.message);var t={"code":e.info.code,"connection":r,"info":e.info,"message":e.info.message||"Error with mediastream","twilioError":e.info.twilioError};r._log.error("Received an error from MediaStream:",e),r.emit("error",t)},r.mediaStream.onopen=function(){r._status!==t.State.Open&&r._status!==t.State.Reconnecting&&(r._status===t.State.Ringing||r._status===t.State.Connecting?(r.mute(!1),r._maybeTransitionToOpen()):r.mediaStream.close())},r.mediaStream.onclose=function(){r._status=t.State.Closed,r.options.shouldPlayDisconnect&&r.options.shouldPlayDisconnect()&&r._soundcache.get(l["default"].SoundName.Disconnect).play(),h.disable(),r._publishMetrics(),r.emit("disconnect",r)},r.outboundConnectionId=a(),r.pstream=n.pstream,r.pstream.on("cancel",r._onCancel),r.pstream.on("ringing",r._onRinging),r.pstream.on("transportClose",function(){r._log.error("Received transportClose from pstream"),r.emit("transportClose")}),r.on("error",function(e){r._publisher.error("connection","error",{"code":e.code,"message":e.message},r),r.pstream&&"disconnected"===r.pstream.status&&r._cleanupEventListeners()}),r.on("disconnect",function(){r._cleanupEventListeners()}),r}return r(t,e),Object.defineProperty(t.prototype,"direction",{"get":function(){return this._direction},"enumerable":!0,"configurable":!0}),Object.defineProperty(t.prototype,"codec",{"get":function(){return this._codec},"enumerable":!0,"configurable":!0}),t.prototype._getRealCallSid=function(){return this._log.warn("_getRealCallSid is deprecated and will be removed in 2.0."),/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid},t.prototype._getTempCallSid=function(){return this._log.warn("_getTempCallSid is deprecated and will be removed in 2.0.                     Please use outboundConnectionId instead."),this.outboundConnectionId},t.prototype._setInputTracksFromStream=function(e){return this.mediaStream.setInputTracksFromStream(e)},t.prototype._setSinkIds=function(e){return this.mediaStream._setSinkIds(e)},t.prototype.accept=function(e){var n=this;if("function"!=typeof e){if(this._status===t.State.Pending){var a=e||this.options.audioConstraints;this._status=t.State.Connecting;var i=function(){if(n._status!==t.State.Connecting)return n._cleanupEventListeners(),void n.mediaStream.close();var e=function(e){var a=n._direction===t.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote";n._publisher.info("connection",a,null,n);var i=v(n.mediaStream.version.getSDP()),r=i.codecName,s=i.codecParams;n._publisher.info("settings","codec",{"codec_params":s,"selected_codec":r},n),n._monitor.enable(e)},a="function"==typeof n.options.getSinkIds&&n.options.getSinkIds();if(Array.isArray(a)&&n.mediaStream._setSinkIds(a)["catch"](function(){}),n.pstream.addListener("hangup",n._onHangup),n._direction===t.CallDirection.Incoming)n._isAnswered=!0,n.mediaStream.answerIncomingCall(n.parameters.CallSid,n.options.offerSdp,n.options.rtcConstraints,n.options.rtcConfiguration,e);else{var i=Array.from(n.customParameters.entries()).map(function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])}).join("&");n.pstream.once("answer",n._onAnswer.bind(n)),n.mediaStream.makeOutgoingCall(n.pstream.token,i,n.outboundConnectionId,n.options.rtcConstraints,n.options.rtcConfiguration,e)}};this.options.beforeAccept&&this.options.beforeAccept(this);var r="function"==typeof this.options.getInputStream&&this.options.getInputStream();(r?this.mediaStream.setInputTracksFromStream(r):this.mediaStream.openWithConstraints(a)).then(function(){n._publisher.info("get-user-media","succeeded",{"data":{"audioConstraints":a}},n),i()},function(e){var t,i;31208===e.code||-1!==["PermissionDeniedError","NotAllowedError"].indexOf(e.name)?(i=31208,t="User denied access to microphone, or the web browser did not allow microphone access at this address.",n._publisher.error("get-user-media","denied",{"data":{"audioConstraints":a,"error":e}},n)):(i=31201,t="Error occurred while accessing microphone: "+e.name+(e.message?" ("+e.message+")":""),n._publisher.error("get-user-media","failed",{"data":{"audioConstraints":a,"error":e}},n)),n._disconnect(),n.emit("error",{"message":t,"code":i})})}}else this._addHandler("accept",e)},t.prototype.cancel=function(e){this._log.warn(".cancel() is deprecated. Please use .ignore() instead."),e?this.ignore(e):this.ignore()},t.prototype.disconnect=function(e){"function"!=typeof e?this._disconnect():this._addHandler("disconnect",e)},t.prototype.error=function(e){"function"==typeof e&&this._addHandler("error",e)},t.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream},t.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream},t.prototype.ignore=function(e){"function"!=typeof e?this._status===t.State.Pending&&(this._status=t.State.Closed,this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this)):this._addHandler("cancel",e)},t.prototype.isMuted=function(){return this.mediaStream.isMuted},t.prototype.mute=function(e){if(void 0===e&&(e=!0),"function"!=typeof e){var t=this.mediaStream.isMuted;this.mediaStream.mute(e);var n=this.mediaStream.isMuted;t!==n&&(this._publisher.info("connection",n?"muted":"unmuted",null,this),this.emit("mute",n,this))}else this._addHandler("mute",e)},t.prototype.postFeedback=function(e,n){if(null==e)return this._postFeedbackDeclined();if(!Object.values(t.FeedbackScore).includes(e))throw new c.InvalidArgumentError("Feedback score must be one of: "+Object.values(t.FeedbackScore));if(null!=n&&!Object.values(t.FeedbackIssue).includes(n))throw new c.InvalidArgumentError("Feedback issue must be one of: "+Object.values(t.FeedbackIssue));return this._publisher.info("feedback","received",{"issue_name":n,"quality_score":e},this,!0)},t.prototype.reject=function(e){if("function"!=typeof e){if(this._status===t.State.Pending){var n={"callsid":this.parameters.CallSid};this.pstream.publish("reject",n),this._status=t.State.Closed,this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this)}}else this._addHandler("reject",e)},t.prototype.sendDigits=function(e){function t(e){if(e.length){var n=e.shift();n&&n.length&&a.insertDTMF(n,w,_),setTimeout(t.bind(null,e),y)}}if(e.match(/[^0-9*#w]/))throw new c.InvalidArgumentError("Illegal character passed into sendDigits");var n=[];e.split("").forEach(function(e){var t="w"!==e?"dtmf"+e:"";"dtmf*"===t&&(t="dtmfs"),"dtmf#"===t&&(t="dtmfh"),n.push(t)}),function r(e,t){var a=n.shift();a&&(t?t.play(a):e.get(a).play()),n.length&&setTimeout(r.bind(null,e),200)}(this._soundcache,this.options.dialtonePlayer);var a=this.mediaStream.getOrCreateDTMFSender();if(a){if(!("canInsertDTMF"in a)||a.canInsertDTMF)return this._log.info("Sending digits using RTCDTMFSender"),void t(e.split("w"));this._log.info("RTCDTMFSender cannot insert DTMF")}if(this._log.info("Sending digits over PStream"),null!==this.pstream&&"disconnected"!==this.pstream.status)this.pstream.publish("dtmf",{"callsid":this.parameters.CallSid,"dtmf":e});else{var i={"code":31e3,"connection":this,"message":"Could not send DTMF: Signaling channel is disconnected"};this.emit("error",i)}},t.prototype.status=function(){return this._status},t.prototype.unmute=function(){this._log.warn(".unmute() is deprecated. Please use .mute(false) to unmute a call instead."),this.mute(!1)},t.prototype.volume=function(e){window&&(window.AudioContext||window.webkitAudioContext)||this._log.warn("This browser does not support Connection.volume"),this._addHandler("volume",e)},t.prototype._addHandler=function(e,t){return M||(this._log.warn("Connection callback handlers (accept, cancel, disconnect, error, ignore, mute, reject,\n        volume) have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: connection.on('"+e+"', handler)"),M=!0),this.addListener(e,t),this},t.prototype._checkVolume=function(e,t,n,a){var i=t>=10,r=0;return n===e&&(r=t),r>=10?this._emitWarning("audio-level-","constant-audio-"+a+"-level",10,r,!1):i&&this._emitWarning("audio-level-","constant-audio-"+a+"-level",10,r,!0),r},t.prototype._cleanupEventListeners=function(){var e=this,t=function(){e.pstream&&(e.pstream.removeListener("answer",e._onAnswer),e.pstream.removeListener("cancel",e._onCancel),e.pstream.removeListener("hangup",e._onHangup),e.pstream.removeListener("ringing",e._onRinging))};t(),setTimeout(t,0)},t.prototype._createMetricPayload=function(){var e={"call_sid":this.parameters.CallSid,"dscp":!!this.options.dscp,"sdk_version":h.RELEASE_VERSION,"selected_region":this.options.selectedRegion};return this.options.gateway&&(e.gateway=this.options.gateway),this.options.region&&(e.region=this.options.region),e.direction=this._direction,e},t.prototype._disconnect=function(e,n){if(e="string"==typeof e?e:null,this._status===t.State.Open||this._status===t.State.Connecting||this._status===t.State.Reconnecting||this._status===t.State.Ringing){if(this._log.info("Disconnecting..."),null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var a=this.parameters.CallSid||this.outboundConnectionId;if(a){var i={"callsid":a};e&&(i.message=e),this.pstream.publish("hangup",i)}}this._cleanupEventListeners(),this.mediaStream.close(),n||this._publisher.info("connection","disconnected-by-local",null,this)}},t.prototype._maybeTransitionToOpen=function(){this.mediaStream&&"open"===this.mediaStream.status&&this._isAnswered&&(this._status=t.State.Open,this.emit("accept",this))},t.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)},t.prototype._publishMetrics=function(){var e=this;0!==this._metricsSamples.length&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this)["catch"](function(t){e._log.warn("Unable to post metrics to Insights. Received error:",t)})},t.prototype._setCallSid=function(e){var t=e.callsid;t&&(this.parameters.CallSid=t,this.mediaStream.callSid=t)},t.toString=function(){return"[Twilio.Connection class]"},t}(o.EventEmitter);!function(e){!function(e){e.Closed="closed",e.Connecting="connecting",e.Open="open",e.Pending="pending",e.Reconnecting="reconnecting",e.Ringing="ringing"}(e.State||(e.State={})),function(e){e.AudioLatency="audio-latency",e.ChoppyAudio="choppy-audio",e.DroppedCall="dropped-call",e.Echo="echo",e.NoisyCall="noisy-call",e.OneWayAudio="one-way-audio"}(e.FeedbackIssue||(e.FeedbackIssue={})),function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five"}(e.FeedbackScore||(e.FeedbackScore={})),function(e){e.Incoming="INCOMING",e.Outgoing="OUTGOING"}(e.CallDirection||(e.CallDirection={})),function(e){e.Opus="opus",e.PCMU="pcmu"}(e.Codec||(e.Codec={})),function(e){e.None="none",e.Timeout="timeout"}(e.IceGatheringFailureReason||(e.IceGatheringFailureReason={})),function(e){e.ConnectionDisconnected="ConnectionDisconnected",e.ConnectionFailed="ConnectionFailed",e.IceGatheringFailed="IceGatheringFailed",e.LowBytes="LowBytes"}(e.MediaFailure||(e.MediaFailure={}))}($||($={})),n["default"]=$},{"./constants":6,"./device":7,"./errors":10,"./rtc":19,"./rtc/candidate":17,"./rtc/sdp":24,"./statsMonitor":30,"./tslog":31,"./util":32,"backoff":39,"events":45}],"6":[function(e,t){var n="1.9.7";t.exports.SOUNDS_BASE_URL="https://media.twiliocdn.com/sdk/js/client/sounds/releases/1.0.0",t.exports.RELEASE_VERSION=n,t.exports.USED_ERRORS=["AuthorizationErrors.AccessTokenExpired","AuthorizationErrors.AccessTokenInvalid","AuthorizationErrors.AuthenticationFailed","ClientErrors.BadRequest","GeneralErrors.ConnectionError","GeneralErrors.TransportError","GeneralErrors.UnknownError","MediaErrors.ClientLocalDescFailed","MediaErrors.ClientRemoteDescFailed","MediaErrors.ConnectionError","SignalingErrors.ConnectionDisconnected","SignalingErrors.ConnectionError"]},{}],"7":[function(e,t,n){"use strict";var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{"value":!0})
;var s=e("events"),o=e("./audiohelper"),l=e("./connection"),c=e("./dialtonePlayer"),d=e("./errors"),u=e("./pstream"),p=e("./regions"),f=e("./tslog"),b=e("./util"),h=e("./constants"),m=e("./eventpublisher"),v=e("./rtc"),g=e("./rtc/getusermedia"),_=e("./sound"),y=e("./util").isUnifiedPlanDefault,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=3e4,C=2e3,x=!1,T=!1,S=function(e){function t(n,a){var i,s=e.call(this)||this;if(s.audio=null,s.connections=[],s.isInitialized=!1,s.sounds={},s.token=null,s._activeConnection=null,s._connectionInputStream=null,s._connectionSinkIds=["default"],s._enabledSounds=((i={})[t.SoundName.Disconnect]=!0,i[t.SoundName.Incoming]=!0,i[t.SoundName.Outgoing]=!0,i),s._log=new f["default"](f.LogLevel.Off),s._logLevel=f.LogLevel.Off,s._publisher=null,s._region=null,s._status=t.Status.Offline,s.mediaPresence={"audio":!0},s.options={"allowIncomingWhileBusy":!1,"audioConstraints":!0,"closeProtection":!1,"codecPreferences":[l["default"].Codec.PCMU,l["default"].Codec.Opus],"connectionFactory":l["default"],"debug":!1,"dscp":!0,"enableIceRestart":!1,"eventgw":"eventgw.twilio.com","forceAggressiveIceNomination":!1,"iceServers":[],"noRegister":!1,"pStreamFactory":u.PStream,"region":p.defaultRegion,"rtcConstraints":{},"soundFactory":_,"sounds":{},"warnings":!0},s.regTimer=null,s.soundcache=new Map,s.stream=null,s._confirmClose=function(e){if(!s._activeConnection)return"";var t=s.options.closeProtection||!1,n="string"!=typeof t?"A call is currently in-progress. Leaving or reloading this page will end the call.":t;return(e||window.event).returnValue=n,n},s._createDefaultPayload=function(e){function t(e,t){t&&(n[e]=t)}var n={"aggressive_nomination":s.options.forceAggressiveIceNomination,"browser_extension":s._isBrowserExtension,"dscp":!!s.options.dscp,"ice_restart_enabled":s.options.enableIceRestart,"platform":v.getMediaEngine(),"sdk_version":h.RELEASE_VERSION,"selected_region":s.options.region};if(e){var a=e.parameters.CallSid;t("call_sid",/^TJ/.test(a)?undefined:a),t("temp_call_sid",e.outboundConnectionId),t("audio_codec",e.codec),n.direction=e.direction}var i=s.stream;return i&&(t("gateway",i.gateway),t("region",i.region)),n},s._disconnectAll=function(){s.connections.splice(0).forEach(function(e){return e.disconnect()}),s._activeConnection&&s._activeConnection.disconnect()},s._onSignalingClose=function(){s.stream=null},s._onSignalingConnected=function(e){s._region=p.getRegionShortcode(e.region)||e.region,s._sendPresence()},s._onSignalingError=function(e){if(e.error){var t=r({},e.error),n=e.callsid;n&&(t.connection=s._findConnection(n)),31201===t.code?t.twilioError=new d.AuthorizationErrors.AuthenticationFailed:31204===t.code?t.twilioError=new d.AuthorizationErrors.AccessTokenInvalid:31205===t.code?(s._stopRegistrationTimer(),t.twilioError=new d.AuthorizationErrors.AccessTokenExpired):t.twilioError||(t.twilioError=new d.GeneralErrors.UnknownError),s._log.info("Received error: ",t),s.emit("error",t)}},s._onSignalingInvite=function(e){var n=!!s._activeConnection;if(!n||s.options.allowIncomingWhileBusy)if(e.callsid&&e.sdp){var a=e.parameters||{};a.CallSid=a.CallSid||e.callsid;var i=Object.assign({},b.queryToJson(a.Params)),r=s._makeConnection(i,{"callParameters":a,"offerSdp":e.sdp});s.connections.push(r),r.once("accept",function(){s.soundcache.get(t.SoundName.Incoming).stop(),s._publishNetworkChange()});var o=s._enabledSounds.incoming&&!n?function(){return s.soundcache.get(t.SoundName.Incoming).play()}:function(){return Promise.resolve()};s._showIncomingConnection(r,o)}else s.emit("error",{"message":"Malformed invite from gateway","twilioError":new d.ClientErrors.BadRequest});else s._log.info("Device busy; ignoring incoming invite")},s._onSignalingOffline=function(){s._log.info("Stream is offline"),s._status=t.Status.Offline,s._region=null,s.emit("offline",s)},s._onSignalingReady=function(){s._log.info("Stream is ready"),s._status=t.Status.Ready,s.emit("ready",s)},s._publishNetworkChange=function(){s._activeConnection&&w&&s._publisher.info("network-information","network-change",{"connection_type":w.type,"downlink":w.downlink,"downlinkMax":w.downlinkMax,"effective_type":w.effectiveType,"rtt":w.rtt},s._activeConnection)},s._updateInputStream=function(e){var t=s._activeConnection;return t&&!e?Promise.reject(new d.InvalidStateError("Cannot unset input device while a call is in progress.")):(s._connectionInputStream=e,t?t._setInputTracksFromStream(e):Promise.resolve())},s._updateSinkIds=function(e,t){return("ringtone"===e?s._updateRingtoneSinkIds(t):s._updateSpeakerSinkIds(t)).then(function(){s._publisher.info("audio",e+"-devices-set",{"audio_device_ids":t},s._activeConnection)},function(n){throw s._publisher.error("audio",e+"-devices-set-failed",{"audio_device_ids":t,"message":n.message},s._activeConnection),n})},window){var o=window,c=o.msBrowser||o.browser||o.chrome;s._isBrowserExtension=!!c&&!!c.runtime&&!!c.runtime.id||!!o.safari&&!!o.safari.extension}if(s._isBrowserExtension&&s._log.info("Running as browser extension."),n)s.setup(n,a);else if(a)throw new d.InvalidArgumentError("Cannot construct a Device with options but without a token");return s}return i(t,e),Object.defineProperty(t,"audioContext",{"get":function(){return t._audioContext},"enumerable":!0,"configurable":!0}),Object.defineProperty(t,"extension",{"get":function(){var e,t,n="undefined"!=typeof document?document.createElement("audio"):{"canPlayType":!1};try{e=n.canPlayType&&!!n.canPlayType("audio/mpeg").replace(/no/,"")}catch(a){e=!1}try{t=n.canPlayType&&!!n.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(a){t=!1}return t&&!e?"ogg":"mp3"},"enumerable":!0,"configurable":!0}),Object.defineProperty(t,"isSupported",{"get":function(){return v.enabled()},"enumerable":!0,"configurable":!0}),t.toString=function(){return"[Twilio.Device class]"},Object.defineProperty(t,"version",{"get":function(){return h.RELEASE_VERSION},"enumerable":!0,"configurable":!0}),t.prototype.activeConnection=function(){return this.isInitialized?this._activeConnection||this.connections[0]:null},t.prototype.cancel=function(e){return this._addHandler(t.EventName.Cancel,e)},t.prototype.connect=function(e,n){if("function"==typeof e)return this._addHandler(t.EventName.Connect,e),null;if(this._throwUnlessSetup("connect"),this._activeConnection)throw new d.InvalidStateError("A Connection is already active");var a=e||{};n=n||this.options&&this.options.audioConstraints||{};var i=this._activeConnection=this._makeConnection(a);return this.connections.splice(0).forEach(function(e){return e.ignore()}),this.soundcache.get(t.SoundName.Incoming).stop(),i.accept(n),this._publishNetworkChange(),i},t.prototype.destroy=function(){this._disconnectAll(),this._stopRegistrationTimer(),this.audio&&this.audio._unbind(),this.stream&&(this.stream.destroy(),this.stream=null),w&&w.removeEventListener("change",this._publishNetworkChange),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("beforeunload",this._confirmClose),window.removeEventListener("unload",this._disconnectAll))},t.prototype.disconnect=function(e){return this._addHandler(t.EventName.Disconnect,e)},t.prototype.disconnectAll=function(){this._throwUnlessSetup("disconnectAll"),this._disconnectAll()},t.prototype.error=function(e){return this._addHandler(t.EventName.Error,e)},t.prototype.incoming=function(e){return this._addHandler(t.EventName.Incoming,e)},t.prototype.offline=function(e){return this._addHandler(t.EventName.Offline,e)},t.prototype.ready=function(e){return this._addHandler(t.EventName.Ready,e)},t.prototype.region=function(){return this._throwUnlessSetup("region"),"string"==typeof this._region?this._region:"offline"},t.prototype.registerPresence=function(){return this._throwUnlessSetup("registerPresence"),this.mediaPresence.audio=!0,this._sendPresence(),this},t.prototype.removeListener=function(e,t){return s.EventEmitter.prototype.removeListener.call(this,e,t),this},t.prototype.setup=function(e,n){var a=this;if(void 0===n&&(n={}),!t.isSupported&&!n.ignoreBrowserSupport){if(window&&window.location&&"http:"===window.location.protocol)throw new d.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again.");throw new d.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC/ORTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.")}if(!e)throw new d.InvalidArgumentError("Token is required for Device.setup()");if("undefined"==typeof t._isUnifiedPlanDefault&&(t._isUnifiedPlanDefault="undefined"!=typeof window&&"undefined"!=typeof RTCPeerConnection&&"undefined"!=typeof RTCRtpTransceiver&&y(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver)),t._audioContext||("undefined"!=typeof AudioContext?t._audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(t._audioContext=new webkitAudioContext)),t._audioContext&&n.fakeLocalDTMF?t._dialtonePlayer||(t._dialtonePlayer=new c["default"](t._audioContext)):t._dialtonePlayer&&(t._dialtonePlayer.cleanup(),delete t._dialtonePlayer),this.isInitialized)return this._log.info("Found existing Device; using new token but ignoring options"),this.updateToken(e),this;this.isInitialized=!0,Object.assign(this.options,n),this.options.dscp&&(this.options.rtcConstraints.optional=[{"googDscp":!0}]),this._logLevel=this.options.debug?f.LogLevel.Debug:this.options.warnings?f.LogLevel.Warn:f.LogLevel.Off,this._log=new(this.options.Log||f["default"])(this._logLevel);var i=function(e,t){return T||(a._log.warn("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio."),T=!0),void 0!==t&&(a._enabledSounds[e]=t),a._enabledSounds[e]};[t.SoundName.Disconnect,t.SoundName.Incoming,t.SoundName.Outgoing].forEach(function(e){a.sounds[e]=i.bind(null,e)});var r=p.getRegionURI(this.options.region,function(e){return a._log.warn("Region "+a.options.region+" is deprecated, please use "+e+".")});this.options.chunderw="wss://"+(this.options.chunderw||r)+"/signal";for(var s={"disconnect":{"filename":"disconnect","maxDuration":3e3},"dtmf0":{"filename":"dtmf-0","maxDuration":1e3},"dtmf1":{"filename":"dtmf-1","maxDuration":1e3},"dtmf2":{"filename":"dtmf-2","maxDuration":1e3},"dtmf3":{"filename":"dtmf-3","maxDuration":1e3},"dtmf4":{"filename":"dtmf-4","maxDuration":1e3},"dtmf5":{"filename":"dtmf-5","maxDuration":1e3},"dtmf6":{"filename":"dtmf-6","maxDuration":1e3},"dtmf7":{"filename":"dtmf-7","maxDuration":1e3},"dtmf8":{"filename":"dtmf-8","maxDuration":1e3},"dtmf9":{"filename":"dtmf-9","maxDuration":1e3},"dtmfh":{"filename":"dtmf-hash","maxDuration":1e3},"dtmfs":{"filename":"dtmf-star","maxDuration":1e3},"incoming":{"filename":"incoming","shouldLoop":!0},"outgoing":{"filename":"outgoing","maxDuration":3e3}},l=0,u=Object.keys(s);l<u.length;l++){var b=u[l],v=s[b],_=h.SOUNDS_BASE_URL+"/"+v.filename+"."+t.extension+"?cache="+h.RELEASE_VERSION,k=this.options.sounds&&this.options.sounds[b]||_,C=new this.options.soundFactory(b,k,{"audioContext":this.options.disableAudioContextSounds?null:t.audioContext,"maxDuration":v.maxDuration,"shouldLoop":v.shouldLoop});this.soundcache.set(b,C)}return this._publisher=(this.options.Publisher||m)("twilio-js-sdk",e,{"defaultPayload":this._createDefaultPayload,"host":this.options.eventgw}),!1===this.options.publishEvents&&this._publisher.disable(),w&&w.addEventListener("change",this._publishNetworkChange),this.audio=new(this.options.AudioHelper||o["default"])(this._updateSinkIds,this._updateInputStream,g,{"audioContext":t.audioContext,"enabledSounds":this._enabledSounds,"logLevel":this._logLevel}),this.audio.on("deviceChange",function(e){var t=a._activeConnection,n=e.map(function(e){return e.deviceId});a._publisher.info("audio","device-change",{"lost_active_device_ids":n},t),t&&t.mediaStream._onInputDevicesChanged()}),this.mediaPresence.audio=!this.options.noRegister,this.updateToken(e),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("unload",this._disconnectAll),this.options.closeProtection&&window.addEventListener("beforeunload",this._confirmClose)),this.on(t.EventName.Error,function(){a.listenerCount("error")>1||a._log.info("Uncaught error event suppressed.")}),this},t.prototype.status=function(){return this._throwUnlessSetup("status"),this._activeConnection?t.Status.Busy:this._status},t.prototype.toString=function(){return"[Twilio.Device instance]"},t.prototype.unregisterPresence=function(){return this._throwUnlessSetup("unregisterPresence"),this.mediaPresence.audio=!1,this._sendPresence(),this},t.prototype.updateToken=function(e){this._throwUnlessSetup("updateToken"),this.token=e,this.register(e)},t.prototype._addHandler=function(e,t){return x||(this._log.warn("Device callback handlers (connect, error, offline, incoming, cancel, ready, disconnect)         have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: device.on('"+e+"', handler)"),x=!0),this.addListener(e,t),this},t.prototype._findConnection=function(e){return this.connections.find(function(t){return t.parameters.CallSid===e||t.outboundConnectionId===e})||null},t.prototype._makeConnection=function(e,n){var a=this;if("undefined"==typeof t._isUnifiedPlanDefault)throw new d.InvalidStateError("Device has not been initialized.");var i={"audioHelper":this.audio,"getUserMedia":g,"isUnifiedPlanDefault":t._isUnifiedPlanDefault,"pstream":this.stream,"publisher":this._publisher,"soundcache":this.soundcache};n=Object.assign({"MediaStream":this.options.MediaStream||this.options.mediaStreamFactory||v.PeerConnection,"audioConstraints":this.options.audioConstraints,"beforeAccept":function(e){a._activeConnection&&a._activeConnection!==e&&(a._activeConnection.disconnect(),a._removeConnection(a._activeConnection))},"codecPreferences":this.options.codecPreferences,"debug":this.options.debug,"dialtonePlayer":t._dialtonePlayer,"dscp":this.options.dscp,"enableIceRestart":this.options.enableIceRestart,"enableRingingState":this.options.enableRingingState,"forceAggressiveIceNomination":this.options.forceAggressiveIceNomination,"getInputStream":function(){return a._connectionInputStream},"getSinkIds":function(){return a._connectionSinkIds},"maxAverageBitrate":this.options.maxAverageBitrate,"rtcConfiguration":this.options.rtcConfiguration||{"iceServers":this.options.iceServers},"rtcConstraints":this.options.rtcConstraints,"shouldPlayDisconnect":function(){return a._enabledSounds.disconnect},"twimlParams":e,"warnings":this.options.warnings},n);var r=new this.options.connectionFactory(i,n);return r.once("accept",function(){a._removeConnection(r),a._activeConnection=r,a.audio&&a.audio._maybeStartPollingVolume(),r.direction===l["default"].CallDirection.Outgoing&&a._enabledSounds.outgoing&&a.soundcache.get(t.SoundName.Outgoing).play(),a.emit("connect",r)}),r.addListener("error",function(e){"closed"===r.status()&&a._removeConnection(r),a.audio&&a.audio._maybeStopPollingVolume(),a._maybeStopIncomingSound(),a.emit("error",e)}),r.once("cancel",function(){a._log.info("Canceled: "+r.parameters.CallSid),a._removeConnection(r),a.audio&&a.audio._maybeStopPollingVolume(),a._maybeStopIncomingSound(),a.emit("cancel",r)}),r.once("disconnect",function(){a.audio&&a.audio._maybeStopPollingVolume(),a._removeConnection(r),a.emit("disconnect",r)}),r.once("reject",function(){a._log.info("Rejected: "+r.parameters.CallSid),a.audio&&a.audio._maybeStopPollingVolume(),a._removeConnection(r),a._maybeStopIncomingSound()}),r.once("transportClose",function(){r.status()===l["default"].State.Pending&&(a.audio&&a.audio._maybeStopPollingVolume(),a._removeConnection(r),a._maybeStopIncomingSound())}),r},t.prototype._maybeStopIncomingSound=function(){this.connections.length||this.soundcache.get(t.SoundName.Incoming).stop()},t.prototype._removeConnection=function(e){this._activeConnection===e&&(this._activeConnection=null);for(var t=this.connections.length-1;t>=0;t--)e===this.connections[t]&&this.connections.splice(t,1)},t.prototype._sendPresence=function(){this.stream&&(this.stream.register({"audio":this.mediaPresence.audio}),this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer())},t.prototype._setupStream=function(e){this._log.info("Setting up VSP"),this.stream=this.options.pStreamFactory(e,this.options.chunderw,{"backoffMaxMs":this.options.backoffMaxMs,"debug":this.options.debug}),this.stream.addListener("close",this._onSignalingClose),this.stream.addListener("connected",this._onSignalingConnected),this.stream.addListener("error",this._onSignalingError),this.stream.addListener("invite",this._onSignalingInvite),this.stream.addListener("offline",this._onSignalingOffline),this.stream.addListener("ready",this._onSignalingReady)},t.prototype._showIncomingConnection=function(e,t){var n,a=this;return Promise.race([t(),new Promise(function(e,t){n=setTimeout(function(){t(new Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))},C)})])["catch"](function(e){a._log.info(e.message)}).then(function(){clearTimeout(n),a.emit("incoming",e)})},t.prototype._startRegistrationTimer=function(){var e=this;this._stopRegistrationTimer(),this.regTimer=setTimeout(function(){e._sendPresence()},k)},t.prototype._stopRegistrationTimer=function(){this.regTimer&&clearTimeout(this.regTimer)},t.prototype._throwUnlessSetup=function(e){if(!this.isInitialized)throw new d.InvalidStateError("Call Device.setup() before "+e)},t.prototype._updateRingtoneSinkIds=function(e){return Promise.resolve(this.soundcache.get(t.SoundName.Incoming).setSinkIds(e))},t.prototype._updateSpeakerSinkIds=function(e){Array.from(this.soundcache.entries()).filter(function(e){return e[0]!==t.SoundName.Incoming}).forEach(function(t){return t[1].setSinkIds(e)}),this._connectionSinkIds=e;var n=this._activeConnection;return n?n._setSinkIds(e):Promise.resolve()},t.prototype.register=function(e){this.stream?(this.stream.setToken(e),this._publisher.setToken(e)):this._setupStream(e)},t}(s.EventEmitter);!function(e){!function(e){e.Cancel="cancel",e.Connect="connect",e.Disconnect="disconnect",e.Error="error",e.Incoming="incoming",e.Offline="offline",e.Ready="ready"}(e.EventName||(e.EventName={})),function(e){e.Busy="busy",e.Offline="offline",e.Ready="ready"}(e.Status||(e.Status={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing",e.Disconnect="disconnect",e.Dtmf0="dtmf0",e.Dtmf1="dtmf1",e.Dtmf2="dtmf2",e.Dtmf3="dtmf3",e.Dtmf4="dtmf4",e.Dtmf5="dtmf5",e.Dtmf6="dtmf6",e.Dtmf7="dtmf7",e.Dtmf8="dtmf8",e.Dtmf9="dtmf9",e.DtmfS="dtmfs",e.DtmfH="dtmfh"}(e.SoundName||(e.SoundName={}))}(S||(S={})),n["default"]=S},{"./audiohelper":4,"./connection":5,"./constants":6,"./dialtonePlayer":8,"./errors":10,"./eventpublisher":11,"./pstream":14,"./regions":15,"./rtc":19,"./rtc/getusermedia":18,"./sound":29,"./tslog":31,"./util":32,"events":45}],"8":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./errors"),i={"dtmf0":[1360,960],"dtmf1":[1230,720],"dtmf2":[1360,720],"dtmf3":[1480,720],"dtmf4":[1230,790],"dtmf5":[1360,790],"dtmf6":[1480,790],"dtmf7":[1230,870],"dtmf8":[1360,870],"dtmf9":[1480,870],"dtmfh":[1480,960],"dtmfs":[1230,960]},r=function(){function e(e){var t=this;this._context=e,this._gainNodes=[],this._gainNodes=[this._context.createGain(),this._context.createGain()],this._gainNodes.forEach(function(e){e.connect(t._context.destination),e.gain.value=.1,t._gainNodes.push(e)})}return e.prototype.cleanup=function(){this._gainNodes.forEach(function(e){e.disconnect()})},e.prototype.play=function(e){var t=this,n=i[e];if(!n)throw new a.InvalidArgumentError("Invalid DTMF sound name");[this._context.createOscillator(),this._context.createOscillator()].forEach(function(e,a){e.type="sine",e.frequency.value=n[a],e.connect(t._gainNodes[a]),e.start(),e.stop(t._context.currentTime+.1),e.addEventListener("ended",function(){return e.disconnect()})})},e}();n["default"]=r},{"./errors":10}],"9":[function(e,t,n){"use strict";function a(e,t,n){"string"==typeof t?(e.message=t,n instanceof Error&&(e.originalError=n)):t instanceof Error&&(e.originalError=t)}var i,r,s,o,l,c,d=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{"value":!0}),function(e){var t=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=20101,r.description="Invalid access token",r.explanation="Twilio was unable to validate your Access Token",r.solutions=[],Object.setPrototypeOf(r,e.AccessTokenInvalid.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.AccessTokenInvalid=t;var n=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=20104,r.description="Access token expired or expiration date invalid",r.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future",r.solutions=[],Object.setPrototypeOf(r,e.AccessTokenExpired.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.AccessTokenExpired=n;var i=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=20151,r.description="Authentication Failed",r.explanation="The Authentication with the provided JWT failed",r.solutions=[],Object.setPrototypeOf(r,e.AuthenticationFailed.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.AuthenticationFailed=i}(r=n.AuthorizationErrors||(n.AuthorizationErrors={})),function(e){var t=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=31400,r.description="Bad Request (HTTP/SIP)",r.explanation="The request could not be understood due to malformed syntax.",r.solutions=[],Object.setPrototypeOf(r,e.BadRequest.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.BadRequest=t}(s=n.ClientErrors||(n.ClientErrors={})),function(e){var t=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=31e3,r.description="Unknown Error",r.explanation="An unknown error has occurred. See error details for more information.",r.solutions=[],Object.setPrototypeOf(r,e.UnknownError.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.UnknownError=t;var n=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=31005,r.description="Connection error",r.explanation="A connection error occurred during the call",r.solutions=[],Object.setPrototypeOf(r,e.ConnectionError.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ConnectionError=n;var i=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=31009,r.description="Transport error",r.explanation="No transport available to send or receive messages",r.solutions=[],Object.setPrototypeOf(r,e.TransportError.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.TransportError=i}(o=n.GeneralErrors||(n.GeneralErrors={})),function(e){var t=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=[],r.code=53e3,r.description="Signaling connection error",r.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.",r.solutions=[],Object.setPrototypeOf(r,e.ConnectionError.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ConnectionError=t;var n=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=["The device running your application lost its Internet connection."],r.code=53001,r.description="Signaling connection disconnected",r.explanation="Raised whenever the signaling connection is unexpectedly disconnected.",r.solutions=["Ensure the device running your application has access to a stable Internet connection."],Object.setPrototypeOf(r,e.ConnectionDisconnected.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ConnectionDisconnected=n}(l=n.SignalingErrors||(n.SignalingErrors={})),function(e){var t=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."],r.code=53400,r.description="Client is unable to create or apply a local media description",r.explanation="Raised whenever a Client is unable to create or apply a local media description.",r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(r,e.ClientLocalDescFailed.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ClientLocalDescFailed=t;var n=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."],r.code=53402,r.description="Client is unable to apply a remote media description",r.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.",r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(r,e.ClientRemoteDescFailed.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ClientRemoteDescFailed=n;var i=function(t){function n(n,i){var r=t.call(this,"")||this;return r.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."],r.code=53405,r.description="Media connection failed",r.explanation="Raised by the Client or Server whenever a media connection fails.",r.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."],Object.setPrototypeOf(r,e.ConnectionError.prototype),a(r,n,i),r}return d(n,t),n}(Error);e.ConnectionError=i}(c=n.MediaErrors||(n.MediaErrors={})),n.errorsByCode=new Map([[20101,r.AccessTokenInvalid],[20104,r.AccessTokenExpired],[20151,r.AuthenticationFailed],[31400,s.BadRequest],[31e3,o.UnknownError],[31005,o.ConnectionError],[31009,o.TransportError],[53e3,l.ConnectionError],[53001,l.ConnectionDisconnected],[53400,c.ClientLocalDescFailed],[53402,c.ClientRemoteDescFailed],[53405,c.ConnectionError]]),Object.freeze(n.errorsByCode)},{}],"10":[function(e,t,n){"use strict";function a(e){var t=s.errorsByCode.get(e);if(!t)throw new o("Error code "+e+" not found");return t}var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{"value":!0});var s=e("./generated");n.AuthorizationErrors=s.AuthorizationErrors,n.ClientErrors=s.ClientErrors,n.GeneralErrors=s.GeneralErrors,n.MediaErrors=s.MediaErrors,n.SignalingErrors=s.SignalingErrors;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);n.InvalidArgumentError=o;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);n.InvalidStateError=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);n.NotSupportedError=c,n.getErrorByCode=a},{"./generated":9}],"11":[function(e,t){"use strict";function n(e,t,a){if(!(this instanceof n))return new n(e,t,a);var r=(a=Object.assign({"defaultPayload":function(){return{}},"host":"eventgw.twilio.com"},a)).defaultPayload;"function"!=typeof r&&(r=function(){return Object.assign({},a.defaultPayload)});var s=!0;Object.defineProperties(this,{"_defaultPayload":{"value":r},"_isEnabled":{"get":function(){return s},"set":function(e){s=e}},"_host":{"value":a.host},"_request":{"value":a.request||i,"writable":!0},"_token":{"value":t,"writable":!0},"isEnabled":{"enumerable":!0,"get":function(){return s}},"productName":{"enumerable":!0,"value":e},"token":{"enumerable":!0,"get":function(){return this._token}}})}function a(e){return{"timestamp":new Date(e.timestamp).toISOString(),"total_packets_received":e.totals.packetsReceived,"total_packets_lost":e.totals.packetsLost,"total_packets_sent":e.totals.packetsSent,"total_bytes_received":e.totals.bytesReceived,"total_bytes_sent":e.totals.bytesSent,"packets_received":e.packetsReceived,"packets_lost":e.packetsLost,"packets_lost_fraction":e.packetsLostFraction&&Math.round(100*e.packetsLostFraction)/100,"bytes_received":e.bytesReceived,"bytes_sent":e.bytesSent,"audio_codec":e.codecName,"audio_level_in":e.audioInputLevel,"audio_level_out":e.audioOutputLevel,"call_volume_input":e.inputVolume,"call_volume_output":e.outputVolume,"jitter":e.jitter,"rtt":e.rtt,"mos":e.mos&&Math.round(100*e.mos)/100}}var i=e("./request");n.prototype._post=function(e,t,n,a,i,r,s){if(!this.isEnabled&&!s)return Promise.resolve();if(!(r&&(r.parameters&&r.parameters.CallSid||r.outboundConnectionId)))return Promise.resolve();var o={"publisher":this.productName,"group":n,"name":a,"timestamp":(new Date).toISOString(),"level":t.toUpperCase(),"payload_type":"application/json","private":!1,"payload":i&&i.forEach?i.slice(0):Object.assign(this._defaultPayload(r),i)},l={"url":"https://"+this._host+"/v4/"+e,"body":o,"headers":{"Content-Type":"application/json","X-Twilio-Token":this.token}},c=this;return new Promise(function(e,t){c._request.post(l,function(n){n?t(n):e()})})},n.prototype.post=function(e,t,n,a,i,r){return this._post("EndpointEvents",e,t,n,a,i,r)},n.prototype.debug=function(e,t,n,a){return this.post("debug",e,t,n,a)},n.prototype.info=function(e,t,n,a){return this.post("info",e,t,n,a)},n.prototype.warn=function(e,t,n,a){return this.post("warning",e,t,n,a)},n.prototype.error=function(e,t,n,a){return this.post("error",e,t,n,a)},n.prototype.postMetrics=function(e,t,n,i,r){var s=this;return new Promise(function(o){var l=n.map(a).map(function(e){return Object.assign(e,i)});o(s._post("EndpointMetrics","info",e,t,l,r))})},n.prototype.setToken=function(e){this._token=e},n.prototype.enable=function(){this._isEnabled=!0},n.prototype.disable=function(){this._isEnabled=!1},t.exports=n},{"./request":16}],"12":[function(e,t,n){function a(e,t){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.enabled)for(var a=n.prefix?n.prefix+" ":"",i=0;i<e.length;i++){var r=e[i];n.handler("string"==typeof r?a+r:r)}}function a(e){"undefined"!=typeof console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.warnings)for(var a=0;a<e.length;a++){var i=e[a];n.warnHandler(i)}}n.enabled=!0,n.prefix=t||"",n.defaultHandler=function(e){"undefined"!=typeof console&&console.log(e)},n.handler=n.defaultHandler,n.warnings=!0,n.defaultWarnHandler=a,n.warnHandler=n.defaultWarnHandler,n.deprecated=i,n.warn=i,e.log=n}n.mixinLog=a},{}],"13":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./constants"),i=e("./errors"),r=a.SOUNDS_BASE_URL+"/outgoing.mp3",s=function(){function e(e,t,n,a){this._name=e,this._availableDevices=t,this._beforeChange=n,this._isSupported=a,this._activeDevices=new Set}return e.prototype["delete"]=function(e){var t=!!this._activeDevices["delete"](e),n=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&n&&this._activeDevices.add(n);var a=Array.from(this._activeDevices.values()).map(function(e){return e.deviceId});return this._beforeChange(this._name,a),!!t},e.prototype.get=function(){return this._activeDevices},e.prototype.set=function(e){var t=this;if(!this._isSupported)return Promise.reject(new i.NotSupportedError("This browser does not support audio output selection"));var n=Array.isArray(e)?e:[e]
;if(!n.length)return Promise.reject(new i.InvalidArgumentError("Must specify at least one device to set"));var a=[],r=n.map(function(e){var n=t._availableDevices.get(e);return n||a.push(e),n});return a.length?Promise.reject(new i.InvalidArgumentError("Devices not found: "+a.join(", "))):new Promise(function(e){e(t._beforeChange(t._name,n))}).then(function(){t._activeDevices.clear(),r.forEach(t._activeDevices.add,t._activeDevices)})},e.prototype.test=function(e){return void 0===e&&(e=r),this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(t){var n;return new Promise(function(t){(n=new Audio(e)).oncanplay=t}).then(function(){return n.setSinkId(t.deviceId).then(function(){return n.play()})})})):Promise.reject(new i.InvalidStateError("No active output devices to test")):Promise.reject(new i.NotSupportedError("This browser does not support audio output selection"))},e}();n["default"]=s},{"./constants":6,"./errors":10}],"14":[function(e,t,n){function a(e,t,n){if(!(this instanceof a))return new a(e,t,n);var i={"logPrefix":"[PStream]","TransportFactory":c,"debug":!1};for(var r in n=n||{},i)r in n||(n[r]=i[r]);this.options=n,this.token=e||"",this.status="disconnected",this.uri=t,this.gateway=null,this.region=null,this._messageQueue=[],this._handleTransportClose=this._handleTransportClose.bind(this),this._handleTransportError=this._handleTransportError.bind(this),this._handleTransportMessage=this._handleTransportMessage.bind(this),this._handleTransportOpen=this._handleTransportOpen.bind(this),l.mixinLog(this,this.options.logPrefix),this.log.enabled=this.options.debug,this.on("error",function(){});var s=this;return this.addListener("ready",function(){s.status="ready"}),this.addListener("offline",function(){s.status="offline"}),this.addListener("close",function(){s.log('Received "close" from server. Destroying PStream...'),s._destroy()}),this.transport=new this.options.TransportFactory(this.uri,{"backoffMaxMs":this.options.backoffMaxMs,"logLevel":this.options.debug?"debug":"off"}),this.transport.on("close",this._handleTransportClose),this.transport.on("error",this._handleTransportError),this.transport.on("message",this._handleTransportMessage),this.transport.on("open",this._handleTransportOpen),this.transport.open(),this}function i(){var e="undefined"!=typeof navigator?navigator:{};return{"p":"browser","v":r.RELEASE_VERSION,"browser":{"userAgent":e.userAgent||"unknown","platform":e.platform||"unknown"},"plugin":"rtc"}}var r=e("./constants"),s=e("events").EventEmitter,o=e("util"),l=e("./log"),c=e("./wstransport")["default"],d=e("./errors"),u=d.GeneralErrors,p=d.SignalingErrors,f="1.5";o.inherits(a,s),a.prototype._handleTransportClose=function(){this.emit("transportClose"),"disconnected"!==this.status&&("offline"!==this.status&&this.emit("offline",this),this.status="disconnected")},a.prototype._handleTransportError=function(e){e?this.emit("error","undefined"!=typeof e.code?{"error":e}:e):this.emit("error",{"error":{"code":31e3,"message":"Websocket closed without a provided reason","twilioError":new p.ConnectionDisconnected}})},a.prototype._handleTransportMessage=function(e){if(e&&e.data&&"string"==typeof e.data){var t=JSON.parse(e.data),n=t.type,a=t.payload,i=void 0===a?{}:a;this.gateway=i.gateway||this.gateway,this.region=i.region||this.region,"error"===n&&i.error&&(i.error.twilioError=new p.ConnectionError),this.emit(n,i)}},a.prototype._handleTransportOpen=function(){var e=this;this.status="connected",this.setToken(this.token),this._messageQueue.splice(0,this._messageQueue.length).forEach(function(t){return e._publish.apply(e,t)})},a.toString=function(){return"[Twilio.PStream class]"},a.prototype.toString=function(){return"[Twilio.PStream instance]"},a.prototype.setToken=function(e){this.log("Setting token and publishing listen"),this.token=e;var t={"token":e,"browserinfo":i()};this._publish("listen",t)},a.prototype.register=function(e){var t={"media":e};this._publish("register",t,!0)},a.prototype.reinvite=function(e,t){this._publish("reinvite",{"sdp":e,"callsid":t},!1)},a.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)},a.prototype.destroy=function(){return this.log("PStream.destroy() called..."),this._destroy(),this},a.prototype.publish=function(e,t){return this._publish(e,t,!0)},a.prototype._publish=function(e,t,n){var a=JSON.stringify({"type":e,"version":f,"payload":t});!!this.transport.send(a)||(this.emit("error",{"error":{"code":31009,"message":"No transport available to send or receive messages","twilioError":new u.TransportError}}),n&&this._messageQueue.push([e,t,!0]))},n.PStream=a},{"./constants":6,"./errors":10,"./log":12,"./wstransport":33,"events":45,"util":56}],"15":[function(e,t,n){"use strict";function a(e,t){if(e===undefined||e===n.defaultRegion)return"chunderw-vpc-gll.twilio.com";var a=n.deprecatedRegions[e];return a&&(e=a,t&&setTimeout(function(){return t(a)})),"chunderw-vpc-gll-"+e+".twilio.com"}function i(e){return n.regionShortcodes[e]||null}var r,s,o,l;Object.defineProperty(n,"__esModule",{"value":!0}),function(e){e.Au="au",e.Br="br",e.Ie="ie",e.Jp="jp",e.Sg="sg",e.UsOr="us-or",e.UsVa="us-va"}(o=n.DeprecatedRegion||(n.DeprecatedRegion={})),function(e){e.Au1="au1",e.Br1="br1",e.De1="de1",e.De1Ix="de1-ix",e.Gll="gll",e.Ie1="ie1",e.Ie1Ix="ie1-ix",e.Ie1Tnx="ie1-tnx",e.Jp1="jp1",e.Sg1="sg1",e.Us1="us1",e.Us1Ix="us1-ix",e.Us1Tnx="us1-tnx",e.Us2="us2",e.Us2Ix="us2-ix",e.Us2Tnx="us2-tnx"}(l=n.Region||(n.Region={})),n.deprecatedRegions=((r={})[o.Au]=l.Au1,r[o.Br]=l.Br1,r[o.Ie]=l.Ie1,r[o.Jp]=l.Jp1,r[o.Sg]=l.Sg1,r[o.UsOr]=l.Us1,r[o.UsVa]=l.Us1,r),n.regionShortcodes={"ASIAPAC_SINGAPORE":l.Sg1,"ASIAPAC_SYDNEY":l.Au1,"ASIAPAC_TOKYO":l.Jp1,"EU_FRANKFURT":l.De1,"EU_IRELAND":l.Ie1,"SOUTH_AMERICA_SAO_PAULO":l.Br1,"US_EAST_VIRGINIA":l.Us1,"US_WEST_OREGON":l.Us2};(s={})[l.Au1]="chunderw-vpc-gll-au1.twilio.com",s[l.Br1]="chunderw-vpc-gll-br1.twilio.com",s[l.De1]="chunderw-vpc-gll-de1.twilio.com",s[l.De1Ix]="chunderw-vpc-gll-de1-ix.twilio.com",s[l.Gll]="chunderw-vpc-gll.twilio.com",s[l.Ie1]="chunderw-vpc-gll-ie1.twilio.com",s[l.Ie1Ix]="chunderw-vpc-gll-ie1-ix.twilio.com",s[l.Ie1Tnx]="chunderw-vpc-gll-ie1-tnx.twilio.com",s[l.Jp1]="chunderw-vpc-gll-jp1.twilio.com",s[l.Sg1]="chunderw-vpc-gll-sg1.twilio.com",s[l.Us1]="chunderw-vpc-gll-us1.twilio.com",s[l.Us1Ix]="chunderw-vpc-gll-us1-ix.twilio.com",s[l.Us1Tnx]="chunderw-vpc-gll-us1-tnx.twilio.com",s[l.Us2]="chunderw-vpc-gll-us2.twilio.com",s[l.Us2Ix]="chunderw-vpc-gll-us2-ix.twilio.com",s[l.Us2Tnx]="chunderw-vpc-gll-us2-tnx.twilio.com";n.defaultRegion="gll",n.getRegionURI=a,n.getRegionShortcode=i},{}],"16":[function(e,t){"use strict";function n(e,t,n){var i={};i.XMLHttpRequest=i.XMLHttpRequest||a;var r=new i.XMLHttpRequest;for(var s in r.open(e,t.url,!0),r.onreadystatechange=function(){4===r.readyState&&(200<=r.status&&r.status<300?n(null,r.responseText):n(new Error(r.responseText)))},t.headers)r.setRequestHeader(s,t.headers[s]);r.send(JSON.stringify(t.body))}var a=e("xmlhttprequest").XMLHttpRequest,i=n;i.get=function(e,t){return new this("GET",e,t)},i.post=function(e,t){return new this("POST",e,t)},t.exports=i},{"xmlhttprequest":2}],"17":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=function(){function e(e){var t;this.deleted=!1,this.isRemote=!1;var n=e.candidate.split("network-cost ");n[1]&&(t=parseInt(n[1],10)),this.candidateType=e.type,this.ip=e.ip||e.address,this.networkCost=t,this.port=e.port,this.priority=e.priority,this.protocol=e.protocol,this.transportId=e.sdpMid}return e.prototype.toPayload=function(){return{"candidate_type":this.candidateType,"deleted":this.deleted,"ip":this.ip,"is_remote":this.isRemote,"network-cost":this.networkCost,"port":this.port,"priority":this.priority,"protocol":this.protocol,"transport_id":this.transportId}},e}();n.RTCLocalIceCandidate=a},{}],"18":[function(e,t){"use strict";function n(e,t){return(t=t||{}).util=t.util||r,t.navigator=t.navigator||("undefined"!=typeof navigator?navigator:null),new Promise(function(n,r){if(!t.navigator)throw new i("getUserMedia is not supported");switch("function"){case a(t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia):return n(t.navigator.mediaDevices.getUserMedia(e));case a(t.navigator.webkitGetUserMedia):return t.navigator.webkitGetUserMedia(e,n,r);case a(t.navigator.mozGetUserMedia):return t.navigator.mozGetUserMedia(e,n,r);case a(t.navigator.getUserMedia):return t.navigator.getUserMedia(e,n,r);default:throw new i("getUserMedia is not supported")}})["catch"](function(e){throw t.util.isFirefox()&&"NotReadableError"===e.name?new i("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):e})}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("../errors").NotSupportedError,r=e("../util");t.exports=n},{"../errors":10,"../util":32}],"19":[function(e,t){"use strict";function n(){return r()}function a(){return"undefined"!=typeof RTCIceGatherer?"ORTC":"WebRTC"}var i=e("./peerconnection"),r=e("./rtcpc").test;t.exports={"enabled":n,"getMediaEngine":a,"PeerConnection":i}},{"./peerconnection":22,"./rtcpc":23}],"20":[function(e,t){"use strict";function n(e){if(!(this instanceof n))return new n(e);var t=this;Object.defineProperties(this,{"size":{"enumerable":!0,"get":function(){return t._map.size}},"_map":{"value":e}}),this[Symbol.iterator]=e[Symbol.iterator]}function a(e){return{"type":"transport","id":e.id,"timestamp":Date.parse(e.timestamp),"bytesSent":undefined,"bytesReceived":undefined,"rtcpTransportStatsId":undefined,"dtlsState":undefined,"selectedCandidatePairId":e.stat("selectedCandidatePairId"),"localCertificateId":e.stat("localCertificateId"),"remoteCertificateId":e.stat("remoteCertificateId")}}function i(e){return{"type":"codec","id":e.id,"timestamp":Date.parse(e.timestamp),"payloadType":undefined,"mimeType":e.stat("mediaType")+"/"+e.stat("googCodecName"),"clockRate":undefined,"channels":undefined,"sdpFmtpLine":undefined,"implementation":undefined}}function r(e){return{"type":"track","id":e.id,"timestamp":Date.parse(e.timestamp),"trackIdentifier":e.stat("googTrackId"),"remoteSource":undefined,"ended":undefined,"kind":e.stat("mediaType"),"detached":undefined,"ssrcIds":undefined,"frameWidth":g(e,"googFrameWidthReceived")?h(e,"googFrameWidthReceived"):h(e,"googFrameWidthSent"),"frameHeight":g(e,"googFrameHeightReceived")?h(e,"googFrameHeightReceived"):h(e,"googFrameHeightSent"),"framesPerSecond":undefined,"framesSent":h(e,"framesEncoded"),"framesReceived":undefined,"framesDecoded":h(e,"framesDecoded"),"framesDropped":undefined,"framesCorrupted":undefined,"partialFramesLost":undefined,"fullFramesLost":undefined,"audioLevel":g(e,"audioOutputLevel")?h(e,"audioOutputLevel")/_:(h(e,"audioInputLevel")||0)/_,"echoReturnLoss":m(e,"googEchoCancellationReturnLoss"),"echoReturnLossEnhancement":m(e,"googEchoCancellationReturnLossEnhancement")}}function s(e,t){return{"id":e.id,"timestamp":Date.parse(e.timestamp),"ssrc":e.stat("ssrc"),"associateStatsId":undefined,"isRemote":undefined,"mediaType":e.stat("mediaType"),"trackId":"track-"+e.id,"transportId":e.stat("transportId"),"codecId":"codec-"+e.id,"firCount":t?h(e,"googFirsSent"):undefined,"pliCount":h(e,t?"googPlisSent":"googPlisReceived"),"nackCount":h(e,t?"googNacksSent":"googNacksReceived"),"sliCount":undefined,"qpSum":h(e,"qpSum")}}function o(e){var t=s(e,!0);return Object.assign(t,{"type":"inbound-rtp","packetsReceived":h(e,"packetsReceived"),"bytesReceived":h(e,"bytesReceived"),"packetsLost":h(e,"packetsLost"),"jitter":f(e.stat("googJitterReceived")),"fractionLost":undefined,"roundTripTime":f(e.stat("googRtt")),"packetsDiscarded":undefined,"packetsRepaired":undefined,"burstPacketsLost":undefined,"burstPacketsDiscarded":undefined,"burstLossCount":undefined,"burstDiscardCount":undefined,"burstLossRate":undefined,"burstDiscardRate":undefined,"gapLossRate":undefined,"gapDiscardRate":undefined,"framesDecoded":h(e,"framesDecoded")}),t}function l(e){var t=s(e,!1);return Object.assign(t,{"type":"outbound-rtp","remoteTimestamp":undefined,"packetsSent":h(e,"packetsSent"),"bytesSent":h(e,"bytesSent"),"targetBitrate":undefined,"framesEncoded":h(e,"framesEncoded")}),t}function c(e,t){return{"type":t?"remote-candidate":"local-candidate","id":e.id,"timestamp":Date.parse(e.timestamp),"transportId":undefined,"isRemote":t,"ip":e.stat("ipAddress"),"port":h(e,"portNumber"),"protocol":e.stat("transport"),"candidateType":b(e.stat("candidateType")),"priority":m(e,"priority"),"url":undefined,"relayProtocol":undefined,"deleted":undefined}}function d(e){return{"type":"candidate-pair","id":e.id,"timestamp":Date.parse(e.timestamp),"transportId":e.stat("googChannelId"),"localCandidateId":e.stat("localCandidateId"),"remoteCandidateId":e.stat("remoteCandidateId"),"state":undefined,"priority":undefined,"nominated":undefined,"writable":v(e,"googWritable"),"readable":undefined,"bytesSent":h(e,"bytesSent"),"bytesReceived":h(e,"bytesReceived"),"lastPacketSentTimestamp":undefined,"lastPacketReceivedTimestamp":undefined,"totalRoundTripTime":undefined,"currentRoundTripTime":f(e.stat("googRtt")),"availableOutgoingBitrate":undefined,"availableIncomingBitrate":undefined,"requestsReceived":h(e,"requestsReceived"),"requestsSent":h(e,"requestsSent"),"responsesReceived":h(e,"responsesReceived"),"responsesSent":h(e,"responsesSent"),"retransmissionsReceived":undefined,"retransmissionsSent":undefined,"consentRequestsSent":h(e,"consentRequestsSent")}}function u(e){return{"type":"certificate","id":e.id,"timestamp":Date.parse(e.timestamp),"fingerprint":e.stat("googFingerprint"),"fingerprintAlgorithm":e.stat("googFingerprintAlgorithm"),"base64Certificate":e.stat("googDerBase64"),"issuerCertificateId":e.stat("googIssuerId")}}function p(e){return{"type":"data-channel","id":e.id,"timestamp":Date.parse(e.timestamp),"label":e.stat("label"),"protocol":e.stat("protocol"),"datachannelid":e.stat("datachannelid"),"transportId":e.stat("transportId"),"state":e.stat("state"),"messagesSent":undefined,"bytesSent":undefined,"messagesReceived":undefined,"bytesReceived":undefined}}function f(e){return isNaN(e)||""===e?undefined:parseInt(e,10)/1e3}function b(e){switch(e){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return e}}function h(e,t){var n=e.stat(t);return g(e,t)?parseInt(n,10):undefined}function m(e,t){var n=e.stat(t);return g(e,t)?parseFloat(n):undefined}function v(e,t){var n=e.stat(t);return g(e,t)?"true"===n||!0===n:undefined}function g(e,t){var n=e.stat(t);return void 0!==n&&""!==n}var _=32767,y="undefined"!=typeof window?window.RTCStatsReport:undefined;y&&(n.prototype=Object.create(y.prototype),n.prototype.constructor=n),["entries","forEach","get","has","keys","values"].forEach(function(e){n.prototype[e]=function(){var t;return(t=this._map)[e].apply(t,arguments)}}),n.fromArray=function(e){return new n(e.reduce(function(e,t){return e.set(t.id,t),e},new Map))},n.fromRTCStatsResponse=function(e){var t=void 0,s=new Map,f=e.result().reduce(function(e,n){var f=n.id;switch(n.type){case"googCertificate":e.set(f,u(n));break;case"datachannel":e.set(f,p(n));break;case"googCandidatePair":v(n,"googActiveConnection")&&(t=f),e.set(f,d(n));break;case"localcandidate":e.set(f,c(n,!1));break;case"remotecandidate":e.set(f,c(n,!0));break;case"ssrc":g(n,"packetsReceived")?e.set("rtp-"+f,o(n)):e.set("rtp-"+f,l(n)),e.set("track-"+f,r(n)),e.set("codec-"+f,i(n));break;case"googComponent":var b=a(n);s.set(b.selectedCandidatePairId,f),e.set(f,a(n))}return e},new Map);if(t){var b=s.get(t);b&&(f.get(b).dtlsState="connected")}return new n(f)},t.exports=n},{}],"21":[function(e,t){"use strict";function n(e,t,n){if(!i(e)||!i(t)||!i(n))return null;var r=a(e,t,n),s=1+.035*r+7e-6*r*(r-60)*(100-r);return s>=1&&s<4.6?s:null}function a(e,t,n){var a=e+2*t+10,i=0;switch(!0){case a<160:i=r.r0-a/40;break;case a<1e3:i=r.r0-(a-120)/10;break;case a>=1e3:i=r.r0-a/100}var s=.01;switch(!0){case-1===n:s=0,i=0;break;case n<=i/2.5:s=2.5;break;case n>i/2.5&&n<100:s=.25}return i-=n*s}function i(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)&&e>=0}var r={"r0":94.768,"is":1.42611};t.exports={"calculate":n}},{}],"22":[function(e,t){"use strict";function n(e,t,a,i){function r(){}if(!e||!t||!a)throw new l("Audiohelper, pstream and getUserMedia are required arguments");if(!(this instanceof n))return new n(e,t,a,i);this.onopen=r,this.onerror=r,this.onclose=r,this.ondisconnected=r,this.onfailed=r,this.onconnected=r,this.onreconnected=r,this.onsignalingstatechange=r,this.onicegatheringfailure=r,this.onicegatheringstatechange=r,this.oniceconnectionstatechange=r,this.onpcconnectionstatechange=r,this.onicecandidate=r,this.onvolume=r,this.version=null,this.pstream=t,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1,this.getUserMedia=a;var s="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!s&&"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId,this._audioContext=s&&e._audioContext,this._hasIceCandidates=!1,this._hasIceGatheringFailures=!1,this._iceGatheringTimeoutId=null,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=r,this._onHangup=r,this._remoteStream=null,this._shouldManageStream=!0,p.mixinLog(this,"[Twilio.PeerConnection]"),this.log.enabled=i.debug,this.log.warnings=i.warnings,this._iceState=_,this._isUnifiedPlan=i.isUnifiedPlan,this.options=i=i||{},this.navigator=i.navigator||("undefined"!=typeof navigator?navigator:null),this.util=i.util||f,this.codecPreferences=i.codecPreferences,this}function a(e,t){"function"==typeof e.addTrack?t.getAudioTracks().forEach(function(n){e.addTrack(n,t)}):e.addStream(t)}function i(e){var t="undefined"!=typeof MediaStream?new MediaStream:new webkitMediaStream;return e.getAudioTracks().forEach(t.addTrack,t),t}function r(e,t){"function"==typeof e.removeTrack?e.getSenders().forEach(function(t){e.removeTrack(t)}):e.removeStream(t)}function s(e,t){if("undefined"!=typeof e.srcObject)e.srcObject=t;else if("undefined"!=typeof e.mozSrcObject)e.mozSrcObject=t;else{if("undefined"==typeof e.src)return!1;var n=e.options.window||window;e.src=(n.URL||n.webkitURL).createObjectURL(t)}return!0}var o=e("../errors"),l=o.InvalidArgumentError,c=o.MediaErrors,d=o.NotSupportedError,u=o.SignalingErrors,p=e("../log"),f=e("../util"),b=e("./rtcpc"),h=e("./sdp").setIceAggressiveNomination,m=15e3,v="none",g="timeout",_="new",y=50;n.prototype.uri=function(){return this._uri},n.prototype.openWithConstraints=function(e){return this.getUserMedia({"audio":e}).then(this._setInputTracksFromStream.bind(this,!1))},n.prototype.setInputTracksFromStream=function(e){var t=this;return this._setInputTracksFromStream(!0,e).then(function(){t._shouldManageStream=!1})},n.prototype._createAnalyser=function(e,t){t=Object.assign({"fftSize":32,"smoothingTimeConstant":.3},t);var n=e.createAnalyser();for(var a in t)n[a]=t[a];return n},n.prototype._setVolumeHandler=function(e){this.onvolume=e},n.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var e=this._audioContext,t=(this._inputAnalyser=this._createAnalyser(e)).frequencyBinCount,n=new Uint8Array(t);this._inputAnalyser2=this._createAnalyser(e,{"minDecibels":-127,"maxDecibels":0,"smoothingTimeConstant":0});var a=(this._outputAnalyser=this._createAnalyser(e)).frequencyBinCount,i=new Uint8Array(a);this._outputAnalyser2=this._createAnalyser(e,{"minDecibels":-127,"maxDecibels":0,"smoothingTimeConstant":0}),this._updateInputStreamSource(this.stream),this._updateOutputStreamSource(this._remoteStream);var r=this;setTimeout(function s(){if(r._audioContext){if("closed"===r.status)return r._inputAnalyser.disconnect(),r._outputAnalyser.disconnect(),r._inputAnalyser2.disconnect(),void r._outputAnalyser2.disconnect();r._inputAnalyser.getByteFrequencyData(n);var e=r.util.average(n);r._inputAnalyser2.getByteFrequencyData(n);var t=r.util.average(n);r._outputAnalyser.getByteFrequencyData(i);var a=r.util.average(i);r._outputAnalyser2.getByteFrequencyData(i);var o=r.util.average(i);r.onvolume(e/255,a/255,t,o),setTimeout(s,y)}},y)}},n.prototype._stopStream=function(e){this._shouldManageStream&&("function"==typeof MediaStreamTrack.prototype.stop?("function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks).forEach(function(e){e.stop()}):e.stop())},n.prototype._updateInputStreamSource=function(e){this._inputStreamSource&&this._inputStreamSource.disconnect(),this._inputStreamSource=this._audioContext.createMediaStreamSource(e),this._inputStreamSource.connect(this._inputAnalyser),this._inputStreamSource.connect(this._inputAnalyser2)},n.prototype._updateOutputStreamSource=function(e){this._outputStreamSource&&this._outputStreamSource.disconnect(),this._outputStreamSource=this._audioContext.createMediaStreamSource(e),this._outputStreamSource.connect(this._outputAnalyser),this._outputStreamSource.connect(this._outputAnalyser2)},n.prototype._setInputTracksFromStream=function(e,t){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(e,t):this._setInputTracksForPlanB(e,t)},n.prototype._setInputTracksForPlanB=function(e,t){var n=this;if(!t)return Promise.reject(new l("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new l("Supplied input stream has no audio tracks"));var s=this.stream;return s?(this._stopStream(s),r(this.version.pc,s),s.getAudioTracks().forEach(s.removeTrack,s),t.getAudioTracks().forEach(s.addTrack,s),a(this.version.pc,t),this._updateInputStreamSource(this.stream)):this.stream=e?i(t):t,this.mute(this.isMuted),this.version?new Promise(function(e,t){n.version.createOffer(n.options.maxAverageBitrate,n.codecPreferences,{"audio":!0},function(){n.version.processAnswer(n.codecPreferences,n._answerSdp,function(){e(n.stream)},t)},t)}):Promise.resolve(this.stream)},n.prototype._setInputTracksForUnifiedPlan=function(e,t){var n=this;if(!t)return Promise.reject(new l("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new l("Supplied input stream has no audio tracks"));var a=this.stream,r=function(){return n.mute(n.isMuted),Promise.resolve(n.stream)};return a?(this._shouldManageStream&&this._stopStream(a),this._sender||(this._sender=this.version.pc.getSenders()[0]),this._sender.replaceTrack(t.getAudioTracks()[0]).then(function(){return n._updateInputStreamSource(t),r()})):(this.stream=e?i(t):t,r())},n.prototype._onInputDevicesChanged=function(){this.stream&&(this.stream.getAudioTracks().every(function(e){return"ended"===e.readyState})&&this._shouldManageStream&&this.openWithConstraints(!0))},n.prototype._onIceGatheringFailure=function(e){this._hasIceGatheringFailures=!0,this.onicegatheringfailure(e)},n.prototype._onMediaConnectionStateChange=function(e){var t=this._iceState;if(t!==e&&("connected"===e||"disconnected"===e||"failed"===e)){this._iceState=e;var n=void 0;switch(e){case"connected":"disconnected"===t||"failed"===t?(n="ICE liveliness check succeeded. Connection with Twilio restored",this.log(n),this.onreconnected(n)):(n="Media connection established.",this.log(n),this.onconnected(n)),this._stopIceGatheringTimeout(),this._hasIceGatheringFailures=!1;break;case"disconnected":n="ICE liveliness check failed. May be having trouble connecting to Twilio",this.log(n),this.ondisconnected(n);break;case"failed":n="Connection with Twilio was interrupted.",this.log(n),this.onfailed(n)}}},n.prototype._setSinkIds=function(e){return this._isSinkSupported?(this.sinkIds=new Set(e.forEach?e:[e]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new d("Audio output selection is not supported by this browser"))},n.prototype._startIceGatheringTimeout=function(){var e=this;this._stopIceGatheringTimeout(),this._iceGatheringTimeoutId=setTimeout(function(){e._onIceGatheringFailure(g)},m)},n.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)},n.prototype._updateAudioOutputs=function(){var e=Array.from(this.sinkIds).filter(function(e){return!this.outputs.has(e)},this),t=Array.from(this.outputs.keys()).filter(function(e){return!this.sinkIds.has(e)},this),n=this,a=e.map(this._createAudioOutput,this);return Promise.all(a).then(function(){return Promise.all(t.map(n._removeAudioOutput,n))})},n.prototype._createAudio=function(e){return new Audio(e)},n.prototype._createAudioOutput=function(e){var t=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(t);var n=this._createAudio();s(n,t.stream);var a=this;return n.setSinkId(e).then(function(){return n.play()}).then(function(){a.outputs.set(e,{"audio":n,"dest":t})})},n.prototype._removeAudioOutputs=function(){return this._masterAudio&&"undefined"!=typeof this._masterAudioDeviceId&&(this._disableOutput(this,this._masterAudioDeviceId),this.outputs["delete"](this._masterAudioDeviceId),this._masterAudioDeviceId=null,this._masterAudio.paused||this._masterAudio.pause(),"undefined"!=typeof this._masterAudio.srcObject?this._masterAudio.srcObject=null:this._masterAudio.src="",this._masterAudio=null),Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)},n.prototype._disableOutput=function(e,t){var n=e.outputs.get(t);n&&(n.audio&&(n.audio.pause(),n.audio.src=""),n.dest&&n.dest.disconnect())},n.prototype._reassignMasterOutput=function(e,t){var n=e.outputs.get(t);e.outputs["delete"](t);var a=this,i=Array.from(e.outputs.keys())[0]||"default";return n.audio.setSinkId(i).then(function(){a._disableOutput(e,i),e.outputs.set(i,n),e._masterAudioDeviceId=i})["catch"](function(){e.outputs.set(t,n),a.log("Could not reassign master output. Attempted to roll back.")})},n.prototype._removeAudioOutput=function(e){return this._masterAudioDeviceId===e?this._reassignMasterOutput(this,e):(this._disableOutput(this,e),this.outputs["delete"](e),Promise.resolve())},n.prototype._onAddTrack=function(e,t){var n=e._masterAudio=this._createAudio();s(n,t),n.play();var a=Array.from(e.outputs.keys())[0]||"default";e._masterAudioDeviceId=a,e.outputs.set(a,{"audio":n}),e._mediaStreamSource=e._audioContext.createMediaStreamSource(t),e.pcStream=t,e._updateAudioOutputs()},n.prototype._fallbackOnAddTrack=function(e,t){var n=document&&document.createElement("audio");n.autoplay=!0,s(n,t)||e.log("Error attaching stream to element."),e.outputs.set("default",{"audio":n})},n.prototype._setEncodingParameters=function(e){if(e&&this._sender&&"function"==typeof this._sender.getParameters&&"function"==typeof this._sender.setParameters){var t=this._sender.getParameters();(t.priority||t.encodings&&t.encodings.length)&&(t.priority="high",t.encodings&&t.encodings.length&&t.encodings.forEach(function(e){e.priority="high",e.networkPriority="high"}),this._sender.setParameters(t))}},n.prototype._setupPeerConnection=function(e,t){var n=this,i=this,r=new(this.options.rtcpcFactory||b);r.create(this.log,e,t),a(r.pc,this.stream);var s="ontrack"in r.pc?"ontrack":"onaddstream";return r.pc[s]=function(e){var t=i._remoteStream=e.stream||e.streams[0];"function"==typeof r.pc.getSenders&&(n._sender=r.pc.getSenders()[0]),i._isSinkSupported?i._onAddTrack(i,t):i._fallbackOnAddTrack(i,t),i._startPollingVolume()},r},n.prototype._maybeSetIceAggressiveNomination=function(e){return this.options.forceAggressiveIceNomination?h(e):e},n.prototype._setupChannel=function(){var e=this,t=this.version.pc;this.version.pc.onopen=function(){e.status="open",e.onopen()},this.version.pc.onstatechange=function(){e.version.pc&&"stable"===e.version.pc.readyState&&(e.status="open",e.onopen())},this.version.pc.onsignalingstatechange=function(){var n=t.signalingState;e.log('signalingState is "'+n+'"'),e.version.pc&&"stable"===e.version.pc.signalingState&&(e.status="open",e.onopen()),e.onsignalingstatechange(t.signalingState)},t.onconnectionstatechange=function(){e.log('pc.connectionState is "'+t.connectionState+'"'),e.onpcconnectionstatechange(t.connectionState),e._onMediaConnectionStateChange(t.connectionState)},t.onicecandidate=function(t){var n=t.candidate;n&&(e._hasIceCandidates=!0,e.onicecandidate(n)),e.log("ICE Candidate: "+JSON.stringify(n))},t.onicegatheringstatechange=function(){var n=t.iceGatheringState;"gathering"===n?(e._hasIceCandidates=!1,e._startIceGatheringTimeout()):"complete"===n&&(e._stopIceGatheringTimeout(),e._hasIceCandidates||e._onIceGatheringFailure(v),e._hasIceCandidates&&e._hasIceGatheringFailures&&e._startIceGatheringTimeout()),e.log('pc.iceGatheringState is "'+t.iceGatheringState+'"'),e.onicegatheringstatechange(n)},t.oniceconnectionstatechange=function(){e.log('pc.iceConnectionState is "'+t.iceConnectionState+'"'),e.oniceconnectionstatechange(t.iceConnectionState),e._onMediaConnectionStateChange(t.iceConnectionState)}},n.prototype._initializeMediaStream=function(e,t){return"open"!==this.status&&("disconnected"===this.pstream.status?(this.onerror({"info":{"code":31e3,"message":"Cannot establish connection. Client is disconnected","twilioError":new u.ConnectionDisconnected}}),this.close(),!1):(this.version=this._setupPeerConnection(e,t),this._setupChannel(),!0))},n.prototype._removeReconnectionListeners=function(){this.pstream&&(this.pstream.removeListener("answer",this._onAnswerOrRinging),this.pstream.removeListener("hangup",this._onHangup))},n.prototype.iceRestart=function(){var e=this;this.options.enableIceRestart&&(this.log("Attempting to restart ICE..."),this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{"iceRestart":!0}).then(function(){e._removeReconnectionListeners(),e._onAnswerOrRinging=function(t){if(e._removeReconnectionListeners(),t.sdp&&"have-local-offer"===e.version.pc.signalingState){var n=e._maybeSetIceAggressiveNomination(t.sdp);e._answerSdp=n,"closed"!==e.status&&e.version.processAnswer(e.codecPreferences,n,null,function(t){var n=t&&t.message?t.message:t;e.log("Failed to process answer during ICE Restart. Error: "+n)})}else{var a="Invalid state or param during ICE Restart:hasSdp:"+!!t.sdp+", signalingState:"+e.version.pc.signalingState;e.log(a)}},e._onHangup=function(){e.log("Received hangup during ICE Restart"),e._removeReconnectionListeners()},e.pstream.on("answer",e._onAnswerOrRinging),e.pstream.on("hangup",e._onHangup),e.pstream.reinvite(e.version.getSDP(),e.callSid)})["catch"](function(t){var n=t&&t.message?t.message:t;e.log("Failed to createOffer during ICE Restart. Error: "+n),e.onfailed(n)}))},n.prototype.makeOutgoingCall=function(e,t,n,a,i,r){function s(){p.options&&p._setEncodingParameters(p.options.dscp),r(p.version.pc)}function o(e){var t=e.message||e;p.onerror({"info":{"code":31e3,"message":"Error processing answer: "+t,"twilioError":new c.ClientRemoteDescFailed}})}function l(){"closed"!==p.status&&p.pstream.publish("invite",{"sdp":p.version.getSDP(),"callsid":p.callSid,"twilio":t?{"params":t}:{}})}function d(e){var t=e.message||e;p.onerror({"info":{"code":31e3,"message":"Error creating the offer: "+t,"twilioError":new c.ClientLocalDescFailed}})}var u=this;if(this._initializeMediaStream(a,i)){var p=this;this.callSid=n,this._onAnswerOrRinging=function(e){if(e.sdp){var t=u._maybeSetIceAggressiveNomination(e.sdp);p._answerSdp=t,"closed"!==p.status&&p.version.processAnswer(u.codecPreferences,t,s,o),p.pstream.removeListener("answer",p._onAnswerOrRinging),p.pstream.removeListener("ringing",p._onAnswerOrRinging)}},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging),this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{"audio":!0},l,d)}},n.prototype.answerIncomingCall=function(e,t,n,a,i){function r(){"closed"!==o.status&&(o.pstream.publish("answer",{"callsid":e,"sdp":o.version.getSDP()}),o.options&&o._setEncodingParameters(o.options.dscp),i(o.version.pc))}function s(e){var t=e.message||e;o.onerror({"info":{"code":31e3,"message":"Error creating the answer: "+t,"twilioError":new c.ClientRemoteDescFailed}})}if(this._initializeMediaStream(n,a)){t=this._maybeSetIceAggressiveNomination(t),
this._answerSdp=t.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=e;var o=this;this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,t,{"audio":!0},r,s)}},n.prototype.close=function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream(this.stream)),this.stream=null,this._removeReconnectionListeners(),this._stopIceGatheringTimeout(),Promise.all(this._removeAudioOutputs())["catch"](function(){}),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this._inputAnalyser2&&this._inputAnalyser2.disconnect(),this._outputAnalyser2&&this._outputAnalyser2.disconnect(),this.status="closed",this.onclose()},n.prototype.reject=function(e){this.callSid=e},n.prototype.ignore=function(e){this.callSid=e},n.prototype.mute=function(e){(this.isMuted=e,this.stream)&&(this._sender&&this._sender.track?this._sender.track.enabled=!e:("function"==typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach(function(t){t.enabled=!e}))},n.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var e=this,t=this.version.pc;if(!t)return this.log("No RTCPeerConnection available to call createDTMFSender on"),null;if("function"==typeof t.getSenders&&("function"==typeof RTCDTMFSender||"function"==typeof RTCDtmfSender)){var n=t.getSenders().find(function(e){return e.dtmf});if(n)return this.log("Using RTCRtpSender#dtmf"),this._dtmfSender=n.dtmf,this._dtmfSender}if("function"==typeof t.createDTMFSender&&"function"==typeof t.getLocalStreams){var a=t.getLocalStreams().map(function(t){var n=e._getAudioTracks(t);return n&&n[0]})[0];return a?(this.log("Creating RTCDTMFSender"),this._dtmfSender=t.createDTMFSender(a),this._dtmfSender):(this.log("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this.log("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null},n.prototype.getRTCDtlsTransport=function(){var e="function"==typeof this.version.pc.getSenders&&this.version.pc.getSenders()[0];return e&&e.transport||null},n.prototype._canStopMediaStreamTrack=function(){return"function"==typeof MediaStreamTrack.prototype.stop},n.prototype._getAudioTracks=function(e){return"function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks},n.protocol=b.test()?new b:null,n.enabled=b.test(),t.exports=n},{"../errors":10,"../log":12,"../util":32,"./rtcpc":23,"./sdp":24}],"23":[function(e,t){(function(n){"use strict";function a(){"undefined"!=typeof window?p.isEdge()?this.RTCPeerConnection=new l("undefined"!=typeof window?window:n):"function"==typeof window.RTCPeerConnection?this.RTCPeerConnection=window.RTCPeerConnection:"function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log("No RTCPeerConnection implementation available"):this.log("No RTCPeerConnection implementation available. The window object was not found.")}function i(e,t,n){return function(){var a=Array.prototype.slice.call(arguments);return new Promise(function(n){n(e.apply(t,a))})["catch"](function(){return new Promise(function(i,r){e.apply(t,n?[i,r].concat(a):a.concat([i,r]))})})}}function r(e,t){return i(e,t,!0)}function s(e,t){return i(e,t,!1)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=e("rtcpeerconnection-shim"),c=e("./sdp"),d=c.setCodecPreferences,u=c.setMaxAverageBitrate,p=e("../util");a.prototype.create=function(e,t,n){this.log=e,this.pc=new this.RTCPeerConnection(n,t)},a.prototype.createModernConstraints=function(e){if(void 0===e)return null;var t=Object.assign({},e);return"undefined"==typeof webkitRTCPeerConnection||p.isEdge()?("undefined"!=typeof e.audio&&(t.offerToReceiveAudio=e.audio),"undefined"!=typeof e.video&&(t.offerToReceiveVideo=e.video)):(t.mandatory={},"undefined"!=typeof e.audio&&(t.mandatory.OfferToReceiveAudio=e.audio),"undefined"!=typeof e.video&&(t.mandatory.OfferToReceiveVideo=e.video)),delete t.audio,delete t.video,t},a.prototype.createOffer=function(e,t,n,a,i){var o=this;return n=this.createModernConstraints(n),r(this.pc.createOffer,this.pc)(n).then(function(n){if(!o.pc)return Promise.resolve();var a=u(n.sdp,e);return s(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({"type":"offer","sdp":d(a,t)}))}).then(a,i)},a.prototype.createAnswer=function(e,t,n,a,i){var o=this;return n=this.createModernConstraints(n),r(this.pc.createAnswer,this.pc)(n).then(function(n){if(!o.pc)return Promise.resolve();var a=u(n.sdp,e);return s(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({"type":"answer","sdp":d(a,t)}))}).then(a,i)},a.prototype.processSDP=function(e,t,n,a,i,r){var o=this;n=d(n,t);var l=new RTCSessionDescription({"sdp":n,"type":"offer"});return s(this.pc.setRemoteDescription,this.pc)(l).then(function(){o.createAnswer(e,t,a,i,r)})},a.prototype.getSDP=function(){return this.pc.localDescription.sdp},a.prototype.processAnswer=function(e,t,n,a){return this.pc?(t=d(t,e),s(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({"sdp":t,"type":"answer"})).then(n,a)):Promise.resolve()},a.test=function(){if("object"===("undefined"==typeof navigator?"undefined":o(navigator))){var e=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(e&&"function"==typeof window.RTCPeerConnection)return!0;if(e&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(e&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!=typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(t){return!1}return!0}if("undefined"!=typeof RTCIceGatherer)return!0}return!1},t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":32,"./sdp":24,"rtcpeerconnection-shim":52}],"24":[function(e,t){"use strict";function n(e){var t=/a=rtpmap:(\d+) (\S+)/m.exec(e)||[null,"",""],n=p(t,3),a=n[1],i=n[2],r=new RegExp("a=fmtp:"+a+" (\\S+)","m").exec(e)||[null,""];return{"codecName":i,"codecParams":p(r,2)[1]}}function a(e){return f.isChrome(window,window.navigator)?e.split("\n").filter(function(e){return-1===e.indexOf("a=ice-lite")}).join("\n"):e}function i(e,t){if("number"!=typeof t||t<v||t>m)return e;var n=/a=rtpmap:(\d+) opus/m.exec(e),a=n&&n.length?n[1]:h,i=new RegExp("a=fmtp:"+a);return e.split("\n").map(function(e){return i.test(e)?e+";maxaveragebitrate="+t:e}).join("\n")}function r(e,t){var n=s(e);return[e.split("\r\nm=")[0]].concat(n.map(function(e){if(!/^m=(audio|video)/.test(e))return e;var n=e.match(/^m=(audio|video)/)[1],a=o(e),i=l(a,t),r=c(i,e),s=a.get("pcma")||[],d=a.get("pcmu")||[];return("audio"===n?new Set(s.concat(d)):new Set).has(i[0])?r.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):r})).join("\r\n")}function s(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var a=new RegExp("m="+(t||".*"),"gm"),i=new RegExp("a="+(n||".*"),"gm");return a.test(e)&&i.test(e)})}function o(e){return Array.from(d(e)).reduce(function(e,t){var n=t[0],a=t[1],i=e.get(a)||[];return e.set(a,i.concat(n))},new Map)}function l(e,t){t=t.map(function(e){return e.toLowerCase()});var n=f.flatMap(t,function(t){return e.get(t)||[]}),a=f.difference(Array.from(e.keys()),t),i=f.flatMap(a,function(t){return e.get(t)});return n.concat(i)}function c(e,t){var n=t.split("\r\n"),a=n[0],i=n.slice(1);return[a=a.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(i).join("\r\n")}function d(e){return u(e).reduce(function(t,n){var a=new RegExp("a=rtpmap:"+n+" ([^/]+)"),i=e.match(a),r=i?i[1].toLowerCase():b[n]?b[n].toLowerCase():"";return t.set(n,r)},new Map)}function u(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map(function(e){return parseInt(e,10)}):[]}var p=function(){function e(e,t){var n=[],a=!0,i=!1,r=undefined;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(l){i=!0,r=l}finally{try{!a&&o["return"]&&o["return"]()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=e("../util"),b={"0":"PCMU","8":"PCMA"},h=111,m=51e4,v=6e3;t.exports={"getPreferredCodecInfo":n,"setCodecPreferences":r,"setIceAggressiveNomination":a,"setMaxAverageBitrate":i}},{"../util":32}],"25":[function(e,t){"use strict";function n(e,t){if(t=Object.assign({"createRTCSample":i},t),!e)return Promise.reject(new o(c));if("function"!=typeof e.getStats)return Promise.reject(new s(d));var n=void 0;try{n=e.getStats()}catch(a){n=new Promise(function(t){return e.getStats(t)}).then(l.fromRTCStatsResponse)}return n.then(t.createRTCSample)}function a(){}function i(e){var t=null,n=new a,i=void 0;Array.from(e.values()).forEach(function(a){if(!a.isRemote){var r=a.type.replace("-","");if(i=i||a.timestamp,a.remoteId){var s=e.get(a.remoteId);s&&s.roundTripTime&&(n.rtt=s.roundTripTime)}switch(r){case"inboundrtp":n.timestamp=n.timestamp||a.timestamp,n.jitter=1e3*a.jitter,n.packetsLost=a.packetsLost,n.packetsReceived=a.packetsReceived,n.bytesReceived=a.bytesReceived;break;case"outboundrtp":if(n.timestamp=a.timestamp,n.packetsSent=a.packetsSent,n.bytesSent=a.bytesSent,a.codecId){var o=e.get(a.codecId);n.codecName=o?o.mimeType&&o.mimeType.match(/(.*\/)?(.*)/)[2]:a.codecId}break;case"transport":t=a.id}}}),n.timestamp||(n.timestamp=i);var r=e.get(t);if(!r)return n;var s=e.get(r.selectedCandidatePairId);if(!s)return n;var o=e.get(s.localCandidateId),l=e.get(s.remoteCandidateId);return n.rtt||(n.rtt=s&&1e3*s.currentRoundTripTime),Object.assign(n,{"localAddress":o&&o.ip,"remoteAddress":l&&l.ip}),n}var r=e("../errors"),s=r.NotSupportedError,o=r.InvalidArgumentError,l=e("./mockrtcstatsreport"),c="PeerConnection is null",d="WebRTC statistics are unsupported";t.exports=n},{"../errors":10,"./mockrtcstatsreport":20}],"26":[function(e,t){function n(){Object.defineProperties(this,{"_eventEmitter":{"value":new a},"_handlers":{"value":{}}})}var a=e("events").EventEmitter;n.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},n.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,arguments)},n.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,arguments)},n.prototype._defineEventHandler=function(e){var t=this;Object.defineProperty(this,"on"+e,{"get":function(){return t._handlers[e]},"set":function(n){var a=t._handlers[e];!a||"function"!=typeof n&&null!=n||(t._handlers[e]=null,t.removeEventListener(e,a)),"function"==typeof n&&(t._handlers[e]=n,t.addEventListener(e,n))}})},t.exports=n},{"events":45}],"27":[function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function i(e){n(this,i),Object.defineProperties(this,{"deviceId":{"get":function(){return e.deviceId}},"groupId":{"get":function(){return e.groupId}},"kind":{"get":function(){return e.kind}},"label":{"get":function(){return e.label}}})};t.exports=a},{}],"28":[function(e,t){function n(){d.call(this),this._defineEventHandler("devicechange"),this._defineEventHandler("deviceinfochange");var e=[];Object.defineProperties(this,{"_deviceChangeIsNative":{"value":l(this,"devicechange")},"_deviceInfoChangeIsNative":{"value":l(this,"deviceinfochange")},"_knownDevices":{"value":e},"_pollInterval":{"value":null,"writable":!0}}),"function"==typeof f.enumerateDevices&&f.enumerateDevices().then(function(t){t.sort(c).forEach([].push,e)}),this._eventEmitter.on("newListener",function(e){"devicechange"!==e&&"deviceinfochange"!==e||(this._pollInterval=this._pollInterval||setInterval(s.bind(null,this),p))}.bind(this)),this._eventEmitter.on("removeListener",function(){this._pollInterval&&!r(this)&&(clearInterval(this._pollInterval),this._pollInterval=null)}.bind(this))}function a(e,t){var n=t.reduce(function(e,t){return e.set(t.deviceId,t.label||null)},new Map);return e.some(function(e){var t=n.get(e.deviceId);return void 0!==t&&t!==e.label})}function i(e,t){return e.length!==t.length||o("deviceId",e,t)}function r(e){return["devicechange","deviceinfochange"].reduce(function(t,n){return t+e._eventEmitter.listenerCount(n)},0)>0}function s(e){f.enumerateDevices().then(function(t){var n=e._knownDevices,r=n.slice();[].splice.apply(n,[0,n.length].concat(t.sort(c))),!e._deviceChangeIsNative&&i(n,r)&&e.dispatchEvent(new Event("devicechange")),!e._deviceInfoChangeIsNative&&a(n,r)&&e.dispatchEvent(new Event("deviceinfochange"))})}function o(e,t,n){return t.some(function(t,a){return t[e]!==n[a][e]})}function l(e,t){function n(t){e.dispatchEvent(t)}var a="on"+t;return a in f&&("addEventListener"in f?f.addEventListener(t,n):f[a]=n,!0)}function c(e,t){return e.deviceId<t.deviceId}var d=e("./eventtarget"),u=e("util").inherits,p=500,f="undefined"!=typeof navigator&&navigator.mediaDevices;u(n,d),f&&"function"==typeof f.enumerateDevices&&(n.prototype.enumerateDevices=function(){return f.enumerateDevices.apply(f,arguments)}),n.prototype.getUserMedia=function(){return f.getUserMedia.apply(f,arguments)},t.exports=f?new n:null},{"./eventtarget":26,"util":56}],"29":[function(e,t){"use strict";function n(e,t,a){if(!(this instanceof n))return new n(e,t,a);if(!e||!t)throw new r("name and url are required arguments");(a=Object.assign({"AudioFactory":"undefined"!=typeof Audio?Audio:null,"maxDuration":0,"shouldLoop":!1},a)).AudioPlayer=a.audioContext?i.bind(i,a.audioContext):a.AudioFactory,Object.defineProperties(this,{"_activeEls":{"value":new Map},"_Audio":{"value":a.AudioPlayer},"_isSinkSupported":{"value":null!==a.AudioFactory&&"function"==typeof a.AudioFactory.prototype.setSinkId},"_maxDuration":{"value":a.maxDuration},"_maxDurationTimeout":{"value":null,"writable":!0},"_playPromise":{"value":null,"writable":!0},"_shouldLoop":{"value":a.shouldLoop},"_sinkIds":{"value":["default"]},"isPlaying":{"enumerable":!0,"get":function(){return!!this._playPromise}},"name":{"enumerable":!0,"value":e},"url":{"enumerable":!0,"value":t}}),this._Audio&&this._play(!0,!1)}function a(e){e&&(e.pause(),e.src="",e.srcObject=null,e.load())}var i=e("@twilio/audioplayer"),r=e("./errors").InvalidArgumentError;n.prototype._playAudioElement=function(e,t,n){var i=this,s=this._activeEls.get(e);if(!s)throw new r('sinkId: "'+e+"\" doesn't have an audio element");return s.muted=t,s.loop=n,s.play().then(function(){return s})["catch"](function(t){throw a(s),i._activeEls["delete"](e),t})},n.prototype._play=function(e,t){this.isPlaying&&this.stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this.stop.bind(this),this._maxDuration)),t="boolean"==typeof t?t:this._shouldLoop;var n=this;return this._playPromise=Promise.all(this._sinkIds.map(function(a){if(!n._Audio)return Promise.resolve();var i=n._activeEls.get(a);return i?n._playAudioElement(a,e,t):("function"==typeof(i=new n._Audio(n.url)).setAttribute&&i.setAttribute("crossorigin","anonymous"),new Promise(function(e){i.addEventListener("canplaythrough",e)}).then(function(){return(n._isSinkSupported?i.setSinkId(a):Promise.resolve()).then(function(){return n._activeEls.set(a,i),n._playPromise?n._playAudioElement(a,e,t):Promise.resolve()})}))}))},n.prototype.setSinkIds=function(e){this._isSinkSupported&&(e=e.forEach?e:[e],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(e)))},n.prototype.stop=function(){var e=this;this._activeEls.forEach(function(t,n){e._sinkIds.includes(n)?(t.pause(),t.currentTime=0):(a(t),e._activeEls["delete"](n))}),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null},n.prototype.play=function(){this._play(!1)},t.exports=n},{"./errors":10,"@twilio/audioplayer":37}],"30":[function(e,t,n){"use strict";function a(e,t){return t.reduce(function(t,n){return t+(n>e?1:0)},0)}function i(e,t){return t.reduce(function(t,n){return t+(n<e?1:0)},0)}var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{"value":!0});var l=e("events"),c=e("./errors"),d=e("./util"),u=e("./rtc/stats"),p=e("./rtc/mos"),f=5,b=0,h=3,m=1e3,v=5e3,g={"audioInputLevel":{"maxDuration":10},"audioOutputLevel":{"maxDuration":10},"bytesReceived":{"clearCount":2,"min":1,"raiseCount":3,"sampleCount":3},"bytesSent":{"clearCount":2,"min":1,"raiseCount":3,"sampleCount":3},"jitter":{"max":30},"mos":{"min":3},"packetsLostFraction":{"max":1},"rtt":{"max":400}},_=function(e){function t(t){var n=e.call(this)||this;n._activeWarnings=new Map,n._currentStreaks=new Map,n._inputVolumes=[],n._outputVolumes=[],n._sampleBuffer=[],n._warningsEnabled=!0,t=t||{},n._getRTCStats=t.getRTCStats||u,n._mos=t.Mos||p,n._peerConnection=t.peerConnection,n._thresholds=o({},g,t.thresholds);var a=Object.values(n._thresholds).map(function(e){return e.sampleCount}).filter(function(e){return!!e});return n._maxSampleCount=Math.max.apply(Math,[f].concat(a)),n._peerConnection&&n.enable(n._peerConnection),n}return s(t,e),t.prototype.addVolumes=function(e,t){this._inputVolumes.push(e),this._outputVolumes.push(t)},t.prototype.disable=function(){return clearInterval(this._sampleInterval),delete this._sampleInterval,this},t.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},t.prototype.enable=function(e){if(e){if(this._peerConnection&&e!==this._peerConnection)throw new c.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=e}if(!this._peerConnection)throw new c.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),m),this},t.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},t.prototype.hasActiveWarning=function(e,t){var n=e+":"+t;return!!this._activeWarnings.get(n)},t.prototype._addSample=function(e){var t=this._sampleBuffer;t.push(e),t.length>this._maxSampleCount&&t.splice(0,t.length-this._maxSampleCount)},t.prototype._clearWarning=function(e,t,n){var a=e+":"+t,i=this._activeWarnings.get(a);!i||Date.now()-i.timeRaised<v||(this._activeWarnings["delete"](a),this.emit("warning-cleared",o({},n,{"name":e,"threshold":{"name":t,"value":this._thresholds[e][t]}})))},t.prototype._createSample=function(e,t){var n=t&&t.totals.bytesSent||0,a=t&&t.totals.bytesReceived||0,i=t&&t.totals.packetsSent||0,r=t&&t.totals.packetsReceived||0,s=t&&t.totals.packetsLost||0,o=e.bytesSent-n,l=e.bytesReceived-a,c=e.packetsSent-i,u=e.packetsReceived-r,p=e.packetsLost-s,f=u+p,b=f>0?p/f*100:0,h=e.packetsReceived+e.packetsLost,m=h>0?e.packetsLost/h*100:100,v="number"!=typeof e.rtt&&t?t.rtt:e.rtt;return{"audioInputLevel":Math.round(d.average(this._inputVolumes.splice(0))),"audioOutputLevel":Math.round(d.average(this._outputVolumes.splice(0))),"bytesReceived":l,"bytesSent":o,"codecName":e.codecName,"jitter":e.jitter,"mos":this._mos.calculate(v,e.jitter,t&&b),"packetsLost":p,"packetsLostFraction":b,"packetsReceived":u,"packetsSent":c,"rtt":v,"timestamp":e.timestamp,"totals":{"bytesReceived":e.bytesReceived,"bytesSent":e.bytesSent,"packetsLost":e.packetsLost,"packetsLostFraction":m,"packetsReceived":e.packetsReceived,"packetsSent":e.packetsSent}}},t.prototype._fetchSample=function(){var e=this;this._getSample().then(function(t){e._addSample(t),e._raiseWarnings(),e.emit("sample",t)})["catch"](function(t){e.disable(),e.emit("error",t)})},t.prototype._getSample=function(){var e=this;return this._getRTCStats(this._peerConnection).then(function(t){var n=null;return e._sampleBuffer.length&&(n=e._sampleBuffer[e._sampleBuffer.length-1]),e._createSample(t,n)})},t.prototype._raiseWarning=function(e,t,n){var a=e+":"+t;this._activeWarnings.has(a)||(this._activeWarnings.set(a,{"timeRaised":Date.now()}),this.emit("warning",o({},n,{"name":e,"threshold":{"name":t,"value":this._thresholds[e][t]}})))},t.prototype._raiseWarnings=function(){var e=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach(function(t){return e._raiseWarningsForStat(t)})},t.prototype._raiseWarningsForStat=function(e){var t,n=this._sampleBuffer,r=this._thresholds[e],s=r.clearCount||b,o=r.raiseCount||h,l=r.sampleCount||this._maxSampleCount,c=n.slice(-l),d=c.map(function(t){return t[e]});if(!d.some(function(e){return null==e})&&("number"==typeof r.max&&((t=a(r.max,d))>=o?this._raiseWarning(e,"max",{"values":d,"samples":c}):t<=s&&this._clearWarning(e,"max",{"values":d,"samples":c})),"number"==typeof r.min&&((t=i(r.min,d))>=o?this._raiseWarning(e,"min",{"values":d,"samples":c}):t<=s&&this._clearWarning(e,"min",{"values":d,"samples":c})),"number"==typeof r.maxDuration&&n.length>1)){var u=(c=n.slice(-2))[0][e],p=c[1][e],f=this._currentStreaks.get(e)||0,m=u===p?f+1:0;this._currentStreaks.set(e,m),m>=r.maxDuration?this._raiseWarning(e,"maxDuration",{"value":m}):0===m&&this._clearWarning(e,"maxDuration",{"value":f})}},t}(l.EventEmitter);n["default"]=_},{"./errors":10,"./rtc/mos":21,"./rtc/stats":25,"./util":32,"events":45}],"31":[function(e,t,n){"use strict";var a,i,r;Object.defineProperty(n,"__esModule",{"value":!0}),function(e){e.Off="off",e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(r=n.LogLevel||(n.LogLevel={}));var s=((a={})[r.Debug]="info",a[r.Info]="info",a[r.Warn]="warn",a[r.Error]="error",a),o=((i={})[r.Debug]=0,i[r.Info]=1,i[r.Warn]=2,i[r.Error]=3,i[r.Off]=4,i),l=function(){function e(e,t){this._logLevel=e,this._console=console,t&&t.console&&(this._console=t.console)}return Object.defineProperty(e.prototype,"logLevel",{"get":function(){return this._logLevel},"enumerable":!0,"configurable":!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[r.Debug].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[r.Error].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[r.Info].concat(e))},e.prototype.log=function(e){for(var t,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];var i=s[e];i&&o[this.logLevel]<=o[e]&&(t=this._console)[i].apply(t,n)},e.prototype.setLogLevel=function(e){this._logLevel=e},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,[r.Warn].concat(e))},e}();n["default"]=l},{}],"32":[function(e,t,n){(function(e){function t(e){if(!(this instanceof t))return new t(e);this.message=e}function a(e){return e&&e.length?e.reduce(function(e,t){return e+t})/e.length:0}function i(e,t,n){n=n||function(e){return e};var a=new Set(t.map(n));return e.filter(function(e){return!a.has(n(e))})}function r(e){return!!e.userAgent.match("Electron")}function s(e,t){var n=!!t.userAgent.match("CriOS"),a=!!t.userAgent.match("HeadlessChrome"),i="undefined"!=typeof e.chrome&&"Google Inc."===t.vendor&&-1===t.userAgent.indexOf("OPR")&&-1===t.userAgent.indexOf("Edge");return n||r(t)||i||a}function o(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/firefox|fxios/i.test(t.userAgent)}function l(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/edge\/\d+/i.test(t.userAgent)}function c(e){return!!e.vendor&&-1!==e.vendor.indexOf("Apple")&&e.userAgent&&-1===e.userAgent.indexOf("CriOS")&&-1===e.userAgent.indexOf("FxiOS")}function d(e,t,n,a){if(void 0===e||void 0===t||void 0===n||void 0===a||"undefined"==typeof n.prototype||"undefined"==typeof a.prototype)return!1;if(s(e,t)&&n.prototype.addTransceiver){var i=new n,r=!0;try{i.addTransceiver("audio")}catch(l){r=!1}return i.close(),r}return!!o(t)||!!c(t)&&"currentDirection"in a.prototype}function u(e){return e?e.split("&").reduce(function(e,t){var n=t.split("="),a=n[0],i=decodeURIComponent((n[1]||"").replace(/\+/g,"%20"));return a&&(e[a]=i),e},{}):""}function p(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;return t=t||function(e){return e},n.reduce(function(e,n){var a=t(n);return e.concat(a)},[])}t.prototype.toString=function(){return"Twilio.Exception: "+this.message},n.Exception=t,n.average=a,n.difference=i,n.isElectron=r,n.isChrome=s,n.isFirefox=o,n.isEdge=l,n.isSafari=c,n.isUnifiedPlanDefault=d,n.queryToJson=u,n.flatMap=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"33":[function(e,t,n){"use strict";var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{"value":!0});var r,s=e("events"),o=e("ws"),l=e("./errors"),c=e("./tslog"),d=e("backoff"),u=1e4,p=5e3,f=15e3;!function(e){e.Connecting="connecting",e.Closed="closed",e.Open="open"}(r=n.WSTransportState||(n.WSTransportState={}));var b=function(e){function t(t,n){void 0===n&&(n={});var a=e.call(this)||this;return a.state=r.Closed,a._onSocketClose=function(e){a._log.info("Received websocket close event code: "+e.code),1006===e.code&&a.emit("error",{"code":31005,"message":e.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region is being specified in Device setup, ensure it's a valid region.","twilioError":new l.SignalingErrors.ConnectionError}),a._closeSocket()},a._onSocketError=function(e){a._log.info("WebSocket received error: "+e.message),a.emit("error",{"code":31e3,"message":e.message||"WSTransport socket error","twilioError":new l.SignalingErrors.ConnectionDisconnected})},a._onSocketMessage=function(e){a._setHeartbeatTimeout(),a._socket&&"\n"===e.data?a._socket.send("\n"):a.emit("message",e)},a._onSocketOpen=function(){a._log.info("WebSocket opened successfully."),a._timeOpened=Date.now(),a.state=r.Open,clearTimeout(a._connectTimeout),a._setHeartbeatTimeout(),a.emit("open")},a._backoff=d.exponential({"factor":2,"initialDelay":100,"maxDelay":"number"==typeof n.backoffMaxMs?Math.max(n.backoffMaxMs,3e3):2e4,"randomisationFactor":.4}),a._log=new c["default"](n.logLevel||c.LogLevel.Off),a._uri=t,a._WebSocket=n.WebSocket||o,a._backoff.on("backoff",function(e,t){a.state!==r.Closed&&a._log.info("Will attempt to reconnect WebSocket in "+t+"ms")}),a._backoff.on("ready",function(e){a.state!==r.Closed&&a._connect(e+1)}),a}return i(t,e),t.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},t.prototype.open=function(){this._log.info("WSTransport.open() called..."),!this._socket||this._socket.readyState!==o.CONNECTING&&this._socket.readyState!==o.OPEN?this._connect():this._log.info("WebSocket already open.")},t.prototype.send=function(e){if(!this._socket||this._socket.readyState!==o.OPEN)return!1;try{this._socket.send(e)}catch(t){return this._log.info("Error while sending message:",t.message),this._closeSocket(),!1}return!0},t.prototype._close=function(){this.state=r.Closed,this._closeSocket()},t.prototype._closeSocket=function(){clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),this._socket?(this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),this._socket.readyState!==o.CONNECTING&&this._socket.readyState!==o.OPEN||this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>u&&this._backoff.reset(),this._backoff.backoff(),delete this._socket,this.emit("close")):this._log.info("No WebSocket to clean up.")},t.prototype._connect=function(e){var t=this;e?this._log.info("Attempting to reconnect (retry #"+e+")..."):this._log.info("Attempting to connect..."),this._closeSocket(),this.state=r.Connecting;var n=null;try{n=new this._WebSocket(this._uri)}catch(a){return this._log.info("Could not connect to endpoint:",a.message),this._close(),void this.emit("error",{"code":31e3,"message":a.message||"Could not connect to "+this._uri,"twilioError":new l.SignalingErrors.ConnectionDisconnected})}delete this._timeOpened,this._connectTimeout=setTimeout(function(){t._log.info("WebSocket connection attempt timed out."),t._closeSocket()},p),n.addEventListener("close",this._onSocketClose),n.addEventListener("error",this._onSocketError),n.addEventListener("message",this._onSocketMessage),n.addEventListener("open",this._onSocketOpen),this._socket=n},t.prototype._setHeartbeatTimeout=function(){var e=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout(function(){e._log.info("No messages received in "+f/1e3+" seconds. Reconnecting..."),e._closeSocket()},f)},t}(s.EventEmitter);n["default"]=b},{"./errors":10,"./tslog":31,"backoff":39,"events":45,"ws":1}],"34":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t,n){return d(this,void 0,void 0,l["default"].mark(function a(){var i,r;return l["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(i=new t).open("GET",n,!0),i.responseType="arraybuffer",a.next=5,new Promise(function(e){i.addEventListener("load",e),i.send()});case 5:return r=a.sent,a.prev=6,a.abrupt("return",e.decodeAudioData(r.target.response));case 10:return a.prev=10,a.t0=a["catch"](6),a.abrupt("return",new Promise(function(t){e.decodeAudioData(r.target.response,t)}));case 13:case"end":return a.stop()}},a,this,[[6,10]])}))}var l=a(e("babel-runtime/regenerator")),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),d=undefined&&undefined.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function s(e){try{l(a.next(e))}catch(t){r(t)}}function o(e){try{l(a["throw"](e))}catch(t){r(t)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,o)}l((a=a.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{"value":!0});var u=e("./Deferred"),p=e("./EventTarget"),f=function(){function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s._audioNode=null,s._pendingPlayDeferreds=[],s._loop=!1,s._src="",s._sinkId="default","string"!=typeof n&&(a=n),s._audioContext=t,s._audioElement=new(a.AudioFactory||Audio),s._bufferPromise=s._createPlayDeferred().promise,s._destination=s._audioContext.destination,s._gainNode=s._audioContext.createGain(),
s._gainNode.connect(s._destination),s._XMLHttpRequest=a.XMLHttpRequestFactory||XMLHttpRequest,s.addEventListener("canplaythrough",function(){s._resolvePlayDeferreds()}),"string"==typeof n&&(s.src=n),s}return s(e,p["default"]),c(e,[{"key":"load","value":function(){this._load(this._src)}},{"key":"pause","value":function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))}},{"key":"play","value":function(){return d(this,void 0,void 0,l["default"].mark(function e(){var t,n=this;return l["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.paused){e.next=6;break}return e.next=3,this._bufferPromise;case 3:if(this.paused){e.next=5;break}return e.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",function(){n._audioNode&&n._audioNode.loop||n.dispatchEvent("ended")}),e.next=11,this._bufferPromise;case 11:if(t=e.sent,!this.paused){e.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:if(this._audioNode.buffer=t,this._audioNode.connect(this._gainNode),this._audioNode.start(),!this._audioElement.srcObject){e.next=19;break}return e.abrupt("return",this._audioElement.play());case 19:case"end":return e.stop()}},e,this)}))}},{"key":"setSinkId","value":function(e){return d(this,void 0,void 0,l["default"].mark(function t(){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this._audioElement.setSinkId){t.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(e!==this.sinkId){t.next=4;break}return t.abrupt("return");case 4:if("default"!==e){t.next=11;break}return this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=e,t.abrupt("return");case 11:return t.next=13,this._audioElement.setSinkId(e);case 13:if(!this._audioElement.srcObject){t.next=15;break}return t.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=e,this._gainNode.connect(this._destination);case 20:case"end":return t.stop()}},t,this)}))}},{"key":"_createPlayDeferred","value":function(){var e=new u["default"];return this._pendingPlayDeferreds.push(e),e}},{"key":"_load","value":function(e){var t=this;this._src&&this._src!==e&&this.pause(),this._src=e,this._bufferPromise=new Promise(function(n){return d(t,void 0,void 0,l["default"].mark(function a(){var t;return l["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return",this._createPlayDeferred().promise);case 2:return a.next=4,o(this._audioContext,this._XMLHttpRequest,e);case 4:t=a.sent,this.dispatchEvent("canplaythrough"),n(t);case 7:case"end":return a.stop()}},a,this)}))})}},{"key":"_rejectPlayDeferreds","value":function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.reject)(e)})}},{"key":"_resolvePlayDeferreds","value":function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.resolve)(e)})}},{"key":"destination","get":function(){return this._destination}},{"key":"loop","get":function(){return this._loop},"set":function(e){if(!e&&this.loop&&!this.paused){var t=function e(){n._audioNode.removeEventListener("ended",e),n.pause()},n=this;this._audioNode.addEventListener("ended",t)}this._loop=e}},{"key":"muted","get":function(){return 0===this._gainNode.gain.value},"set":function(e){this._gainNode.gain.value=e?0:1}},{"key":"paused","get":function(){return null===this._audioNode}},{"key":"src","get":function(){return this._src},"set":function(e){this._load(e)}},{"key":"srcObject","get":function(){return this._audioElement.srcObject},"set":function(e){this._audioElement.srcObject=e}},{"key":"sinkId","get":function(){return this._sinkId}}]),e}();n["default"]=f},{"./Deferred":35,"./EventTarget":36,"babel-runtime/regenerator":38}],"35":[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();Object.defineProperty(n,"__esModule",{"value":!0});var r=function(){function e(){var t=this;a(this,e),this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return i(e,[{"key":"reject","get":function(){return this._reject}},{"key":"resolve","get":function(){return this._resolve}}]),e}();n["default"]=r},{}],"36":[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();Object.defineProperty(n,"__esModule",{"value":!0});var r=e("events"),s=function(){function e(){a(this,e),this._eventEmitter=new r.EventEmitter}return i(e,[{"key":"addEventListener","value":function(e,t){return this._eventEmitter.addListener(e,t)}},{"key":"dispatchEvent","value":function(e){for(var t,n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return(t=this._eventEmitter).emit.apply(t,[e].concat(a))}},{"key":"removeEventListener","value":function(e,t){return this._eventEmitter.removeListener(e,t)}}]),e}();n["default"]=s},{"events":45}],"37":[function(e,t){"use strict";var n=e("./AudioPlayer");t.exports=n["default"]},{"./AudioPlayer":34}],"38":[function(e,t){t.exports=e("regenerator-runtime")},{"regenerator-runtime":50}],"39":[function(e,t){
//      Copyright (c) 2012 Mathieu Turcotte
var n=e("./lib/backoff"),a=e("./lib/strategy/exponential"),i=e("./lib/strategy/fibonacci"),r=e("./lib/function_call.js");t.exports.Backoff=n,t.exports.FunctionCall=r,t.exports.FibonacciStrategy=i,t.exports.ExponentialStrategy=a,t.exports.fibonacci=function(e){return new n(new i(e))},t.exports.exponential=function(e){return new n(new a(e))},t.exports.call=function(e,t,n){var a=Array.prototype.slice.call(arguments);return e=a[0],t=a.slice(1,a.length-1),n=a[a.length-1],new r(e,t,n)}},{"./lib/backoff":40,"./lib/function_call.js":41,"./lib/strategy/exponential":42,"./lib/strategy/fibonacci":43}],"40":[function(e,t){function n(e){a.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={"backoff":this.onBackoff_.bind(this)}}
//      Copyright (c) 2012 Mathieu Turcotte
var a=e("events"),i=e("precond");e("util").inherits(n,a.EventEmitter),n.prototype.failAfter=function(e){i.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},n.prototype.backoff=function(e){i.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},n.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},n.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=n},{"events":45,"precond":46,"util":56}],"41":[function(e,t){function n(e,t,r){a.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(r,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=r,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=n.DEFAULT_RETRY_PREDICATE_,this.state_=n.State_.PENDING}
//      Copyright (c) 2012 Mathieu Turcotte
var a=e("events"),i=e("precond"),r=e("util"),s=e("./backoff"),o=e("./strategy/fibonacci");r.inherits(n,a.EventEmitter),n.State_={"PENDING":0,"RUNNING":1,"COMPLETED":2,"ABORTED":3},n.DEFAULT_RETRY_PREDICATE_=function(){return!0},n.prototype.isPending=function(){return this.state_==n.State_.PENDING},n.prototype.isRunning=function(){return this.state_==n.State_.RUNNING},n.prototype.isCompleted=function(){return this.state_==n.State_.COMPLETED},n.prototype.isAborted=function(){return this.state_==n.State_.ABORTED},n.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},n.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},n.prototype.getLastResult=function(){return this.lastResult_.concat()},n.prototype.getNumRetries=function(){return this.numRetries_},n.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},n.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=n.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},n.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new o;this.backoff_=e?e(t):new s(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=n.State_.RUNNING,this.doCall_(!1)},n.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);a.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},n.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},n.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,a.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=n.State_.COMPLETED,this.doCallback_())}},n.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},t.exports=n},{"./backoff":40,"./strategy/fibonacci":43,"events":45,"precond":46,"util":56}],"42":[function(e,t){function n(e){r.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=n.DEFAULT_FACTOR,e&&e.factor!==undefined&&(i.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}
//      Copyright (c) 2012 Mathieu Turcotte
var a=e("util"),i=e("precond"),r=e("./strategy");a.inherits(n,r),n.DEFAULT_FACTOR=2,n.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},n.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=n},{"./strategy":44,"precond":46,"util":56}],"43":[function(e,t){function n(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}
//      Copyright (c) 2012 Mathieu Turcotte
var a=e("util"),i=e("./strategy");a.inherits(n,i),n.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},n.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=n},{"./strategy":44,"util":56}],"44":[function(e,t){function n(e){return e!==undefined&&null!==e}function a(e){if(n((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(n(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(n(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}
//      Copyright (c) 2012 Mathieu Turcotte
e("events"),e("util");a.prototype.getMaxDelay=function(){return this.maxDelay_},a.prototype.getInitialDelay=function(){return this.initialDelay_},a.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},a.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},a.prototype.reset=function(){this.reset_()},a.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=a},{"events":45,"util":56}],"45":[function(e,t){function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=y(null),this._eventsCount=0),this._maxListeners=this._maxListeners||undefined}function a(e){return e._maxListeners===undefined?n.defaultMaxListeners:e._maxListeners}function i(e,t,n){if(t)e.call(n);else for(var a=e.length,i=h(e,a),r=0;r<a;++r)i[r].call(n)}function r(e,t,n,a){if(t)e.call(n,a);else for(var i=e.length,r=h(e,i),s=0;s<i;++s)r[s].call(n,a)}function s(e,t,n,a,i){if(t)e.call(n,a,i);else for(var r=e.length,s=h(e,r),o=0;o<r;++o)s[o].call(n,a,i)}function o(e,t,n,a,i,r){if(t)e.call(n,a,i,r);else for(var s=e.length,o=h(e,s),l=0;l<s;++l)o[l].call(n,a,i,r)}function l(e,t,n,a){if(t)e.apply(n,a);else for(var i=e.length,r=h(e,i),s=0;s<i;++s)r[s].apply(n,a)}function c(e,t,n,i){var r,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]):(s=e._events=y(null),e._eventsCount=0),o){if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),!o.warned&&(r=a(e))&&r>0&&o.length>r){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else o=s[t]=n,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function u(e,t,n){var a={"fired":!1,"wrapFn":undefined,"target":e,"type":t,"listener":n},i=k.call(d,a);return i.listener=n,a.wrapFn=i,i}function p(e,t,n){var a=e._events;if(!a)return[];var i=a[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?m(i):h(i,i.length):[]}function f(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function b(e,t){for(var n=t,a=n+1,i=e.length;a<i;n+=1,a+=1)e[n]=e[a];e.pop()}function h(e,t){for(var n=new Array(t),a=0;a<t;++a)n[a]=e[a];return n}function m(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function v(e){var t=function(){};return t.prototype=e,new t}function g(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function _(e){var t=this;return function(){return t.apply(e,arguments)}}
// Copyright Joyent, Inc. and other Node contributors.
// The above copyright notice and this permission notice shall be included
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
var y=Object.create||v,w=Object.keys||g,k=Function.prototype.bind||_;t.exports=n,n.EventEmitter=n,n.prototype._events=undefined,n.prototype._maxListeners=undefined;var C,x=10;try{var T={};Object.defineProperty&&Object.defineProperty(T,"x",{"value":0}),C=0===T.x}catch(S){C=!1}C?Object.defineProperty(n,"defaultMaxListeners",{"enumerable":!0,"get":function(){return x},"set":function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');x=e}}):n.defaultMaxListeners=x,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return a(this)},n.prototype.emit=function(e){var t,n,a,c,d,u,p="error"===e;if(u=this._events)p=p&&null==u.error;else if(!p)return!1;if(p){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var f=new Error('Unhandled "error" event. ('+t+")");throw f.context=t,f}if(!(n=u[e]))return!1;var b="function"==typeof n;switch(a=arguments.length){case 1:i(n,b,this);break;case 2:r(n,b,this,arguments[1]);break;case 3:s(n,b,this,arguments[1],arguments[2]);break;case 4:o(n,b,this,arguments[1],arguments[2],arguments[3]);break;default:for(c=new Array(a-1),d=1;d<a;d++)c[d-1]=arguments[d];l(n,b,this,c)}return!0},n.prototype.addListener=function(e,t){return c(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return c(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,u(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,u(this,e,t)),this},n.prototype.removeListener=function(e,t){var n,a,i,r,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(a=this._events))return this;if(!(n=a[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=y(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():b(n,i),1===n.length&&(a[e]=n[0]),a.removeListener&&this.emit("removeListener",e,s||t)}return this},n.prototype.removeAllListeners=function(e){var t,n,a;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=y(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=y(null):delete n[e]),this;if(0===arguments.length){var i,r=w(n);for(a=0;a<r.length;++a)"removeListener"!==(i=r[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=y(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},n.prototype.listeners=function(e){return p(this,e,!0)},n.prototype.rawListeners=function(e){return p(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},n.prototype.listenerCount=f,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],"46":[function(e,t){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
t.exports=e("./lib/checks")},{"./lib/checks":47}],"47":[function(e,t){function n(e,t,n,a){n=n||"";var i=new e(o.format.apply(this,[n].concat(a)));throw Error.captureStackTrace(i,t),i}function a(e,t,a){n(l.IllegalArgumentError,e,t,a)}function i(e,t,a){n(l.IllegalStateError,e,t,a)}function r(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function s(e){return function(t,n){var i=r(t);if(i==e)return t;a(arguments.callee,n||'Expected "'+e+'" but got "'+i+'".',Array.prototype.slice.call(arguments,2))}}
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var o=e("util"),l=t.exports=e("./errors");t.exports.checkArgument=function(e,t){e||a(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(e!==undefined)return e;a(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;a(arguments.callee,t||'Expected value to be defined and not null but got "'+r(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=s("string"),t.exports.checkIsArray=s("array"),t.exports.checkIsNumber=s("number"),t.exports.checkIsBoolean=s("boolean"),t.exports.checkIsFunction=s("function"),t.exports.checkIsObject=s("object")},{"./errors":48,"util":56}],"48":[function(e,t){function n(e){Error.call(this,e),this.message=e}function a(e){Error.call(this,e),this.message=e}
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var i=e("util");i.inherits(n,Error),n.prototype.name="IllegalArgumentError",i.inherits(a,Error),a.prototype.name="IllegalStateError",t.exports.IllegalStateError=a,t.exports.IllegalArgumentError=n},{"util":56}],"49":[function(e,t){function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function i(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function r(e){if(u===clearTimeout)return clearTimeout(e);if((u===a||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function s(){h&&f&&(h=!1,f.length?b=f.concat(b):m=-1,b.length&&o())}function o(){if(!h){var e=i(s);h=!0;for(var t=b.length;t;){for(f=b,b=[];++m<t;)f&&f[m].run();m=-1,t=b.length}f=null,h=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var d,u,p=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{u="function"==typeof clearTimeout?clearTimeout:a}catch(e){u=a}}();var f,b=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];b.push(new l(e,t)),1!==b.length||h||i(o)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(){return[]},p.binding=function(){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],"50":[function(e,t){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=undefined,t.exports=e("./runtime"),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(r){n.regeneratorRuntime=undefined}},{"./runtime":51}],"51":[function(e,t){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";function n(e,t,n,a){var r=t&&t.prototype instanceof i?t:i,s=Object.create(r.prototype),o=new f(a||[]);return s._invoke=c(e,n,o),s}function a(e,t,n){try{return{"type":"normal","arg":e.call(t,n)}}catch(a){return{"type":"throw","arg":a}}}function i(){}function r(){}function s(){}function o(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(n,i,r,s){var o=a(e[n],e,i);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&g.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,r,s)},function(e){t("throw",e,r,s)}):Promise.resolve(c).then(function(e){l.value=e,r(l)},s)}s(o.arg)}function n(e,n){function a(){return new Promise(function(a,i){t(e,n,a,i)})}return i=i?i.then(a,a):a()}var i;this._invoke=n}function c(e,t,n){var i=T;return function(r,s){if(i===M)throw new Error("Generator is already running");if(i===$){if("throw"===r)throw s;return h()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var l=d(o,n);if(l){if(l===j)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===T)throw i=$,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=M;var c=a(e,t,n);if("normal"===c.type){if(i=n.done?$:S,c.arg===j)continue;return{"value":c.arg,"done":n.done}}"throw"===c.type&&(i=$,n.method="throw",n.arg=c.arg)}}}function d(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=m,d(e,t),"throw"===t.method))return j;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return j}var i=a(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,j;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,j):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,j)}function u(e){var t={"tryLoc":e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function p(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{"tryLoc":"root"}],e.forEach(u,this),this.reset(!0)}function b(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(g.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t};return a.next=a}}return{"next":h}}function h(){return{"value":m,"done":!0}}var m,v=Object.prototype,g=v.hasOwnProperty,_="function"==typeof Symbol?Symbol:{},y=_.iterator||"@@iterator",w=_.asyncIterator||"@@asyncIterator",k=_.toStringTag||"@@toStringTag",C="object"==typeof t,x=e.regeneratorRuntime;if(x)C&&(t.exports=x);else{(x=e.regeneratorRuntime=C?t.exports:{}).wrap=n;var T="suspendedStart",S="suspendedYield",M="executing",$="completed",j={},E={};E[y]=function(){return this};var A=Object.getPrototypeOf,P=A&&A(A(b([])));P&&P!==v&&g.call(P,y)&&(E=P);var I=s.prototype=i.prototype=Object.create(E);r.prototype=I.constructor=s,s.constructor=r,s[k]=r.displayName="GeneratorFunction",x.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===r||"GeneratorFunction"===(t.displayName||t.name))},x.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,k in e||(e[k]="GeneratorFunction")),e.prototype=Object.create(I),e},x.awrap=function(e){return{"__await":e}},o(l.prototype),l.prototype[w]=function(){return this},x.AsyncIterator=l,x.async=function(e,t,a,i){var r=new l(n(e,t,a,i));return x.isGeneratorFunction(t)?r:r.next().then(function(e){return e.done?e.value:r.next()})},o(I),I[k]="Generator",I[y]=function(){return this},I.toString=function(){return"[object Generator]"},x.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function a(){for(;t.length;){var n=t.pop();if(n in e)return a.value=n,a.done=!1,a}return a.done=!0,a}},x.values=b,f.prototype={"constructor":f,"reset":function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(p),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},"stop":function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},"dispatchException":function(e){function t(t,a){return r.type="throw",r.arg=e,n.next=t,a&&(n.method="next",n.arg=m),!!a}if(this.done)throw e;for(var n=this,a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],r=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=g.call(i,"catchLoc"),o=g.call(i,"finallyLoc");if(s&&o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},"abrupt":function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&g.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,j):this.complete(r)},"complete":function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),j},"finish":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),p(n),j}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var i=a.arg;p(n)}return i}}throw new Error("illegal catch attempt")},"delegateYield":function(e,t,n){return this.delegate={"iterator":b(e),"resultName":t,"nextLoc":n},"next"===this.method&&(this.arg=m),j}}}}(function(){return this}()||Function("return this")())},{}],"52":[function(e,t){
/*
 *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
"use strict";function n(e,t,n,a,i){var r=l.writeRtpDescription(e.kind,t);if(r+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),r+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var o="msid:"+(a?a.id:"-")+" "+s+"\r\n";r+="a="+o,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),r}function a(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var a=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof a;return i&&(a=[a]),a=a.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?a[0]:a,!!a.length}})}function i(e,t){var n={"codecs":[],"headerExtensions":[],"fecMechanisms":[]},a=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var r=a(e.parameters.apt,n),s=a(t.parameters.apt,i);return r&&s&&r.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(a){for(var r=0;r<t.codecs.length;r++){var s=t.codecs[r];if(a.name.toLowerCase()===s.name.toLowerCase()&&a.clockRate===s.clockRate){if("rtx"===a.name.toLowerCase()&&a.parameters&&s.parameters.apt&&!i(a,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(a.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<a.rtcpFeedback.length;t++)if(a.rtcpFeedback[t].type===e.type&&a.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var a=0;a<t.headerExtensions.length;a++){var i=t.headerExtensions[a];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function r(e,t,n){return-1!=={"offer":{"setLocalDescription":["stable","have-local-offer"],"setRemoteDescription":["stable","have-remote-offer"]},"answer":{"setLocalDescription":["have-remote-offer","have-local-pranswer"],"setRemoteDescription":["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function o(e,t){var n=new Error(t);return n.name=e,n}var l=e("sdp");t.exports=function(e,t){function c(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{"track":t}))}function d(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{"track":t}))}function u(t,n,a,i){var r=new Event("track");r.track=n,r.receiver=a,r.transceiver={"receiver":a},r.streams=i,e.setTimeout(function(){t._dispatchEvent("track",r)})}var p=function(n){var i=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=r[e].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw o("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=a(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({"iceServers":n.iceServers,"gatherPolicy":n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=undefined,this._isClosed=!1};p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},p.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={"track":null,"iceGatherer":null,"iceTransport":null,"dtlsTransport":null,"localCapabilities":null,"remoteCapabilities":null,"rtpSender":null,"rtpReceiver":null,"kind":e,"mid":null,"sendEncodingParameters":null,"recvEncodingParameters":null,"stream":null,"associatedRemoteMediaStreams":[],"wantReceive":!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var a=this._createIceAndDtlsTransports();n.iceTransport=a.iceTransport,n.dtlsTransport=a.dtlsTransport}return this.transceivers.push(n),n},p.prototype.addTrack=function(t,n){if(this._isClosed)throw o("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var a;if(this.transceivers.find(function(e){return e.track===t}))throw o("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(a=this.transceivers[i]);return a||(a=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),a.track=t,a.stream=n,a.rtpSender=new e.RTCRtpSender(t,a.dtlsTransport),a.rtpSender},p.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var a=e.clone();e.getTracks().forEach(function(e,t){var n=a.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),a.getTracks().forEach(function(e){n.addTrack(e,a)})}},p.prototype.removeTrack=function(t){if(this._isClosed)throw o("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw o("InvalidAccessError","Sender was not created by this connection.");var a=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(a)&&this.localStreams.indexOf(a)>-1&&this.localStreams.splice(this.localStreams.indexOf(a),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},p.prototype._createIceGatherer=function(t,n){var a=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({"iceServers":this._config.iceServers,"gatherPolicy":this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{"value":"new","writable":!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==a.transceivers[t].bufferedCandidateEvents&&a.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},p.prototype._gather=function(t,n){var a=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var r=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(a.usingBundle&&n>0)){var r=new Event("icecandidate");r.candidate={"sdpMid":t,"sdpMLineIndex":n};var s=e.candidate,o=!s||0===Object.keys(s).length;if(o)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),s.component=1;var c=l.writeCandidate(s);r.candidate=Object.assign(r.candidate,l.parseCandidate(c)),r.candidate.candidate=c}var d=l.getMediaSections(a.localDescription.sdp);d[r.candidate.sdpMLineIndex]+=o?"a=end-of-candidates\r\n":"a="+r.candidate.candidate+"\r\n",a.localDescription.sdp=l.getDescription(a.localDescription.sdp)+d.join("");var u=a.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==a.iceGatheringState&&(a.iceGatheringState="gathering",a._emitGatheringStateChange()),o||a._dispatchEvent("icecandidate",r),u&&(a._dispatchEvent("icecandidate",new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},e.setTimeout(function(){r.forEach(function(e){i.onlocalcandidate(e)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var a=new e.RTCDtlsTransport(n);return a.ondtlsstatechange=function(){t._updateConnectionState()},a.onerror=function(){Object.defineProperty(a,"state",{"value":"failed","writable":!0}),t._updateConnectionState()},{"iceTransport":n,"dtlsTransport":a}},p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var a=this.transceivers[e].dtlsTransport;a&&(delete a.ondtlsstatechange,delete a.onerror,delete this.transceivers[e].dtlsTransport)},p.prototype._transceive=function(e,n,a){var r=i(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={"cname":l.localCName,"compound":e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),a&&e.rtpReceiver&&r.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={"compound":e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},p.prototype.setLocalDescription=function(e){var t,n,a=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(o("TypeError",'Unsupported type "'+e.type+'"'));if(!r("setLocalDescription",e.type,a.signalingState)||a._isClosed)return Promise.reject(o("InvalidStateError","Can not set local "+e.type+" in state "+a.signalingState));if("offer"===e.type)t=l.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=l.parseRtpParameters(e);a.transceivers[t].localCapabilities=n}),a.transceivers.forEach(function(e,t){a._gather(e.mid,t)});else if("answer"===e.type){t=l.splitSections(a.remoteDescription.sdp),n=t.shift();var s=l.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var r=a.transceivers[t],o=r.iceGatherer,c=r.iceTransport,d=r.dtlsTransport,u=r.localCapabilities,p=r.remoteCapabilities;if(!(l.isRejected(e)&&0===l.matchPrefix(e,"a=bundle-only").length)&&!r.isDatachannel){var f=l.getIceParameters(e,n),b=l.getDtlsParameters(e,n);s&&(b.role="server"),a.usingBundle&&0!==t||(a._gather(r.mid,t),"new"===c.state&&c.start(o,f,s?"controlling":"controlled"),"new"===d.state&&d.start(b));var h=i(u,p);a._transceive(r,h.codecs.length>0,!1)}})}return a.localDescription={"type":e.type,"sdp":e.sdp},"offer"===e.type?a._updateSignalingState("have-local-offer"):a._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(n){var a=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(o("TypeError",'Unsupported type "'+n.type+'"'));if(!r("setRemoteDescription",n.type,a.signalingState)||a._isClosed)return Promise.reject(o("InvalidStateError","Can not set remote "+n.type+" in state "+a.signalingState));var i={};a.remoteStreams.forEach(function(e){i[e.id]=e});var p=[],f=l.splitSections(n.sdp),b=f.shift(),h=l.matchPrefix(b,"a=ice-lite").length>0,m=l.matchPrefix(b,"a=group:BUNDLE ").length>0;a.usingBundle=m;var v=l.matchPrefix(b,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(r,o){var u=l.splitLines(r),f=l.getKind(r),v=l.isRejected(r)&&0===l.matchPrefix(r,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],_=l.getDirection(r,b),y=l.parseMsid(r),w=l.getMid(r)||l.generateIdentifier();if("application"!==f||"DTLS/SCTP"!==g){var k,C,x,T,S,M,$,j,E,A,P,I=l.parseRtpParameters(r);v||(A=l.getIceParameters(r,b),(P=l.getDtlsParameters(r,b)).role="client"),$=l.parseRtpEncodingParameters(r);var D=l.parseRtcpParameters(r),R=l.matchPrefix(r,"a=end-of-candidates",b).length>0,L=l.matchPrefix(r,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!v&&m&&o>0&&a.transceivers[o]&&(a._disposeIceAndDtlsTransports(o),a.transceivers[o].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[o].iceTransport=a.transceivers[0].iceTransport,a.transceivers[o].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[o].rtpSender&&a.transceivers[o].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[o].rtpReceiver&&a.transceivers[o].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),"offer"!==n.type||v)"answer"!==n.type||v||(C=(k=a.transceivers[o]).iceGatherer,x=k.iceTransport,T=k.dtlsTransport,S=k.rtpReceiver,M=k.sendEncodingParameters,j=k.localCapabilities,a.transceivers[o].recvEncodingParameters=$,a.transceivers[o].remoteCapabilities=I,a.transceivers[o].rtcpParameters=D,L.length&&"new"===x.state&&(!h&&!R||m&&0!==o?L.forEach(function(e){s(k.iceTransport,e)}):x.setRemoteCandidates(L)),m&&0!==o||("new"===x.state&&x.start(C,A,"controlling"),"new"===T.state&&T.start(P)),a._transceive(k,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!S||"sendrecv"!==_&&"sendonly"!==_?delete k.rtpReceiver:(E=S.track,y?(i[y.stream]||(i[y.stream]=new e.MediaStream),c(E,i[y.stream]),p.push([E,S,i[y.stream]])):(i["default"]||(i["default"]=new e.MediaStream),c(E,i["default"]),p.push([E,S,i["default"]]))));else{(k=a.transceivers[o]||a._createTransceiver(f)).mid=w,k.iceGatherer||(k.iceGatherer=a._createIceGatherer(o,m)),L.length&&"new"===k.iceTransport.state&&(!R||m&&0!==o?L.forEach(function(e){s(k.iceTransport,e)}):k.iceTransport.setRemoteCandidates(L)),j=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(j.codecs=j.codecs.filter(function(e){return"rtx"!==e.name})),M=k.sendEncodingParameters||[{"ssrc":1001*(2*o+2)}];var N,O=!1;if("sendrecv"===_||"sendonly"===_){if(O=!k.rtpReceiver,S=k.rtpReceiver||new e.RTCRtpReceiver(k.dtlsTransport,f),O)E=S.track,y&&"-"===y.stream||(y?(i[y.stream]||(i[y.stream]=new e.MediaStream,Object.defineProperty(i[y.stream],"id",{"get":function(){return y.stream}})),Object.defineProperty(E,"id",{"get":function(){return y.track}}),N=i[y.stream]):(i["default"]||(i["default"]=new e.MediaStream),N=i["default"])),N&&(c(E,N),k.associatedRemoteMediaStreams.push(N)),p.push([E,S,N])}else k.rtpReceiver&&k.rtpReceiver.track&&(k.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===k.rtpReceiver.track.id});t&&d(t,e)}),k.associatedRemoteMediaStreams=[]);k.localCapabilities=j,k.remoteCapabilities=I,k.rtpReceiver=S,k.rtcpParameters=D,k.sendEncodingParameters=M,k.recvEncodingParameters=$,a._transceive(a.transceivers[o],!1,O)}}else a.transceivers[o]={"mid":w,"isDatachannel":!0}}),a._dtlsRole===undefined&&(a._dtlsRole="offer"===n.type?"active":"passive"),a.remoteDescription={"type":n.type,"sdp":n.sdp},"offer"===n.type?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(i).forEach(function(t){var n=i[t];if(n.getTracks().length){if(-1===a.remoteStreams.indexOf(n)){a.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){a._dispatchEvent("addstream",r)})}p.forEach(function(e){var t=e[0],i=e[1];n.id===e[2].id&&u(a,t,i,[n])})}}),p.forEach(function(e){e[2]||u(a,e[0],e[1],[])}),e.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},p.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},p.prototype._updateConnectionState=function(){var e,t={"new":0,"closed":0,"connecting":0,"checking":0,"connected":0,"completed":0,"disconnected":0,"failed":0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t["new"]>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},p.prototype.createOffer=function(){var a=this;if(a._isClosed)return Promise.reject(o("InvalidStateError","Can not call createOffer after close"));var i=a.transceivers.filter(function(e){return"audio"===e.kind}).length,r=a.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");s.offerToReceiveAudio!==undefined&&(i=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),s.offerToReceiveVideo!==undefined&&(r=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(a.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)});i>0||r>0;)i>0&&(a._createTransceiver("audio"),i--),r>0&&(a._createTransceiver("video"),r--);var c=l.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(n,i){var r=n.track,s=n.kind,o=n.mid||l.generateIdentifier();n.mid=o,n.iceGatherer||(n.iceGatherer=a._createIceGatherer(i,a.usingBundle));var c=e.RTCRtpSender.getCapabilities(s);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&e.parameters["level-asymmetry-allowed"]===undefined&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=n.sendEncodingParameters||[{"ssrc":1001*(2*i+1)}];r&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={"ssrc":d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=c,n.sendEncodingParameters=d}),"max-compat"!==a._config.bundlePolicy&&(c+="a=group:BUNDLE "+a.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",a.transceivers.forEach(function(e,t){c+=n(e,e.localCapabilities,"offer",e.stream,a._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===a.iceGatheringState||0!==t&&a.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,c+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({"type":"offer","sdp":c});return Promise.resolve(d)},p.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(o("InvalidStateError","Can not call createAnswer after close"));var r=l.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&(r+="a=group:BUNDLE "+a.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=l.getMediaSections(a.remoteDescription.sdp).length;a.transceivers.forEach(function(e,o){if(!(o+1>s))if(e.isDatachannel)r+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{var l;if(e.stream)"audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]),l&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={"ssrc":e.sendEncodingParameters[0].ssrc+1});var c=i(e.localCapabilities,e.remoteCapabilities);!c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=n(e,c,"answer",e.stream,a._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var c=new e.RTCSessionDescription({"type":"answer","sdp":r});return Promise.resolve(c)},p.prototype.addIceCandidate=function(e){var t,n=this;return e&&e.sdpMLineIndex===undefined&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,i){if(!n.remoteDescription)return i(o("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var r=e.sdpMLineIndex;if(e.sdpMid)for(var c=0;c<n.transceivers.length;c++)if(n.transceivers[c].mid===e.sdpMid){r=c;break}var d=n.transceivers[r];if(!d)return i(o("OperationError","Can not add ICE candidate"));if(d.isDatachannel)return a();var u=Object.keys(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return a();if(u.component&&1!==u.component)return a();if((0===r||r>0&&d.iceTransport!==n.transceivers[0].iceTransport)&&!s(d.iceTransport,u))return i(o("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=l.getMediaSections(n.remoteDescription.sdp))[r]+="a="+(u.type?p:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].isDatachannel||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=l.getMediaSections(n.remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=l.getDescription(n.remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);a()})},p.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=function(e){return{"inboundrtp":"inbound-rtp","outboundrtp":"outbound-rtp","candidatepair":"candidate-pair","localcandidate":"local-candidate","remotecandidate":"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var a=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(n){e[n].type=t(e[n]),a.set(n,e[n])})}),n(a)})})};var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),p}},{"sdp":53}],"53":[function(e,t){"use strict";var n={"generateIdentifier":function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,n={"foundation":(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],"component":parseInt(t[1],10),"protocol":t[2].toLowerCase(),"priority":parseInt(t[3],10),"ip":t[4],"address":t[4],"port":parseInt(t[5],10),"type":t[7]},a=8;a<t.length;a+=2)switch(t[a]){case"raddr":n.relatedAddress=t[a+1];break;case"rport":n.relatedPort=parseInt(t[a+1],10);break;case"tcptype":n.tcpType=t[a+1];break;case"ufrag":n.ufrag=t[a+1],n.usernameFragment=t[a+1];break;default:n[t[a]]=t[a+1]}return n},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={"payloadType":parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},n.writeRtpMap=function(e){var t=e.payloadType;e.preferredPayloadType!==undefined&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{"id":parseInt(t[0],10),"direction":t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv","uri":t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,n={},a=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<a.length;i++)n[(t=a[i].trim().split("="))[0].trim()]=t[1];return n},n.writeFmtp=function(e){var t="",n=e.payloadType;if(e.preferredPayloadType!==undefined&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var a=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?a.push(t+"="+e.parameters[t]):a.push(t)}),t+="a=fmtp:"+n+" "+a.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{"type":t.shift(),"parameter":t.join(" ")}},n.writeRtcpFb=function(e){var t="",n=e.payloadType;return e.preferredPayloadType!==undefined&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={"ssrc":parseInt(e.substr(7,t-7),10)},a=e.indexOf(":",t);return a>-1?(n.attribute=e.substr(t+1,a-t-1),n.value=e.substr(a+1)):n.attribute=e.substr(t+1),n},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{"semantics":t.shift(),"ssrcs":t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{"algorithm":t[0].toLowerCase(),"value":t[1]}},n.getDtlsParameters=function(e,t){return{"role":"auto","fingerprints":n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},n.getIceParameters=function(e,t){var a=n.splitLines(e);return{"usernameFragment":(a=a.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),"password":a.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={"codecs":[],"headerExtensions":[],"fecMechanisms":[],"rtcp":[]},a=n.splitLines(e)[0].split(" "),i=3;i<a.length;i++){var r=a[i],s=n.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(s){var o=n.parseRtpMap(s),l=n.matchPrefix(e,"a=fmtp:"+r+" ");switch(o.parameters=l.length?n.parseFmtp(l[0]):{},o.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(n.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ",a+=t.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=t.codecs.map(function(e){return e.preferredPayloadType!==undefined?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){a+=n.writeRtpMap(e),a+=n.writeFmtp(e),a+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(a+="a=maxptime:"+i+"\r\n"),a+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){a+=n.writeExtmap(e)}),a},n.parseRtpEncodingParameters=function(e){var t,a=[],i=n.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=o.length>0&&o[0].ssrc,c=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});c.length>0&&c[0].length>1&&c[0][0]===l&&(t=c[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={"ssrc":l,"codecPayloadType":parseInt(e.parameters.apt,10)};l&&t&&(n.rtx={"ssrc":t}),a.push(n),
r&&((n=JSON.parse(JSON.stringify(n))).fec={"ssrc":l,"mechanism":s?"red+ulpfec":"red"},a.push(n))}}),0===a.length&&l&&a.push({"ssrc":l});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:undefined,a.forEach(function(e){e.maxBitrate=d})),a},n.parseRtcpParameters=function(e){var t={},a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];a&&(t.cname=a.value,t.ssrc=a.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var r=n.matchPrefix(e,"a=rtcp-mux");return t.mux=r.length>0,t},n.parseMsid=function(e){var t,a=n.matchPrefix(e,"a=msid:");if(1===a.length)return{"stream":(t=a[0].substr(7).split(" "))[0],"track":t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{"stream":(t=i[0].value.split(" "))[0],"track":t[1]}:void 0},n.parseSctpDescription=function(e){var t,a=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var r=n.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{"port":parseInt(r[0].substr(12),10),"protocol":a.fmt,"maxMessageSize":t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var s=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{"port":parseInt(s[0],10),"protocol":s[1],"maxMessageSize":t}}},n.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],t.maxMessageSize!==undefined&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,a){var i=t!==undefined?t:2;return"v=0\r\no="+(a||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,a,i){var r=n.writeRtpDescription(e.kind,t);if(r+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+s,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),r},n.getDirection=function(e,t){for(var a=n.splitLines(e),i=0;i<a.length;i++)switch(a[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{"kind":t[0],"port":parseInt(t[1],10),"protocol":t[2],"fmt":t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{"username":t[0],"sessionId":t[1],"sessionVersion":parseInt(t[2],10),"netType":t[3],"addressType":t[4],"address":t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),a=0;a<t.length;a++)if(t[a].length<2||"="!==t[a].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],"54":[function(e,t){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],"55":[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],"56":[function(e,t,n){(function(t,a){function i(e,t){var a={"seen":[],"stylize":s};return arguments.length>=3&&(a.depth=arguments[2]),arguments.length>=4&&(a.colors=arguments[3]),h(t)?a.showHidden=t:t&&n._extend(a,t),w(a.showHidden)&&(a.showHidden=!1),w(a.depth)&&(a.depth=2),w(a.colors)&&(a.colors=!1),w(a.customInspect)&&(a.customInspect=!0),a.colors&&(a.stylize=r),l(a,e,a.depth)}function r(e,t){var n=i.styles[t];return n?"\x1b["+i.colors[n][0]+"m"+e+"\x1b["+i.colors[n][1]+"m":e}function s(e){return e}function o(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function l(e,t,a){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(a,e);return _(i)||(i=l(e,i,a)),i}var r=c(e,t);if(r)return r;var s=Object.keys(t),h=o(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),T(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(S(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(k(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(T(t))return d(t)}var v,g="",y=!1,w=["{","}"];(b(t)&&(y=!0,w=["[","]"]),S(t))&&(g=" [Function"+(t.name?": "+t.name:"")+"]");return k(t)&&(g=" "+RegExp.prototype.toString.call(t)),x(t)&&(g=" "+Date.prototype.toUTCString.call(t)),T(t)&&(g=" "+d(t)),0!==s.length||y&&0!=t.length?a<0?k(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),v=y?u(e,t,a,h,s):s.map(function(n){return p(e,t,a,h,n,y)}),e.seen.pop(),f(v,g,w)):w[0]+g+w[1]}function c(e,t){if(w(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function u(e,t,n,a,i){for(var r=[],s=0,o=t.length;s<o;++s)A(t,String(s))?r.push(p(e,t,n,a,String(s),!0)):r.push("");return i.forEach(function(i){i.match(/^\d+$/)||r.push(p(e,t,n,a,i,!0))}),r}function p(e,t,n,a,i,r){var s,o,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{"value":t[i]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),A(a,i)||(s="["+i+"]"),o||(e.seen.indexOf(c.value)<0?(o=m(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(o=r?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),w(s)){if(r&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function f(e,t,n){return e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function b(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return null==e}function g(e){return"number"==typeof e}function _(e){return"string"==typeof e}function y(e){return"symbol"==typeof e}function w(e){return void 0===e}function k(e){return C(e)&&"[object RegExp]"===$(e)}function C(e){return"object"==typeof e&&null!==e}function x(e){return C(e)&&"[object Date]"===$(e)}function T(e){return C(e)&&("[object Error]"===$(e)||e instanceof Error)}function S(e){return"function"==typeof e}function M(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function $(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
// Copyright Joyent, Inc. and other Node contributors.
// The above copyright notice and this permission notice shall be included
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
var P=/%[sdj%]/g;n.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}n=1;for(var a=arguments,r=a.length,s=String(e).replace(P,function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(a[n++]);case"%d":return Number(a[n++]);case"%j":try{return JSON.stringify(a[n++])}catch(t){return"[Circular]"}default:return e}}),o=a[n];n<r;o=a[++n])m(o)||!C(o)?s+=" "+o:s+=" "+i(o);return s},n.deprecate=function(e,i){function r(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(w(a.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return r};var I,D={};n.debuglog=function(e){if(w(I)&&(I=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!D[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){var a=t.pid;D[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,a,t)}}else D[e]=function(){};return D[e]},n.inspect=i,i.colors={"bold":[1,22],"italic":[3,23],"underline":[4,24],"inverse":[7,27],"white":[37,39],"grey":[90,39],"black":[30,39],"blue":[34,39],"cyan":[36,39],"green":[32,39],"magenta":[35,39],"red":[31,39],"yellow":[33,39]},i.styles={"special":"cyan","number":"yellow","boolean":"yellow","undefined":"grey","null":"bold","string":"green","date":"magenta","regexp":"red"},n.isArray=b,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=v,n.isNumber=g,n.isString=_,n.isSymbol=y,n.isUndefined=w,n.isRegExp=k,n.isObject=C,n.isDate=x,n.isError=T,n.isFunction=S,n.isPrimitive=M,n.isBuffer=e("./support/isBuffer");var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",E(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!C(t))return e;for(var n=Object.keys(t),a=n.length;a--;)e[n[a]]=t[n[a]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":55,"_process":49,"inherits":54}]},{},[3])(3);if("function"==typeof define&&define.amd)define([],function(){return t});else{var n=e.Twilio=e.Twilio||{};n.Connection=n.Connection||t.Connection,n.Device=n.Device||t.Device,n.PStream=n.PStream||t.PStream}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Twilio||(t.Twilio={})).Chat=e()}}(function(){return function e(t,n,a){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={"exports":{}};t[s][0].call(d.exports,function(e){return i(t[s][1][e]||e)},d,d.exports,e,t,n,a)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({"1":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){try{return new Date(e)}catch(e){return null}}function r(e){switch(e){case"notParticipating":return"known";default:return e}}var s=a(e("babel-runtime/core-js/get-iterator")),o=a(e("babel-runtime/regenerator")),l=a(e("babel-runtime/core-js/promise")),c=a(e("babel-runtime/helpers/asyncToGenerator")),d=a(e("babel-runtime/core-js/map")),u=a(e("babel-runtime/core-js/json/stringify")),p=a(e("babel-runtime/core-js/number/is-integer")),f=a(e("babel-runtime/core-js/object/get-prototype-of")),b=a(e("babel-runtime/helpers/classCallCheck")),h=a(e("babel-runtime/helpers/createClass")),m=a(e("babel-runtime/helpers/possibleConstructorReturn")),v=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var g=e("events"),_=e("./logger"),y=e("./data/members"),w=e("./member"),k=e("./data/messages"),C=e("./util"),x=_.Logger.scope("Channel"),T={"lastMessage":"lastMessage","attributes":"attributes","createdBy":"createdBy","dateCreated":"dateCreated","dateUpdated":"dateUpdated","friendlyName":"friendlyName","lastConsumedMessageIndex":"lastConsumedMessageIndex","notificationLevel":"notificationLevel","sid":"sid","status":"status","type":"type","uniqueName":"uniqueName"};n.filterStatus=r;var S=function(e){function t(e,n,a){(0,b["default"])(this,t);var r=(0,m["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this)),s=n.attributes||{},o=n.createdBy,l=i(n.dateCreated),c=i(n.dateUpdated),h=n.friendlyName||null,v=(0,p["default"])(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,g=n.uniqueName||null;try{(0,u["default"])(s)}catch(e){throw new Error("Attributes must be a valid JSON object.")}return r.services=e,r.sid=a,r.entityName=n.channel,r.state={"uniqueName":g,"status":"known","type":n.type,"attributes":s,"createdBy":o,"dateCreated":l,"dateUpdated":c,"friendlyName":h,"lastConsumedMessageIndex":v},n.notificationLevel&&(r.state.notificationLevel=n.notificationLevel),r.members=new d["default"],r.membersEntity=new y.Members(r,r.services,r.members),r.membersEntity.on("memberJoined",r.emit.bind(r,"memberJoined")),r.membersEntity.on("memberLeft",r.emit.bind(r,"memberLeft")),r.membersEntity.on("memberUpdated",function(e){return r.emit("memberUpdated",e)}),r.messagesEntity=new k.Messages(r,e),r.messagesEntity.on("messageAdded",function(e){return r._onMessageAdded(e)}),r.messagesEntity.on("messageUpdated",function(e){return r.emit("messageUpdated",e)}),r.messagesEntity.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r}return(0,v["default"])(t,e),(0,h["default"])(t,[{"key":"_subscribe","value":function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({"id":this.entityName,"mode":"open_existing"}).then(function(t){return e.entity=t,e.entity.on("updated",function(t){e._update(t.value)}),e.entity.on("removed",function(){return e.emit("removed",e)}),e._update(e.entity.value),t})["catch"](function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&x.error("Failed to get channel object",t),x.debug("ERROR: Failed to get channel object",t),t})}},{"key":"_subscribeStreams","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){var e,n;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._subscribe();case 3:return x.trace("_subscribeStreams, this.entity.value=",this.entity.value),e=this.entity.value.messages,n=this.entity.value.roster,t.next=8,l["default"].all([this.messagesEntity.subscribe(e),this.membersEntity.subscribe(n)]);case 8:t.next=15;break;case 10:throw t.prev=10,t.t0=t["catch"](0),"disconnected"!==this.services.syncClient.connectionState&&x.error("Failed to subscribe on channel objects",this.sid,t.t0),x.debug("ERROR: Failed to subscribe on channel objects",this.sid,t.t0),t.t0;case 15:case"end":return t.stop()}},t,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{"key":"_unsubscribe","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",l["default"].all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_setStatus","value":function(e,t){var n=this;this.statusSource=t,this.state.status!==e&&(this.state.status=e,"joined"===e?this._subscribeStreams()["catch"](function(t){if(x.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}):"invited"===e?this._subscribe()["catch"](function(t){if(x.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}):this.entityPromise&&this._unsubscribe()["catch"](function(t){if(x.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}))}},{"key":"_statusSource","value":function(){return this.statusSource}},{"key":"_update","value":function(e){x.trace("_update",e);var n=[];for(var a in t.preprocessUpdate(e,this.sid),e){var i=T[a];if(i)if(i===T.status)e.status&&"unknown"!=e.status&&this.state.status!==r(e.status)&&(this.state.status=r(e.status),n.push(i));else if(i===T.attributes)C.isDeepEqual(this.state.attributes,e.attributes)||(this.state.attributes=e.attributes,n.push(i));else if(i===T.lastConsumedMessageIndex)void 0!==e.lastConsumedMessageIndex&&e.lastConsumedMessageIndex!==this.state.lastConsumedMessageIndex&&(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,n.push(i));else if(i===T.lastMessage){var s=!1;this.state.lastMessage&&!e.lastMessage?(delete this.state.lastMessage,s=!0):(this.state.lastMessage||(this.state.lastMessage={}),e.lastMessage&&void 0!==e.lastMessage.index&&e.lastMessage.index!==this.state.lastMessage.index&&(this.state.lastMessage.index=e.lastMessage.index,s=!0),!e.lastMessage||!e.lastMessage.timestamp||this.state.lastMessage.timestamp&&this.state.lastMessage.timestamp.getTime()===e.lastMessage.timestamp.getTime()||(this.state.lastMessage.timestamp=e.lastMessage.timestamp,s=!0),C.isDeepEqual(this.state.lastMessage,{})&&delete this.state.lastMessage),s&&n.push(i)}else e[a]instanceof Date?this.state[i]&&this.state[i].getTime()===e[a].getTime()||(this.state[i]=e[a],n.push(i)):this[i]!==e[a]&&(this.state[i]=e[a],n.push(i))}n.length>0&&this.emit("updated",{"channel":this,"updateReasons":n})}},{"key":"_onMessageAdded","value":function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=(0,s["default"])(this.members.values());!(t=(i=r.next()).done);t=!0){var o=i.value;if(o.identity===e.author){o._endTyping();break}}}catch(e){n=!0,a=e}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw a}}this.emit("messageAdded",e)}},{"key":"add","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Channel.add requires an <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.add(e));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"advanceLastConsumedMessageIndex","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,p["default"])(e)){t.next=2;break}throw new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter");case 2:return t.next=4,this._subscribeStreams();case 4:return t.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,e,this.lastConsumedMessageIndex));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"decline","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{"channelSid":this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"delete","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{"channelSid":this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getAttributes","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMessages","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e,n,a){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n||(0,p["default"])(n)){t.next=2;break}throw new Error("Anchor should be a valid message index");case 2:return t.next=4,this._subscribeStreams();case 4:return t.abrupt("return",this.messagesEntity.getMessages(e,n,a));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMembers","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMembersCount","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){var e,n,a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.getSessionLinks();case 2:return e=t.sent,n=new C.UriBuilder(e.publicChannelsUrl).path(this.sid).build(),t.next=6,this.services.network.get(n);case 6:return a=t.sent,t.abrupt("return",a.body.members_count);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMemberBySid","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Channel.getMemberBySid requires a <String>memberSid parameter");case 2:return t.abrupt("return",this.membersEntity.getMemberBySid(e));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMemberByIdentity","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Channel.getMemberByIdentity requires a <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.getMemberByIdentity(e));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMessagesCount","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){var e,n,a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.getSessionLinks();case 2:return e=t.sent,n=new C.UriBuilder(e.publicChannelsUrl).path(this.sid).build(),t.next=6,this.services.network.get(n);case 6:return a=t.sent,t.abrupt("return",a.body.messages_count);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUnconsumedMessagesCount","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){var e,n,a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.getSessionLinks();case 2:return e=t.sent,n=new C.UriBuilder(e.myChannelsUrl).arg("ChannelSid",this.sid).build(),t.next=6,this.services.network.get(n);case 6:if(!(a=t.sent).body.channels.length||a.body.channels[0].channel_sid!=this.sid){t.next=11;break}if(void 0===a.body.channels[0].unread_messages_count||null==a.body.channels[0].unread_messages_count){t.next=10;break}return t.abrupt("return",a.body.channels[0].unread_messages_count);case 10:return t.abrupt("return",null);case 11:throw new Error("Channel is not in user channels list");case 12:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"invite","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&e.length){t.next=2;break}throw new Error("Channel.invite requires an <String>identity parameter");case 2:return t.next=4,this.membersEntity.invite(e);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"join","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{"channelSid":this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"leave","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.state.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{"channelSid":this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeMember","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&("string"==typeof e||e instanceof w.Member)){t.next=2;break}throw new Error("Channel.removeMember requires a <String|Member>member parameter.");case 2:if(!(e instanceof w.Member)){t.next=7;break}return t.next=5,this.membersEntity.removeBySid(e.sid);case 5:t.next=9;break;case 7:return t.next=9,this.membersEntity.removeByIdentity(e);case 9:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sendMessage","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e,n){var a,i;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}throw new Error("Message is required parameter");case 2:if("string"!=typeof e&&null!==e){t.next=9;break}return t.next=5,this.messagesEntity.send(e,n);case 5:return a=t.sent,t.abrupt("return",C.parseToNumber(a.messageId));case 9:return t.next=11,this.messagesEntity.sendMedia(e,n);case 11:return i=t.sent,t.abrupt("return",C.parseToNumber(i.messageId));case 13:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setAllMessagesConsumed","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._subscribeStreams();case 2:return t.next=4,this.getMessages(1);case 4:if(!((e=t.sent).items.length>0)){t.next=7;break}return t.abrupt("return",this.advanceLastConsumedMessageIndex(e.items[0].index));case 7:return t.abrupt("return",l["default"].resolve(0));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setNoMessagesConsumed","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setUserNotificationLevel","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("notificationLevel can't be null");case 2:return t.next=4,this.services.session.addCommand("editNotificationLevel",{"channelSid":this.sid,"notificationLevel":e});case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"typing","value":function(){return this.services.typingIndicator.send(this.sid)}},{"key":"updateAttributes","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==e){t.next=8;break}throw new Error("Attributes can't be null");case 8:if(e.constructor===Object){t.next=10;break}throw new Error("Attributes must be a valid JSON object.");case 10:return t.next=12,this.services.session.addCommand("editAttributes",{"channelSid":this.sid,"attributes":(0,u["default"])(e)});case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateFriendlyName","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.friendlyName===e){t.next=3;break}return t.next=3,this.services.session.addCommand("editFriendlyName",{"channelSid":this.sid,"friendlyName":e});case 3:return t.abrupt("return",this);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateLastConsumedMessageIndex","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,p["default"])(e)||null===e){t.next=2;break}throw new Error('Incorrect argument "index": integer number or null expected');case 2:return t.next=4,this._subscribeStreams();case 4:return t.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,e));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateUniqueName","value":function(){var e=(0,c["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.uniqueName===e){t.next=4;break}return e||(e=""),t.next=4,this.services.session.addCommand("editUniqueName",{"channelSid":this.sid,"uniqueName":e});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUserDescriptors","value":function(){var e=(0,c["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"status","get":function(){return this.state.status}},{"key":"type","get":function(){return this.state.type}},{"key":"uniqueName","get":function(){return this.state.uniqueName}},{"key":"isPrivate","get":function(){return"private"===this.state.type}},{"key":"friendlyName","get":function(){return this.state.friendlyName}},{"key":"dateUpdated","get":function(){return this.state.dateUpdated}},{"key":"dateCreated","get":function(){return this.state.dateCreated}},{"key":"createdBy","get":function(){return this.state.createdBy}},{"key":"attributes","get":function(){return this.state.attributes}},{"key":"lastConsumedMessageIndex","get":function(){return this.state.lastConsumedMessageIndex}},{"key":"lastMessage","get":function(){return this.state.lastMessage}},{"key":"notificationLevel","get":function(){return this.state.notificationLevel}}],[{"key":"preprocessUpdate","value":function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,u["default"])(e.attributes)}catch(n){x.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){x.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){x.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){x.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),t}(g.EventEmitter);n.Channel=S},{"./data/members":6,"./data/messages":7,"./logger":14,"./member":16,"./util":30,"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/number/is-integer":36,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"2":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){try{return new Date(e)}catch(e){return null}}var r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var o=e("./logger"),l=e("./channel"),c=o.Logger.scope("ChannelDescriptor"),d=function(){function e(t,n){(0,r["default"])(this,e),this.client=t,this.descriptor=n,n.sid?(this.sid=n.sid,this.channel=n.sid+".channel"):(this.sid=n.channel_sid,this.channel=n.channel_sid+".channel"),this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(e){c.warn("Failed to parse channel attributes",e)}return{}}(n.attributes),this.createdBy=n.created_by,this.dateCreated=i(n.date_created),this.dateUpdated=i(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type,this.isPrivate="private"==n.type,this.lastConsumedMessageIndex=n.last_consumed_message_index,n.notification_level&&(this.notificationLevel=n.notification_level),n.status?this.status=l.filterStatus(n.status):this.status="unknown"}return(0,s["default"])(e,[{"key":"getChannel","value":function(){return this.client.getChannelBySid(this.sid)}}]),e}();n.ChannelDescriptor=d},{"./channel":1,"./logger":14,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"3":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/core-js/object/assign")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/promise")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits")),p=a(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("./logger"),h=e("./configuration"),m=e("./user");n.User=m.User;var v=e("./data/publicchannels"),g=e("./services/network"),_=e("./interfaces/notificationtypes"),y=e("./synclist"),w=e("twilsock"),k=e("twilio-notifications"),C=e("twilio-sync"),x=e("twilio-mcs-client"),T=e("./session"),S=e("./data/channels"),M=e("./data/users"),$=e("./services/typingindicator"),j=e("./services/consumptionhorizon"),E=e("./data/userchannels"),A=e("./pushnotification");n.PushNotification=A.PushNotification;var P=e("./util"),I=b.Logger.scope("Client"),D=e("./../package.json").version,R="A valid Twilio token should be provided",L=function O(){(0,p["default"])(this,O)},N=function(e){function t(e,n){(0,p["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));a.connectionState="connecting",a.sessionPromise=null,a.channelsPromise=null,a.version=D,a.parsePushNotification=t.parsePushNotification,a.options=n||{},a.options.disableDeepClone||(a.options=P.deepClone(a.options)),a.options.logLevel=a.options.logLevel||"silent",I.setLevel(a.options.logLevel);var i=a.options.productId="ip_messaging";if(a.options.Sync=a.options.Sync||{},void 0===a.options.Sync.enableSessionStorage&&(a.options.Sync.enableSessionStorage=!0),a.options.region&&(a.options.Sync.region=a.options.region),!e)throw new Error(R);return a.services=new L,a.config=new h.Configuration(a.options),a.options.twilsockClient=a.options.twilsockClient||new w.Twilsock(e,i,a.options),a.options.transport=a.options.transport||a.options.twilsockClient,a.options.notificationsClient=a.options.notificationsClient||new k.Notifications(e,a.options),a.options.syncClient=a.options.syncClient||new C.SyncClient(e,a.options),a.services.syncClient=a.options.syncClient,a.services.transport=a.options.transport,a.services.twilsockClient=a.options.twilsockClient,a.services.notificationClient=a.options.notificationsClient,a.services.session=new T.Session(a.services,a.config),a.sessionPromise=a.services.session.initialize(),a.services.network=new g.Network(a.config,a.services),a.services.users=new M.Users({"session":a.services.session,"network":a.services.network,"syncClient":a.services.syncClient}),a.services.users.on("userSubscribed",a.emit.bind(a,"userSubscribed")),a.services.users.on("userUpdated",function(e){return a.emit("userUpdated",e)}),a.services.users.on("userUnsubscribed",a.emit.bind(a,"userUnsubscribed")),a.services.twilsockClient.on("tokenAboutToExpire",function(e){return a.emit("tokenAboutToExpire",e)}),a.services.twilsockClient.on("tokenExpired",function(){return a.emit("tokenExpired")}),a.services.twilsockClient.on("connectionError",function(e){return a.emit("connectionError",e)}),a.services.consumptionHorizon=new j.ConsumptionHorizon(a.services),a.services.typingIndicator=new $.TypingIndicator(a.config,{"transport":a.services.twilsockClient,"notificationClient":a.services.notificationClient},a.getChannelBySid.bind(a)),a.services.syncList=new y.SyncList(a.services),a.channels=new S.Channels(a.services),a.channelsPromise=a.sessionPromise.then(function(){return a.channels.on("channelAdded",a.emit.bind(a,"channelAdded")),a.channels.on("channelRemoved",a.emit.bind(a,"channelRemoved")),a.channels.on("channelInvited",a.emit.bind(a,"channelInvited")),a.channels.on("channelJoined",a.emit.bind(a,"channelJoined")),a.channels.on("channelLeft",a.emit.bind(a,"channelLeft")),a.channels.on("channelUpdated",function(e){return a.emit("channelUpdated",e)}),a.channels.on("memberJoined",a.emit.bind(a,"memberJoined")),a.channels.on("memberLeft",a.emit.bind(a,"memberLeft")),a.channels.on("memberUpdated",function(e){return a.emit("memberUpdated",e)}),a.channels.on("messageAdded",a.emit.bind(a,"messageAdded")),a.channels.on("messageUpdated",function(e){return a.emit("messageUpdated",e)}),a.channels.on("messageRemoved",a.emit.bind(a,"messageRemoved")),a.channels.on("typingStarted",a.emit.bind(a,"typingStarted")),a.channels.on("typingEnded",a.emit.bind(a,"typingEnded")),a.channels.fetchChannels()}).then(function(){return a.channels}),a.services.notificationClient.on("connectionStateChanged",function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==a.connectionState&&(a.connectionState=t,a.emit("connectionStateChanged",a.connectionState))}),a.fpaToken=e,a}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"subscribeToPushNotifications","value":function(e){var t=this,n=[];return[_.NotificationTypes.NEW_MESSAGE,_.NotificationTypes.ADDED_TO_CHANNEL,_.NotificationTypes.INVITED_TO_CHANNEL,_.NotificationTypes.REMOVED_FROM_CHANNEL,_.NotificationTypes.TYPING_INDICATOR,_.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(a){n.push(t.services.notificationClient.subscribe(a,e))}),o["default"].all(n)}},{"key":"unsubscribeFromPushNotifications","value":function(e){var t=this,n=[];return[_.NotificationTypes.NEW_MESSAGE,_.NotificationTypes.ADDED_TO_CHANNEL,_.NotificationTypes.INVITED_TO_CHANNEL,_.NotificationTypes.REMOVED_FROM_CHANNEL,_.NotificationTypes.TYPING_INDICATOR,_.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(a){n.push(t.services.notificationClient.unsubscribe(a,e))}),o["default"].all(n)}},{"key":"initialize","value":function(){var e=(0,s["default"])(i["default"].mark(function n(){var e,a,s=this;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sessionPromise;case 2:return t.supportedPushChannels.forEach(function(e){
return s.subscribeToPushNotifications(e)}),n.next=5,this.services.session.getSessionLinks();case 5:return e=n.sent,this.services.publicChannels=new v.PublicChannels(this,this.services,e.publicChannelsUrl),this.services.userChannels=new E.UserChannels(this,this.services,e.myChannelsUrl),(a=(0,r["default"])(this.options)).transport=null,this.services.mcsClient=new x.McsClient(this.fpaToken,e.mediaServiceUrl,a),n.next=13,this.services.typingIndicator.initialize();case 13:case"end":return n.stop()}},n,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"shutdown","value":function(){var e=(0,s["default"])(i["default"].mark(function t(){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateToken","value":function(){var e=(0,s["default"])(i["default"].mark(function t(e){var n=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(I.info("updateToken"),e){t.next=3;break}throw new Error(R);case 3:if(this.fpaToken!==e){t.next=5;break}return t.abrupt("return",this);case 5:return t.next=7,this.services.twilsockClient.updateToken(e).then(function(){return n.fpaToken=e}).then(function(){return n.services.mcsClient.updateToken(e)}).then(function(){return n.sessionPromise});case 7:return t.abrupt("return",this);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelBySid","value":function(){var e=(0,s["default"])(i["default"].mark(function t(e){var n=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Client.getChannelBySid requires a <String>channelSid parameter");case 2:return t.abrupt("return",this.channels.syncListRead.promise.then(function(){return n.channels.getChannel(e).then(function(t){return t||n.services.publicChannels.getChannelBySid(e).then(function(e){return n.channels.pushChannel(e)})})}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelByUniqueName","value":function(){var e=(0,s["default"])(i["default"].mark(function t(e){var n=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");case 2:return t.abrupt("return",this.channels.syncListRead.promise.then(function(){return n.services.publicChannels.getChannelByUniqueName(e).then(function(e){return n.channels.pushChannel(e)})}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getSubscribedChannels","value":function(e){return this.channelsPromise.then(function(t){return t.getChannels(e)})}},{"key":"getLocalChannels","value":function(e){return this.channelsPromise.then(function(n){var a=[];n.channels.forEach(function(e){a.push(e)});var i="ascending";if(e&&e.order)if("descending"===e.order)i="descending";else if("ascending"!==e.order)throw new Error("Sorting order should be `ascending` or `descending`");if(e&&e.criteria)if("lastMessage"===e.criteria)a.sort(function(e,n){return t.compareChannelsByLastMessage(e,n,i)});else if("uniqueName"===e.criteria)a.sort(function(e,n){return t.compareChannelsByStringProperty(e.uniqueName,n.uniqueName,i)});else{if("friendlyName"!==e.criteria)throw new Error("Sorting criteria should be one of `lastMessage`, `uniqueName` or `friendlyName`");a.sort(function(e,n){return t.compareChannelsByStringProperty(e.friendlyName,n.friendlyName,i)})}return a})}},{"key":"getPublicChannelDescriptors","value":function(){return this.services.publicChannels.getChannels()}},{"key":"getUserChannelDescriptors","value":function(){return this.services.userChannels.getChannels()}},{"key":"createChannel","value":function(e){return e=e||{},this.channelsPromise.then(function(t){return t.addChannel(e)})}},{"key":"setPushRegistrationId","value":function(){var e=(0,s["default"])(i["default"].mark(function n(e,a){var r=this;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(-1!==t.supportedPushChannels.indexOf(e)){n.next=2;break}throw new Error("Invalid or unsupported channelType: "+e);case 2:return n.next=4,this.subscribeToPushNotifications(e).then(function(){return r.services.notificationClient.setPushRegistrationId(a,e)});case 4:case"end":return n.stop()}},n,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"unsetPushRegistrationId","value":function(){var e=(0,s["default"])(i["default"].mark(function n(e){return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(-1!==t.supportedPushChannels.indexOf(e)){n.next=2;break}throw new Error("Invalid or unsupported channelType: "+e);case 2:return n.next=4,this.unsubscribeFromPushNotifications(e);case 4:case"end":return n.stop()}},n,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"handlePushNotification","value":function(){var e=(0,s["default"])(i["default"].mark(function n(e){return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:I.debug("handlePushNotification, notificationPayload=",e),this.emit("pushNotification",t.parsePushNotification(e));case 2:case"end":return n.stop()}},n,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUser","value":function(e){return this.services.users.getUser(e)}},{"key":"getUserDescriptor","value":function(){var e=(0,s["default"])(i["default"].mark(function t(e){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.services.users.getUserDescriptor(e));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getSubscribedUsers","value":function(){var e=(0,s["default"])(i["default"].mark(function t(){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"user","get":function(){return this.services.users.myself}},{"key":"reachabilityEnabled","get":function(){return this.services.session.reachabilityEnabled}},{"key":"token","get":function(){return this.fpaToken}}],[{"key":"create","value":function(){var e=(0,s["default"])(i["default"].mark(function n(e,a){var r;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=new t(e,a),n.next=3,r.initialize();case 3:return n.abrupt("return",r);case 4:case"end":return n.stop()}},n,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"compareChannelsByLastMessage","value":function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.timestamp&&t.lastMessage.timestamp)return e.lastMessage.timestamp.getTime()<t.lastMessage.timestamp.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.timestamp)return-1;if(t.lastMessage.timestamp)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{"key":"compareChannelsByStringProperty","value":function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{"key":"parsePushNotificationChatData","value":function(e){var n={};for(var a in t.supportedPushDataFields)void 0!==e[a]&&null!==e[a]&&("message_index"===a?null!==P.parseToNumber(e[a])&&(n[t.supportedPushDataFields[a]]=Number(e[a])):n[t.supportedPushDataFields[a]]=e[a]);return n}},{"key":"parsePushNotification","value":function(e){if(I.debug("parsePushNotification, notificationPayload=",e),null==e)throw new Error("Push notification payload should be provided");if(void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var n=t.parsePushNotificationChatData(e),a=e.aps,i=null,r=null;return"string"==typeof a.alert?i=a.alert||null:(i=a.alert.body||null,r=a.alert.title||null),new A.PushNotification({"title":r,"body":i,"sound":a.sound||null,"badge":a.badge||null,"action":a.category||null,"type":e.twi_message_type,"data":n})}if(void 0!==e.data){var s=e.data;if(!s.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var o=t.parsePushNotificationChatData(e.data);return new A.PushNotification({"title":s.twi_title||null,"body":s.twi_body||null,"sound":s.twi_sound||null,"badge":null,"action":s.twi_action||null,"type":s.twi_message_type,"data":o})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),t}(f.EventEmitter);n.Client=N,N.version=D,N.supportedPushChannels=["fcm","apn","gcm"],N.supportedPushDataFields={"channel_sid":"channelSid","message_sid":"messageSid","message_index":"messageIndex"},n["default"]=N},{"./../package.json":288,"./configuration":4,"./data/channels":5,"./data/publicchannels":8,"./data/userchannels":9,"./data/users":11,"./interfaces/notificationtypes":12,"./logger":14,"./pushnotification":18,"./services/consumptionhorizon":20,"./services/network":21,"./services/typingindicator":22,"./session":23,"./synclist":25,"./user":27,"./util":30,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196,"twilio-mcs-client":214,"twilio-notifications":224,"twilio-sync":236,"twilsock":264}],"4":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s="/v1/typing",o=function(){function e(t){(0,i["default"])(this,e);var n=(t=t||{}).Chat||t.IPMessaging||t||{};this.region=n.region||t.region,this.baseUrl=n.apiUri||n.typingUri||(this.region&&"us1"!==this.region?"https://aim."+this.region+".twilio.com":"https://aim.twilio.com"),this.typingIndicatorUri=this.baseUrl+s,this.typingIndicatorTimeoutOverride=n.typingIndicatorTimeoutOverride,this.httpCacheIntervalOverride=n.httpCacheIntervalOverride,this.consumptionReportIntervalOverride=n.consumptionReportIntervalOverride,this.userInfosToSubscribeOverride=n.userInfosToSubscribeOverride,this.retryWhenThrottledOverride=n.retryWhenThrottledOverride,this.backoffConfigOverride=n.backoffConfigOverride}return(0,r["default"])(e,[{"key":"typingIndicatorTimeoutDefault","get":function(){return 5e3}},{"key":"httpCacheIntervalDefault","get":function(){return"PT5S"}},{"key":"consumptionReportIntervalDefault","get":function(){return"PT5S"}},{"key":"userInfosToSubscribeDefault","get":function(){return 100}},{"key":"retryWhenThrottledDefault","get":function(){return!0}},{"key":"backoffConfigDefault","get":function(){return{"min":1e3,"max":4e3,"maxAttemptsCount":3}}}]),e}();n.Configuration=o},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"5":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/core-js/json/stringify")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/set")),c=a(e("babel-runtime/core-js/map")),d=a(e("babel-runtime/core-js/object/get-prototype-of")),u=a(e("babel-runtime/helpers/classCallCheck")),p=a(e("babel-runtime/helpers/createClass")),f=a(e("babel-runtime/helpers/possibleConstructorReturn")),b=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var h=e("events"),m=e("../logger"),v=e("../channel");n.Channel=v.Channel;var g=e("../util/deferred"),_=e("../util"),y=m.Logger.scope("Channels"),w=function(e){function t(e){(0,u["default"])(this,t);var n=(0,f["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this));return n.services=e,n.channels=new c["default"],n.thumbstones=new l["default"],n.syncListFetched=!1,n.syncListRead=new g.Deferred,n}return(0,b["default"])(t,e),(0,p["default"])(t,[{"key":"getMap","value":function(){var e=this;return this.services.session.getMyChannelsId().then(function(t){return e.services.syncClient.map({"id":t,"mode":"open_existing"})})}},{"key":"addChannel","value":function(){var e=(0,o["default"])(r["default"].mark(function t(e){var n,a,i,o,l,c;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0,null!==(n=void 0===e.attributes?{}:e.attributes)){t.next=4;break}throw new Error("Attributes can't be null");case 4:if(n.constructor===Object){t.next=6;break}throw new Error("Attributes must be a valid JSON object");case 6:return t.next=8,this.services.session.addCommand("createChannel",{"friendlyName":e.friendlyName,"uniqueName":e.uniqueName,"type":e.isPrivate?"private":"public","attributes":(0,s["default"])(n)});case 8:if(a=t.sent,i="channelSid"in a?a.channelSid:null,o="channel"in a?a.channel:null,!(l=this.channels.get(i))){t.next=16;break}return t.next=15,l._subscribe();case 15:return t.abrupt("return",l);case 16:return c=new v.Channel(this.services,{"channel":o,"entityName":null,"uniqueName":null,"attributes":null,"createdBy":null,"friendlyName":null,"lastConsumedMessageIndex":null,"type":e.isPrivate?"private":"public","dateCreated":null,"dateUpdated":null},i),this.channels.set(c.sid,c),this.registerForEvents(c),t.next=21,c._subscribe();case 21:return this.emit("channelAdded",c),t.abrupt("return",c);case 23:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"fetchChannels","value":function(){var e,t=this;this.getMap().then((e=(0,o["default"])(r["default"].mark(function n(e){var a,s;return r["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.on("itemAdded",function(e){y.debug("itemAdded: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)}),e.on("itemRemoved",function(e){y.debug("itemRemoved: "+e.key);var n=e.key;t.syncListFetched||t.thumbstones.add(n);var a=t.channels.get(n);a&&("joined"!==a.status&&"invited"!==a.status||(a._setStatus("known","sync"),t.emit("channelLeft",a)),a.isPrivate&&(t.channels["delete"](n),t.emit("channelRemoved",a),a.emit("removed",a)))}),e.on("itemUpdated",function(e){y.debug("itemUpdated: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)}),a=[],n.next=6,t.services.syncList.getPage();case 6:(s=n.sent).items.forEach(function(e){a.push(t.upsertChannel("synclist",e.channel_sid,e))});case 9:if(!s.hasNextPage){n.next=16;break}return n.next=12,s.nextPage();case 12:(s=n.sent).items.forEach(function(e){a.push(t.upsertChannel("synclist",e.channel_sid,e))}),n.next=9;break;case 16:return t.syncListRead.set(!0),n.abrupt("return",i["default"].all(a));case 18:case"end":return n.stop()}},n,t)})),function(){return e.apply(this,arguments)})).then(function(){t.syncListFetched=!0,t.thumbstones.clear(),y.debug("Channels list fetched")}).then(function(){return t})["catch"](function(e){throw"disconnected"!=t.services.syncClient.connectionState&&y.error("Failed to get channels list",e),y.debug("ERROR: Failed to get channels list",e),e})}},{"key":"_wrapPaginator","value":function(e,t){var n=this;return t(e.items).then(function(a){return{"items":a,"hasNextPage":e.hasNextPage,"hasPrevPage":e.hasPrevPage,"nextPage":function(){return e.nextPage().then(function(e){return n._wrapPaginator(e,t)})},"prevPage":function(){return e.prevPage().then(function(e){return n._wrapPaginator(e,t)})}}})}},{"key":"getChannels","value":function(e){var t=this;return this.getMap().then(function(t){return t.getItems(e)}).then(function(e){return t._wrapPaginator(e,function(e){return i["default"].all(e.map(function(e){return t.upsertChannel("sync",e.key,e.value)}))})})}},{"key":"getChannel","value":function(e){var t=this;return this.getMap().then(function(t){return t.getItems({"key":e})}).then(function(e){return e.items.map(function(e){return t.upsertChannel("sync",e.key,e.value)})}).then(function(e){return e.length>0?e[0]:null})}},{"key":"pushChannel","value":function(e){var t=e.sid,n={"entityName":null,"lastConsumedMessageIndex":e.lastConsumedMessageIndex,"type":e.type,"status":e.status,"friendlyName":e.friendlyName,"dateUpdated":e.dateUpdated,"dateCreated":e.dateCreated,"uniqueName":e.uniqueName,"createdBy":e.createdBy,"attributes":e.attributes,"channel":e.channel,"notificationLevel":e.notificationLevel,"sid":t};return this.upsertChannel("chat",t,n)}},{"key":"upsertChannel","value":function(e,t,n){var a=this;y.trace("upsertChannel(sid="+t+", data=",n);var i=this.channels.get(t);if(i){if(y.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),void 0===i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e)if("joined"===n.status&&"joined"!==i.status){i._setStatus("joined",e);var r={};void 0!==n.notificationLevel&&(r.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(r.lastConsumedMessageIndex=n.lastConsumedMessageIndex),_.isDeepEqual(r,{})||i._update(r),i._subscribe().then(function(){a.emit("channelJoined",i)})}else if("invited"===n.status&&"invited"!==i.status){i._setStatus("invited",e);var s={};void 0!==n.notificationLevel&&(s.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(s.lastConsumedMessageIndex=n.lastConsumedMessageIndex),_.isDeepEqual(s,{})||i._update(s),i._subscribe().then(function(){a.emit("channelInvited",i)})}else"known"!==n.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"!==n.status&&"known"!==n.status||"private"!==n.type?i._update(n):i._subscribe():(i._setStatus("known",e),i._update(n),i._subscribe().then(function(){a.emit("channelLeft",i)}));else y.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{"sid":t,"data":n.status,"channel":i.status});return i._subscribe().then(function(){return i})}if("chat"!==e&&"synclist"!==e||!this.thumbstones.has(t))return y.trace("upsertChannel: creating local channel object with sid "+t,n),i=new v.Channel(this.services,n,t),this.channels.set(t,i),i._subscribe().then(function(){return a.registerForEvents(i),a.emit("channelAdded",i),"joined"===n.status?(i._setStatus("joined",e),a.emit("channelJoined",i)):"invited"===n.status&&(i._setStatus("invited",e),a.emit("channelInvited",i)),i});y.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{"key":"onChannelRemoved","value":function(e){var t=this.channels.get(e);t&&(this.channels["delete"](e),this.emit("channelRemoved",t))}},{"key":"registerForEvents","value":function(e){var t=this;e.on("removed",function(){return t.onChannelRemoved(e.sid)}),e.on("updated",function(e){return t.emit("channelUpdated",e)}),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",function(e){return t.emit("memberUpdated",e)}),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",function(e){return t.emit("messageUpdated",e)}),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(h.EventEmitter);n.Channels=w},{"../channel":1,"../logger":14,"../util":30,"../util/deferred":29,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/core-js/set":46,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"6":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("events"),f=e("../member"),b=e("../logger").Logger.scope("Members"),h=function(e){function t(e,n,a){(0,l["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return i.services=n,i.channel=e,i.members=a,i}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"unsubscribe","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"subscribe","value":function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({"id":e,"mode":"open_existing"}).then(function(e){e.on("itemAdded",function(e){b.debug(t.channel.sid+" itemAdded: "+e.item.key),t.upsertMember(e.item.key,e.item.value).then(function(e){t.emit("memberJoined",e)})}),e.on("itemRemoved",function(e){b.debug(t.channel.sid+" itemRemoved: "+e.key);var n=e.key;if(t.members.has(n)){var a=t.members.get(n);t.members["delete"](n),t.emit("memberLeft",a)}}),e.on("itemUpdated",function(e){b.debug(t.channel.sid+" itemUpdated: "+e.item.key),t.upsertMember(e.item.key,e.item.value)});var n=[],a=t;return e.getItems().then(function r(e){return e.items.forEach(function(e){n.push(a.upsertMember(e.key,e.value))}),e.hasNextPage?e.nextPage().then(r):null}).then(function(){return i["default"].all(n)}).then(function(){return e})})["catch"](function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&b.error("Failed to get roster object for channel",t.channel.sid,e),b.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e})}},{"key":"upsertMember","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e,n){var a,i=this;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this.members.get(e))){t.next=3;break}return t.abrupt("return",a._update(n));case 3:return a=new f.Member(this.services,this.channel,n,e),this.members.set(e,a),a.on("updated",function(e){return i.emit("memberUpdated",e)}),t.abrupt("return",a);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMembers","value":function(){var e=this;return this.rosterEntityPromise.then(function(){var t=[];return e.members.forEach(function(e){return t.push(e)}),t})}},{"key":"getMemberBySid","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n=this;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.rosterEntityPromise.then(function(){var t=n.members.get(e);if(!t)throw new Error("Member with SID "+e+" was not found");return t}));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMemberByIdentity","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n,a=this;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.abrupt("return",this.rosterEntityPromise.then(function(){if(a.members.forEach(function(t){t.identity===e&&(n=t)}),!n)throw new Error("Member with identity "+e+" was not found");return n}));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"add","value":function(e){return this.services.session.addCommand("addMemberV2",{"channelSid":this.channel.sid,"username":e})}},{"key":"invite","value":function(e){return this.services.session.addCommand("inviteMember",{"channelSid":this.channel.sid,"username":e})}},{"key":"removeByIdentity","value":function(e){return this.services.session.addCommand("removeMember",{"channelSid":this.channel.sid,"username":e})}},{"key":"removeBySid","value":function(e){return this.services.session.addCommand("removeMember",{"channelSid":this.channel.sid,"memberSid":e})}}]),t}(p.EventEmitter);n.Members=h},{"../logger":14,"../member":16,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"7":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/core-js/json/stringify")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/map")),c=a(e("babel-runtime/core-js/object/get-prototype-of")),d=a(e("babel-runtime/helpers/classCallCheck")),u=a(e("babel-runtime/helpers/createClass")),p=a(e("babel-runtime/helpers/possibleConstructorReturn")),f=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var b=e("events"),h=e("../logger"),m=e("../message"),v=h.Logger.scope("Messages"),g=function(e){function t(e,n){(0,d["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this));return a.channel=e,a.services=n,a.messagesByIndex=new l["default"],a.messagesListPromise=null,a}return(0,f["default"])(t,e),(0,u["default"])(t,[{"key":"subscribe","value":function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({"id":e,"mode":"open_existing"}).then(function(e){return e.on("itemAdded",function(e){v.debug(t.channel.sid+" itemAdded: "+e.item.index);var n=new m.Message(t.channel,t.services,e.item.index,e.item.value);t.messagesByIndex.has(n.index)?v.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.messagesByIndex.set(n.index,n),n.on("updated",function(e){return t.emit("messageUpdated",e)}),t.emit("messageAdded",n))}),e.on("itemRemoved",function(e){v.debug(t.channel.sid+" itemRemoved: "+e.index);var n=e.index;if(t.messagesByIndex.has(n)){var a=t.messagesByIndex.get(n);t.messagesByIndex["delete"](a.index),a.removeAllListeners("updated"),t.emit("messageRemoved",a)}}),e.on("itemUpdated",function(e){v.debug(t.channel.sid+" itemUpdated: "+e.item.index);var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.value)}),e})["catch"](function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&v.error("Failed to get messages object for channel",t.channel.sid,e),v.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e})}},{"key":"unsubscribe","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"send","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v.debug("Sending text message",e,n),null!==n){t.next=3;break}throw new Error("Attributes can't be null");case 3:if(n.constructor===Object){t.next=5;break}throw new Error("Attributes must be a valid JSON object");case 5:return t.abrupt("return",this.services.session.addCommand("sendMessage",{"channelSid":this.channel.sid,"text":e,"attributes":(0,r["default"])(n)}));case 6:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sendMedia","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v.debug("Sending media message",e,i),i.constructor===Object){t.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:if(n=void 0,!(e instanceof FormData)){t.next=11;break}return v.debug("Sending media message as FormData",e,i),t.next=8,this.services.mcsClient.postFormData(e);case 8:n=t.sent,t.next=18;break;case 11:if(v.debug("Sending media message as SendMediaOptions",e,i),(a=e).contentType&&a.media){t.next=15;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 15:return t.next=17,this.services.mcsClient.post(a.contentType,a.media);case 17:n=t.sent;case 18:return t.abrupt("return",this.services.session.addCommand("sendMediaMessage",{"channelSid":this.channel.sid,"mediaSid":n.sid,"attributes":(0,r["default"])(i)}));case 19:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMessages","value":function(e,t,n){return t=void 0!==t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{"key":"wrapPaginator","value":function(e,t,n){var a=this,i="desc"===e,r=function(){return t.nextPage().then(function(t){return a.wrapPaginator(e,t,n)})},s=function(){return t.prevPage().then(function(t){return a.wrapPaginator(e,t,n)})};return n(t.items).then(function(e){return{"items":e.sort(function(e,t){return e.index-t.index}),"hasPrevPage":i?t.hasNextPage:t.hasPrevPage,"hasNextPage":i?t.hasPrevPage:t.hasNextPage,"prevPage":i?r:s,"nextPage":i?s:r}})}},{"key":"_upsertMessage","value":function(e,t){var n=this,a=this.messagesByIndex.get(e);if(a)return a;var i=new m.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",function(e){return n.emit("messageUpdated",e)}),i}},{"key":"_getMessages","value":function(e,t,n){var a=this;t=void 0!==t?t:"end",e=e||30;var r="backwards"===n?"desc":"asc";return this.messagesListPromise.then(function(n){return n.getItems({"from":"end"!==t?t:void 0,"pageSize":e,"order":r})}).then(function(e){return a.wrapPaginator(r,e,function(e){return i["default"].all(e.map(function(e){return a._upsertMessage(e.index,e.value)}))})})}}]),t}(b.EventEmitter);n.Messages=g},{"../logger":14,"../message":17,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"8":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("../util/index"),c=e("../restpaginator"),d=e("../channeldescriptor"),u=function(){function e(t,n,a){(0,s["default"])(this,e),this.client=t,this.services=n,this.url=a}return(0,o["default"])(e,[{"key":"getChannels","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e,n,a=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new l.UriBuilder(this.url).arg("PageToken",r.pageToken).build(),t.next=3,this.services.network.get(e);case 3:return n=t.sent,t.abrupt("return",new c.RestPaginator(n.body.channels.map(function(e){return new d.ChannelDescriptor(a.client,e)}),function(e){return a.getChannels({"pageToken":e})},n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelBySid","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new l.UriBuilder(this.url).path(e).build(),t.next=3,
this.services.network.get(n);case 3:return a=t.sent,t.abrupt("return",new d.ChannelDescriptor(this.client,a.body));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelByUniqueName","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new l.UriBuilder(this.url).path(e).build(),t.next=3,this.services.network.get(n);case 3:return a=t.sent,t.abrupt("return",new d.ChannelDescriptor(this.client,a.body));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.PublicChannels=u},{"../channeldescriptor":2,"../restpaginator":19,"../util/index":30,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"9":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("../util/index"),c=e("../restpaginator"),d=e("../channeldescriptor"),u=function(){function e(t,n,a){(0,s["default"])(this,e),this.client=t,this.services=n,this.url=a}return(0,o["default"])(e,[{"key":"getChannels","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e,n,a=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new l.UriBuilder(this.url).arg("PageToken",r.pageToken).build(),t.next=3,this.services.network.get(e);case 3:return n=t.sent,t.abrupt("return",new c.RestPaginator(n.body.channels.map(function(e){return new d.ChannelDescriptor(a.client,e)}),function(e){return a.getChannels({"pageToken":e})},n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.UserChannels=u},{"../channeldescriptor":2,"../restpaginator":19,"../util/index":30,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"10":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("../util/index"),c=e("../restpaginator"),d=e("../userdescriptor"),u=function(){function e(t,n){(0,s["default"])(this,e),this.services=t,this.url=n}return(0,o["default"])(e,[{"key":"getUserDescriptor","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new l.UriBuilder(this.url).path(e).build(),t.next=3,this.services.network.get(n);case 3:return a=t.sent,t.abrupt("return",new d.UserDescriptor(this.services,a.body));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelUserDescriptors","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a,r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new l.UriBuilder(this.url).arg("ChannelSid",e).arg("PageToken",s.pageToken).build(),t.next=3,this.services.network.get(n);case 3:return a=t.sent,t.abrupt("return",new c.RestPaginator(a.body.users.map(function(e){return new d.UserDescriptor(r.services,e)}),function(t){return r.getChannelUserDescriptors(e,{"pageToken":t})},a.body.meta.prev_token,a.body.meta.next_token));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.UserDescriptors=u},{"../restpaginator":19,"../userdescriptor":28,"../util/index":30,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"11":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/map")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("events"),f=e("../user"),b=e("./userdescriptors"),h=function(e){function t(e){(0,l["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return n.services=e,n.fifoStack=[],n.fifoStackMaxLength=100,n.myself=new f.User(null,null,n.services),n.myself.on("updated",function(e){return n.emit("userUpdated",e)}),n.myself.on("userSubscribed",function(){return n.emit("userSubscribed",n.myself)}),n.myself.on("userUnsubscribed",function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()}),n.services=e,n.subscribedUsers=new s["default"],n.userDescriptorsPromise=n.services.session.getSessionLinks().then(function(e){return n.userDescriptors=new b.UserDescriptors({"users":n,"network":n.services.network},e.usersUrl),n.userDescriptors}),n.services.session.getMaxUserInfosToSubscribe().then(function(e){n.fifoStackMaxLength=e}),n.services.session.getUsersData().then(function(e){return n.myself.identity=e.identity,n.myself.entityName=e.user,n.myself._ensureFetched()}),n}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"handleUnsubscribeUser","value":function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers["delete"](e.identity);var t=-1;this.fifoStack.find(function(n,a){return n==e.identity&&(t=a,!0)})&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{"key":"handleSubscribeUser","value":function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{"key":"getUser","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a,r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.getUsersData();case 2:return t.next=4,this.myself._ensureFetched();case 4:if(e!=this.myself.identity){t.next=6;break}return t.abrupt("return",this.myself);case 6:if(n=this.subscribedUsers.get(e)){t.next=19;break}if(s){t.next=13;break}return t.next=11,this.getUserDescriptor(e);case 11:a=t.sent,s=a._getDescriptor().sync_unique_name;case 13:return(n=new f.User(e,s,this.services)).on("updated",function(e){return r.emit("userUpdated",e)}),n.on("userSubscribed",function(){return r.handleSubscribeUser(n)}),n.on("userUnsubscribed",function(){return r.handleUnsubscribeUser(n)}),t.next=19,n._ensureFetched();case 19:return t.abrupt("return",n);case 20:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUserDescriptor","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.userDescriptorsPromise;case 2:return t.abrupt("return",this.userDescriptors.getUserDescriptor(e));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelUserDescriptors","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.userDescriptorsPromise;case 2:return t.abrupt("return",this.userDescriptors.getChannelUserDescriptors(e));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getSubscribedUsers","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.getUsersData();case 2:return t.next=4,this.myself._ensureFetched();case 4:return e=[this.myself],this.subscribedUsers.forEach(function(t){return e.push(t)}),t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(p.EventEmitter);n.Users=h},{"../user":27,"./userdescriptors":10,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"12":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0});var r=function s(){(0,i["default"])(this,s)};n.NotificationTypes=r,r.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",r.NEW_MESSAGE="twilio.channel.new_message",r.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",r.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",r.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",r.CONSUMPTION_UPDATE="twilio.channel.consumption_update"},{"babel-runtime/helpers/classCallCheck":50}],"13":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0});var r=function s(){(0,i["default"])(this,s)};n.ResponseCodes=r,r.HTTP_200_OK=200,r.HTTP_400_BAD_REQUEST=400,r.HTTP_404_NOT_FOUND=404,r.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,r.LIST_NOT_FOUND=54150},{"babel-runtime/helpers/classCallCheck":50}],"14":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return[(new Date).toISOString()+" Chat "+e+":"].concat((0,o["default"])(t))}var r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("loglevel"),c=function(){function e(t){(0,r["default"])(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return(0,s["default"])(e,[{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.trace.apply(null,i(this.prefix+"T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i(this.prefix+"D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i(this.prefix+"I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i(this.prefix+"W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i(this.prefix+"E",t))}}],[{"key":"scope","value":function(t){return new e(t)}},{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.trace.apply(null,i("T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i("I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i("W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i("E",t))}}]),e}();n.Logger=c},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"loglevel":199}],"15":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(){function e(t,n){(0,s["default"])(this,e),this.mcsMedia=null,this.services=n,this.state={"sid":t.sid,"filename":t.filename,"contentType":t.contentType,"size":t.size}}return(0,o["default"])(e,[{"key":"getContentUrl","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sid","get":function(){return this.state.sid}},{"key":"filename","get":function(){return this.state.filename}},{"key":"contentType","get":function(){return this.state.contentType}},{"key":"size","get":function(){return this.state.size}}]),e}();n.Media=l},{"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"16":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/json/stringify")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/number/is-integer")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("./util"),h=e("./logger").Logger.scope("Member"),m=function(e){function t(e,n,a,i){(0,c["default"])(this,t);var r=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));if(r.channel=n,r.services=e,r.state={"attributes":b.parseAttributes(a.attributes,"Retrieved malformed attributes from the server for member: "+i,h),"dateCreated":a.dateCreated?b.parseTime(a.dateCreated):null,"dateUpdated":a.dateCreated?b.parseTime(a.dateUpdated):null,"sid":i,"typingTimeout":null,"isTyping":!1,"identity":a.identity||null,"roleSid":a.roleSid||null,"lastConsumedMessageIndex":(0,o["default"])(a.lastConsumedMessageIndex)?a.lastConsumedMessageIndex:null,"lastConsumptionTimestamp":a.lastConsumptionTimestamp?b.parseTime(a.lastConsumptionTimestamp):null,"type":a.type||"chat","userInfo":a.userInfo},!a.identity&&!a.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return r}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"_startTyping","value":function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout(function(){return t._endTyping()},e),this}},{"key":"_endTyping","value":function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{"key":"_update","value":function(e){var t=[],n=b.parseAttributes(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,h);e.attributes&&!b.isDeepEqual(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var a=b.parseTime(e.dateUpdated);e.dateUpdated&&a.getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=a,t.push("dateUpdated"));var i=b.parseTime(e.dateCreated);if(e.dateCreated&&i.getTime()!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!(0,o["default"])(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var r=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===r.getTime()||(this.state.lastConsumptionTimestamp=r,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{"member":this,"updateReasons":t}),this}},{"key":"getUserDescriptor","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUser","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateAttributes","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==e){t.next=8;break}throw new Error("Attributes can't be null");case 8:if(e.constructor===Object){t.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:return t.next=12,this.services.session.addCommand("editMemberAttributes",{"channelSid":this.channel.sid,"memberSid":this.sid,"attributes":(0,i["default"])(e)});case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sid","get":function(){return this.state.sid}},{"key":"attributes","get":function(){return this.state.attributes}},{"key":"dateCreated","get":function(){return this.state.dateCreated}},{"key":"dateUpdated","get":function(){return this.state.dateUpdated}},{"key":"identity","get":function(){return this.state.identity}},{"key":"isTyping","get":function(){return this.state.isTyping}},{"key":"lastConsumedMessageIndex","get":function(){return this.state.lastConsumedMessageIndex}},{"key":"lastConsumptionTimestamp","get":function(){return this.state.lastConsumptionTimestamp}},{"key":"roleSid","get":function(){return this.state.roleSid}},{"key":"type","get":function(){return this.state.type}}]),t}(f.EventEmitter);n.Member=m},{"./logger":14,"./util":30,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/number/is-integer":36,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"17":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){try{return t?JSON.parse(t):{}}catch(t){return v.warn("Got malformed attributes for the message",e),{}}}var r=a(e("babel-runtime/core-js/json/stringify")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("./util/index"),h=e("./logger"),m=e("./media"),v=h.Logger.scope("Message"),g=function(e){function t(e,n,a,r){(0,c["default"])(this,t);var s=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return s.channel=e,s.services=n,s.state={"sid":r.sid,"index":a,"author":null==r.author?null:r.author,"body":r.text,"timestamp":r.timestamp?new Date(r.timestamp):null,"dateUpdated":r.dateUpdated?new Date(r.dateUpdated):null,"lastUpdatedBy":r.lastUpdatedBy?r.lastUpdatedBy:null,"attributes":i(r.sid,r.attributes),"type":r.type?r.type:"text","media":r.type&&"media"===r.type&&r.media?new m.Media(r.media,s.services):null,"memberSid":null==r.memberSid?null:r.memberSid},s}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"_update","value":function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("timestamp"));var n=i(this.sid,e.attributes);b.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{"message":this,"updateReasons":t})}},{"key":"getMember","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){var e,n,a=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=null,!this.state.memberSid){t.next=5;break}return t.next=4,this.channel.getMemberBySid(this.memberSid)["catch"](function(){return v.debug('Member with sid "'+a.memberSid+'" not found for message '+a.sid),null});case 4:e=t.sent;case 5:if(e||!this.state.author){t.next=9;break}return t.next=8,this.channel.getMemberByIdentity(this.state.author)["catch"](function(){return v.debug('Member with identity "'+a.author+'" not found for message '+a.sid),null});case 8:e=t.sent;case 9:if(!e){t.next=11;break}return t.abrupt("return",e);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{"channelSid":this.channel.sid,"messageIdx":this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateBody","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new Error("Body <String> is a required parameter for updateBody");case 2:return t.next=4,this.services.session.addCommand("editMessage",{"channelSid":this.channel.sid,"messageIdx":this.index.toString(),"text":e});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateAttributes","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==e){t.next=8;break}throw new Error("Attributes can't be null");case 8:if(e.constructor===Object){t.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:return t.next=12,this.services.session.addCommand("editMessageAttributes",{"channelSid":this.channel.sid,"messageIdx":this.index,"attributes":(0,r["default"])(e)});case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sid","get":function(){return this.state.sid}},{"key":"author","get":function(){return this.state.author}},{"key":"body","get":function(){return"media"===this.type?null:this.state.body}},{"key":"dateUpdated","get":function(){return this.state.dateUpdated}},{"key":"index","get":function(){return this.state.index}},{"key":"lastUpdatedBy","get":function(){return this.state.lastUpdatedBy}},{"key":"timestamp","get":function(){return this.state.timestamp}},{"key":"attributes","get":function(){return this.state.attributes}},{"key":"type","get":function(){return this.state.type}},{"key":"media","get":function(){return this.state.media}},{"key":"memberSid","get":function(){return this.state.memberSid}}]),t}(f.EventEmitter);n.Message=g},{"./logger":14,"./media":15,"./util/index":30,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"18":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0}),n.PushNotification=function r(e){(0,i["default"])(this,r),this.title=e.title||null,this.body=e.body||null,this.sound=e.sound||null,this.badge=e.badge||null,this.action=e.action||null,this.type=e.type||null,this.data=e.data||{}}},{"babel-runtime/helpers/classCallCheck":50}],"19":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var o=function(){function e(t,n,a,i){(0,r["default"])(this,e),this.state={"prevToken":a,"nextToken":i,"source":n,"items":t}}return(0,s["default"])(e,[{"key":"nextPage","value":function(){return this.hasNextPage?this.state.source(this.state.nextToken):i["default"].reject(new Error("No next page"))}},{"key":"prevPage","value":function(){return this.hasPrevPage?this.state.source(this.state.prevToken):i["default"].reject(new Error("No previous page"))}},{"key":"hasNextPage","get":function(){return!!this.state.nextToken}},{"key":"hasPrevPage","get":function(){return!!this.state.prevToken}},{"key":"items","get":function(){return this.state.items}}]),e}();n.RestPaginator=o},{"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"20":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/core-js/map")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("../sessionerror"),c=function(){function e(t){(0,o["default"])(this,e),this.services=t,this.consumptionHorizonRequests=new r["default"],this.consumptionHorizonUpdateTimer=null}return(0,s["default"])(e,[{"key":"getReportInterval","value":function(){return this.services.session.getConsumptionReportInterval().then(function(e){return 1e3*e})}},{"key":"delayedSendConsumptionHorizon","value":function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout(function(){t.sendConsumptionReport(!1)},e))}},{"key":"sendConsumptionReport","value":function(e){var t=this,n=[],a=new r["default"];this.consumptionHorizonRequests.forEach(function(e,t){n.push(e.entry),a.set(t,e.promises)}),n.length>0&&this.services.session.addCommand("consumptionReportV2",{"report":n}).then(function(e){return t.processConsumptionReportResponse(e,a)})["catch"](function(e){return t.processConsumptionReportError(e,a)}),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{"key":"processConsumptionReportResponse","value":function(e,t){e&&e.report&&Array.isArray(e.report)&&e.report.length>0&&e.report.forEach(function(e){var n=e;if(t.has(n.channelSid)){var a=null;void 0!==n.unreadMessagesCount&&null!=n.unreadMessagesCount&&(a=n.unreadMessagesCount),t.get(n.channelSid).forEach(function(e){return e.resolve(a)}),t["delete"](n.channelSid)}}),this.processConsumptionReportError(new l.SessionError("Error while setting LastConsumedMessageIndex",null),t)}},{"key":"processConsumptionReportError","value":function(e,t){t.forEach(function(t){return t.forEach(function(t){return t.reject(e)})})}},{"key":"updateLastConsumedMessageIndexForChannel","value":function(e,t){var n=this;return new i["default"](function(a,i){n.addPendingConsumptionHorizonRequest(e,{"channelSid":e,"messageIdx":t},{"resolve":a,"reject":i}),n.getReportInterval().then(function(e){return n.delayedSendConsumptionHorizon(e)})})}},{"key":"advanceLastConsumedMessageIndexForChannel","value":function(e,t,n){var a=this,r=this.consumptionHorizonRequests.get(e);return new i["default"](function(i,s){r&&r.entry?r.entry.messageIdx>=t?a.addPendingConsumptionHorizonRequest(e,r.entry,{"resolve":i,"reject":s}):a.addPendingConsumptionHorizonRequest(e,{"channelSid":e,"messageIdx":t},{"resolve":i,"reject":s}):null!==n&&t<n?a.addPendingConsumptionHorizonRequest(e,{"channelSid":e,"messageIdx":n},{"resolve":i,"reject":s}):a.addPendingConsumptionHorizonRequest(e,{"channelSid":e,"messageIdx":t},{"resolve":i,"reject":s}),a.getReportInterval().then(function(e){return a.delayedSendConsumptionHorizon(e)})})}},{"key":"addPendingConsumptionHorizonRequest","value":function(e,t,n){if(this.consumptionHorizonRequests.has(e)){var a=this.consumptionHorizonRequests.get(e);a.entry=t,a.promises.push(n)}else this.consumptionHorizonRequests.set(e,{"entry":t,"promises":[n]})}}]),e}();n.ConsumptionHorizon=c},{"../sessionerror":24,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"21":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/promise")),o=a(e("babel-runtime/core-js/get-iterator")),l=a(e("babel-runtime/helpers/slicedToArray")),c=a(e("babel-runtime/core-js/object/assign")),d=a(e("babel-runtime/core-js/map")),u=a(e("babel-runtime/helpers/classCallCheck")),p=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("operation-retrier"),b=function(){function e(t,n){var a=this;(0,u["default"])(this,e),this.config=t,this.services=n,this.cache=new d["default"],this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then(function(e){a.cacheLifetime=1e3*e,a.cleanupCache()})}return(0,p["default"])(e,[{"key":"backoffConfig","value":function(){return(0,c["default"])(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{"key":"retryWhenThrottled","value":function(){
return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{"key":"isExpired","value":function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{"key":"cleanupCache","value":function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,o["default"])(this.cache);!(e=(a=i.next()).done);e=!0){var r=a.value,s=(0,l["default"])(r,2),c=s[0],d=s[1];this.isExpired(d.timestamp)&&this.cache["delete"](c)}}catch(e){t=!0,n=e}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}0===this.cache.size&&clearInterval(this.timer)}},{"key":"pokeTimer","value":function(){var e=this;this.timer=this.timer||setInterval(function(){return e.cleanupCache()},2*this.cacheLifetime)}},{"key":"executeWithRetry","value":function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new s["default"](function(a,i){var r=[502,503,504];n&&r.push(429);var s=new f.Retrier(t.backoffConfig());s.on("attempt",function(){e().then(function(e){return s.succeeded(e)})["catch"](function(e){r.indexOf(e.status)>-1?s.failed(e):"Twilsock disconnected"===e.message?s.failed(e):(s.removeAllListeners(),s.cancel(),i(e))})}),s.on("succeeded",function(e){a(e)}),s.on("cancelled",function(e){return i(e)}),s.on("failed",function(e){return i(e)}),s.start()})}},{"key":"get","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a,r,s=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.cache.get(e))||this.isExpired(n.timestamp)){t.next=3;break}return t.abrupt("return",n.response);case 3:return a={},t.next=6,this.executeWithRetry(function(){return s.services.transport.get(e,a)},this.retryWhenThrottled());case 6:return r=t.sent,this.cache.set(e,{"response":r,"timestamp":Date.now()}),this.pokeTimer(),t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.Network=b},{"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/regenerator":58,"operation-retrier":201}],"22":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/core-js/map")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("../logger"),c=e("../interfaces/notificationtypes"),d=l.Logger.scope("TypingIndicator"),u=function(){function e(t,n,a){(0,s["default"])(this,e),this.config=t,this.services=n,this.getChannel=a,this.serviceTypingTimeout=null,this.sentUpdates=new r["default"]}return(0,o["default"])(e,[{"key":"initialize","value":function(){var e=this;this.services.notificationClient.subscribe(c.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",function(t,n){t===c.NotificationTypes.TYPING_INDICATOR&&e.handleRemoteTyping(n)})}},{"key":"handleRemoteTyping","value":function(e){var t=this;d.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then(function(n){n&&n.members.forEach(function(n){n.identity===e.identity&&n._startTyping(t.typingTimeout)})})["catch"](function(e){throw d.error(e),e})}},{"key":"send","value":function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?i["default"].resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{"key":"_send","value":function(e){var t=this;d.trace("Sending typing indicator");var n=this.config.typingIndicatorUri,a="ChannelSid="+e;return this.services.transport.post(n,{"Content-Type":"application/x-www-form-urlencoded"},a).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})["catch"](function(e){throw d.error("Failed to send typing indicator:",e),e})}},{"key":"typingTimeout","get":function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();n.TypingIndicator=u},{"../interfaces/notificationtypes":12,"../logger":14,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"23":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/promise")),o=a(e("babel-runtime/core-js/map")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("uuid"),u=e("platform"),p=e("./interfaces/responsecodes"),f=e("./logger"),b=e("./sessionerror"),h=e("./util/deferred"),m=e("iso8601-duration"),v=e("./../package.json").version,g=f.Logger.scope("Session"),_=function w(){(0,c["default"])(this,w)},y=function(){function e(t,n){(0,c["default"])(this,e);var a="undefined"!=typeof navigator?u.parse(navigator.userAgent):u;this.services=t,this.config=n,this.sessionInfo=new h.Deferred,this.currentContext={},this.pendingCommands=new o["default"],this.sessionStreamPromise=null,this.endpointPlatform=["js",v,a.os,a.name,a.version].join("|")}return(0,l["default"])(e,[{"key":"handleContextUpdate","value":function(e){var t;g.info("Session context updated"),g.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some(function(e){return!t.hasOwnProperty(e)})||(g.info("new session context accepted"),this.sessionInfo.set(e))}},{"key":"initialize","value":function(){var e=this,t={"type":"IpMsgSession","apiVersion":"3","endpointPlatform":this.endpointPlatform};return this.sessionStreamPromise=this.services.syncClient.list({"purpose":"com.twilio.rtd.ipmsg","context":t}).then(function(t){return g.info("Session created",t.sid),t.on("itemAdded",function(t){return e.processCommandResponse(t.item)}),t.on("itemUpdated",function(t){return e.processCommandResponse(t.item)}),t.on("contextUpdated",function(t){return e.handleContextUpdate(t.context)}),t})["catch"](function(e){throw g.error("Failed to create session",e),e}),this.sessionStreamPromise}},{"key":"addCommand","value":function(e,t){return this.processCommand(e,t)}},{"key":"processCommand","value":function(e,t){var n=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new _;return i.request=t,i.request.action=e,i.commandId=d.v4(),g.info("Adding command: ",e,i.commandId),g.debug("command arguments:",t,a),new s["default"](function(r,s){n.sessionStreamPromise.then(function(e){return n.pendingCommands.set(i.commandId,{"resolve":r,"reject":s,"commandId":i.commandId,"request":i.request}),e.push(i)}).then(function(){return g.debug("Command accepted by server",i.commandId)})["catch"](function(o){n.pendingCommands["delete"](i.commandId),g.error("Failed to add a command to the session",o),o.code!=p.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&o.code!==p.ResponseCodes.LIST_NOT_FOUND||!a?s(new Error("Can't add command: "+o.message)):(g.info("recreating session..."),n.initialize(),r(n.processCommand(e,t,!1)))})})}},{"key":"processCommandResponse","value":function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(t.response.status===p.ResponseCodes.HTTP_200_OK){g.debug("Command succeeded: ",t);var a=this.pendingCommands.get(n).resolve;this.pendingCommands["delete"](n),a(t.response)}else{g.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands["delete"](n),i(new b.SessionError(t.response.statusText,t.response.status))}}}},{"key":"getSessionContext","value":function(){return this.sessionStreamPromise.then(function(e){return e.getContext()})}},{"key":"getSessionLinks","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sessionInfo.promise;case 2:return e=t.sent,t.abrupt("return",{"publicChannelsUrl":this.config.baseUrl+e.links.publicChannelsUrl,"myChannelsUrl":this.config.baseUrl+e.links.myChannelsUrl,"typingUrl":this.config.baseUrl+e.links.typingUrl,"syncListUrl":this.config.baseUrl+e.links.syncListUrl,"usersUrl":this.config.baseUrl+e.links.usersUrl,"mediaServiceUrl":e.links.mediaServiceUrl});case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getChannelsId","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sessionInfo.promise;case 2:return e=t.sent,t.abrupt("return",e.channels);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMyChannelsId","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sessionInfo.promise;case 2:return e=t.sent,t.abrupt("return",e.myChannels);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getMaxUserInfosToSubscribe","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sessionInfo.promise;case 2:return e=t.sent,t.abrupt("return",this.config.userInfosToSubscribeOverride||e.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getUsersData","value":function(){return this.sessionInfo.promise.then(function(e){return{"user":e.userInfo,"identity":e.identity}})}},{"key":"getConsumptionReportInterval","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e,n;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSessionContext();case 2:return e=t.sent,n=this.config.consumptionReportIntervalOverride||e.consumptionReportInterval||this.config.consumptionReportIntervalDefault,t.prev=4,t.abrupt("return",m.toSeconds(m.parse(n)));case 8:return t.prev=8,t.t0=t["catch"](4),g.error("Failed to parse consumption report interval",n,"using default value",this.config.consumptionReportIntervalDefault),t.abrupt("return",m.toSeconds(m.parse(this.config.consumptionReportIntervalDefault)));case 12:case"end":return t.stop()}},t,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}()},{"key":"getHttpCacheInterval","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){var e,n;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSessionContext();case 2:return e=t.sent,n=this.config.httpCacheIntervalOverride||e.httpCacheInterval||this.config.httpCacheIntervalDefault,t.prev=4,t.abrupt("return",m.toSeconds(m.parse(n)));case 8:return t.prev=8,t.t0=t["catch"](4),g.error("Failed to parse cache interval",n,"using default value",this.config.httpCacheIntervalDefault),t.abrupt("return",m.toSeconds(m.parse(this.config.httpCacheIntervalDefault)));case 12:case"end":return t.stop()}},t,this,[[4,8]])}));return function(){return e.apply(this,arguments)}}()},{"key":"identity","get":function(){return this.sessionInfo.current.identity}},{"key":"reachabilityEnabled","get":function(){return this.currentContext.reachabilityEnabled}}]),e}();n.Session=y},{"./../package.json":288,"./interfaces/responsecodes":13,"./logger":14,"./sessionerror":24,"./util/deferred":29,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58,"iso8601-duration":197,"platform":203,"uuid":283}],"24":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/create")),r=a(e("babel-runtime/core-js/object/set-prototype-of")),s=a(e("babel-runtime/core-js/array/from")),o=a(e("babel-runtime/core-js/reflect/construct")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=function(e){function t(e,n){(0,c["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return a.name=a.constructor.name,a.message=e,a.code=n,Error.captureStackTrace?Error.captureStackTrace(a,a.constructor):a.stack=(new Error).stack,a}return(0,u["default"])(t,e),t}(function(e){function t(){var t=(0,o["default"])(e,(0,s["default"])(arguments));return(0,r["default"])(t,(0,l["default"])(this)),t}return t.prototype=(0,i["default"])(e.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),r["default"]?(0,r["default"])(t,e):t.__proto__=e,t}(Error));n.SessionError=p},{"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/object/set-prototype-of":43,"babel-runtime/core-js/reflect/construct":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"25":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("./util/index"),c=e("./restpaginator"),d=e("./synclistdescriptor"),u=function(){function e(t){(0,s["default"])(this,e),this.services=t}return(0,o["default"])(e,[{"key":"getPage","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a,r,s=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},t.next=3,this.services.session.getSessionLinks();case 3:return n=t.sent,a=new l.UriBuilder(n.syncListUrl).arg("PageToken",e.pageToken).build(),t.next=7,this.services.network.get(a);case 7:return r=t.sent,t.abrupt("return",new c.RestPaginator(r.body.channels.map(function(e){return new d.SyncListDescriptor(e)}),function(e){return s.getPage({"pageToken":e})},r.body.meta.previous_token,r.body.meta.next_token));case 9:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.SyncList=u},{"./restpaginator":19,"./synclistdescriptor":26,"./util/index":30,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"26":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0}),n.SyncListDescriptor=function r(e){(0,i["default"])(this,r),this.descriptor=e,this.channel_sid=e.channel_sid,this.status=e.status,this.channel=e.channel,this.messages=e.messages,this.roster=e.roster,this.lastConsumedMessageIndex=e.last_consumed_message_index,this.notificationLevel=e.notification_level,this.status=e.status}},{"babel-runtime/helpers/classCallCheck":50}],"27":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/json/stringify")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/promise")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("./logger"),h=e("./util"),m=b.Logger.scope("User"),v=function(e){function t(e,n,a){(0,c["default"])(this,t);var i=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return i.subscribed="initializing",i.setMaxListeners(0),i.services=a,i.state={"identity":e,"entityName":n,"friendlyName":null,"attributes":{},"online":null,"notifiable":null},i}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"_update","value":function(e,t){var n=[];switch(m.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var a={};try{a=JSON.parse(t.value)}catch(e){m.warn("Retrieved malformed attributes from the server for user: "+this.state.identity)}h.isDeepEqual(this.state.attributes,a)||(this.state.attributes=a,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{"user":this,"updateReasons":n})}},{"key":"_updateReachabilityInfo","value":function(e,t){var n=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t)["catch"](function(e){m.warn("Failed to get reachability info for ",n.state.identity,e)}):o["default"].resolve()}},{"key":"_fetch","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){var e=this;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.entityName){t.next=2;break}return t.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({"id":this.state.entityName,"mode":"open_existing","includeItems":!0}).then(function(t){return e.entity=t,t.on("itemUpdated",function(t){return m.debug(e.state.entityName+" ("+e.state.identity+") itemUpdated: "+t.item.key),e._update(t.item.key,t.item.value)}),o["default"].all([t.get("friendlyName").then(function(t){return e._update(t.key,t.value)}),t.get("attributes").then(function(t){return e._update(t.key,t.value)}),e._updateReachabilityInfo(t,function(t){return e._update(t.key,t.value)})])}).then(function(){return m.debug("Fetched for",e.identity),e.subscribed="subscribed",e.emit("userSubscribed",e),e})["catch"](function(t){throw e.promiseToFetch=null,t}),t.abrupt("return",this.promiseToFetch);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_ensureFetched","value":function(){return this.promiseToFetch||this._fetch()}},{"key":"updateAttributes","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==e){t.next=8;break}throw new Error("Attributes can't be null");case 8:if(e.constructor===Object){t.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:if("unsubscribed"!=this.subscribed){t.next=12;break}throw new Error("Can't modify unsubscribed object");case 12:return t.next=14,this.services.session.addCommand("editUserAttributes",{"username":this.state.identity,"attributes":(0,i["default"])(e)});case 14:return t.abrupt("return",this);case 15:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateFriendlyName","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||"string"==typeof e){t.next=2;break}throw new Error("friendlyName must be string or empty");case 2:if("unsubscribed"!=this.subscribed){t.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return t.next=6,this.services.session.addCommand("editUserFriendlyName",{"username":this.state.identity,"friendlyName":e});case 6:return t.abrupt("return",this);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"unsubscribe","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"identity","get":function(){return this.state.identity},"set":function(e){this.state.identity=e}},{"key":"entityName","set":function(e){this.state.entityName=e}},{"key":"attributes","get":function(){return this.state.attributes}},{"key":"friendlyName","get":function(){return this.state.friendlyName}},{"key":"online","get":function(){return this.state.online}},{"key":"notifiable","get":function(){return this.state.notifiable}},{"key":"isSubscribed","get":function(){return"subscribed"==this.subscribed}}]),t}(f.EventEmitter);n.User=v},{"./logger":14,"./util":30,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"28":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=e("./logger").Logger.scope("UserDescriptor"),o=function(){function e(t,n){(0,i["default"])(this,e),this.services=t,this.descriptor=n,this.identity=n.identity,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(e){s.warn("Failed to parse user attributes",e)}return{}}(n.attributes),this.online=n.is_online,this.notifiable=n.is_notifiable}return(0,r["default"])(e,[{"key":"subscribe","value":function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{"key":"_getDescriptor","value":function(){return this.descriptor}}]),e}();n.UserDescriptor=o},{"./logger":14,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"29":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var o=function(){function e(){var t=this;(0,r["default"])(this,e),this._promise=new i["default"](function(e,n){t._resolve=e,t._reject=n})}return(0,s["default"])(e,[{"key":"update","value":function(e){this._resolve(e)}},{"key":"set","value":function(e){this.current=e,this._resolve(e)}},{"key":"fail","value":function(e){this._reject(e)}},{"key":"promise","get":function(){return this._promise}}]),e}();n.Deferred=o},{"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"30":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass")),s=a(e("babel-runtime/core-js/json/stringify"));Object.defineProperty(n,"__esModule",{"value":!0});var o=e("rfc6902");n.isDeepEqual=function(e,t){return 0===o.createPatch(e,t).length},n.deepClone=function(e){return JSON.parse((0,s["default"])(e))},n.parseToNumber=function(e){return void 0===e||isNaN(Number(e))?null:Number(e)},n.parseTime=function(e){try{return new Date(e)}catch(e){return null}},n.parseAttributes=function(e,t,n){var a={};if(e)try{a=JSON.parse(e)}catch(e){n.warn(t)}return a};var l=function(){function e(t){(0,i["default"])(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,r["default"])(e,[{"key":"arg","value":function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{"key":"path","value":function(e){return this.paths.push(encodeURIComponent(e)),this}},{"key":"build","value":function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();n.UriBuilder=l},{"babel-runtime/core-js/json/stringify":34,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"rfc6902":208}],"31":[function(e,t){t.exports={"default":e("core-js/library/fn/array/from"),"__esModule":!0}},{"core-js/library/fn/array/from":60}],"32":[function(e,t){t.exports={"default":e("core-js/library/fn/get-iterator"),"__esModule":!0}},{"core-js/library/fn/get-iterator":61}],"33":[function(e,t){t.exports={"default":e("core-js/library/fn/is-iterable"),"__esModule":!0}},{"core-js/library/fn/is-iterable":62}],"34":[function(e,t){t.exports={"default":e("core-js/library/fn/json/stringify"),"__esModule":!0}},{"core-js/library/fn/json/stringify":63}],"35":[function(e,t){t.exports={"default":e("core-js/library/fn/map"),"__esModule":!0}},{"core-js/library/fn/map":64}],"36":[function(e,t){t.exports={"default":e("core-js/library/fn/number/is-integer"),"__esModule":!0}},{"core-js/library/fn/number/is-integer":65}],"37":[function(e,t){t.exports={"default":e("core-js/library/fn/object/assign"),"__esModule":!0}},{"core-js/library/fn/object/assign":66}],"38":[function(e,t){t.exports={"default":e("core-js/library/fn/object/create"),"__esModule":!0}},{"core-js/library/fn/object/create":67}],"39":[function(e,t){t.exports={"default":e("core-js/library/fn/object/define-property"),"__esModule":!0}},{"core-js/library/fn/object/define-property":68}],"40":[function(e,t){t.exports={"default":e("core-js/library/fn/object/get-own-property-descriptor"),"__esModule":!0}},{"core-js/library/fn/object/get-own-property-descriptor":69}],"41":[function(e,t){t.exports={"default":e("core-js/library/fn/object/get-prototype-of"),"__esModule":!0}},{"core-js/library/fn/object/get-prototype-of":70}],"42":[function(e,t){t.exports={"default":e("core-js/library/fn/object/keys"),"__esModule":!0}},{"core-js/library/fn/object/keys":71}],"43":[function(e,t){t.exports={"default":e("core-js/library/fn/object/set-prototype-of"),"__esModule":!0}},{"core-js/library/fn/object/set-prototype-of":72}],"44":[function(e,t){t.exports={"default":e("core-js/library/fn/promise"),"__esModule":!0}},{"core-js/library/fn/promise":73}],"45":[function(e,t){t.exports={"default":e("core-js/library/fn/reflect/construct"),"__esModule":!0}},{"core-js/library/fn/reflect/construct":74}],"46":[function(e,t){t.exports={"default":e("core-js/library/fn/set"),"__esModule":!0}},{"core-js/library/fn/set":75}],"47":[function(e,t){t.exports={"default":e("core-js/library/fn/symbol"),"__esModule":!0}},{"core-js/library/fn/symbol":76}],"48":[function(e,t){t.exports={"default":e("core-js/library/fn/symbol/iterator"),"__esModule":!0}},{"core-js/library/fn/symbol/iterator":77}],"49":[function(e,t,n){"use strict";n.__esModule=!0;var a,i=(a=e("../core-js/promise"))&&a.__esModule?a:{"default":a};n["default"]=function(e){return function(){var t=e.apply(this,arguments);return new i["default"](function(e,n){return function a(r,s){try{var o=t[r](s),l=o.value}catch(e){return void n(e)}if(!o.done)return i["default"].resolve(l).then(function(e){a("next",e)},function(e){a("throw",e)});e(l)}("next")})}}},{"../core-js/promise":44}],"50":[function(e,t,n){"use strict";n.__esModule=!0,n["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],"51":[function(e,t,n){"use strict";n.__esModule=!0;var a,i=(a=e("../core-js/object/define-property"))&&a.__esModule?a:{"default":a};n["default"]=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,i["default"])(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}()},{"../core-js/object/define-property":39}],"52":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var i=a(e("../core-js/object/get-prototype-of")),r=a(e("../core-js/object/get-own-property-descriptor"));n["default"]=function s(e,t,n){null===e&&(e=Function.prototype);var a=(0,r["default"])(e,t);if(void 0===a){var o=(0,i["default"])(e);return null===o?void 0:s(o,t,n)}if("value"in a)return a.value;var l=a.get;return void 0!==l?l.call(n):void 0}},{"../core-js/object/get-own-property-descriptor":40,"../core-js/object/get-prototype-of":41}],"53":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var i=a(e("../core-js/object/set-prototype-of")),r=a(e("../core-js/object/create")),s=a(e("../helpers/typeof"));n["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s["default"])(t)));e.prototype=(0,r["default"])(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(i["default"]?(0,i["default"])(e,t):e.__proto__=t)}},{"../core-js/object/create":38,"../core-js/object/set-prototype-of":43,"../helpers/typeof":57}],"54":[function(e,t,n){"use strict";n.__esModule=!0;var a,i=(a=e("../helpers/typeof"))&&a.__esModule?a:{"default":a};n["default"]=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i["default"])(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":57}],"55":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var i=a(e("../core-js/is-iterable")),r=a(e("../core-js/get-iterator"));n["default"]=function(e,t){if(Array.isArray(e))return e;if((0,i["default"])(Object(e)))return function(e,t){var n=[],a=!0,i=!1,s=void 0;try{for(var o,l=(0,r["default"])(e);!(a=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{!a&&l["return"]&&l["return"]()}finally{if(i)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},{"../core-js/get-iterator":32,"../core-js/is-iterable":33}],"56":[function(e,t,n){"use strict";n.__esModule=!0;var a,i=(a=e("../core-js/array/from"))&&a.__esModule?a:{"default":a};n["default"]=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i["default"])(e)}},{"../core-js/array/from":31}],"57":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var i=a(e("../core-js/symbol/iterator")),r=a(e("../core-js/symbol")),s="function"==typeof r["default"]&&"symbol"==typeof i["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof r["default"]&&e.constructor===r["default"]&&e!==r["default"].prototype?"symbol":typeof e};n["default"]="function"==typeof r["default"]&&"symbol"===s(i["default"])?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof r["default"]&&e.constructor===r["default"]&&e!==r["default"].prototype?"symbol":void 0===e?"undefined":s(e)}},{"../core-js/symbol":47,"../core-js/symbol/iterator":48}],"58":[function(e,t){t.exports=e("regenerator-runtime")},{"regenerator-runtime":204}],"59":[function(){},{}],"60":[function(e,t){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":93,"../../modules/es6.array.from":168,"../../modules/es6.string.iterator":183}],"61":[function(e,t){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":166,"../modules/es6.string.iterator":183,"../modules/web.dom.iterable":195}],"62":[function(e,t){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":167,"../modules/es6.string.iterator":183,"../modules/web.dom.iterable":195}],"63":[function(e,t){var n=e("../../modules/_core"),a=n.JSON||(n.JSON={"stringify":JSON.stringify})
;t.exports=function(){return a.stringify.apply(a,arguments)}},{"../../modules/_core":93}],"64":[function(e,t){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":93,"../modules/es6.map":170,"../modules/es6.object.to-string":179,"../modules/es6.string.iterator":183,"../modules/es7.map.from":185,"../modules/es7.map.of":186,"../modules/es7.map.to-json":187,"../modules/web.dom.iterable":195}],"65":[function(e,t){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":93,"../../modules/es6.number.is-integer":171}],"66":[function(e,t){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":93,"../../modules/es6.object.assign":172}],"67":[function(e,t){e("../../modules/es6.object.create");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.create(e,t)}},{"../../modules/_core":93,"../../modules/es6.object.create":173}],"68":[function(e,t){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,a){return n.defineProperty(e,t,a)}},{"../../modules/_core":93,"../../modules/es6.object.define-property":174}],"69":[function(e,t){e("../../modules/es6.object.get-own-property-descriptor");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},{"../../modules/_core":93,"../../modules/es6.object.get-own-property-descriptor":175}],"70":[function(e,t){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":93,"../../modules/es6.object.get-prototype-of":176}],"71":[function(e,t){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":93,"../../modules/es6.object.keys":177}],"72":[function(e,t){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":93,"../../modules/es6.object.set-prototype-of":178}],"73":[function(e,t){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":93,"../modules/es6.object.to-string":179,"../modules/es6.promise":180,"../modules/es6.string.iterator":183,"../modules/es7.promise.finally":188,"../modules/es7.promise.try":189,"../modules/web.dom.iterable":195}],"74":[function(e,t){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":93,"../../modules/es6.reflect.construct":181}],"75":[function(e,t){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),e("../modules/es7.set.of"),e("../modules/es7.set.from"),t.exports=e("../modules/_core").Set},{"../modules/_core":93,"../modules/es6.object.to-string":179,"../modules/es6.set":182,"../modules/es6.string.iterator":183,"../modules/es7.set.from":190,"../modules/es7.set.of":191,"../modules/es7.set.to-json":192,"../modules/web.dom.iterable":195}],"76":[function(e,t){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":93,"../../modules/es6.object.to-string":179,"../../modules/es6.symbol":184,"../../modules/es7.symbol.async-iterator":193,"../../modules/es7.symbol.observable":194}],"77":[function(e,t){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":163,"../../modules/es6.string.iterator":183,"../../modules/web.dom.iterable":195}],"78":[function(e,t){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],"79":[function(e,t){t.exports=function(){}},{}],"80":[function(e,t){t.exports=function(e,t,n,a){if(!(e instanceof t)||void 0!==a&&a in e)throw TypeError(n+": incorrect invocation!");return e}},{}],"81":[function(e,t){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":114}],"82":[function(e,t){var n=e("./_for-of");t.exports=function(e,t){var a=[];return n(e,!1,a.push,a,t),a}},{"./_for-of":103}],"83":[function(e,t){var n=e("./_to-iobject"),a=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,r,s){var o,l=n(t),c=a(l.length),d=i(s,c);if(e&&r!=r){for(;c>d;)if((o=l[d++])!=o)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===r)return e||d||0;return!e&&-1}}},{"./_to-absolute-index":153,"./_to-iobject":155,"./_to-length":156}],"84":[function(e,t){var n=e("./_ctx"),a=e("./_iobject"),i=e("./_to-object"),r=e("./_to-length"),s=e("./_array-species-create");t.exports=function(e,t){var o=1==e,l=2==e,c=3==e,d=4==e,u=6==e,p=5==e||u,f=t||s;return function(t,s,b){for(var h,m,v=i(t),g=a(v),_=n(s,b,3),y=r(g.length),w=0,k=o?f(t,y):l?f(t,0):void 0;y>w;w++)if((p||w in g)&&(m=_(h=g[w],w,v),e))if(o)k[w]=m;else if(m)switch(e){case 3:return!0;case 5:return h;case 6:return w;case 2:k.push(h)}else if(d)return!1;return u?-1:c||d?d:k}}},{"./_array-species-create":86,"./_ctx":95,"./_iobject":110,"./_to-length":156,"./_to-object":157}],"85":[function(e,t){var n=e("./_is-object"),a=e("./_is-array"),i=e("./_wks")("species");t.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":112,"./_is-object":114,"./_wks":164}],"86":[function(e,t){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":85}],"87":[function(e,t){"use strict";var n=e("./_a-function"),a=e("./_is-object"),i=e("./_invoke"),r=[].slice,s={};t.exports=Function.bind||function(e){var t=n(this),o=r.call(arguments,1),l=function(){var n=o.concat(r.call(arguments));return this instanceof l?function(e,t,n){if(!(t in s)){for(var a=[],i=0;i<t;i++)a[i]="a["+i+"]";s[t]=Function("F,a","return new F("+a.join(",")+")")}return s[t](e,n)}(t,n.length,n):i(t,n,e)};return a(t.prototype)&&(l.prototype=t.prototype),l}},{"./_a-function":78,"./_invoke":109,"./_is-object":114}],"88":[function(e,t){var n=e("./_cof"),a=e("./_wks")("toStringTag"),i="Arguments"==n(function(){return arguments}());t.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?r:i?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":89,"./_wks":164}],"89":[function(e,t){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],"90":[function(e,t){"use strict";var n=e("./_object-dp").f,a=e("./_object-create"),i=e("./_redefine-all"),r=e("./_ctx"),s=e("./_an-instance"),o=e("./_for-of"),l=e("./_iter-define"),c=e("./_iter-step"),d=e("./_set-species"),u=e("./_descriptors"),p=e("./_meta").fastKey,f=e("./_validate-collection"),b=u?"_s":"size",h=function(e,t){var n,a=p(t);if("F"!==a)return e._i[a];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={"getConstructor":function(e,t,l,c){var d=e(function(e,n){s(e,d,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[b]=0,null!=n&&o(n,l,e[c],e)});return i(d.prototype,{"clear":function(){for(var e=f(this,t),n=e._i,a=e._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete n[a.i];e._f=e._l=void 0,e[b]=0},"delete":function(e){var n=f(this,t),a=h(n,e);if(a){var i=a.n,r=a.p;delete n._i[a.i],a.r=!0,r&&(r.n=i),i&&(i.p=r),n._f==a&&(n._f=i),n._l==a&&(n._l=r),n[b]--}return!!a},"forEach":function(e){f(this,t);for(var n,a=r(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(a(n.v,n.k,this);n&&n.r;)n=n.p},"has":function(e){return!!h(f(this,t),e)}}),u&&n(d.prototype,"size",{"get":function(){return f(this,t)[b]}}),d},"def":function(e,t,n){var a,i,r=h(e,t);return r?r.v=n:(e._l=r={"i":i=p(t,!0),"k":t,"v":n,"p":a=e._l,"n":void 0,"r":!1},e._f||(e._f=r),a&&(a.n=r),e[b]++,"F"!==i&&(e._i[i]=r)),e},"getEntry":h,"setStrong":function(e,t,n){l(e,t,function(e,n){this._t=f(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?c(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,c(1))},n?"entries":"values",!n,!0),d(t)}}},{"./_an-instance":80,"./_ctx":95,"./_descriptors":97,"./_for-of":103,"./_iter-define":117,"./_iter-step":119,"./_meta":122,"./_object-create":126,"./_object-dp":127,"./_redefine-all":141,"./_set-species":146,"./_validate-collection":161}],"91":[function(e,t){var n=e("./_classof"),a=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},{"./_array-from-iterable":82,"./_classof":88}],"92":[function(e,t){"use strict";var n=e("./_global"),a=e("./_export"),i=e("./_meta"),r=e("./_fails"),s=e("./_hide"),o=e("./_redefine-all"),l=e("./_for-of"),c=e("./_an-instance"),d=e("./_is-object"),u=e("./_set-to-string-tag"),p=e("./_object-dp").f,f=e("./_array-methods")(0),b=e("./_descriptors");t.exports=function(e,t,h,m,v,g){var _=n[e],y=_,w=v?"set":"add",k=y&&y.prototype,C={};return b&&"function"==typeof y&&(g||k.forEach&&!r(function(){(new y).entries().next()}))?(y=t(function(t,n){c(t,y,e,"_c"),t._c=new _,null!=n&&l(n,v,t[w],t)}),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in k&&(!g||"clear"!=e)&&s(y.prototype,e,function(n,a){if(c(this,y,e),!t&&g&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,a);return t?this:i})}),g||p(y.prototype,"size",{"get":function(){return this._c.size}})):(y=m.getConstructor(t,e,v,w),o(y.prototype,h),i.NEED=!0),u(y,e),C[e]=y,a(a.G+a.W+a.F,C),g||m.setStrong(y,e,v),y}},{"./_an-instance":80,"./_array-methods":84,"./_descriptors":97,"./_export":101,"./_fails":102,"./_for-of":103,"./_global":104,"./_hide":106,"./_is-object":114,"./_meta":122,"./_object-dp":127,"./_redefine-all":141,"./_set-to-string-tag":147}],"93":[function(e,t){var n=t.exports={"version":"2.6.9"};"number"==typeof __e&&(__e=n)},{}],"94":[function(e,t){"use strict";var n=e("./_object-dp"),a=e("./_property-desc");t.exports=function(e,t,i){t in e?n.f(e,t,a(0,i)):e[t]=i}},{"./_object-dp":127,"./_property-desc":140}],"95":[function(e,t){var n=e("./_a-function");t.exports=function(e,t,a){if(n(e),void 0===t)return e;switch(a){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,i){return e.call(t,n,a,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":78}],"96":[function(e,t){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],"97":[function(e,t){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{"get":function(){return 7}}).a})},{"./_fails":102}],"98":[function(e,t){var n=e("./_is-object"),a=e("./_global").document,i=n(a)&&n(a.createElement);t.exports=function(e){return i?a.createElement(e):{}}},{"./_global":104,"./_is-object":114}],"99":[function(e,t){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],"100":[function(e,t){var n=e("./_object-keys"),a=e("./_object-gops"),i=e("./_object-pie");t.exports=function(e){var t=n(e),r=a.f;if(r)for(var s,o=r(e),l=i.f,c=0;o.length>c;)l.call(e,s=o[c++])&&t.push(s);return t}},{"./_object-gops":132,"./_object-keys":135,"./_object-pie":136}],"101":[function(e,t){var n=e("./_global"),a=e("./_core"),i=e("./_ctx"),r=e("./_hide"),s=e("./_has"),o=function(e,t,l){var c,d,u,p=e&o.F,f=e&o.G,b=e&o.S,h=e&o.P,m=e&o.B,v=e&o.W,g=f?a:a[t]||(a[t]={}),_=g.prototype,y=f?n:b?n[t]:(n[t]||{}).prototype;for(c in f&&(l=t),l)(d=!p&&y&&void 0!==y[c])&&s(g,c)||(u=d?y[c]:l[c],g[c]=f&&"function"!=typeof y[c]?l[c]:m&&d?i(u,n):v&&y[c]==u?function(e){var t=function(t,n,a){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,a)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(u):h&&"function"==typeof u?i(Function.call,u):u,h&&((g.virtual||(g.virtual={}))[c]=u,e&o.R&&_&&!_[c]&&r(_,c,u)))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,o.U=64,o.R=128,t.exports=o},{"./_core":93,"./_ctx":95,"./_global":104,"./_has":105,"./_hide":106}],"102":[function(e,t){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],"103":[function(e,t,n){var a=e("./_ctx"),i=e("./_iter-call"),r=e("./_is-array-iter"),s=e("./_an-object"),o=e("./_to-length"),l=e("./core.get-iterator-method"),c={},d={};(n=t.exports=function(e,t,n,u,p){var f,b,h,m,v=p?function(){return e}:l(e),g=a(n,u,t?2:1),_=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(r(v)){for(f=o(e.length);f>_;_++)if((m=t?g(s(b=e[_])[0],b[1]):g(e[_]))===c||m===d)return m}else for(h=v.call(e);!(b=h.next()).done;)if((m=i(h,g,b.value,t))===c||m===d)return m}).BREAK=c,n.RETURN=d},{"./_an-object":81,"./_ctx":95,"./_is-array-iter":111,"./_iter-call":115,"./_to-length":156,"./core.get-iterator-method":165}],"104":[function(e,t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],"105":[function(e,t){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],"106":[function(e,t){var n=e("./_object-dp"),a=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,i){return n.f(e,t,a(1,i))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":97,"./_object-dp":127,"./_property-desc":140}],"107":[function(e,t){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":104}],"108":[function(e,t){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{"get":function(){return 7}}).a})},{"./_descriptors":97,"./_dom-create":98,"./_fails":102}],"109":[function(e,t){t.exports=function(e,t,n){var a=void 0===n;switch(t.length){case 0:return a?e():e.call(n);case 1:return a?e(t[0]):e.call(n,t[0]);case 2:return a?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return a?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return a?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],"110":[function(e,t){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":89}],"111":[function(e,t){var n=e("./_iterators"),a=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||i[a]===e)}},{"./_iterators":120,"./_wks":164}],"112":[function(e,t){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":89}],"113":[function(e,t){var n=e("./_is-object"),a=Math.floor;t.exports=function(e){return!n(e)&&isFinite(e)&&a(e)===e}},{"./_is-object":114}],"114":[function(e,t){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],"115":[function(e,t){var n=e("./_an-object");t.exports=function(e,t,a,i){try{return i?t(n(a)[0],a[1]):t(a)}catch(t){var r=e["return"];throw void 0!==r&&n(r.call(e)),t}}},{"./_an-object":81}],"116":[function(e,t){"use strict";var n=e("./_object-create"),a=e("./_property-desc"),i=e("./_set-to-string-tag"),r={};e("./_hide")(r,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,s){e.prototype=n(r,{"next":a(1,s)}),i(e,t+" Iterator")}},{"./_hide":106,"./_object-create":126,"./_property-desc":140,"./_set-to-string-tag":147,"./_wks":164}],"117":[function(e,t){"use strict";var n=e("./_library"),a=e("./_export"),i=e("./_redefine"),r=e("./_hide"),s=e("./_iterators"),o=e("./_iter-create"),l=e("./_set-to-string-tag"),c=e("./_object-gpo"),d=e("./_wks")("iterator"),u=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,f,b,h,m,v){o(f,t,b);var g,_,y,w=function(e){if(!u&&e in T)return T[e];switch(e){case"keys":case"values":return function(){return new f(this,e)}}return function(){return new f(this,e)}},k=t+" Iterator",C="values"==h,x=!1,T=e.prototype,S=T[d]||T["@@iterator"]||h&&T[h],M=S||w(h),$=h?C?w("entries"):M:void 0,j="Array"==t&&T.entries||S;if(j&&(y=c(j.call(new e)))!==Object.prototype&&y.next&&(l(y,k,!0),n||"function"==typeof y[d]||r(y,d,p)),C&&S&&"values"!==S.name&&(x=!0,M=function(){return S.call(this)}),n&&!v||!u&&!x&&T[d]||r(T,d,M),s[t]=M,s[k]=p,h)if(g={"values":C?M:w("values"),"keys":m?M:w("keys"),"entries":$},v)for(_ in g)_ in T||i(T,_,g[_]);else a(a.P+a.F*(u||x),t,g);return g}},{"./_export":101,"./_hide":106,"./_iter-create":116,"./_iterators":120,"./_library":121,"./_object-gpo":133,"./_redefine":142,"./_set-to-string-tag":147,"./_wks":164}],"118":[function(e,t){var n=e("./_wks")("iterator"),a=!1;try{var i=[7][n]();i["return"]=function(){a=!0},Array.from(i,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!a)return!1;var i=!1;try{var r=[7],s=r[n]();s.next=function(){return{"done":i=!0}},r[n]=function(){return s},e(r)}catch(e){}return i}},{"./_wks":164}],"119":[function(e,t){t.exports=function(e,t){return{"value":t,"done":!!e}}},{}],"120":[function(e,t){t.exports={}},{}],"121":[function(e,t){t.exports=!0},{}],"122":[function(e,t){var n=e("./_uid")("meta"),a=e("./_is-object"),i=e("./_has"),r=e("./_object-dp").f,s=0,o=Object.isExtensible||function(){return!0},l=!e("./_fails")(function(){return o(Object.preventExtensions({}))}),c=function(e){r(e,n,{"value":{"i":"O"+ ++s,"w":{}}})},d=t.exports={"KEY":n,"NEED":!1,"fastKey":function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!o(e))return"F";if(!t)return"E";c(e)}return e[n].i},"getWeak":function(e,t){if(!i(e,n)){if(!o(e))return!0;if(!t)return!1;c(e)}return e[n].w},"onFreeze":function(e){return l&&d.NEED&&o(e)&&!i(e,n)&&c(e),e}}},{"./_fails":102,"./_has":105,"./_is-object":114,"./_object-dp":127,"./_uid":159}],"123":[function(e,t){var n=e("./_global"),a=e("./_task").set,i=n.MutationObserver||n.WebKitMutationObserver,r=n.process,s=n.Promise,o="process"==e("./_cof")(r);t.exports=function(){var e,t,l,c=function(){var n,a;for(o&&(n=r.domain)&&n.exit();e;){a=e.fn,e=e.next;try{a()}catch(n){throw e?l():t=void 0,n}}t=void 0,n&&n.enter()};if(o)l=function(){r.nextTick(c)};else if(!i||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);l=function(){d.then(c)}}else l=function(){a.call(n,c)};else{var u=!0,p=document.createTextNode("");new i(c).observe(p,{"characterData":!0}),l=function(){p.data=u=!u}}return function(n){var a={"fn":n,"next":void 0};t&&(t.next=a),e||(e=a,l()),t=a}}},{"./_cof":89,"./_global":104,"./_task":152}],"124":[function(e,t){"use strict";function n(e){var t,n;this.promise=new e(function(e,a){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=a}),this.resolve=a(t),this.reject=a(n)}var a=e("./_a-function");t.exports.f=function(e){return new n(e)}},{"./_a-function":78}],"125":[function(e,t){"use strict";var n=e("./_descriptors"),a=e("./_object-keys"),i=e("./_object-gops"),r=e("./_object-pie"),s=e("./_to-object"),o=e("./_iobject"),l=Object.assign;t.exports=!l||e("./_fails")(function(){var e={},t={},n=Symbol(),a="abcdefghijklmnopqrst";return e[n]=7,a.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=a})?function(e){for(var t=s(e),l=arguments.length,c=1,d=i.f,u=r.f;l>c;)for(var p,f=o(arguments[c++]),b=d?a(f).concat(d(f)):a(f),h=b.length,m=0;h>m;)p=b[m++],n&&!u.call(f,p)||(t[p]=f[p]);return t}:l},{"./_descriptors":97,"./_fails":102,"./_iobject":110,"./_object-gops":132,"./_object-keys":135,"./_object-pie":136,"./_to-object":157}],"126":[function(e,t){var n=e("./_an-object"),a=e("./_object-dps"),i=e("./_enum-bug-keys"),r=e("./_shared-key")("IE_PROTO"),s=function(){},o=function(){var t,n=e("./_dom-create")("iframe"),a=i.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object</script>"),t.close(),o=t.F;a--;)delete o.prototype[i[a]];return o()};t.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=n(e),i=new s,s.prototype=null,i[r]=e):i=o(),void 0===t?i:a(i,t)}},{"./_an-object":81,"./_dom-create":98,"./_enum-bug-keys":99,"./_html":107,"./_object-dps":128,"./_shared-key":148}],"127":[function(e,t,n){var a=e("./_an-object"),i=e("./_ie8-dom-define"),r=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(a(e),t=r(t,!0),a(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":81,"./_descriptors":97,"./_ie8-dom-define":108,"./_to-primitive":158}],"128":[function(e,t){var n=e("./_object-dp"),a=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){a(e);for(var r,s=i(t),o=s.length,l=0;o>l;)n.f(e,r=s[l++],t[r]);return e}},{"./_an-object":81,"./_descriptors":97,"./_object-dp":127,"./_object-keys":135}],"129":[function(e,t,n){var a=e("./_object-pie"),i=e("./_property-desc"),r=e("./_to-iobject"),s=e("./_to-primitive"),o=e("./_has"),l=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?c:function(e,t){if(e=r(e),t=s(t,!0),l)try{return c(e,t)}catch(e){}if(o(e,t))return i(!a.f.call(e,t),e[t])}},{"./_descriptors":97,"./_has":105,"./_ie8-dom-define":108,"./_object-pie":136,"./_property-desc":140,"./_to-iobject":155,"./_to-primitive":158}],"130":[function(e,t){var n=e("./_to-iobject"),a=e("./_object-gopn").f,i={}.toString,r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return r&&"[object Window]"==i.call(e)?function(e){try{return a(e)}catch(e){return r.slice()}}(e):a(n(e))}},{"./_object-gopn":131,"./_to-iobject":155}],"131":[function(e,t,n){var a=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return a(e,i)}},{"./_enum-bug-keys":99,"./_object-keys-internal":134}],"132":[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],"133":[function(e,t){var n=e("./_has"),a=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),r=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=a(e),n(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?r:null}},{"./_has":105,"./_shared-key":148,"./_to-object":157}],"134":[function(e,t){var n=e("./_has"),a=e("./_to-iobject"),i=e("./_array-includes")(!1),r=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var s,o=a(e),l=0,c=[];for(s in o)s!=r&&n(o,s)&&c.push(s);for(;t.length>l;)n(o,s=t[l++])&&(~i(c,s)||c.push(s));return c}},{"./_array-includes":83,"./_has":105,"./_shared-key":148,"./_to-iobject":155}],"135":[function(e,t){var n=e("./_object-keys-internal"),a=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,a)}},{"./_enum-bug-keys":99,"./_object-keys-internal":134}],"136":[function(e,t,n){n.f={}.propertyIsEnumerable},{}],"137":[function(e,t){var n=e("./_export"),a=e("./_core"),i=e("./_fails");t.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*i(function(){r(1)}),"Object",s)}},{"./_core":93,"./_export":101,"./_fails":102}],"138":[function(e,t){t.exports=function(e){try{return{"e":!1,"v":e()}}catch(e){return{"e":!0,"v":e}}}},{}],"139":[function(e,t){var n=e("./_an-object"),a=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),a(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":81,"./_is-object":114,"./_new-promise-capability":124}],"140":[function(e,t){t.exports=function(e,t){return{"enumerable":!(1&e),"configurable":!(2&e),"writable":!(4&e),"value":t}}},{}],"141":[function(e,t){var n=e("./_hide");t.exports=function(e,t,a){for(var i in t)a&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},{"./_hide":106}],"142":[function(e,t){t.exports=e("./_hide")},{"./_hide":106}],"143":[function(e,t){"use strict";var n=e("./_export"),a=e("./_a-function"),i=e("./_ctx"),r=e("./_for-of");t.exports=function(e){n(n.S,e,{"from":function(e){var t,n,s,o,l=arguments[1];return a(this),(t=void 0!==l)&&a(l),null==e?new this:(n=[],t?(s=0,o=i(l,arguments[2],2),r(e,!1,function(e){n.push(o(e,s++))})):r(e,!1,n.push,n),new this(n))}})}},{"./_a-function":78,"./_ctx":95,"./_export":101,"./_for-of":103}],"144":[function(e,t){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{"of":function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":101}],"145":[function(e,t){var n=e("./_is-object"),a=e("./_an-object"),i=function(e,t){if(a(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={"set":Object.setPrototypeOf||("__proto__"in{}?function(t,n,a){try{(a=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return i(e,t),n?e.__proto__=t:a(e,t),e}}({},!1):void 0),"check":i}},{"./_an-object":81,"./_ctx":95,"./_is-object":114,"./_object-gopd":129}],"146":[function(e,t){"use strict";var n=e("./_global"),a=e("./_core"),i=e("./_object-dp"),r=e("./_descriptors"),s=e("./_wks")("species");t.exports=function(e){var t="function"==typeof a[e]?a[e]:n[e];r&&t&&!t[s]&&i.f(t,s,{"configurable":!0,"get":function(){return this}})}},{"./_core":93,"./_descriptors":97,"./_global":104,"./_object-dp":127,"./_wks":164}],"147":[function(e,t){var n=e("./_object-dp").f,a=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!a(e=r?e:e.prototype,i)&&n(e,i,{"configurable":!0,"value":t})}},{"./_has":105,"./_object-dp":127,"./_wks":164}],"148":[function(e,t){var n=e("./_shared")("keys"),a=e("./_uid");t.exports=function(e){return n[e]||(n[e]=a(e))}},{"./_shared":149,"./_uid":159}],"149":[function(e,t){var n=e("./_core"),a=e("./_global"),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(t.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({"version":n.version,"mode":e("./_library")?"pure":"global","copyright":"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":93,"./_global":104,"./_library":121}],"150":[function(e,t){var n=e("./_an-object"),a=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[i])?t:a(r)}},{"./_a-function":78,"./_an-object":81,"./_wks":164}],"151":[function(e,t){var n=e("./_to-integer"),a=e("./_defined");t.exports=function(e){return function(t,i){var r,s,o=String(a(t)),l=n(i),c=o.length;return l<0||l>=c?e?"":void 0:(r=o.charCodeAt(l))<55296||r>56319||l+1===c||(s=o.charCodeAt(l+1))<56320||s>57343?e?o.charAt(l):r:e?o.slice(l,l+2):s-56320+(r-55296<<10)+65536}}},{"./_defined":96,"./_to-integer":154}],"152":[function(e,t){var n,a,i,r=e("./_ctx"),s=e("./_invoke"),o=e("./_html"),l=e("./_dom-create"),c=e("./_global"),d=c.process,u=c.setImmediate,p=c.clearImmediate,f=c.MessageChannel,b=c.Dispatch,h=0,m={},v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},g=function(e){v.call(e.data)};u&&p||(u=function(e){for(var t=[],a=1;arguments.length>a;)t.push(arguments[a++]);return m[++h]=function(){s("function"==typeof e?e:Function(e),t)},n(h),h},p=function(e){delete m[e]},"process"==e("./_cof")(d)?n=function(e){d.nextTick(r(v,e,1))}:b&&b.now?n=function(e){b.now(r(v,e,1))}:f?(i=(a=new f).port2,a.port1.onmessage=g,n=r(i.postMessage,i,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",g,!1)):n="onreadystatechange"in l("script")?function(e){o.appendChild(l("script")).onreadystatechange=function(){o.removeChild(this),v.call(e)}}:function(e){setTimeout(r(v,e,1),0)}),t.exports={"set":u,"clear":p}},{"./_cof":89,"./_ctx":95,"./_dom-create":98,"./_global":104,"./_html":107,"./_invoke":109}],"153":[function(e,t){var n=e("./_to-integer"),a=Math.max,i=Math.min;t.exports=function(e,t){return(e=n(e))<0?a(e+t,0):i(e,t)}},{"./_to-integer":154}],"154":[function(e,t){var n=Math.ceil,a=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?a:n)(e)}},{}],"155":[function(e,t){var n=e("./_iobject"),a=e("./_defined");t.exports=function(e){return n(a(e))}},{"./_defined":96,"./_iobject":110}],"156":[function(e,t){var n=e("./_to-integer"),a=Math.min;t.exports=function(e){return e>0?a(n(e),9007199254740991):0}},{"./_to-integer":154}],"157":[function(e,t){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":96}],"158":[function(e,t){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var a,i;if(t&&"function"==typeof(a=e.toString)&&!n(i=a.call(e)))return i;if("function"==typeof(a=e.valueOf)&&!n(i=a.call(e)))return i;if(!t&&"function"==typeof(a=e.toString)&&!n(i=a.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":114}],"159":[function(e,t){var n=0,a=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+a).toString(36))}},{}],"160":[function(e,t){var n=e("./_global").navigator;t.exports=n&&n.userAgent||""},{"./_global":104}],"161":[function(e,t){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":114}],"162":[function(e,t){var n=e("./_global"),a=e("./_core"),i=e("./_library"),r=e("./_wks-ext"),s=e("./_object-dp").f;t.exports=function(e){var t=a.Symbol||(a.Symbol=i?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{"value":r.f(e)})}},{"./_core":93,"./_global":104,"./_library":121,"./_object-dp":127,"./_wks-ext":163}],"163":[function(e,t,n){n.f=e("./_wks")},{"./_wks":164}],"164":[function(e,t){var n=e("./_shared")("wks"),a=e("./_uid"),i=e("./_global").Symbol,r="function"==typeof i;(t.exports=function(e){return n[e]||(n[e]=r&&i[e]||(r?i:a)("Symbol."+e))}).store=n},{"./_global":104,"./_shared":149,"./_uid":159}],"165":[function(e,t){var n=e("./_classof"),a=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[n(e)]}},{"./_classof":88,"./_core":93,"./_iterators":120,"./_wks":164}],"166":[function(e,t){var n=e("./_an-object"),a=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":81,"./_core":93,"./core.get-iterator-method":165}],"167":[function(e,t){var n=e("./_classof"),a=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||i.hasOwnProperty(n(t))}},{"./_classof":88,"./_core":93,"./_iterators":120,"./_wks":164}],"168":[function(e){"use strict";var t=e("./_ctx"),n=e("./_export"),a=e("./_to-object"),i=e("./_iter-call"),r=e("./_is-array-iter"),s=e("./_to-length"),o=e("./_create-property"),l=e("./core.get-iterator-method");n(n.S+n.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{"from":function(e){var n,c,d,u,p=a(e),f="function"==typeof this?this:Array,b=arguments.length,h=b>1?arguments[1]:void 0,m=void 0!==h,v=0,g=l(p);if(m&&(h=t(h,b>2?arguments[2]:void 0,2)),null==g||f==Array&&r(g))for(c=new f(n=s(p.length));n>v;v++)o(c,v,m?h(p[v],v):p[v]);else for(u=g.call(p),c=new f;!(d=u.next()).done;v++)o(c,v,m?i(u,h,[d.value,v],!0):d.value);return c.length=v,c}})},{"./_create-property":94,"./_ctx":95,"./_export":101,"./_is-array-iter":111,"./_iter-call":115,"./_iter-detect":118,"./_to-length":156,"./_to-object":157,"./core.get-iterator-method":165}],"169":[function(e,t){"use strict";var n=e("./_add-to-unscopables"),a=e("./_iter-step"),i=e("./_iterators"),r=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=r(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":79,"./_iter-define":117,"./_iter-step":119,"./_iterators":120,"./_to-iobject":155}],"170":[function(e,t){"use strict"
;var n=e("./_collection-strong"),a=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{"get":function(e){var t=n.getEntry(a(this,"Map"),e);return t&&t.v},"set":function(e,t){return n.def(a(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":92,"./_collection-strong":90,"./_validate-collection":161}],"171":[function(e){var t=e("./_export");t(t.S,"Number",{"isInteger":e("./_is-integer")})},{"./_export":101,"./_is-integer":113}],"172":[function(e){var t=e("./_export");t(t.S+t.F,"Object",{"assign":e("./_object-assign")})},{"./_export":101,"./_object-assign":125}],"173":[function(e){var t=e("./_export");t(t.S,"Object",{"create":e("./_object-create")})},{"./_export":101,"./_object-create":126}],"174":[function(e){var t=e("./_export");t(t.S+t.F*!e("./_descriptors"),"Object",{"defineProperty":e("./_object-dp").f})},{"./_descriptors":97,"./_export":101,"./_object-dp":127}],"175":[function(e){var t=e("./_to-iobject"),n=e("./_object-gopd").f;e("./_object-sap")("getOwnPropertyDescriptor",function(){return function(e,a){return n(t(e),a)}})},{"./_object-gopd":129,"./_object-sap":137,"./_to-iobject":155}],"176":[function(e){var t=e("./_to-object"),n=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return n(t(e))}})},{"./_object-gpo":133,"./_object-sap":137,"./_to-object":157}],"177":[function(e){var t=e("./_to-object"),n=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return n(t(e))}})},{"./_object-keys":135,"./_object-sap":137,"./_to-object":157}],"178":[function(e){var t=e("./_export");t(t.S,"Object",{"setPrototypeOf":e("./_set-proto").set})},{"./_export":101,"./_set-proto":145}],"179":[function(){},{}],"180":[function(e){"use strict";var t,n,a,i,r=e("./_library"),s=e("./_global"),o=e("./_ctx"),l=e("./_classof"),c=e("./_export"),d=e("./_is-object"),u=e("./_a-function"),p=e("./_an-instance"),f=e("./_for-of"),b=e("./_species-constructor"),h=e("./_task").set,m=e("./_microtask")(),v=e("./_new-promise-capability"),g=e("./_perform"),_=e("./_user-agent"),y=e("./_promise-resolve"),w=s.TypeError,k=s.process,C=k&&k.versions,x=C&&C.v8||"",T=s.Promise,S="process"==l(k),M=function(){},$=n=v.f,j=!!function(){try{var t=T.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(M,M)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(M)instanceof n&&0!==x.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),E=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var n=e._c;m(function(){for(var a=e._v,i=1==e._s,r=0,s=function(t){var n,r,s,o=i?t.ok:t.fail,l=t.resolve,c=t.reject,d=t.domain;try{o?(i||(2==e._h&&D(e),e._h=1),!0===o?n=a:(d&&d.enter(),n=o(a),d&&(d.exit(),s=!0)),n===t.promise?c(w("Promise-chain cycle")):(r=E(n))?r.call(n,l,c):l(n)):c(a)}catch(e){d&&!s&&d.exit(),c(e)}};n.length>r;)s(n[r++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){h.call(s,function(){var t,n,a,i=e._v,r=I(e);if(r&&(t=g(function(){S?k.emit("unhandledRejection",i,e):(n=s.onunhandledrejection)?n({"promise":e,"reason":i}):(a=s.console)&&a.error&&a.error("Unhandled promise rejection",i)}),e._h=S||I(e)?2:1),e._a=void 0,r&&t.e)throw t.v})},I=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){h.call(s,function(){var t;S?k.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({"promise":e,"reason":e._v})})},R=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");(t=E(e))?m(function(){var a={"_w":n,"_d":!1};try{t.call(e,o(L,a,1),o(R,a,1))}catch(e){R.call(a,e)}}):(n._v=e,n._s=1,A(n,!1))}catch(e){R.call({"_w":n,"_d":!1},e)}}};j||(T=function(e){p(this,T,"Promise","_h"),u(e),t.call(this);try{e(o(L,this,1),o(R,this,1))}catch(e){R.call(this,e)}},(t=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(T.prototype,{"then":function(e,t){var n=$(b(this,T));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=S?k.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},"catch":function(e){return this.then(void 0,e)}}),a=function(){var e=new t;this.promise=e,this.resolve=o(L,e,1),this.reject=o(R,e,1)},v.f=$=function(e){return e===T||e===i?new a(e):n(e)}),c(c.G+c.W+c.F*!j,{"Promise":T}),e("./_set-to-string-tag")(T,"Promise"),e("./_set-species")("Promise"),i=e("./_core").Promise,c(c.S+c.F*!j,"Promise",{"reject":function(e){var t=$(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(r||!j),"Promise",{"resolve":function(e){return y(r&&this===i?T:this,e)}}),c(c.S+c.F*!(j&&e("./_iter-detect")(function(e){T.all(e)["catch"](M)})),"Promise",{"all":function(e){var t=this,n=$(t),a=n.resolve,i=n.reject,r=g(function(){var n=[],r=0,s=1;f(e,!1,function(e){var o=r++,l=!1;n.push(void 0),s++,t.resolve(e).then(function(e){l||(l=!0,n[o]=e,--s||a(n))},i)}),--s||a(n)});return r.e&&i(r.v),n.promise},"race":function(e){var t=this,n=$(t),a=n.reject,i=g(function(){f(e,!1,function(e){t.resolve(e).then(n.resolve,a)})});return i.e&&a(i.v),n.promise}})},{"./_a-function":78,"./_an-instance":80,"./_classof":88,"./_core":93,"./_ctx":95,"./_export":101,"./_for-of":103,"./_global":104,"./_is-object":114,"./_iter-detect":118,"./_library":121,"./_microtask":123,"./_new-promise-capability":124,"./_perform":138,"./_promise-resolve":139,"./_redefine-all":141,"./_set-species":146,"./_set-to-string-tag":147,"./_species-constructor":150,"./_task":152,"./_user-agent":160,"./_wks":164}],"181":[function(e){var t=e("./_export"),n=e("./_object-create"),a=e("./_a-function"),i=e("./_an-object"),r=e("./_is-object"),s=e("./_fails"),o=e("./_bind"),l=(e("./_global").Reflect||{}).construct,c=s(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),d=!s(function(){l(function(){})});t(t.S+t.F*(c||d),"Reflect",{"construct":function(e,t){a(e),i(t);var s=arguments.length<3?e:a(arguments[2]);if(d&&!c)return l(e,t,s);if(e==s){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var u=[null];return u.push.apply(u,t),new(o.apply(e,u))}var p=s.prototype,f=n(r(p)?p:Object.prototype),b=Function.apply.call(e,f,t);return r(b)?b:f}})},{"./_a-function":78,"./_an-object":81,"./_bind":87,"./_export":101,"./_fails":102,"./_global":104,"./_is-object":114,"./_object-create":126}],"182":[function(e,t){"use strict";var n=e("./_collection-strong"),a=e("./_validate-collection");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{"add":function(e){return n.def(a(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":92,"./_collection-strong":90,"./_validate-collection":161}],"183":[function(e){"use strict";var t=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,n=this._t,a=this._i;return a>=n.length?{"value":void 0,"done":!0}:(e=t(n,a),this._i+=e.length,{"value":e,"done":!1})})},{"./_iter-define":117,"./_string-at":151}],"184":[function(e){"use strict";var t=e("./_global"),n=e("./_has"),a=e("./_descriptors"),i=e("./_export"),r=e("./_redefine"),s=e("./_meta").KEY,o=e("./_fails"),l=e("./_shared"),c=e("./_set-to-string-tag"),d=e("./_uid"),u=e("./_wks"),p=e("./_wks-ext"),f=e("./_wks-define"),b=e("./_enum-keys"),h=e("./_is-array"),m=e("./_an-object"),v=e("./_is-object"),g=e("./_to-object"),_=e("./_to-iobject"),y=e("./_to-primitive"),w=e("./_property-desc"),k=e("./_object-create"),C=e("./_object-gopn-ext"),x=e("./_object-gopd"),T=e("./_object-gops"),S=e("./_object-dp"),M=e("./_object-keys"),$=x.f,j=S.f,E=C.f,A=t.Symbol,P=t.JSON,I=P&&P.stringify,D=u("_hidden"),R=u("toPrimitive"),L={}.propertyIsEnumerable,N=l("symbol-registry"),O=l("symbols"),F=l("op-symbols"),z=Object.prototype,H="function"==typeof A&&!!T.f,U=t.QObject,B=!U||!U.prototype||!U.prototype.findChild,q=a&&o(function(){return 7!=k(j({},"a",{"get":function(){return j(this,"a",{"value":7}).a}})).a})?function(e,t,n){var a=$(z,t);a&&delete z[t],j(e,t,n),a&&e!==z&&j(z,t,a)}:j,G=function(e){var t=O[e]=k(A.prototype);return t._k=e,t},W=H&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},V=function(e,t,a){return e===z&&V(F,t,a),m(e),t=y(t,!0),m(a),n(O,t)?(a.enumerable?(n(e,D)&&e[D][t]&&(e[D][t]=!1),a=k(a,{"enumerable":w(0,!1)})):(n(e,D)||j(e,D,w(1,{})),e[D][t]=!0),q(e,t,a)):j(e,t,a)},Q=function(e,t){m(e);for(var n,a=b(t=_(t)),i=0,r=a.length;r>i;)V(e,n=a[i++],t[n]);return e},Y=function(e){var t=L.call(this,e=y(e,!0));return!(this===z&&n(O,e)&&!n(F,e))&&(!(t||!n(this,e)||!n(O,e)||n(this,D)&&this[D][e])||t)},K=function(e,t){if(e=_(e),t=y(t,!0),e!==z||!n(O,t)||n(F,t)){var a=$(e,t);return!a||!n(O,t)||n(e,D)&&e[D][t]||(a.enumerable=!0),a}},J=function(e){for(var t,a=E(_(e)),i=[],r=0;a.length>r;)n(O,t=a[r++])||t==D||t==s||i.push(t);return i},Z=function(e){for(var t,a=e===z,i=E(a?F:_(e)),r=[],s=0;i.length>s;)!n(O,t=i[s++])||a&&!n(z,t)||r.push(O[t]);return r};H||(r((A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(a){this===z&&t.call(F,a),n(this,D)&&n(this[D],e)&&(this[D][e]=!1),q(this,e,w(1,a))};return a&&B&&q(z,e,{"configurable":!0,"set":t}),G(e)}).prototype,"toString",function(){return this._k}),x.f=K,S.f=V,e("./_object-gopn").f=C.f=J,e("./_object-pie").f=Y,T.f=Z,a&&!e("./_library")&&r(z,"propertyIsEnumerable",Y,!0),p.f=function(e){return G(u(e))}),i(i.G+i.W+i.F*!H,{"Symbol":A});for(var X="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;X.length>ee;)u(X[ee++]);for(var te=M(u.store),ne=0;te.length>ne;)f(te[ne++]);i(i.S+i.F*!H,"Symbol",{"for":function(e){return n(N,e+="")?N[e]:N[e]=A(e)},"keyFor":function(e){if(!W(e))throw TypeError(e+" is not a symbol!");for(var t in N)if(N[t]===e)return t},"useSetter":function(){B=!0},"useSimple":function(){B=!1}}),i(i.S+i.F*!H,"Object",{"create":function(e,t){return void 0===t?k(e):Q(k(e),t)},"defineProperty":V,"defineProperties":Q,"getOwnPropertyDescriptor":K,"getOwnPropertyNames":J,"getOwnPropertySymbols":Z});var ae=o(function(){T.f(1)});i(i.S+i.F*ae,"Object",{"getOwnPropertySymbols":function(e){return T.f(g(e))}}),P&&i(i.S+i.F*(!H||o(function(){var e=A();return"[null]"!=I([e])||"{}"!=I({"a":e})||"{}"!=I(Object(e))})),"JSON",{"stringify":function(e){for(var t,n,a=[e],i=1;arguments.length>i;)a.push(arguments[i++]);if(n=t=a[1],(v(t)||void 0!==e)&&!W(e))return h(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!W(t))return t}),a[1]=t,I.apply(P,a)}}),A.prototype[R]||e("./_hide")(A.prototype,R,A.prototype.valueOf),c(A,"Symbol"),c(Math,"Math",!0),c(t.JSON,"JSON",!0)},{"./_an-object":81,"./_descriptors":97,"./_enum-keys":100,"./_export":101,"./_fails":102,"./_global":104,"./_has":105,"./_hide":106,"./_is-array":112,"./_is-object":114,"./_library":121,"./_meta":122,"./_object-create":126,"./_object-dp":127,"./_object-gopd":129,"./_object-gopn":131,"./_object-gopn-ext":130,"./_object-gops":132,"./_object-keys":135,"./_object-pie":136,"./_property-desc":140,"./_redefine":142,"./_set-to-string-tag":147,"./_shared":149,"./_to-iobject":155,"./_to-object":157,"./_to-primitive":158,"./_uid":159,"./_wks":164,"./_wks-define":162,"./_wks-ext":163}],"185":[function(e){e("./_set-collection-from")("Map")},{"./_set-collection-from":143}],"186":[function(e){e("./_set-collection-of")("Map")},{"./_set-collection-of":144}],"187":[function(e){var t=e("./_export");t(t.P+t.R,"Map",{"toJSON":e("./_collection-to-json")("Map")})},{"./_collection-to-json":91,"./_export":101}],"188":[function(e){"use strict";var t=e("./_export"),n=e("./_core"),a=e("./_global"),i=e("./_species-constructor"),r=e("./_promise-resolve");t(t.P+t.R,"Promise",{"finally":function(e){var t=i(this,n.Promise||a.Promise),s="function"==typeof e;return this.then(s?function(n){return r(t,e()).then(function(){return n})}:e,s?function(n){return r(t,e()).then(function(){throw n})}:e)}})},{"./_core":93,"./_export":101,"./_global":104,"./_promise-resolve":139,"./_species-constructor":150}],"189":[function(e){"use strict";var t=e("./_export"),n=e("./_new-promise-capability"),a=e("./_perform");t(t.S,"Promise",{"try":function(e){var t=n.f(this),i=a(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},{"./_export":101,"./_new-promise-capability":124,"./_perform":138}],"190":[function(e){e("./_set-collection-from")("Set")},{"./_set-collection-from":143}],"191":[function(e){e("./_set-collection-of")("Set")},{"./_set-collection-of":144}],"192":[function(e){var t=e("./_export");t(t.P+t.R,"Set",{"toJSON":e("./_collection-to-json")("Set")})},{"./_collection-to-json":91,"./_export":101}],"193":[function(e){e("./_wks-define")("asyncIterator")},{"./_wks-define":162}],"194":[function(e){e("./_wks-define")("observable")},{"./_wks-define":162}],"195":[function(e){e("./es6.array.iterator");for(var t=e("./_global"),n=e("./_hide"),a=e("./_iterators"),i=e("./_wks")("toStringTag"),r="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),s=0;s<r.length;s++){var o=r[s],l=t[o],c=l&&l.prototype;c&&!c[i]&&n(c,i,o),a[o]=a.Array}},{"./_global":104,"./_hide":106,"./_iterators":120,"./_wks":164,"./es6.array.iterator":169}],"196":[function(e,t){function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=d(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function a(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function i(e,t,n,i){var r,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]):(s=e._events=d(null),e._eventsCount=0),o){if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),!o.warned&&(r=a(e))&&r>0&&o.length>r){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else o=s[t]=n,++e._eventsCount;return e}function r(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function s(e,t,n){var a={"fired":!1,"wrapFn":void 0,"target":e,"type":t,"listener":n},i=p.call(r,a);return i.listener=n,a.wrapFn=i,i}function o(e,t,n){var a=e._events;if(!a)return[];var i=a[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):c(i,i.length):[]}function l(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function c(e,t){for(var n=new Array(t),a=0;a<t;++a)n[a]=e[a];return n}
// Copyright Joyent, Inc. and other Node contributors.
// The above copyright notice and this permission notice shall be included
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
var d=Object.create||function(e){var t=function(){};return t.prototype=e,new t},u=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},p=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0;var f,b=10;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{"value":0}),f=0===h.x}catch(e){f=!1}f?Object.defineProperty(n,"defaultMaxListeners",{"enumerable":!0,"get":function(){return b},"set":function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');b=e}}):n.defaultMaxListeners=b,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return a(this)},n.prototype.emit=function(e){var t,n,a,i,r,s,o="error"===e;if(s=this._events)o=o&&null==s.error;else if(!o)return!1;if(o){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=s[e]))return!1;var d="function"==typeof n;switch(a=arguments.length){case 1:!function(e,t,n){if(d)e.call(n);else for(var a=e.length,i=c(e,a),r=0;r<a;++r)i[r].call(n)}(n,0,this);break;case 2:!function(e,t,n,a){if(t)e.call(n,a);else for(var i=e.length,r=c(e,i),s=0;s<i;++s)r[s].call(n,a)}(n,d,this,arguments[1]);break;case 3:!function(e,t,n,a,i){if(t)e.call(n,a,i);else for(var r=e.length,s=c(e,r),o=0;o<r;++o)s[o].call(n,a,i)}(n,d,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,a,i,r){if(t)e.call(n,a,i,r);else for(var s=e.length,o=c(e,s),l=0;l<s;++l)o[l].call(n,a,i,r)}(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),r=1;r<a;r++)i[r-1]=arguments[r];!function(e,t,n,a){if(d)e.apply(n,a);else for(var i=e.length,r=c(e,i),s=0;s<i;++s)r[s].apply(n,a)}(n,0,this,i)}return!0},n.prototype.addListener=function(e,t){return i(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return i(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,s(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,s(this,e,t)),this},n.prototype.removeListener=function(e,t){var n,a,i,r,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(a=this._events))return this;if(!(n=a[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=d(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(e){for(var t=i,n=t+1,a=e.length;n<a;t+=1,n+=1)e[t]=e[n];e.pop()}(n),1===n.length&&(a[e]=n[0]),a.removeListener&&this.emit("removeListener",e,s||t)}return this},n.prototype.removeAllListeners=function(e){var t,n,a;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=d(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=d(null):delete n[e]),this;if(0===arguments.length){var i,r=u(n);for(a=0;a<r.length;++a)"removeListener"!==(i=r[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=d(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},n.prototype.listeners=function(e){return o(this,e,!0)},n.prototype.rawListeners=function(e){return o(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},n.prototype.listenerCount=l,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],"197":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=["weeks","years","months","days","hours","minutes","seconds"],i=n.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),r=n.parse=function(e){return e.match(i).slice(1).reduce(function(e,t,n){return e[a[n]]=parseFloat(t)||0,e},{})},s=n.end=function(e,t){var n=t?t.getTime():Date.now(),a=new Date(n);return a.setFullYear(a.getFullYear()+e.years),a.setMonth(a.getMonth()+e.months),a.setDate(a.getDate()+e.days),a.setHours(a.getHours()+e.hours),a.setMinutes(a.getMinutes()+e.minutes),a.setMilliseconds(a.getMilliseconds()+1e3*e.seconds),a.setDate(a.getDate()+7*e.weeks),a},o=n.toSeconds=function(e,t){var n=t?t.getTime():Date.now(),a=new Date(n);return(s(e,a).getTime()-a.getTime())/1e3};n["default"]={"end":s,"toSeconds":o,"pattern":i,"parse":r}},{}],"198":[function(e,t,n){var a,i;a=this,i=function(){return function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={"i":a,"l":!1,"exports":{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{"configurable":!1,"enumerable":!0,"get":a})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e){"use strict";e.exports=function(e){var t,n,a;for(t=1;t<arguments.length;t++)for(a in n=arguments[t])n.hasOwnProperty(a)&&(e[a]=n[a]);return e}},function(e,t,n){"use strict";var a=n(0);e.exports={"build":function(e,t){var n,i,r,s=t.plugins;for(n=0,i=s.length;n<i;n++)(r=s[n]).methods&&a(e,r.methods),r.properties&&Object.defineProperties(e,r.properties)},"hook":function(e,t,n){var a,i,r,s,o=e.config.plugins,l=[e.context];for(n&&(l=l.concat(n)),a=0,i=o.length;a<i;a++)s=o[a],(r=o[a][t])&&r.apply(s,l)}}},function(e){"use strict";function t(e){if(0===e.length)return e;var t,n,a=e.split(/[_-]/);if(1===a.length&&a[0][0].toLowerCase()===a[0][0])return e;for(n=a[0].toLowerCase(),t=1;t<a.length;t++)n=n+a[t].charAt(0).toUpperCase()+a[t].substring(1).toLowerCase();return n}t.prepended=function(e,n){return e+(n=t(n))[0].toUpperCase()+n.substring(1)},e.exports=t},function(e,t,n){"use strict";function a(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}var i=n(0),r=n(2);i(a.prototype,{"addState":function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},"addStateLifecycleNames":function(e){this.lifecycle.onEnter[e]=r.prepended("onEnter",e),this.lifecycle.onLeave[e]=r.prepended("onLeave",e),this.lifecycle.on[e]=r.prepended("on",e)},"addTransition":function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},"addTransitionLifecycleNames":function(e){this.lifecycle.onBefore[e]=r.prepended("onBefore",e),this.lifecycle.onAfter[e]=r.prepended("onAfter",e),this.lifecycle.on[e]=r.prepended("on",e)},"mapTransition":function(e){var t=e.name,n=e.from,a=e.to;return this.addState(n),"function"!=typeof a&&this.addState(a),this.addTransition(t),this.map[n][t]=e,e},"configureLifecycle":function(){return{"onBefore":{"transition":"onBeforeTransition"},"onAfter":{"transition":"onAfterTransition"},"onEnter":{"state":"onEnterState"},"onLeave":{"state":"onLeaveState"},"on":{"transition":"onTransition"}}},"configureInitTransition":function(e){return"string"==typeof e?this.mapTransition(i({},this.defaults.init,{"to":e,"active":!0})):"object"==typeof e?this.mapTransition(i({},this.defaults.init,e,{"active":!0})):(this.addState(this.defaults.init.from),this.defaults.init)},"configureData":function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},"configureMethods":function(e){return e||{}},"configurePlugins":function(e){var t,n,a;for(t=0,n=(e=e||[]).length;t<n;t++)"function"==typeof(a=e[t])&&(e[t]=a=a()),a.configure&&a.configure(this);return e},"configureTransitions":function(e){var t,n,a,i,r,s=this.defaults.wildcard;for(n=0;n<e.length;n++)for(a=e[n],i=Array.isArray(a.from)?a.from:[a.from||s],r=a.to||s,t=0;t<i.length;t++)this.mapTransition({"name":a.name,"from":i[t],"to":r})},"transitionFor":function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},"transitionsFor":function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},"allStates":function(){return this.states},"allTransitions":function(){return this.transitions}}),e.exports=a},function(e,t,n){function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}var i=n(0),r=n(6),s=n(1),o=[null,[]];i(a.prototype,{"init":function(e){if(i(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},"is":function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},"isPending":function(){return this.pending},"can":function(e){return!this.isPending()&&!!this.seek(e)},"cannot":function(e){return!this.can(e)},"allStates":function(){return this.config.allStates()},"allTransitions":function(){return this.config.allTransitions()},"transitions":function(){return this.config.transitionsFor(this.state)},"seek":function(e,t){var n=this.config.defaults.wildcard,a=this.config.transitionFor(this.state,e),i=a&&a.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},"fire":function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},"transit":function(e,t,n,a){var i=this.config.lifecycle,r=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),a.unshift({"transition":e,"from":t,"to":n,"fsm":this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),r?this.observersForEvent(i.onLeave.state):o,r?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),r?["doTransit",[this]]:o,r?this.observersForEvent(i.onEnter.state):o,r?this.observersForEvent(i.onEnter[n]):o,r?this.observersForEvent(i.on[n]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],a)):this.context.onInvalidTransition(e,t,n)},"beginTransit":function(){this.pending=!0},"endTransit":function(e){return this.pending=!1,e},"failTransit":function(e){throw this.pending=!1,e},"doTransit":function(e){this.state=e.to},"observe":function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},"observersForEvent":function(e){for(var t,n=0,a=this.observers.length,i=[];n<a;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},"observeEvents":function(e,t,n,a){if(0===e.length)return this.endTransit(void 0===a||a);var i=e[0][0],r=e[0][1],o=e[0][2];if(t[0].event=i,i&&o&&i!==n&&s.hook(this,"lifecycle",t),0===r.length)return e.shift(),this.observeEvents(e,t,i,a);var l=r.shift(),c=l[i].apply(l,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i))["catch"](this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},"onInvalidTransition":function(e,t,n){throw new r("transition is invalid in current state",e,t,n,this.state)},"onPendingTransition":function(e,t,n){throw new r("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=a},function(e,t,n){"use strict";function a(e){return i(this||{},e)}function i(e,t){return r(e,new c(t,a)),e._fsm(),e}function r(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");l.build(e,t),Object.defineProperties(e,p),s(e,u),s(e,t.methods),t.allTransitions().forEach(function(t){e[o(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new d(this,t),this._fsm.init(arguments)}}var s=n(0),o=n(2),l=n(1),c=n(3),d=n(4),u={"is":function(e){return this._fsm.is(e)},"can":function(e){return this._fsm.can(e)},"cannot":function(e){return this._fsm.cannot(e)},"observe":function(){return this._fsm.observe(arguments)},"transitions":function(){return this._fsm.transitions()},"allTransitions":function(){return this._fsm.allTransitions()},"allStates":function(){return this._fsm.allStates()},"onInvalidTransition":function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},"onPendingTransition":function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},p={"state":{"configurable":!1,"enumerable":!0,"get":function(){return this._fsm.state},"set":function(){throw Error("use transitions to change state")}}};a.version="3.0.1",a.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new c(t,a);return r(e.prototype,n),e.prototype._fsm.config=n,e},a.apply=i,a.defaults={"wildcard":"*","init":{"name":"init","from":"none"}},e.exports=a},function(e){"use strict";e.exports=function(e,t,n,a,i){this.message=e,this.transition=t,this.from=n,this.to=a,this.current=i}}])},"object"==typeof n&&"object"==typeof t?t.exports=i():"object"==typeof n?n.StateMachine=i():a.StateMachine=i()},{}],"199":[function(e,t){
/*
* loglevel - https://github.com/pimterry/loglevel
*
* Copyright (c) 2013 Tim Perry
* Licensed under the MIT license.
*/
!function(e,n){"use strict";"object"==typeof t&&t.exports?t.exports=n():e.log=n()}(this,function(){"use strict";function e(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function t(e,t){for(var n=0;n<s.length;n++){var a=s[n];this[a]=n<e?i:this.methodFactory(a,e,t)}this.log=this.debug}function n(n){return function(t){return"debug"===t&&(t="log"),typeof console!==r&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):i)}(n)||function(e,n,a){return function(){typeof console!==r&&(t.call(this,n,a),this[e].apply(this,arguments))}}.apply(this,arguments)}function a(e,a,i){function o(){var e;if(typeof window!==r){try{e=window.localStorage[d]}catch(e){}if(typeof e===r)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(d)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}var l,c=this,d="loglevel";e&&(d+=":"+e),c.name=e,c.levels={"TRACE":0,"DEBUG":1,"INFO":2,"WARN":3,"ERROR":4,"SILENT":5},c.methodFactory=i||n,c.getLevel=function(){return l},c.setLevel=function(n,a){if("string"==typeof n&&void 0!==c.levels[n.toUpperCase()]&&(n=c.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(l=n,!1!==a&&function(e){var t=(s[e]||"silent").toUpperCase();if(typeof window!==r){try{return void(window.localStorage[d]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"="+t+";"}catch(e){}}}(n),t.call(c,n,e),typeof console===r&&n<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){o()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var u=o();null==u&&(u=null==a?"WARN":a),c.setLevel(u,!1)}var i=function(){},r="undefined",s=["trace","debug","info","warn","error"],o=new a,l={};o.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new a(e,o.getLevel(),o.methodFactory)),t};var c=typeof window!==r?window.log:void 0;return o.noConflict=function(){return typeof window!==r&&window.log===o&&(window.log=c),o},o.getLoggers=function(){return l},o})},{}],"200":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){return null!=e}var r=a(e("babel-runtime/core-js/object/get-prototype-of")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),l=a(e("babel-runtime/helpers/possibleConstructorReturn")),c=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var d=function(e){function t(e){(0,s["default"])(this,t);var n=(0,l["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));if(i((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(i(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(i(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(i(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(n.initialDelay=e.initialDelay||100,n.maxDelay=e.maxDelay||1e4,n.maxDelay<=n.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return n.randomisationFactor=e.randomisationFactor||0,n.factor=e.factor||2,n.maxNumberOfRetry=-1,n.reset(),n}return(0,c["default"])(t,e),(0,o["default"])(t,[{"key":"backoff","value":function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{"key":"reset","value":function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{"key":"failAfter","value":function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got "+e);this.maxNumberOfRetry=e}},{"key":"next","value":function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{"key":"onBackoff","value":function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{"key":"exponential","value":function(e){return new t(e)}}]),t}(e("events").EventEmitter);n.Backoff=d,n["default"]=d},{"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196}],"201":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./retrier");n.Retrier=a.Retrier;var i=e("./backoff");n.Backoff=i.Backoff,n["default"]=a.Retrier},{"./backoff":200,"./retrier":202}],"202":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/core-js/object/get-prototype-of")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),l=a(e("babel-runtime/helpers/possibleConstructorReturn")),c=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var d=function(e){function t(e){(0,s["default"])(this,t);var n=(0,l["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return n.minDelay=e.min,n.maxDelay=e.max,n.initialDelay=e.initial||0,n.maxAttemptsCount=e.maxAttemptsCount||0,n.maxAttemptsTime=e.maxAttemptsTime||0,n.randomness=e.randomness||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return(0,c["default"])(t,e),(0,o["default"])(t,[{"key":"attempt","value":function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{"key":"nextDelay","value":function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{"key":"randomize","value":function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{"key":"scheduleAttempt","value":function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout(function(){return t.attempt()},n)}},{"key":"cleanup","value":function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{"key":"start","value":function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new i["default"](function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})}},{"key":"cancel","value":function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{"key":"succeeded","value":function(e){this.emit("succeeded",e),this.resolve(e)}},{"key":"failed","value":function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{"key":"run","value":function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)})["catch"](function(e){return t.failed(e)})}),this.start()}}]),t}(e("events").EventEmitter);n.Retrier=d,n["default"]=d},{"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196}],"203":[function(e,t,n){(function(e){(function(){"use strict";function a(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function i(e){return e=c(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:a(e)}function r(e,t){for(var n in e)g.call(e,n)&&t(e[n],n,e)}function s(e){return null==e?a(e):_.call(e).slice(8,-1)}function o(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function l(e,t){var n=null;return function(e,t){var n=-1,a=e?e.length:0;if("number"==typeof a&&a>-1&&a<=h)for(;++n<a;)t(e[n],n,e);else r(e,t)}(e,function(a,i){n=t(n,a,i,e)}),n}function c(e){return String(e).replace(/^ +| +$/g,"")}var d={"function":!0,"object":!0},u=d[typeof window]&&window||this,p=d[typeof n]&&n,f=d[typeof t]&&t&&!t.nodeType&&t,b=p&&f&&"object"==typeof e&&e;!b||b.global!==b&&b.window!==b&&b.self!==b||(u=b);var h=Math.pow(2,53)-1,m=/\bOpera/,v=Object.prototype,g=v.hasOwnProperty,_=v.toString,y=function w(e){function t(t){return l(t,function(t,n){var a=n.pattern||o(n);return!t&&(t=RegExp("\\b"+a+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+a+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+a+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(a,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=i(t[0].replace(RegExp(a,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}var n=u,a=e&&"object"==typeof e&&"String"!=s(e);a&&(n=e,e=null);var d=n.navigator||{},p=d.userAgent||"";e||(e=p);var f,b,h,v,g,y=a?!!d.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(_.toString()),k=a?"Object":"ScriptBridgingProxyObject",C=a?"Object":"Environment",x=a&&n.java?"JavaPackage":s(n.java),T=a?"Object":"RuntimeObject",S=/\bJava/.test(x)&&n.java,M=S&&s(n.environment)==C,$=S?"a":"\u03b1",j=S?"b":"\u03b2",E=n.document||{},A=n.operamini||n.opera,P=m.test(P=a&&A?A["[[Class]]"]:s(A))?P:A=null,I=e,D=[],R=null,L=e==p,N=L&&A&&"function"==typeof A.version&&A.version(),O=l([{"label":"EdgeHTML","pattern":"Edge"},"Trident",{"label":"WebKit","pattern":"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(t,n){return t||RegExp("\\b"+(n.pattern||o(n))+"\\b","i").exec(e)&&(n.label||n)}),F=l(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{"label":"Microsoft Edge","pattern":"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{"label":"Samsung Internet","pattern":"SamsungBrowser"},"SeaMonkey",{"label":"Silk","pattern":"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{"label":"SRWare Iron","pattern":"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{"label":"Opera Mini","pattern":"OPiOS"},"Opera",{"label":"Opera","pattern":"OPR"},"Chrome",{"label":"Chrome Mobile","pattern":"(?:CriOS|CrMo)"},{"label":"Firefox","pattern":"(?:Firefox|Minefield)"},{"label":"Firefox for iOS","pattern":"FxiOS"},{"label":"IE","pattern":"IEMobile"},{"label":"IE","pattern":"MSIE"},"Safari"],function(t,n){return t||RegExp("\\b"+(n.pattern||o(n))+"\\b","i").exec(e)&&(n.label||n)}),z=t([{"label":"BlackBerry","pattern":"BB10"},"BlackBerry",{"label":"Galaxy S","pattern":"GT-I9000"},{"label":"Galaxy S2","pattern":"GT-I9100"},{"label":"Galaxy S3","pattern":"GT-I9300"},{"label":"Galaxy S4","pattern":"GT-I9500"},{"label":"Galaxy S5","pattern":"SM-G900"},{"label":"Galaxy S6","pattern":"SM-G920"},{"label":"Galaxy S6 Edge","pattern":"SM-G925"},{"label":"Galaxy S7","pattern":"SM-G930"},{"label":"Galaxy S7 Edge","pattern":"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{"label":"Kindle Fire","pattern":"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{"label":"Wii U","pattern":"WiiU"},"Wii","Xbox One",{"label":"Xbox 360","pattern":"Xbox"},"Xoom"]),H=l({"Apple":{"iPad":1,"iPhone":1,"iPod":1},"Archos":{},"Amazon":{"Kindle":1,"Kindle Fire":1},"Asus":{"Transformer":1},"Barnes & Noble":{"Nook":1},"BlackBerry":{"PlayBook":1},"Google":{"Google TV":1,"Nexus":1},"HP":{"TouchPad":1},"HTC":{},"LG":{},"Microsoft":{"Xbox":1,"Xbox One":1},"Motorola":{"Xoom":1},"Nintendo":{"Wii U":1,"Wii":1},"Nokia":{"Lumia":1},"Samsung":{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},"Sony":{"PlayStation":1,"PlayStation Vita":1}},function(t,n,a){return t||(n[z]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(z)]||RegExp("\\b"+o(a)+"(?:\\b|\\w*\\d)","i").exec(e))&&a}),U=l(["Windows Phone","Android","CentOS",{"label":"Chrome OS","pattern":"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],function(t,n){var a=n.pattern||o(n);return!t&&(t=RegExp("\\b"+a+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=function(e,t,n){var a={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(a=a[/[\d.]+$/.exec(e)])&&(e="Windows "+a),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),i(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(t,a,n.label||n)),t});if(O&&(O=[O]),H&&!z&&(z=t([H])),(f=/\bGoogle TV\b/.exec(z))&&(z=f[0]),/\bSimulator\b/i.test(e)&&(z=(z?z+" ":"")+"Simulator"),"Opera Mini"==F&&/\bOPiOS\b/.test(e)&&D.push("running in Turbo/Uncompressed mode"),"IE"==F&&/\blike iPhone OS\b/.test(e)?(H=(f=w(e.replace(/like iPhone OS/,""))).manufacturer,z=f.product):/^iP/.test(z)?(F||(F="Safari"),U="iOS"+((f=/ OS ([\d_]+)/i.exec(e))?" "+f[1].replace(/_/g,"."):"")):"Konqueror"!=F||/buntu/i.test(U)?H&&"Google"!=H&&(/Chrome/.test(F)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(z))||/\bAndroid\b/.test(U)&&/^Chrome/.test(F)&&/\bVersion\//i.test(e)?(F="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==F?(/\bMobi/i.test(e)||(U="Android",D.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&D.unshift("accelerated")):"PaleMoon"==F&&(f=/\bFirefox\/([\d.]+)\b/.exec(e))?D.push("identifying as Firefox "+f[1]):"Firefox"==F&&(f=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(U||(U="Firefox OS"),z||(z=f[1])):!F||(f=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(F))?(F&&!z&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(f+"/")+8))&&(F=null),(f=z||H||U)&&(z||H||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(F=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:f)+" Browser")):"Electron"==F&&(f=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&D.push("Chromium "+f):U="Kubuntu",N||(N=l(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",o(F),"(?:Firefox|Minefield|NetFront)"],function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})),(f=("iCab"==O&&parseFloat(N)>3?"WebKit":/\bOpera\b/.test(F)&&(/\bOPR\b/.test(e)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(O)&&"WebKit"||!O&&/\bMSIE\b/i.test(e)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==O&&/\bPlayStation\b(?! Vita\b)/i.test(F)&&"NetFront")&&(O=[f]),"IE"==F&&(f=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(F+=" Mobile",U="Windows Phone "+(/\+$/.test(f)?f:f+".x"),D.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(F="IE Mobile",U="Windows Phone 8.x",D.unshift("desktop mode"),N||(N=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=F&&"Trident"==O&&(f=/\brv:([\d.]+)/.exec(e))&&(F&&D.push("identifying as "+F+(N?" "+N:"")),F="IE",N=f[1]),L){if(v="global",g=null!=(h=n)?typeof h[v]:"number",/^(?:boolean|number|string|undefined)$/.test(g)||"object"==g&&!h[v])s(f=n.runtime)==k?(F="Adobe AIR",U=f.flash.system.Capabilities.os):s(f=n.phantom)==T?(F="PhantomJS",N=(f=f.version||null)&&f.major+"."+f.minor+"."+f.patch):"number"==typeof E.documentMode&&(f=/\bTrident\/(\d+)/i.exec(e))?(N=[N,E.documentMode],(f=+f[1]+4)!=N[1]&&(D.push("IE "+N[1]+" mode"),O&&(O[1]=""),N[1]=f),N="IE"==F?String(N[1].toFixed(1)):N[0]):"number"==typeof E.documentMode&&/^(?:Chrome|Firefox)\b/.test(F)&&(D.push("masking as "+F+" "+N),F="IE",N="11.0",O=["Trident"],U="Windows");else if(S&&(I=(f=S.lang.System).getProperty("os.arch"),U=U||f.getProperty("os.name")+" "+f.getProperty("os.version")),M){try{N=n.require("ringo/engine").version.join("."),F="RingoJS"}catch(w){(f=n.system)&&f.global.system==n.system&&(F="Narwhal",U||(U=f[0].os||null))}F||(F="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(f=n.process)&&("object"==typeof f.versions&&("string"==typeof f.versions.electron?(D.push("Node "+f.versions.node),F="Electron",N=f.versions.electron):"string"==typeof f.versions.nw&&(D.push("Chromium "+N,"Node "+f.versions.node),F="NW.js",N=f.versions.nw)),F||(F="Node.js",I=f.arch,U=f.platform,N=(N=/[\d.]+/.exec(f.version))?N[0]:null));U=U&&i(U)}if(N&&(f=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(N)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(L&&d.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(R=/b/i.test(f)?"beta":"alpha",N=N.replace(RegExp(f+"\\+?$"),"")+("beta"==R?j:$)+(/\d+\+?/.exec(f)||"")),"Fennec"==F||"Firefox"==F&&/\b(?:Android|Firefox OS)\b/.test(U))F="Firefox Mobile";else if("Maxthon"==F&&N)N=N.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(z))"Xbox 360"==z&&(U=null),"Xbox 360"==z&&/\bIEMobile\b/.test(e)&&D.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(F)&&(!F||z||/Browser|Mobi/.test(F))||"Windows CE"!=U&&!/Mobi/i.test(e))if("IE"==F&&L)try{null===n.external&&D.unshift("platform preview")}catch(w){D.unshift("embedded")}else(/\bBlackBerry\b/.test(z)||/\bBB10\b/.test(e))&&(f=(RegExp(z.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||N)?(U=((f=[f,/BB10/.test(e)])[1]?(z=null,H="BlackBerry"):"Device Software")+" "+f[0],N=null):this!=r&&"Wii"!=z&&(L&&A||/Opera/.test(F)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==F&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==F&&(U&&!/^Win/.test(U)&&N>5.5||/\bWindows XP\b/.test(U)&&N>8||8==N&&!/\bTrident\b/.test(e)))&&!m.test(f=w.call(r,e.replace(m,"")+";"))&&f.name&&(f="ing as "+f.name+((f=f.version)?" "+f:""),m.test(F)?(/\bIE\b/.test(f)&&"Mac OS"==U&&(U=null),f="identify"+f):(f="mask"+f,F=P?i(P.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(f)&&(U=null),L||(N=null)),O=["Presto"],D.push(f));else F+=" Mobile";(f=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(f=[parseFloat(f.replace(/\.(\d)$/,".0$1")),f],"Safari"==F&&"+"==f[1].slice(-1)?(F="WebKit Nightly",R="alpha",N=f[1].slice(0,-1)):N!=f[1]&&N!=(f[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(N=null),f[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==f[0]&&537.36==f[2]&&parseFloat(f[1])>=28&&"WebKit"==O&&(O=["Blink"]),L&&(y||f[1])?(O&&(O[1]="like Chrome"),f=f[1]||((f=f[0])<530?1:f<532?2:f<532.05?3:f<533?4:f<534.03?5:f<534.07?6:f<534.1?7:f<534.13?8:f<534.16?9:f<534.24?10:f<534.3?11:f<535.01?12:f<535.02?"13+":f<535.07?15:f<535.11?16:f<535.19?17:f<536.05?18:f<536.1?19:f<537.01?20:f<537.11?"21+":f<537.13?23:f<537.18?24:f<537.24?25:f<537.36?26:"Blink"!=O?"27":"28")):(O&&(O[1]="like Safari"),f=(f=f[0])<400?1:f<500?2:f<526?3:f<533?4:f<534?"4+":f<535?5:f<537?6:f<538?7:f<601?8:"8"),O&&(O[1]+=" "+(f+="number"==typeof f?".x":/[.+]/.test(f)?"":"+")),"Safari"==F&&(!N||parseInt(N)>45)&&(N=f)),"Opera"==F&&(f=/\bzbov|zvav$/.exec(U))?(F+=" ",D.unshift("desktop mode"),"zvav"==f?(F+="Mini",N=null):F+="Mobile",U=U.replace(RegExp(" *"+f+"$"),"")):"Safari"==F&&/\bChrome\b/.exec(O&&O[1])&&(D.unshift("desktop mode"),F="Chrome Mobile",N=null,/\bOS X\b/.test(U)?(H="Apple",U="iOS 4.3+"):U=null),N&&0==N.indexOf(f=/[\d.]+$/.exec(U))&&e.indexOf("/"+f+"-")>-1&&(U=c(U.replace(f,""))),O&&!/\b(?:Avant|Nook)\b/.test(F)&&(/Browser|Lunascape|Maxthon/.test(F)||"Safari"!=F&&/^iOS/.test(U)&&/\bSafari\b/.test(O[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(F)&&O[1])&&(f=O[O.length-1])&&D.push(f),D.length&&(D=["("+D.join("; ")+")"]),H&&z&&z.indexOf(H)<0&&D.push("on "+H),z&&D.push((/^on /.test(D[D.length-1])?"":"on ")+z),U&&(f=/ ([\d.+]+)$/.exec(U),b=f&&"/"==U.charAt(U.length-f[0].length-1),U={"architecture":32,"family":f&&!b?U.replace(f[0],""):U,"version":f?f[1]:null,"toString":function(){var e=this.version;return this.family+(e&&!b?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(f=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(I))&&!/\bi686\b/i.test(I)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+f),"")),F&&(/\bWOW64\b/i.test(e)||L&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(e))&&D.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==F&&parseFloat(N)>=39&&(U.architecture=64),e||(e=null);var B={};return B.description=e,B.layout=O&&O[0],B.manufacturer=H,B.name=F,B.prerelease=R,B.product=z,B.ua=e,B.version=F&&N,B.os=U||{"architecture":null,"family":null,"version":null,"toString":function(){return"null"}},B.parse=w,B.toString=function(){return this.description||""},B.version&&D.unshift(N),B.name&&D.unshift(F),U&&F&&(U!=String(U).split(" ")[0]||U!=F.split(" ")[0]&&!z)&&D.push(z?"("+U+")":"on "+U),D.length&&(B.description=D.join(" ")),B}();p&&f?r(y,function(e,t){p[t]=e}):u.platform=y}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"204":[function(e,t){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=e("./runtime"),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},{"./runtime":205}],"205":[function(e,t){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";function n(e,t,n,r){var s=t&&t.prototype instanceof i?t:i,o=Object.create(s.prototype),l=new p(r||[]);return o._invoke=function(e,t,n){var i=x;return function(r,s){if(i===S)throw new Error("Generator is already running");if(i===M){if("throw"===r)throw s;return b()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var l=c(o,n);if(l){if(l===$)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===x)throw i=M,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=S;var d=a(e,t,n);if("normal"===d.type){if(i=n.done?M:T,d.arg===$)continue;return{"value":d.arg,"done":n.done}}"throw"===d.type&&(i=M,n.method="throw",n.arg=d.arg)}}}(e,n,l),o}function a(e,t,n){try{return{"type":"normal","arg":e.call(t,n)}}catch(e){return{"type":"throw","arg":e}}}function i(){}function r(){}function s(){}function o(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){var t;this._invoke=function(n,i){function r(){return new Promise(function(t,r){!function s(t,n,i,r){var o=a(e[t],e,n);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&v.call(c,"__await")?Promise.resolve(c.__await).then(function(e){s("next",e,i,r)},function(e){s("throw",e,i,r)}):Promise.resolve(c).then(function(e){l.value=e,i(l)},r)}r(o.arg)}(n,i,t,r)})}return t=t?t.then(r,r):r()}}function c(e,t){var n=e.iterator[t.method];if(n===h){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=h,c(e,t),"throw"===t.method))return $;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return $}var i=a(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,$;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=h),t.delegate=null,$):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,$)}function d(e){var t={"tryLoc":e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function u(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{"tryLoc":"root"}],e.forEach(d,this),this.reset(!0)}function f(e){if(e){var t=e[_];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=h,t.done=!0,t};return a.next=a}}return{"next":b}}function b(){return{"value":h,"done":!0}}var h,m=Object.prototype,v=m.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},_=g.iterator||"@@iterator",y=g.asyncIterator||"@@asyncIterator",w=g.toStringTag||"@@toStringTag",k="object"==typeof t,C=e.regeneratorRuntime;if(C)k&&(t.exports=C);else{(C=e.regeneratorRuntime=k?t.exports:{}).wrap=n;var x="suspendedStart",T="suspendedYield",S="executing",M="completed",$={},j={};j[_]=function(){return this};var E=Object.getPrototypeOf,A=E&&E(E(f([])));A&&A!==m&&v.call(A,_)&&(j=A);var P=s.prototype=i.prototype=Object.create(j);r.prototype=P.constructor=s,s.constructor=r,s[w]=r.displayName="GeneratorFunction",C.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===r||"GeneratorFunction"===(t.displayName||t.name))},C.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,w in e||(e[w]="GeneratorFunction")),e.prototype=Object.create(P),e},C.awrap=function(e){return{"__await":e}},o(l.prototype),l.prototype[y]=function(){return this},C.AsyncIterator=l,C.async=function(e,t,a,i){var r=new l(n(e,t,a,i));return C.isGeneratorFunction(t)?r:r.next().then(function(e){return e.done?e.value:r.next()})},o(P),P[w]="Generator",P[_]=function(){return this},P.toString=function(){return"[object Generator]"},C.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function a(){for(;t.length;){var n=t.pop();if(n in e)return a.value=n,a.done=!1,a}return a.done=!0,a}},C.values=f,p.prototype={"constructor":p,"reset":function(e){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(u),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=h)},"stop":function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},"dispatchException":function(e){function t(t,a){return r.type="throw",r.arg=e,n.next=t,a&&(n.method="next",n.arg=h),!!a}if(this.done)throw e;for(var n=this,a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],r=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=v.call(i,"catchLoc"),o=v.call(i,"finallyLoc");if(s&&o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},"abrupt":function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&v.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,$):this.complete(r)},"complete":function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),$},"finish":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),u(n),$}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var i=a.arg;u(n)}return i}}throw new Error("illegal catch attempt")},"delegateYield":function(e,t,n){return this.delegate={"iterator":f(e),"resultName":t,"nextLoc":n},"next"===this.method&&(this.arg=h),$}}}}(function(){return this}()||Function("return this")())},{}],"206":[function(e,t,n){"use strict";function a(e,t){var n={};for(var a in e)u.call(e,a)&&void 0!==e[a]&&(n[a]=1);for(var i in t)u.call(t,i)&&void 0!==t[i]&&delete n[i];return Object.keys(n)}function i(e){for(var t=e.length,n={},a=0;a<t;a++){var i=e[a];for(var r in i)u.call(i,r)&&void 0!==i[r]&&(n[r]=(n[r]||0)+1)}for(var r in n)n[r]<t&&delete n[r];return Object.keys(n)}function r(e,t){return{"operations":e.operations.concat(t),"cost":e.cost+1}}function s(e,t,n,a){void 0===a&&(a=c);var i={"0,0":{"operations":[],"cost":0}},s=isNaN(e.length)||e.length<=0?0:e.length,o=isNaN(t.length)||t.length<=0?0:t.length;return function l(n,a){var s=n+","+a,o=i[s];if(void 0===o){if(n>0&&a>0&&d.compare(e[n-1],t[a-1]))o=l(n-1,a-1);else{var c=[];if(n>0){var u=l(n-1,a),p={"op":"remove","index":n-1};c.push(r(u,p))}if(a>0){var f=l(n,a-1),b={"op":"add","index":n-1,"value":t[a-1]};c.push(r(f,b))}if(n>0&&a>0){var h=l(n-1,a-1),m={"op":"replace","index":n-1,"original":e[n-1],"value":t[a-1]};c.push(r(h,m))}o=c.sort(function(e,t){return e.cost-t.cost})[0]}i[s]=o}return o}(s,o).operations.reduce(function(e,t){var i=e[0],r=e[1];if("add"===t.op){var o=t.index+1+r,l=o<s+r?String(o):"-",c={"op":t.op,"path":n.add(l).toString(),"value":t.value};return[i.concat(c),r+1]}if("remove"===t.op)return c={"op":t.op,"path":n.add(String(t.index+r)).toString()},[i.concat(c),r-1];var d=n.add(String(t.index+r)),u=a(t.original,t.value,d);return[i.concat.apply(i,u),r]},[[],0])[0]}function o(e,t,n,r){void 0===r&&(r=c);var s=[];return a(e,t).forEach(function(e){s.push({"op":"remove","path":n.add(e).toString()})}),a(t,e).forEach(function(e){s.push({"op":"add","path":n.add(e).toString(),"value":t[e]})}),i([e,t]).forEach(function(a){s.push.apply(s,r(e[a],t[a],n.add(a)))}),s}function l(e,t,n){return d.compare(e,t)?[]:[{"op":"replace","path":n.toString(),"value":t}]}function c(e,t,n,a){void 0===a&&(a=c);var i=d.objectType(e),r=d.objectType(t);return"array"==i&&"array"==r?s(e,t,n,a):"object"==i&&"object"==r?o(e,t,n,a):l(e,t,n)}Object.defineProperty(n,"__esModule",{"value":!0});var d=e("./equal"),u=Object.prototype.hasOwnProperty;n.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},n.subtract=a,n.intersection=i,n.diffArrays=s,n.diffObjects=o,n.diffValues=l,n.diffAny=c},{"./equal":207}],"207":[function(e,t,n){"use strict";function a(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e}function i(e,t){if(e===t)return!0;var n=a(e),s=a(t);return"array"==n&&"array"==s?function(e,t){var n=e.length;if(n!==t.length)return!1;for(var a=0;a<n;a++)if(!i(e[a],t[a]))return!1;return!0}(e,t):"object"==n&&"object"==s&&function(e,t){var n=Object.keys(e),a=Object.keys(t),s=n.length;if(s!==a.length)return!1;for(var o=0;o<s;o++){var l=n[o];if(!r.call(t,l)||!i(e[l],t[l]))return!1}return!0}(e,t)}Object.defineProperty(n,"__esModule",{"value":!0});var r=Object.prototype.hasOwnProperty;n.objectType=a,n.compare=i},{}],"208":[function(e,t,n){"use strict";function a(e,t){var n=i.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{"op":"test","path":t,"value":n.value}}Object.defineProperty(n,"__esModule",{"value":!0});var i=e("./pointer"),r=e("./patch"),s=e("./diff");n.applyPatch=function(e,t){return t.map(function(t){return r.apply(e,t)})},n.createPatch=function(e,t,n){var a=new i.Pointer;return(n?function(e){return function t(n,a,i){var r=e(n,a,i);return Array.isArray(r)?r:s.diffAny(n,a,i,t)}}(n):s.diffAny)(e,t,a)},n.createTests=function(e,t){var n=new Array;return t.filter(s.isDestructive).forEach(function(t){var i=a(e,t.path);if(i&&n.push(i),"from"in t){var r=a(e,t.from);r&&n.push(r)}}),n}},{"./diff":206,"./patch":209,"./pointer":210}],"209":[function(e,t,n){"use strict";function a(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var a=parseInt(t,10);e.splice(a,0,n)}else e[t]=n}function i(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function r(e,t){var n=f.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new m(t.path):(a(n.parent,n.key,b.clone(t.value)),null)}function s(e,t){var n=f.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new m(t.path):(i(n.parent,n.key),null)}function o(e,t){var n=f.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new m(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new m(t.path)}else if(void 0===n.value)return new m(t.path);return n.parent[n.key]=t.value,null}function l(e,t){var n=f.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new m(t.from);var r=f.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new m(t.path):(i(n.parent,n.key),a(r.parent,r.key,n.value),null)}function c(e,t){var n=f.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new m(t.from);var i=f.Pointer.fromJSON(t.path).evaluate(e);return void 0===i.parent?new m(t.path):(a(i.parent,i.key,b.clone(n.value)),null)}function d(e,t){var n=f.Pointer.fromJSON(t.path).evaluate(e);return h.compare(n.value,t.value)?null:new v(n.value,t.value)}var u,p=this&&this.__extends||(u=function(e,t){return(u=Object.setPrototypeOf||{"__proto__":[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{"value":!0});var f=e("./pointer"),b=e("./util"),h=e("./equal"),m=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return p(t,e),t}(Error);n.MissingError=m;var v=function(e){function t(t,n){var a=e.call(this,"Test failed: "+t+" != "+n)||this;return a.actual=t,a.expected=n,a.name="TestError",a.actual=t,a.expected=n,a}return p(t,e),t}(Error);n.TestError=v,n.add=r,n.remove=s,n.replace=o,n.move=l,n.copy=c,n.test=d;var g=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t.op)||this;return n.operation=t,n.name="InvalidOperationError",n}return p(t,e),t}(Error);n.InvalidOperationError=g,n.apply=function(e,t){switch(t.op){case"add":return r(e,t);case"remove":return s(e,t);case"replace":return o(e,t);case"move":return l(e,t);case"copy":return c(e,t);case"test":return d(e,t)}return new g(t)}},{"./equal":207,"./pointer":210,"./util":211}],"210":[function(e,t,n){"use strict";function a(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(n,"__esModule",{"value":!0});var r=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(a);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)},e.prototype.toString=function(){return this.tokens.map(i).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",a=e,i=1,r=this.tokens.length;i<r;i++)a=((t=a)||{})[n=this.tokens[i]];return{"parent":t,"key":n,"value":a}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,a=1,i=this.tokens.length-1,r=this.tokens[a];a<i;a++)n=(n||{})[r];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();n.Pointer=r},{}],"211":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=Object.prototype.hasOwnProperty;n.clone=function i(e){if(null==e||"object"!=typeof e)return e;if(e.constructor==Array){for(var t=e.length,n=new Array(t),r=0;r<t;r++)n[r]=i(e[r]);return n}var s={};for(var o in e)a.call(e,o)&&(s[o]=i(e[o]));return s}},{}],"212":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("./logger"),c=e("./configuration"),d=e("./media");n.Media=d.Media,n.McsMedia=d.Media;var u=e("./services/transport"),p=e("./services/network"),f=l.Logger.scope(""),b=e("./../package.json").version,h="A valid Twilio token should be provided",m=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,s["default"])(this,e),this.options=a,this.options.logLevel=this.options.logLevel||"silent",this.config=new c.Configuration(t,n,this.options),!t)throw new Error(h);f.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new u.Transport,this.transport=this.options.transport,this.network=new p.Network(this.config,this.transport)}return(0,o["default"])(e,[{"key":"updateToken","value":function(e){if(f.info("updateToken"),!e)throw new Error(h);this.config.updateToken(e)}},{"key":"get","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.get(this.config.baseUrl+"/"+e);case 2:return n=t.sent,t.abrupt("return",new d.Media(this.config,this.network,n.body));case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"post","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n){var a;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.post(this.config.baseUrl,n,e);case 2:return a=t.sent,t.abrupt("return",new d.Media(this.config,this.network,a.body));case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"postFormData","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.post(this.config.baseUrl,e);case 2:return n=t.sent,t.abrupt("return",new d.Media(this.config,this.network,n.body));case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.Client=m,n.McsClient=m,m.version=b,n["default"]=m},{"./../package.json":220,"./configuration":213,"./logger":215,"./media":216,"./services/network":217,"./services/transport":218,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"213":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(t,n,a){(0,i["default"])(this,e);var r=a.MCS||a||{};this.region=r.region||a.region,this.baseUrl=(void 0===this.region?"https://mcs.us1.twilio.com":"https://mcs."+this.region+".twilio.com")+n,this.token=t,this.retryWhenThrottledOverride=r.retryWhenThrottledOverride,this.backoffConfigOverride=r.backoffConfigOverride}return(0,r["default"])(e,[{"key":"updateToken","value":function(e){this.token=e}}],[{"key":"backoffConfigDefault","get":function(){return{"min":1e3,"max":4e3,"maxAttemptsCount":3}}},{"key":"retryWhenThrottledDefault","get":function(){return!0}}]),e}();n.Configuration=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"214":[function(e,t){"use strict";var n=e("./client");t.exports=n},{"./client":212}],"215":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return[(new Date).toISOString()+" MCS Client "+e+":"].concat((0,o["default"])(t))}var r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("loglevel"),c=function(){function e(t){(0,r["default"])(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return(0,s["default"])(e,[{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.trace.apply(null,i(this.prefix+"T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i(this.prefix+"D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i(this.prefix+"I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i(this.prefix+"W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i(this.prefix+"E",t))}}],[{"key":"scope","value":function(t){return new e(t)}},{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.trace.apply(null,i("T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i("I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i("W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i("E",t))}}]),e}();n.Logger=c},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"loglevel":199}],"216":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/core-js/promise")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/helpers/classCallCheck")),l=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var c=function(){function e(t,n,a){(0,o["default"])(this,e),this.config=t,this.network=n,this._update(a)}return(0,l["default"])(e,[{"key":"getContentUrl","value":function(){var e=(0,s["default"])(i["default"].mark(function t(){var e;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.get(this.config.baseUrl+"/"+this.sid);case 2:return e=t.sent,this._update(e.body),t.abrupt("return",r["default"].resolve(this.state.contentDirectUrl));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_update","value":function(e){this.state={"sid":e.sid,"serviceSid":e.service_sid,"channelSid":e.channel_sid,"messageSid":e.message_sid,"dateCreated":e.date_created?new Date(e.date_created):null,"dateUpdated":e.date_updated?new Date(e.date_updated):null,"size":e.size,"contentType":e.content_type,"url":e.url,"contentUrl":e.links.content,"contentDirectUrl":e.links.content_direct_temporary,"filename":e.filename?e.filename:null}}},{"key":"sid","get":function(){return this.state.sid}},{"key":"serviceSid","get":function(){return this.state.serviceSid}},{"key":"dateCreated","get":function(){return this.state.dateCreated}},{"key":"dateUpdated","get":function(){return this.state.dateUpdated}},{"key":"contentType","get":function(){return this.state.contentType}},{"key":"size","get":function(){return this.state.size}},{"key":"fileName","get":function(){return this.state.filename}}]),e}();n.Media=c},{"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"217":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/promise")),o=a(e("babel-runtime/core-js/object/assign")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("operation-retrier"),u=e("../logger"),p=e("../configuration"),f=u.Logger.scope("Network"),b=function(){function e(t,n){(0,l["default"])(this,e),this.config=t,this.transport=n}return(0,c["default"])(e,[{"key":"backoffConfig","value":function(){return(0,o["default"])(p.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}},{"key":"retryWhenThrottled","value":function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==p.Configuration.retryWhenThrottledDefault&&p.Configuration.retryWhenThrottledDefault}},{"key":"executeWithRetry","value":function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new s["default"](function(a,i){var r=[502,503,504];n&&r.push(429);var s=new d.Retrier(t.backoffConfig());s.on("attempt",function(){e().then(function(e){return s.succeeded(e)})["catch"](function(e){r.indexOf(e.status)>-1?s.failed(e):"Twilsock disconnected"===e.message?s.failed(e):(s.removeAllListeners(),s.cancel(),i(e))})}),s.on("succeeded",function(e){a(e)}),s.on("cancelled",function(e){return i(e)}),s.on("failed",function(e){return i(e)}),s.start()})}},{"key":"get","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){var n,a,r=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"X-Twilio-Token":this.config.token},f.trace("sending GET request to ",e," headers ",n),t.next=4,this.executeWithRetry(function(){return r.transport.get(e,n)},this.retryWhenThrottled());case 4:return a=t.sent,f.trace("response",a),t.abrupt("return",a);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"post","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n,a){var r,s;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={"X-Twilio-Token":this.config.token},n instanceof FormData||!a||(0,o["default"])(r,{"Content-Type":a}),s=void 0,f.trace("sending POST request to ",e," headers ",r),t.prev=4,t.next=7,this.transport.post(e,r,n);case 7:s=t.sent,t.next=18;break;case 10:if(t.prev=10,t.t0=t["catch"](4),!(t.t0 instanceof TypeError)){t.next=17;break}throw f.trace("got error in post response",t.t0),new TypeError("Posting FormData supported only with browser engine's FormData");case 17:throw t.t0;case 18:return f.trace("response",s),t.abrupt("return",s);case 20:case"end":return t.stop()}},t,this,[[4,10]])}));return function(){return e.apply(this,arguments)}}()}]),e}();n.Network=b},{"../configuration":213,"../logger":215,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58,"operation-retrier":201}],"218":[function(e,t,n){(function(t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/json/stringify")),r=a(e("babel-runtime/core-js/promise")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("./transporterror"),c=t.XMLHttpRequest||e("xmlhttprequest").XMLHttpRequest,d=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,[{"key":"get","value":function(t,n){return e.request("GET",t,n)}},{"key":"post","value":function(t,n,a){return e.request("POST",t,n,a)}}],[{"key":"request","value":function(e,t,n,a){return new r["default"](function(r,s){var o=new c;for(var d in o.open(e,t,!0),o.onreadystatechange=function(){if(4===o.readyState){var e,t=(e=o.getAllResponseHeaders())?e.split("\r\n").map(function(e){return e.split(": ")}).filter(function(e){return 2===e.length&&e[1].length>0}).reduce(function(e,t){return e[t[0]]=t[1],e},{}):{},n=function(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}(o);if(200<=o.status&&o.status<300)r({"status":o.status,"headers":t,"body":n});else{var a=o.statusText&&o.statusText.code?o.statusText.code:"NONE",c=void 0;c="string"==typeof n?n&&1===n.split("\n",2).length?n:"":(0,i["default"])(n);var d=o.status+": ["+a+"] "+c;s(new l.TransportError(d,o.status,n,a,t))}}},n)o.setRequestHeader(d,n[d]),"Content-Type"===d&&"application/json"===n[d]&&(a=(0,i["default"])(a));o.send(a)})}}]),e}();n.Transport=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transporterror":219,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"xmlhttprequest":59}],"219":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/create")),r=a(e("babel-runtime/core-js/object/set-prototype-of")),s=a(e("babel-runtime/core-js/array/from")),o=a(e("babel-runtime/core-js/reflect/construct")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=function(e){function t(e,n,a,i,r){(0,c["default"])(this,t);var s=(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e));return s.code=n,s.body=a,s.status=i,s.headers=r,s}return(0,u["default"])(t,e),t}(function(e){function t(){var t=(0,o["default"])(e,(0,s["default"])(arguments));return(0,r["default"])(t,(0,l["default"])(this)),t}return t.prototype=(0,i["default"])(e.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),r["default"]?(0,r["default"])(t,e):t.__proto__=e,t}(Error));n.TransportError=p},{"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/object/set-prototype-of":43,"babel-runtime/core-js/reflect/construct":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"220":[function(e,t){t.exports={"_from":"twilio-mcs-client@^0.3.1","_id":"twilio-mcs-client@0.3.1","_inBundle":!1,"_integrity":"sha512-lNt9a5Uucqno+Xhacw3d9G2/i/n3F9wLhqQvYybyZ0e0O0nmDJaTVNHi5tyJURTcPTUNu/XyNJvWRK8BXuplnw==","_location":"/twilio-mcs-client","_phantomChildren":{},"_requested":{"type":"range","registry":!0,"raw":"twilio-mcs-client@^0.3.1","name":"twilio-mcs-client","escapedName":"twilio-mcs-client","rawSpec":"^0.3.1","saveSpec":null,"fetchSpec":"^0.3.1"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/twilio-mcs-client/-/twilio-mcs-client-0.3.1.tgz","_shasum":"09c58631cd9f5f85d133fa60c6f66dce2833644e","_spec":"twilio-mcs-client@^0.3.1","_where":"/home/travis/build/twilio/twilio-chat.js","author":{"name":"Twilio"},"browser":{"xmlhttprequest":!1},"browserify":{"transform":["babelify"]},"bundleDependencies":!1,"dependencies":{"loglevel":"^1.6.4","operation-retrier":"^3.0.1","xmlhttprequest":"^1.8.0"},"deprecated":!1,"description":"Twilio Media Content Service client library","devDependencies":{"@types/chai":"^4.2.2","@types/chai-as-promised":"^7.1.2","@types/chai-datetime":"0.0.33","@types/chai-string":"^1.4.2","@types/core-js":"^2.5.2","@types/mocha":"^5.2.7","@types/node":"^12.7.4","@types/sinon":"^7.0.13","@types/sinon-chai":"^3.2.3","async":"^3.1.0","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","browserify":"^16.0.0","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-datetime":"^1.5.0","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.1","del":"^5.1.0","dotenv":"^8.1.0","express":"^4.17.1","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^3.0.0","gulp-insert":"^0.5.0","gulp-mocha":"^7.0.1","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^2.0.0","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0","jsdoc":"~3.5.5","jsdoc-strip-async-await":"^0.1.0","mocha":"^6.2.0","ngrok":"^3.2.5","nyc":"^14.1.1","sinon":"^7.4.2","sinon-chai":"^3.3.0","source-map-explorer":"^2.0.1","ts-node":"^8.3.0","tslint":"^5.19.0","twilio":"^3.34.0","typescript":"^3.6.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"engines":{"node":">=6"},"license":"MIT","main":"lib/index.js","name":"twilio-mcs-client","scripts":{},"types":"./lib/client.d.ts","version":"0.3.1"}},{}],"221":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/object/get-prototype-of")),o=a(e("babel-runtime/helpers/classCallCheck")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/possibleConstructorReturn")),d=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var u=e("events"),p=e("twilsock"),f=e("./configuration"),b=e("./registrar"),h=e("./logger"),m=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o["default"])(this,t);var a=(0,c["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this));if(!e||0===e.length)throw new Error("Token is required for Notifications client");n.logLevel=n.logLevel||"error",h.log.setLevel(n.logLevel),n.minTokenRefreshInterval;var i=n.productId||"notifications";return n.twilsockClient=n.twilsockClient||new p.TwilsockClient(e,i,n),n.transport=n.transport||n.twilsockClient,a.services={"twilsock":n.twilsockClient,"transport":n.transport,"config":new f.Configuration(null,n)},a.registrar=new b.Registrar(i,a.services.transport,a.services.twilsock,a.services.config),a.reliableTransportState={"overall":!1,"transport":!1,"registration":!1,"lastEmitted":null},a._onTransportStateChange(a.services.twilsock.isConnected),a.registrar.on("transportReady",function(e){
a._onRegistrationStateChange(e?"registered":"")}),a.registrar.on("stateChanged",function(e){a._onRegistrationStateChange(e)}),a.registrar.on("needReliableTransport",a._onNeedReliableTransport.bind(a)),a.services.twilsock.on("message",function(e,t){return a._routeMessage(e,t)}),a.services.twilsock.on("connected",function(e){a._onTransportStateChange(!0),a.registrar.setNotificationId("twilsock",e)}),a.services.twilsock.on("disconnected",function(){a._onTransportStateChange(!1)}),a.services.config.updateToken(e),a.registrar.updateToken(e),a}return(0,d["default"])(t,e),(0,l["default"])(t,[{"key":"_routeMessage","value":function(e,t){h.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{"key":"_onNeedReliableTransport","value":function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{"key":"_onRegistrationStateChange","value":function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{"key":"_onTransportStateChange","value":function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{"key":"_updateTransportState","value":function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,h.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{"key":"subscribe","value":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return h.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{"key":"unsubscribe","value":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return h.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{"key":"handlePushNotification","value":function(e){return{"messageType":e.twi_message_type,"payload":e.payload}}},{"key":"setPushRegistrationId","value":function(e,t){h.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{"key":"updateToken","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.log.info("authTokenUpdated"),this.services.config.token!==e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.services.twilsock.updateToken(e);case 5:this.services.config.updateToken(e),this.registrar.updateToken(e);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"connectionState","get":function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}}]),t}(u.EventEmitter);n.Client=m},{"./configuration":222,"./logger":225,"./registrar":227,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196,"twilsock":264}],"222":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i["default"])(this,e);var a=n.notifications||{},r="https://ers."+(a.region||n.region||"us1")+".twilio.com/v1/registrations";this.registrarUrl=a.ersUrl||r,this._token=t}return(0,r["default"])(e,[{"key":"updateToken","value":function(e){this._token=e}},{"key":"token","get":function(){return this._token}}]),e}();n.Configuration=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"223":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=new p["default"];return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[].concat((0,u["default"])([].concat((0,u["default"])(e)).filter(function(e){return!t.has(e)})),(0,u["default"])([].concat((0,u["default"])(t)).filter(function(t){return!e.has(t)})))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}var r=a(e("babel-runtime/helpers/slicedToArray")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/possibleConstructorReturn")),d=a(e("babel-runtime/helpers/inherits")),u=a(e("babel-runtime/helpers/toConsumableArray")),p=a(e("babel-runtime/core-js/set")),f=a(e("babel-runtime/helpers/classCallCheck")),b=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var h=e("events"),m=e("./logger"),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p["default"];(0,f["default"])(this,e),this.token=t,this.notificationId=n,this.messageTypes=a}return(0,b["default"])(e,[{"key":"clone","value":function(){return new e(this.token,this.notificationId,new p["default"](this.messageTypes))}}]),e}();n.RegistrationState=v;var g=function(e){function t(e){(0,f["default"])(this,t);var n=(0,c["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return n.config=e,n.desiredState=new v,n.currentState=new v,n.hasActiveAttempt=!1,n}return(0,d["default"])(t,e),(0,b["default"])(t,[{"key":"subscribe","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.desiredState.messageTypes.has(e)){t.next=3;break}return m.log.debug("message type already registered ",e),t.abrupt("return");case 3:return this.desiredState.messageTypes.add(e),t.next=6,this.persistRegistration();case 6:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"unsubscribe","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.desiredState.messageTypes.has(e)){t.next=2;break}return t.abrupt("return");case 2:return this.desiredState.messageTypes["delete"](e),t.next=5,this.persistRegistration();case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateToken","value":function(e){this.desiredState.token=e,this.persistRegistration()}},{"key":"persistRegistration","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){var e,n,a,o,l,c,d=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.config.token&&0!==this.config.token.length){t.next=3;break}return m.log.trace("Can't persist registration: token is not set"),t.abrupt("return");case 3:if(!this.hasActiveAttempt){t.next=6;break}return m.log.trace("One registration attempt is already in progress"),t.abrupt("return");case 6:if(e=i(this.desiredState,this.currentState),n=(0,r["default"])(e,2),a=n[0],o=n[1],a){t.next=9;break}return t.abrupt("return");case 9:if(this.currentState.notificationId||o["delete"]("notificationId"),m.log.trace("Persisting registration",o,this.desiredState),t.prev=11,this.hasActiveAttempt=!0,!((l=this.desiredState.clone()).messageTypes.size>0)){t.next=24;break}return t.next=17,this.updateRegistration(l,o);case 17:c=t.sent,this.currentState.token=c.token,this.currentState.notificationId=c.notificationId,this.currentState.messageTypes=c.messageTypes,this.emit("stateChanged","registered"),t.next=30;break;case 24:return t.next=26,this.removeRegistration();case 26:this.currentState.token=l.token,this.currentState.notificationId=l.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return t.prev=30,this.hasActiveAttempt=!1,setTimeout(function(){return d.persistRegistration()},0),t.finish(30);case 34:case"end":return t.stop()}},t,this,[[11,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{"key":"setNotificationId","value":function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),t}(h.EventEmitter);n.Connector=g},{"./logger":225,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/set":46,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/helpers/toConsumableArray":56,"babel-runtime/regenerator":58,"events":196}],"224":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./client");n.Notifications=a.Client},{"./client":221}],"225":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return[(new Date).toISOString()+" Notifications "+e+":"].concat((0,o["default"])(t))}var r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("loglevel"),c=function(){function e(){(0,r["default"])(this,e),this.prefix=""}return(0,s["default"])(e,[{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("T"+this.prefix,t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("D"+this.prefix,t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i("I"+this.prefix,t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i("W"+this.prefix,t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i("E"+this.prefix,t))}}],[{"key":"scope","value":function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],new e}}]),e}();n.Logger=c;var d=c.scope();n.log=d},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"loglevel":199}],"226":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/array/from")),r=a(e("babel-runtime/core-js/object/assign")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("operation-retrier"),b=e("./logger"),h=e("./connector");n.Connector=h.Connector;var m={"min":2e3,"max":12e4,"randomness":.2},v=function(e){function t(e,n,a,i){(0,c["default"])(this,t);var r=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,i));return r.channelType=e,r.context=n,r.transport=a,r}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"updateRegistration","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.has("notificationId")){t.next=3;break}return t.next=3,this.removeRegistration();case 3:if(e.notificationId&&e.notificationId.length){t.next=5;break}return t.abrupt("return",e);case 5:return t.next=7,this.register(e);case 7:return t.abrupt("return",e);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeRegistration","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){var e,n,a=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.registrationId){t.next=2;break}return t.abrupt("return");case 2:return e=this.config.registrarUrl+"/"+this.registrationId+"?productId="+this.context.productId,n={"Content-Type":"application/json","X-Twilio-Token":this.config.token},t.prev=4,b.log.trace("Removing registration for ",this.channelType),t.next=8,new f.Retrier((0,r["default"])(m,{"maxAttemptsCount":3})).run(function(){return a.transport["delete"](e,n)});case 8:b.log.debug("Registration removed for",this.channelType),t.next=15;break;case 11:throw t.prev=11,t.t0=t["catch"](4),b.log.error("Failed to remove of registration ",this.channelType,t.t0),t.t0;case 15:case"end":return t.stop()}},t,this,[[4,11]])}));return function(){return e.apply(this,arguments)}}()},{"key":"register","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,r,o,l=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.log.trace("Registering",this.channelType,e),n={"endpoint_platform":this.context.platform,"channel_type":this.channelType,"version":this.context.protocolVersion.toString(),"message_types":(0,i["default"])(e.messageTypes),"data":{"registration_id":e.notificationId},"ttl":"PT24H"},a=this.config.registrarUrl+"?productId="+this.context.productId,r={"Content-Type":"application/json","X-Twilio-Token":e.token},b.log.trace("Creating registration for channel ",this.channelType),t.prev=5,t.next=8,new f.Retrier(m).run(function(){return l.transport.post(a,r,n)});case 8:o=t.sent,this.registrationId=o.body.id,b.log.debug("Registration created: ",o),t.next=17;break;case 13:throw t.prev=13,t.t0=t["catch"](5),b.log.error("Registration failed: ",t.t0),t.t0;case 17:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return e.apply(this,arguments)}}()}]),t}(h.Connector);n.RegistrarConnector=v},{"./connector":223,"./logger":225,"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"operation-retrier":201}],"227":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/map")),r=a(e("babel-runtime/core-js/object/get-prototype-of")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),l=a(e("babel-runtime/helpers/possibleConstructorReturn")),c=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("events"),u=e("./registrar.connector"),p=e("./twilsock.connector"),f=function(e){function t(e,n,a,o){(0,s["default"])(this,t);var c=(0,l["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));c.config=o,c.connectors=new i["default"];var d=c.detectPlatform();return c.connectors.set("gcm",new u.RegistrarConnector("gcm",{"protocolVersion":3,"productId":e,"platform":d},n,o)),c.connectors.set("fcm",new u.RegistrarConnector("fcm",{"protocolVersion":3,"productId":e,"platform":d},n,o)),c.connectors.set("apn",new u.RegistrarConnector("apn",{"protocolVersion":4,"productId":e,"platform":d},n,o)),c.connectors.set("twilsock",new p.TwilsockConnector({"productId":e,"platform":d},a,o)),c.connectors.get("twilsock").on("transportReady",function(e){return c.emit("transportReady",e)}),c}return(0,c["default"])(t,e),(0,o["default"])(t,[{"key":"setNotificationId","value":function(e,t){this.connector(e).setNotificationId(t)}},{"key":"subscribe","value":function(e,t){return this.connector(t).subscribe(e)}},{"key":"unsubscribe","value":function(e,t){return this.connector(t).unsubscribe(e)}},{"key":"updateToken","value":function(e){this.connectors.forEach(function(t){return t.updateToken(e)})}},{"key":"connector","value":function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{"key":"detectPlatform","value":function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(d.EventEmitter);n.Registrar=f},{"./registrar.connector":226,"./twilsock.connector":228,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196}],"228":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/array/from")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("uuid"),f=function(e){function t(e,n,a){(0,l["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,a));return i.twilsock=n,i.context=e,e.id=p.v4(),i.twilsock.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),i.twilsock.on("registered",function(t){e&&t===e.id&&"connected"===n.state&&i.emit("transportReady",!0)}),i}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"setNotificationId","value":function(){}},{"key":"updateToken","value":function(){}},{"key":"updateContextRequest","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"product_id":this.context.productId,"notification_protocol_version":4,"endpoint_platform":this.context.platform,"message_types":e},this.emit("transportReady",!1),t.next=4,this.twilsock.setNotificationsContext(this.context.id,n);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateRegistration","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e,n){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.has("messageType")){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.updateContextRequest((0,i["default"])(e.messageTypes));case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeRegistration","value":function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),t}(e("./connector").Connector);n.TwilsockConnector=f},{"./connector":223,"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"uuid":283}],"229":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=e("./utils/tree"),o=function(){function e(t,n){(0,i["default"])(this,e),this.value=t,this.revision=n||0}return(0,r["default"])(e,[{"key":"isValid","get":function(){return!0}}]),e}(),l=function(){function e(t){(0,i["default"])(this,e),this.revision=t}return(0,r["default"])(e,[{"key":"isValid","get":function(){return!1}}]),e}(),c=function(){function e(){(0,i["default"])(this,e),this.items=new s.TreeMap}return(0,r["default"])(e,[{"key":"store","value":function(e,t,n){var a=this.items.get(e);return a&&a.revision>n?a.isValid?a.value:null:(this.items.set(e,new o(t,n)),t)}},{"key":"delete","value":function(e,t){var n=this.items.get(e);(!n||n.revision<t)&&this.items.set(e,new l(t))}},{"key":"isKnown","value":function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{"key":"get","value":function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{"key":"has","value":function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();n.Cache=c,n["default"]=c},{"./utils/tree":253,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"230":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e){if("string"==typeof e)return{"id":e,"mode":"open_or_create"};_.validateOptionalTtl(e.ttl);var t=e.mode||(e.id?"open_or_create":"create_new");return(0,f["default"])((0,f["default"])({},e),{"mode":t})}return{"mode":"create_new"}}var r=a(e("babel-runtime/core-js/promise")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits")),f=a(e("babel-runtime/core-js/object/assign"));Object.defineProperty(n,"__esModule",{"value":!0});var b=e("events"),h=e("twilsock"),m=e("twilio-notifications"),v=e("./utils/uri"),g=e("./utils/syncerror"),_=e("./utils/sanitize"),y=e("./utils/logger"),w=e("./configuration"),k=e("./subscriptions"),C=e("./router"),x=e("./services/network"),T=e("./syncdocument"),S=e("./synclist"),M=e("./syncmap"),$=e("./clientInfo"),j=e("./entitiesCache"),E=e("./services/storage"),A=e("./streams/syncstream"),P=e("./livequery"),I=e("./livequery"),D="data_sync",R=e("../package.json").version,L=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,c["default"])(this,t);var a=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")?y["default"].setLevel(n.logLevel):y["default"].setLevel("silent");var i=n.productId=n.productId||D,r=n.twilsockClient=n.twilsockClient||new h.Twilsock(e,i,n);r.on("tokenAboutToExpire",function(e){return a.emit("tokenAboutToExpire",e)}),r.on("tokenExpired",function(){return a.emit("tokenExpired")}),r.on("connectionError",function(e){return a.emit("connectionError",e)});var s=n.notificationsClient=n.notificationsClient||new m.Notifications(e,n),o=new w.Configuration(n),d=new x.NetworkService(new $.ClientInfo(R),o,r),p=new E.SessionStorage(o);a.localStorageId=null,r.connect(),a.services={"config":o,"twilsock":r,"notifications":s,"network":d,"storage":p,"router":null,"subscriptions":null};var f=new k.Subscriptions(a.services),b=new C.Router({"config":o,"subscriptions":f,"notifications":s});return a.services.router=b,a.services.subscriptions=f,a.entities=new j.EntitiesCache,s.on("connectionStateChanged",function(){a.emit("connectionStateChanged",a.services.notifications.connectionState)}),a}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"ensureReady","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){var e;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.services.config.sessionStorageEnabled){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.services.twilsock.storageId();case 5:e=t.sent,this.services.storage.updateStorageId(e.id),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),y["default"].warn("Failed to initialize storage",t.t0);case 12:case"end":return t.stop()}},t,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{"key":"storeRootInSessionCache","value":function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var a=_.deepClone(n);e!==S.SyncList.type&&e!==M.SyncMap.type||(a.last_event_id=null,delete a.items),this.services.storage.store(e,t,a)}}},{"key":"readRootFromSessionCache","value":function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{"key":"_get","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){var a,i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new g.SyncError("Cannot get entity without id",404);case 2:return a=new v.UriBuilder(e).pathSegment(n).queryParam("Include",r?"items":void 0).build(),t.next=5,this.services.network.get(a);case 5:return i=t.sent,t.abrupt("return",i.body);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_createDocument","value":function(e,t,n){var a={"unique_name":e,"data":t||{}};return"number"==typeof n&&(a.ttl=n),this.services.network.post(this.services.config.documentsUri,a).then(function(e){return e.body.data=a.data,e.body})}},{"key":"_getDocument","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(T.SyncDocument.type,e)||this._get(this.services.config.documentsUri,e));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_createList","value":function(e,t,n,a){var i={"unique_name":e,"purpose":t,"context":n};return"number"==typeof a&&(i.ttl=a),this.services.network.post(this.services.config.listsUri,i).then(function(e){return e.body})}},{"key":"_getList","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(S.SyncList.type,e)||this._get(this.services.config.listsUri,e));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_createMap","value":function(e,t){var n={"unique_name":e};return"number"==typeof t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then(function(e){return e.body})}},{"key":"_getMap","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(M.SyncMap.type,e)||this._get(this.services.config.mapsUri,e,n));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_getStream","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(A.SyncStream.type,e)||this._get(this.services.config.streamsUri,e,!1));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_createStream","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){var a,i,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={"unique_name":e},"number"==typeof n&&(a.ttl=n),t.next=4,this.services.network.post(this.services.config.streamsUri,a);case 4:return i=t.sent,r=i.body,t.abrupt("return",r);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_getLiveQuery","value":function(e){return this.readRootFromSessionCache(P.LiveQuery.type,e)}},{"key":"getCached","value":function(e,t){return e&&this.entities.get(e,t)||null}},{"key":"removeFromCacheAndSession","value":function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{"key":"document","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,r,o,l=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(n=i(e),a=void 0,"create_new"!==n.mode){t.next=10;break}return t.next=7,this._createDocument(n.id,n.value,n.ttl);case 7:a=t.sent,t.next=40;break;case 10:if(!(r=this.getCached(n.id,T.SyncDocument.type))){t.next=15;break}return t.abrupt("return",new T.SyncDocument(r));case 15:return t.prev=15,t.next=18,this._getDocument(n.id);case 18:a=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t["catch"](15),404===t.t0.status&&"open_existing"!==n.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createDocument(n.id,n.value,n.ttl);case 30:a=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t["catch"](27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.document(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(T.SyncDocument.type,n.id,a),o=new T.SyncDocumentImpl(this.services,a,function(e,t,n){return l.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),t.abrupt("return",new T.SyncDocument(o));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}));return function(){return e.apply(this,arguments)}}()},{"key":"map","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,r,o,l=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(n=i(e),a=void 0,"create_new"!==n.mode){t.next=10;break}return t.next=7,this._createMap(n.id,n.ttl);case 7:a=t.sent,t.next=40;break;case 10:if(!(r=this.getCached(n.id,M.SyncMap.type))){t.next=15;break}return t.abrupt("return",new M.SyncMap(r));case 15:return t.prev=15,t.next=18,this._getMap(n.id,n.includeItems);case 18:a=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t["catch"](15),404===t.t0.status&&"open_existing"!==n.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createMap(n.id,n.ttl);case 30:a=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t["catch"](27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.map(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(M.SyncMap.type,n.id,a),o=new M.SyncMapImpl(this.services,a,function(e,t,n){return l.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),t.abrupt("return",new M.SyncMap(o));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}));return function(){return e.apply(this,arguments)}}()},{"key":"list","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,r,o,l=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(n=i(e),a=void 0,"create_new"!==n.mode){t.next=10;break}return t.next=7,this._createList(n.id,n.purpose,n.context,n.ttl);case 7:a=t.sent,t.next=40;break;case 10:if(!(r=this.getCached(n.id,S.SyncList.type))){t.next=15;break}return t.abrupt("return",new S.SyncList(r));case 15:return t.prev=15,t.next=18,this._getList(n.id);case 18:a=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t["catch"](15),404===t.t0.status&&"open_existing"!==n.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createList(n.id,n.purpose,n.context,n.ttl);case 30:a=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t["catch"](27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.list(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(S.SyncList.type,n.id,a),o=new S.SyncListImpl(this.services,a,function(e,t,n){return l.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),t.abrupt("return",new S.SyncList(o));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}));return function(){return e.apply(this,arguments)}}()},{"key":"stream","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,r,o,l,c=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(n=i(e),a=void 0,"create_new"!==n.mode){t.next=10;break}return t.next=7,this._createStream(n.id,n.ttl);case 7:a=t.sent,t.next=40;break;case 10:if(!(r=this.getCached(n.id,A.SyncStream.type))){t.next=15;break}return t.abrupt("return",new A.SyncStream(r));case 15:return t.prev=15,t.next=18,
this._getStream(n.id);case 18:a=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t["catch"](15),404===t.t0.status&&"open_existing"!==n.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createStream(n.id,n.ttl);case 30:a=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t["catch"](27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.stream(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(A.SyncStream.type,n.id,a),o=function(e,t,n){return c.removeFromCacheAndSession(e,t,n)},l=new A.SyncStreamImpl(this.services,a,o),l=this.entities.store(l),t.abrupt("return",new A.SyncStream(l));case 45:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}));return function(){return e.apply(this,arguments)}}()},{"key":"shutdown","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateToken","value":function(e){return e?this.services.twilsock.updateToken(e):r["default"].reject(new Error("A valid Twilio token should be provided"))}},{"key":"liveQuery","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){var a,i,r,o,l,c=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(e&&"string"==typeof e){t.next=4;break}throw new Error("Index name must contain a non-empty string value");case 4:return a=new v.UriBuilder(this.services.config.insightsUri).pathSegment(e).pathSegment("Items").build(),t.next=7,I.queryItems({"network":this.services.network,"uri":a,"queryString":n});case 7:return i=t.sent,(r=this.getCached(i.query_id,P.LiveQuery.type))||((o=this._getLiveQuery(i.query_id))||(o={"indexName":e,"queryExpression":n,"sid":i.query_id,"queryUri":a}),l=function(e,t,n){return c.removeFromCacheAndSession(e,t,n)},r=new P.LiveQueryImpl(o,this.services,l,i.items)),this.storeRootInSessionCache(P.LiveQuery.type,i.query_id,r.liveQueryDescriptor),r=this.entities.store(r),t.abrupt("return",new P.LiveQuery(r));case 13:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"instantQuery","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,i=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=function(e,t){return i.liveQuery(e,t)},a=new P.InstantQuery({"indexName":e,"network":this.services.network,"insightsUri":this.services.config.insightsUri,"liveQueryCreator":n}),t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"connectionState","get":function(){return this.services.notifications.connectionState}}],[{"key":"version","get":function(){return R}}]),t}(b.EventEmitter);n.Client=L,n.SyncClient=L,n["default"]=L},{"../package.json":255,"./clientInfo":231,"./configuration":233,"./entitiesCache":234,"./livequery":238,"./router":242,"./services/network":243,"./services/storage":244,"./streams/syncstream":245,"./subscriptions":246,"./syncdocument":247,"./synclist":248,"./syncmap":249,"./utils/logger":250,"./utils/sanitize":251,"./utils/syncerror":252,"./utils/uri":254,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196,"twilio-notifications":224,"twilsock":264}],"231":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0});var r=e("platform"),s=function o(e){(0,i["default"])(this,o),this.sdk="js",this.sdkVer=e,this.os=r.os.family,this.osVer=r.os.version,this.pl=r.name,this.plVer=r.version};n.ClientInfo=s,n["default"]=s},{"babel-runtime/helpers/classCallCheck":50,"platform":203}],"232":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),l=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var c=e("events"),d=e("uuid"),u=function(e){function t(){(0,r["default"])(this,t);var e=(0,o["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this));return e.closed=!1,e.uuid=d(),e}return(0,l["default"])(t,e),(0,s["default"])(t,[{"key":"close","value":function(){this.removeAllListeners(),this.closed=!0}},{"key":"ensureNotClosed","value":function(){if(this.closed)throw new Error("Invalid operation on closed object")}},{"key":"listenerUuid","get":function(){return this.uuid}}]),t}(c.EventEmitter);n.Closeable=u,n["default"]=u},{"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196,"uuid":283}],"233":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s="/v4/Subscriptions",o="/v3/Maps",l="/v3/Lists",c="/v3/Documents",d="/v3/Streams",u="/v3/Insights",p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i["default"])(this,e);var n,a,r,p="https://cds."+(t.region||"us1")+".twilio.com",f=t.cdsUri||p;this.settings={"subscriptionsUri":f+s,"documentsUri":f+c,"listsUri":f+l,"mapsUri":f+o,"streamsUri":f+d,"insightsUri":f+u,"sessionStorageEnabled":(n=t.Sync,a="enableSessionStorage",r=!0,n&&void 0!==n[a]?n[a]:r)}}return(0,r["default"])(e,[{"key":"subscriptionsUri","get":function(){return this.settings.subscriptionsUri}},{"key":"documentsUri","get":function(){return this.settings.documentsUri}},{"key":"listsUri","get":function(){return this.settings.listsUri}},{"key":"mapsUri","get":function(){return this.settings.mapsUri}},{"key":"streamsUri","get":function(){return this.settings.streamsUri}},{"key":"insightsUri","get":function(){return this.settings.insightsUri}},{"key":"backoffConfig","get":function(){return this.settings.backoffConfig||{}}},{"key":"sessionStorageEnabled","get":function(){return this.settings.sessionStorageEnabled}}]),e}();n.Configuration=p},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"234":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/map")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var o=function(){function e(){(0,r["default"])(this,e),this.names=new i["default"],this.entities=new i["default"]}return(0,s["default"])(e,[{"key":"store","value":function(e){return this.entities.get(e.sid)||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{"key":"getResolved","value":function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{"key":"get","value":function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{"key":"remove","value":function(e){var t=this.entities.get(e);t&&(this.entities["delete"](e),t.uniqueName&&this.names["delete"](t.type+"::"+t.uniqueName))}}]),e}();n.EntitiesCache=o},{"babel-runtime/core-js/map":35,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"235":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/get-iterator")),r=a(e("babel-runtime/core-js/map")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(){function e(t,n){(0,s["default"])(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new r["default"]}return(0,o["default"])(e,[{"key":"_advanceLastEventId","value":function(){}},{"key":"reportFailure","value":function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{"key":"_subscribe","value":function(){this.services.router.subscribe(this.sid,this)}},{"key":"_unsubscribe","value":function(){this.services.router.unsubscribe(this.sid)}},{"key":"_setSubscriptionState","value":function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{"key":"close","value":function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{"key":"attach","value":function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{"key":"detach","value":function(e){this._attachedListeners["delete"](e),this._attachedListeners.size||this.close()}},{"key":"broadcastEventToListeners","value":function(e,t){var n=!0,a=!1,r=void 0;try{for(var s,o=(0,i["default"])(this._attachedListeners.values());!(n=(s=o.next()).done);n=!0)s.value.emit(e,t)}catch(e){a=!0,r=e}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw r}}}}]),e}();n.SyncEntity=l,n["default"]=l},{"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/map":35,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"236":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./client");n.SyncClient=a.SyncClient;var i=e("./syncdocument");n.SyncDocument=i.SyncDocument;var r=e("./synclist");n.SyncList=r.SyncList;var s=e("./listitem");n.SyncListItem=s.ListItem;var o=e("./syncmap");n.SyncMap=o.SyncMap;var l=e("./mapitem");n.SyncMapItem=l.MapItem,n["default"]=a.SyncClient,t.exports=a.SyncClient,t.exports.SyncClient=a.SyncClient},{"./client":230,"./listitem":237,"./mapitem":239,"./syncdocument":247,"./synclist":248,"./syncmap":249}],"237":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(t){(0,i["default"])(this,e),this.data=t}return(0,r["default"])(e,[{"key":"update","value":function(e,t,n,a){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this.data.dateUpdated=a,this}},{"key":"updateDateExpires","value":function(e){this.data.dateExpires=e}},{"key":"uri","get":function(){return this.data.uri}},{"key":"revision","get":function(){return this.data.revision}},{"key":"lastEventId","get":function(){return this.data.lastEventId}},{"key":"dateUpdated","get":function(){return this.data.dateUpdated}},{"key":"dateExpires","get":function(){return this.data.dateExpires}},{"key":"index","get":function(){return this.data.index}},{"key":"value","get":function(){return this.data.value}}]),e}();n.ListItem=s,n["default"]=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"238":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e)return e.reduce(function(e,t){return e[t.key]={"key":t.key,"value":t.data,"revision":t.revision},e},{})}var r,s=a(e("babel-runtime/core-js/promise")),o=a(e("babel-runtime/core-js/object/assign")),l=a(e("babel-runtime/helpers/get")),c=a(e("babel-runtime/regenerator")),d=a(e("babel-runtime/helpers/asyncToGenerator")),u=a(e("babel-runtime/core-js/object/keys")),p=a(e("babel-runtime/core-js/object/get-prototype-of")),f=a(e("babel-runtime/helpers/createClass")),b=a(e("babel-runtime/helpers/possibleConstructorReturn")),h=a(e("babel-runtime/helpers/inherits")),m=a(e("babel-runtime/helpers/classCallCheck")),v=(r=(0,d["default"])(c["default"].mark(function M(e){var t,n,a,i,r;return c["default"].wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t=e.network,n=e.queryString,a=e.uri,null!=n){s.next=3;break}throw new _.SyncError("Invalid query",400,54507);case 3:return i={"query_string":n},s.next=6,t.post(a,i,void 0,!0);case 6:return r=s.sent,s.abrupt("return",r.body);case 8:case"end":return s.stop()}},M,this)})),function(){return r.apply(this,arguments)});Object.defineProperty(n,"__esModule",{"value":!0});var g=e("./utils/uri"),_=e("./utils/syncerror"),y=e("./utils/logger"),w=e("events"),k=e("./entity"),C=e("./closeable");n.InsightsItem=function $(){(0,m["default"])(this,$)};var x=function(e){function t(e,n,a,r){(0,m["default"])(this,t);var s=(0,b["default"])(this,(t.__proto__||(0,p["default"])(t)).call(this,n,a));return s.descriptor=e,s.items=i(r),s}return(0,h["default"])(t,e),(0,f["default"])(t,[{"key":"onRemoved","value":function(){}},{"key":"getItems","value":function(){var e=this,t={};return this.items&&(0,u["default"])(this.items).map(function(n){t[n]=e.items[n].value}),t}},{"key":"_update","value":function(e){var t=e.item_key,n=e.item_revision;switch(e.type){case"live_query_item_updated":var a=this.items[t];if(!a||n>a.revision){var i={"key":t,"revision":n,"value":e.item_data};this.items[t]=i,this.broadcastEventToListeners("itemUpdated",i)}break;case"live_query_item_removed":delete this.items[t],this.broadcastEventToListeners("itemRemoved",{"key":t})}}},{"key":"sid","get":function(){return this.descriptor.sid}},{"key":"uniqueName","get":function(){return null}},{"key":"type","get":function(){return t.type}},{"key":"lastEventId","get":function(){return null}},{"key":"indexName","get":function(){return this.descriptor.indexName}},{"key":"queryString","get":function(){return this.descriptor.queryExpression}},{"key":"queryUri","get":function(){return this.descriptor.queryUri}},{"key":"liveQueryDescriptor","get":function(){return this.descriptor}},{"key":"network","get":function(){return this.services.network}}],[{"key":"type","get":function(){return"live_query"}}]),t}(k.SyncEntity);n.LiveQueryImpl=x,n.queryItems=v;var T=function(e){function t(e){(0,m["default"])(this,t);var n=(0,b["default"])(this,(t.__proto__||(0,p["default"])(t)).call(this));return n.liveQueryImpl=e,n.liveQueryImpl.attach(n),n}return(0,h["default"])(t,e),(0,f["default"])(t,[{"key":"close","value":function(){(0,l["default"])(t.prototype.__proto__||(0,p["default"])(t.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{"key":"getItems","value":function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}},{"key":"type","get":function(){return x.type}},{"key":"sid","get":function(){return this.liveQueryImpl.sid}}],[{"key":"type","get":function(){return x.type}}]),t}(C["default"]);n.LiveQuery=T;var S=function(e){function t(e){(0,m["default"])(this,t);var n=(0,b["default"])(this,(t.__proto__||(0,p["default"])(t)).call(this));return n.queryExpression=null,(0,o["default"])(n,e),n.updateIndexName(e.indexName),n}return(0,h["default"])(t,e),(0,f["default"])(t,[{"key":"search","value":function(){var e=(0,d["default"])(c["default"].mark(function t(e){var n=this;return c["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",v({"network":this.network,"uri":this.queryUri,"queryString":e}).then(function(t){n.queryExpression=e,n.items=i(t.items),n.emit("searchResult",n.getItems())})["catch"](function(t){throw y["default"].error("Error '"+t.message+"' while executing query '"+e+"'"),n.queryExpression=null,n.items=null,t}));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"subscribe","value":function(){var e=(0,d["default"])(c["default"].mark(function t(){return c["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",s["default"].reject(new _.SyncError("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getItems","value":function(){var e=this,t={};return this.items&&(0,u["default"])(this.items).map(function(n){t[n]=e.items[n].value}),t}},{"key":"updateIndexName","value":function(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{"key":"generateQueryUri","value":function(e){return new g.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}},{"key":"type","get":function(){return t.type}}],[{"key":"type","get":function(){return"instant_query"}}]),t}(w.EventEmitter);n.InstantQuery=S,n["default"]=T},{"./closeable":232,"./entity":235,"./utils/logger":250,"./utils/syncerror":252,"./utils/uri":254,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/object/keys":42,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"239":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(t){(0,i["default"])(this,e),this.descriptor=t}return(0,r["default"])(e,[{"key":"update","value":function(e,t,n,a){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=a,this}},{"key":"updateDateExpires","value":function(e){this.descriptor.date_expires=e}},{"key":"uri","get":function(){return this.descriptor.url}},{"key":"revision","get":function(){return this.descriptor.revision}},{"key":"lastEventId","get":function(){return this.descriptor.last_event_id}},{"key":"dateExpires","get":function(){return this.descriptor.date_expires}},{"key":"key","get":function(){return this.descriptor.key}},{"key":"value","get":function(){return this.descriptor.data}},{"key":"dateUpdated","get":function(){return this.descriptor.date_updated}}]),e}();n.MapItem=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"240":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/map")),o=a(e("babel-runtime/core-js/promise")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var d=function(){function e(t){(0,l["default"])(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return(0,c["default"])(e,[{"key":"add","value":function(e,t){var n=this,a=new o["default"](function(a,i){return n.queuedRequests.push({"input":e,"requestFunction":t,"resolve":a,"reject":i})});return this.wakeupQueue(),a}},{"key":"squashAndAdd","value":function(e,t){var n=this.queuedRequests;this.queuedRequests=[];var a=void 0;n.length>0?(a=n.map(function(e){return e.input}).reduce(this.inputMergingFunction),a=this.inputMergingFunction(a,e)):a=e;var i=this.add(a,t);return n.forEach(function(e){return i.then(e.resolve,e.reject)}),i}},{"key":"isEmpty","value":function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{"key":"wakeupQueue","value":function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then(function(){e.isRequestInFlight=!1,e.wakeupQueue()})}}}]),e}();n.MergingQueue=d;var u=function(){function e(t){(0,l["default"])(this,e),this.queueByNamespaceKey=new s["default"],this.inputReducer=t}return(0,c["default"])(e,[{"key":"add","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n,a){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.invokeQueueMethod(e,function(e){return e.add(n,a)}));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"squashAndAdd","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n,a){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.invokeQueueMethod(e,function(e){return e.squashAndAdd(n,a)}));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"invokeQueueMethod","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n){var a,r;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.queueByNamespaceKey.has(e)||this.queueByNamespaceKey.set(e,new d(this.inputReducer)),a=this.queueByNamespaceKey.get(e),r=n(a),this.queueByNamespaceKey.get(e).isEmpty()&&this.queueByNamespaceKey["delete"](e),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();n.NamespacedMergingQueue=u},{"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"241":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(){function e(t,n,a,i){(0,s["default"])(this,e),this.prevToken=a,this.nextToken=i,this.items=t,this.source=n}return(0,o["default"])(e,[{"key":"nextPage","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"prevPage","value":function(){var e=(0,r["default"])(i["default"].mark(function t(){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"hasNextPage","get":function(){return!!this.nextToken}},{"key":"hasPrevPage","get":function(){return!!this.prevToken}}]),e}();n.Paginator=l},{"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"242":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=e("./utils/logger"),o="com.twilio.rtd.cds.document",l="com.twilio.rtd.cds.list",c="com.twilio.rtd.cds.map",d="twilio.sync.event",u=function(){function e(t){var n=this;(0,i["default"])(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(d),this.notifications.subscribe(o),this.notifications.subscribe(l),this.notifications.subscribe(c),this.notifications.on("message",function(e,t){return n.onMessage(e,t)}),this.notifications.on("transportReady",function(e){return n.onConnectionStateChanged(e)})}return(0,r["default"])(e,[{"key":"onMessage","value":function(e,t){switch(s["default"].trace("Notification type:",e,"content:",t),e){case o:case l:case c:this.subscriptions.acceptMessage(t,!1);break;case d:this.subscriptions.acceptMessage(t,!0)}}},{"key":"subscribe","value":function(e,t){this.subscriptions.add(e,t)}},{"key":"unsubscribe","value":function(e){this.subscriptions.remove(e)}},{"key":"onConnectionStateChanged","value":function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();n.Router=u,n["default"]=u},{"./utils/logger":250,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"243":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function r(e){return e.body?e.body.code:0}function s(e){return 409===e.status?new f.SyncNetworkError(i(e),e.status,r(e),e.body):e.status?new f.SyncError(i(e),e.status,r(e)):e instanceof m.TransportUnavailableError?e:new f.SyncError(e.message,0,0)}var o=a(e("babel-runtime/core-js/promise")),l=a(e("babel-runtime/core-js/object/assign")),c=a(e("babel-runtime/core-js/json/stringify")),d=a(e("babel-runtime/helpers/classCallCheck")),u=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("uuid"),f=e("../utils/syncerror"),b=e("../utils/logger"),h=e("operation-retrier"),m=e("twilsock"),v=function(){function e(t,n,a){(0,d["default"])(this,e),this.clientInfo=t,this.config=n,this.transport=a}return(0,u["default"])(e,[{"key":"createHeaders","value":function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,c["default"])(this.clientInfo),"Twilio-Request-Id":"RQ"+p.v4().replace(/-/g,"")}}},{"key":"backoffConfig","value":function(){return(0,l["default"])({"min":4e3,"max":6e4,"maxAttemptsTime":9e4,"randomness":.2},this.config.backoffConfig)}},{"key":"executeWithRetry","value":function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new o["default"](function(a,i){var r=[502,503,504];n&&r.push(429);var o=new h.Retrier(t.backoffConfig());o.on("attempt",function(){e().then(function(e){return o.succeeded(e)})["catch"](function(e){if(r.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);o.failed(s(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?o.failed(s(e)):(o.removeAllListeners(),o.cancel(),i(s(e)))})}),o.on("succeeded",function(e){a(e)}),o.on("cancelled",function(e){return i(s(e))}),o.on("failed",function(e){return i(s(e))}),o.start()})}},{"key":"get","value":function(e){var t=this,n=this.createHeaders();return b["default"].debug("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,n)},!0)}},{"key":"post","value":function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.createHeaders();return null!=n&&(r["If-Match"]=n),b["default"].debug("POST",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return a.transport.post(e,r,t)},i)}},{"key":"put","value":function(e,t,n){var a=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),b["default"].debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return a.transport.put(e,i,t)},!1)}},{"key":"delete","value":function(e){var t=this,n=this.createHeaders();return b["default"].debug("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport["delete"](e,n)},!1)}}]),e}();n.NetworkService=v},{"../utils/logger":250,"../utils/syncerror":252,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"operation-retrier":201,"twilsock":264,"uuid":283}],"244":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/assign")),r=a(e("babel-runtime/core-js/json/stringify")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(){function e(t,n){(0,s["default"])(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return(0,o["default"])(e,[{"key":"storageKey","value":function(e,t){return this.storageId+"::"+e+"::"+t}},{"key":"updateStorageId","value":function(e){this.storageId=e}},{"key":"store","value":function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{"key":"read","value":function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{"key":"remove","value":function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{"key":"update","value":function(e,t,n,a){if(!this.isReady)return null;this._apply(this.storageKey(e,t),a),n&&this._apply(this.storageKey(e,n),a)}},{"key":"_store","value":function(e,t){try{this.storage.setItem(e,(0,r["default"])(t))}catch(e){}}},{"key":"_read","value":function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{"key":"_apply","value":function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,(0,i["default"])(n,t))}},{"key":"isReady","get":function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();n.SessionStorage=l},{"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/assign":37,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"245":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/get")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("../entity"),f=e("../utils/sanitize"),b=e("../closeable"),h=function(e){function t(e,n,a){(0,l["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e,a));return i.descriptor=n,i}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"publishMessage","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n,a,i,s;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"data":e},t.next=3,this.services.network.post(this.links.messages,n);case 3:return a=t.sent,i=a.body,s=this._handleMessagePublished(i.sid,e,!1),t.abrupt("return",s);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n,a;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.validateMandatoryTtl(e),t.prev=1,n={"ttl":e},t.next=5,this.services.network.post(this.uri,n);case 5:a=t.sent,this.descriptor.date_expires=a.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t["catch"](1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}));return function(){return e.apply(this,arguments)}}()},{"key":"removeStream","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network["delete"](this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_update","value":function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{"key":"_handleMessagePublished","value":function(e,t,n){var a={"sid":e,"value":t};return this.broadcastEventToListeners("messagePublished",{"message":a,"isLocal":!n}),a}},{"key":"onRemoved","value":function(e){this._unsubscribe(),
this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{"isLocal":e})}},{"key":"uri","get":function(){return this.descriptor.url}},{"key":"links","get":function(){return this.descriptor.links}},{"key":"dateExpires","get":function(){return this.descriptor.date_expires}},{"key":"type","get":function(){return"stream"}},{"key":"lastEventId","get":function(){return null}},{"key":"indexName","get":function(){}},{"key":"queryString","get":function(){}},{"key":"sid","get":function(){return this.descriptor.sid}},{"key":"uniqueName","get":function(){return this.descriptor.unique_name||null}}],[{"key":"type","get":function(){return"stream"}}]),t}(p.SyncEntity);n.SyncStreamImpl=h;var m=function(e){function t(e){(0,l["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return n.syncStreamImpl=e,n.syncStreamImpl.attach(n),n}return(0,u["default"])(t,e),(0,c["default"])(t,[{"key":"publishMessage","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncStreamImpl.publishMessage(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncStreamImpl.setTtl(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeStream","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){return r["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"close","value":function(){(0,i["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}},{"key":"uri","get":function(){return this.syncStreamImpl.uri}},{"key":"links","get":function(){return this.syncStreamImpl.links}},{"key":"dateExpires","get":function(){return this.syncStreamImpl.dateExpires}},{"key":"type","get":function(){return h.type}},{"key":"lastEventId","get":function(){return null}},{"key":"sid","get":function(){return this.syncStreamImpl.sid}},{"key":"uniqueName","get":function(){return this.syncStreamImpl.uniqueName}}],[{"key":"type","get":function(){return h.type}}]),t}(b["default"]);n.SyncStream=m,n["default"]=m},{"../closeable":232,"../entity":235,"../utils/sanitize":251,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58}],"246":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/get-iterator")),o=a(e("babel-runtime/helpers/slicedToArray")),l=a(e("babel-runtime/core-js/object/assign")),c=a(e("babel-runtime/core-js/map")),d=a(e("babel-runtime/helpers/classCallCheck")),u=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("operation-retrier"),f=e("./utils/syncerror"),b=e("./utils/logger"),h=e("twilsock"),m=function(){function e(t){(0,d["default"])(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return(0,u["default"])(e,[{"key":"update","value":function(e,t){this.localObject._update(e,t)}},{"key":"updatePending","value":function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{"key":"reset","value":function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{"key":"markAsFailed","value":function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new f.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status,e.error.code))}},{"key":"complete","value":function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{"key":"setSubscriptionState","value":function(e){this.localObject._setSubscriptionState(e)}},{"key":"sid","get":function(){return this.localObject.sid}},{"key":"type","get":function(){return this.localObject.type}},{"key":"lastEventId","get":function(){return this.localObject.lastEventId}},{"key":"indexName","get":function(){return this.localObject.indexName}},{"key":"queryString","get":function(){return this.localObject.queryString}},{"key":"isEstablished","get":function(){return this.established}}]),e}(),v=function(){function e(t){var n=this;(0,d["default"])(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new c["default"],this.persisted=new c["default"],this.latestPokeResponseArrivalTimestampByCorrelationId=new c["default"],this.backoff=p.Backoff.exponential((0,l["default"])({"randomisationFactor":.2,"initialDelay":100,"maxDelay":12e4},this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,a=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,a):(n.backoff.reset(),b["default"].debug("All subscriptions resolved."))})}return(0,u["default"])(e,[{"key":"getSubscriptionUpdateBatch","value":function(){function e(e,t,n,a){var i=[],r=!0,l=!1,c=void 0;try{for(var d,u=(0,s["default"])(e);!(r=(d=u.next()).done);r=!0){var p=d.value,f=(0,o["default"])(p,2),b=f[0],h=f[1];if(!t.get(b)&&n!==h.pendingAction&&!h.rejectedWithError&&(i.push(h),a&&i.length>=a))break}}catch(e){l=!0,c=e}finally{try{!r&&u["return"]&&u["return"]()}finally{if(l)throw c}}return i}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{"action":"establish","subscriptions":t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{"action":"cancel","subscriptions":n}:{"action":null,"subscriptions":null}}},{"key":"persist","value":function(){this.backoff.backoff()}},{"key":"applyNewSubscriptionUpdateBatch","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e,n){var a,r,o,l,c,d,u,p,f,m,v,g,_,y,w,k,C,x,T=this;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isConnected){t.next=4;break}return b["default"].debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),t.abrupt("return");case 4:for(n=this.processLocalActions(e,n),a=(new Date).getTime(),r=!0,o=!1,l=void 0,t.prev=9,c=(0,s["default"])(n);!(r=(d=c.next()).done);r=!0)u=d.value,this.recordActionAttemptOn(u,e,a);t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](9),o=!0,l=t.t0;case 17:t.prev=17,t.prev=18,!r&&c["return"]&&c["return"]();case 20:if(t.prev=20,!o){t.next=23;break}throw l;case 23:return t.finish(20);case 24:return t.finish(17);case 25:return p=this.pendingPokeReason,this.pendingPokeReason=null,t.prev=27,t.next=30,this.request(e,a,p,n);case 30:f=t.sent,m=f.body.max_batch_size,!isNaN(parseInt(m))&&isFinite(m)&&m>0&&(this.maxBatchSize=m),this.subscriptionTtlTimer||(v=f.body.ttl_in_s,!isNaN(parseFloat(v))&&isFinite(v)&&v>0&&(this.subscriptionTtlTimer=setTimeout(function(){return T.onSubscriptionTtlElapsed()},1e3*v))),"establish"===e&&(g=f.body.estimated_delivery_in_ms,!isNaN(parseFloat(g))&&isFinite(g)&&g>0?setTimeout(function(){return T.verifyPokeDelivery(a,g,n)},g):b["default"].error("Invalid timeout: "+g),n.filter(function(e){return e.pendingCorrelationId===a}).forEach(function(e){return e.setSubscriptionState("response_in_flight")})),this.backoff.reset(),t.next=60;break;case 38:for(t.prev=38,t.t1=t["catch"](27),_=!0,y=!1,w=void 0,t.prev=43,k=(0,s["default"])(n);!(_=(C=k.next()).done);_=!0)x=C.value,this.recordActionFailureOn(x,e);t.next=51;break;case 47:t.prev=47,t.t2=t["catch"](43),y=!0,w=t.t2;case 51:t.prev=51,t.prev=52,!_&&k["return"]&&k["return"]();case 54:if(t.prev=54,!y){t.next=57;break}throw w;case 57:return t.finish(54);case 58:return t.finish(51);case 59:t.t1 instanceof h.TransportUnavailableError?(b["default"].debug("Twilsock connection (required for subscription) not ready (c:"+a+"); waiting\u2026"),this.backoff.reset()):(b["default"].debug("Failed an attempt to "+e+" subscriptions (c:"+a+"); retrying",t.t1),this.persist());case 60:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24],[27,38],[43,47,51,59],[52,,54,58]])}));return function(){return e.apply(this,arguments)}}()},{"key":"verifyPokeDelivery","value":function(e,t,n){var a=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),r=i?(new Date).getTime()-i:t;r>=t?(n.filter(function(t){return t.pendingCorrelationId===e}).forEach(function(e){e.updatePending(null,null),e.retryCount++,a.persisted["delete"](e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId["delete"](e)):setTimeout(function(){return a.verifyPokeDelivery(e,t,n)},t-r)}},{"key":"processLocalActions","value":function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{"key":"recordActionAttemptOn","value":function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var a=this.persisted.get(e.sid);a&&a.updatePending(t,n)}}},{"key":"recordActionFailureOn","value":function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted["delete"](e.sid)}},{"key":"request","value":function(e,t,n,a){var i=a.map(function(t){return{"object_sid":t.sid,"object_type":t.type,"last_event_id":"establish"===e?t.lastEventId:void 0,"index_name":"establish"===e?t.indexName:void 0,"query_string":"establish"===e?t.queryString:void 0}}),r=a.filter(function(e){return e.retryCount>0}).length;b["default"].debug("Attempting '"+e+"' request (c:"+t+"):",i);var s={"event_protocol_version":3,"action":e,"correlation_id":t,"retried_requests":r,"ttl_in_s":-1,"requests":i};return"ttl"===n&&(s.reason=n),this.services.network.post(this.services.config.subscriptionsUri,s)}},{"key":"add","value":function(e,t){b["default"].debug("Establishing intent to subscribe to "+e);var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted["delete"](e),this.subscriptions.set(e,new m(t)),this.persist())}},{"key":"remove","value":function(e){b["default"].debug("Establishing intent to unsubscribe from "+e),this.subscriptions["delete"](e)&&this.persist()}},{"key":"acceptMessage","value":function(e,t){switch(b["default"].trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:this.applyEventToSubscribedEntity(e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:e.event_type.match(/^live_query/)?e.event.query_id:void 0,e,t);break;default:b["default"].debug("Dropping unknown message type "+e.event_type)}}},{"key":"applySubscriptionEstablishedMessage","value":function(e,t){var n=e.object_sid,a=this.persisted.get(e.object_sid);a&&a.pendingCorrelationId===t?"interrupted"===e.replay_status?(b["default"].debug("Event Replay for subscription to "+n+" (c:"+t+") interrupted; continuing eagerly."),a.updatePending(null,null),this.persisted["delete"](a.sid),this.backoff.reset()):"completed"===e.replay_status&&(b["default"].debug("Event Replay for subscription to "+n+" (c:"+t+") completed. Subscription is ready."),a.complete(e.last_event_id),this.persisted.set(e.object_sid,a),a.setSubscriptionState("established"),this.backoff.reset()):b["default"].debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{"key":"applySubscriptionCancelledMessage","value":function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted["delete"](e.object_sid)):b["default"].debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{"key":"applySubscriptionFailedMessage","value":function(e,t){var n=e.object_sid,a=this.subscriptions.get(n),i=this.persisted.get(n);a&&i?i.pendingCorrelationId===t&&(b["default"].error("Failed to subscribe on "+i.sid,e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!a&&i&&(this.persisted["delete"](n),i.setSubscriptionState("none")),this.persist()}},{"key":"applyEventToSubscribedEntity","value":function(e,t,n){if(e){var a;n=n||(a=this.persisted.get(e))&&a.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,n)):b["default"].debug("Message dropped for SID '"+e+"', for which there is no subscription.")}}},{"key":"onConnectionStateChanged","value":function(e){this.isConnected=e,e&&this.poke("reconnect")}},{"key":"onSubscriptionTtlElapsed","value":function(){this.isConnected&&this.poke("ttl")}},{"key":"poke","value":function(e){b["default"].debug("Triggering event replay for all subscriptions, reason="+e),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],n=!0,a=!1,i=void 0;try{for(var r,o=(0,s["default"])(this.persisted.values());!(n=(r=o.next()).done);n=!0){var l=r.value;l.reset(),l.rejectedWithError&&t.push(l)}}catch(e){a=!0,i=e}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}this.persisted.clear();var c=!0,d=!1,u=void 0;try{for(var p,f=(0,s["default"])(t);!(c=(p=f.next()).done);c=!0){var h=p.value;this.persisted.set(h.sid,h)}}catch(e){d=!0,u=e}finally{try{!c&&f["return"]&&f["return"]()}finally{if(d)throw u}}this.persist()}},{"key":"shutdown","value":function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();n.Subscriptions=v},{"./utils/logger":250,"./utils/syncerror":252,"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/assign":37,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/regenerator":58,"operation-retrier":201,"twilsock":264}],"247":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/get")),r=a(e("babel-runtime/core-js/promise")),s=a(e("babel-runtime/core-js/object/assign")),o=a(e("babel-runtime/regenerator")),l=a(e("babel-runtime/helpers/asyncToGenerator")),c=a(e("babel-runtime/core-js/object/get-prototype-of")),d=a(e("babel-runtime/helpers/classCallCheck")),u=a(e("babel-runtime/helpers/createClass")),p=a(e("babel-runtime/helpers/possibleConstructorReturn")),f=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var b=e("./utils/syncerror"),h=e("./utils/sanitize"),m=e("./utils/logger"),v=e("./entity"),g=e("./mergingqueue"),_=e("./closeable"),y=function(e){function t(e,n,a){(0,d["default"])(this,t);var i=(0,p["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this,e,a));return i.isDeleted=!1,i.updateMergingQueue=new g.MergingQueue(function(e,t){return"number"==typeof t.ttl?{"ttl":t.ttl}:e}),i.descriptor=n,i.descriptor.data=i.descriptor.data||{},i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,f["default"])(t,e),(0,u["default"])(t,[{"key":"_update","value":function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{"value":e.document_data,"isLocal":!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{"last_event_id":e.id,"revision":e.document_revision,"date_updated":e.date_created,"data":e.document_data})):m["default"].trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{"key":"set","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){var a,i=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n||{},h.validateOptionalTtl(a.ttl),t.abrupt("return",this.updateMergingQueue.squashAndAdd(a,function(t){return i._setUnconditionally(e,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){var a,i=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n||{},h.validateOptionalTtl(a.ttl),t.abrupt("return",this.updateMergingQueue.add(a,function(t){return i._setWithIfMatch(e,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.mutate(function(t){return(0,s["default"])(t,e)},n));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.validateMandatoryTtl(e),t.next=3,this._postUpdateToServer({"ttl":e});case 3:n=t.sent,this.descriptor.date_expires=n.date_expires;case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_setUnconditionally","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){var a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._postUpdateToServer({"data":e,"revision":void 0,"ttl":n});case 2:return a=t.sent,this._handleSuccessfulUpdateResult(a),t.abrupt("return",this.value);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_setWithIfMatch","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){var a,i,r;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=e(h.deepClone(this.value)))){t.next=22;break}return i=this.revision,t.prev=3,t.next=6,this._postUpdateToServer({"data":a,"revision":i,"ttl":n});case 6:return r=t.sent,this._handleSuccessfulUpdateResult(r),t.abrupt("return",this.value);case 11:if(t.prev=11,t.t0=t["catch"](3),412!==t.t0.status){t.next=19;break}return t.next=16,this._softSync();case 16:return t.abrupt("return",this._setWithIfMatch(e));case 19:throw t.t0;case 20:t.next=23;break;case 22:return t.abrupt("return",this.value);case 23:case"end":return t.stop()}},t,this,[[3,11]])}));return function(){return e.apply(this,arguments)}}()},{"key":"_handleSuccessfulUpdateResult","value":function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{"last_event_id":e.last_event_id,"revision":e.revision,"date_updated":e.date_updated,"data":e.data}),this.broadcastEventToListeners("updated",{"value":this.value,"isLocal":!0}))}},{"key":"_postUpdateToServer","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n,a,i;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isDeleted){t.next=17;break}return n={"data":e.data},"number"==typeof e.ttl&&(n.ttl=e.ttl),a=e.revision,t.prev=4,t.next=7,this.services.network.post(this.uri,n,a);case 7:return i=t.sent,t.abrupt("return",{"revision":i.body.revision,"data":e.data,"last_event_id":i.body.last_event_id,"date_updated":i.body.date_updated,"date_expires":i.body.date_expires});case 11:throw t.prev=11,t.t0=t["catch"](4),404===t.t0.status&&this.onRemoved(!1),t.t0;case 15:t.next=18;break;case 17:return t.abrupt("return",r["default"].reject(new b.SyncError("The Document has been removed",404,54100)));case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(){return e.apply(this,arguments)}}()},{"key":"_softSync","value":function(){var e=(0,l["default"])(o["default"].mark(function t(){var e=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.services.network.get(this.uri).then(function(t){var n={"type":"document_updated","id":t.body.last_event_id,"document_revision":t.body.revision,"document_data":t.body.data,"date_created":t.body.date_updated};return e._update(n),e})["catch"](function(t){404===t.status?e.onRemoved(!1):m["default"].error("Can't get updates for "+e.sid+":",t)}));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"onRemoved","value":function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{"isLocal":e}))}},{"key":"removeDocument","value":function(){var e=(0,l["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network["delete"](this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",r["default"].reject(new b.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"uri","get":function(){return this.descriptor.url}},{"key":"revision","get":function(){return this.descriptor.revision}},{"key":"lastEventId","get":function(){return this.descriptor.last_event_id}},{"key":"dateExpires","get":function(){return this.descriptor.date_expires}},{"key":"type","get":function(){return"document"}},{"key":"indexName","get":function(){}},{"key":"queryString","get":function(){}},{"key":"sid","get":function(){return this.descriptor.sid}},{"key":"value","get":function(){return this.descriptor.data}},{"key":"dateUpdated","get":function(){return this.descriptor.date_updated}},{"key":"uniqueName","get":function(){return this.descriptor.unique_name||null}}],[{"key":"type","get":function(){return"document"}}]),t}(v.SyncEntity);n.SyncDocumentImpl=y;var w=function(e){function t(e){(0,d["default"])(this,t);var n=(0,p["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this));return n.syncDocumentImpl=e,n.syncDocumentImpl.attach(n),n}return(0,f["default"])(t,e),(0,u["default"])(t,[{"key":"set","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncDocumentImpl.set(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncDocumentImpl.mutate(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncDocumentImpl.update(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncDocumentImpl.setTtl(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeDocument","value":function(){var e=(0,l["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"close","value":function(){(0,i["default"])(t.prototype.__proto__||(0,c["default"])(t.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}},{"key":"uri","get":function(){return this.syncDocumentImpl.uri}},{"key":"revision","get":function(){return this.syncDocumentImpl.revision}},{"key":"lastEventId","get":function(){return this.syncDocumentImpl.lastEventId}},{"key":"dateExpires","get":function(){return this.syncDocumentImpl.dateExpires}},{"key":"type","get":function(){return y.type}},{"key":"sid","get":function(){return this.syncDocumentImpl.sid}},{"key":"value","get":function(){return this.syncDocumentImpl.value}},{"key":"dateUpdated","get":function(){return this.syncDocumentImpl.dateUpdated}},{"key":"uniqueName","get":function(){return this.syncDocumentImpl.uniqueName}}],[{"key":"type","get":function(){return y.type}}]),t}(_["default"]);n.SyncDocument=w,n["default"]=w},{"./closeable":232,"./entity":235,"./mergingqueue":240,"./utils/logger":250,"./utils/sanitize":251,"./utils/syncerror":252,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58}],"248":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/get")),r=a(e("babel-runtime/core-js/object/assign")),s=a(e("babel-runtime/regenerator")),o=a(e("babel-runtime/helpers/asyncToGenerator")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("./utils/sanitize"),b=e("./utils/uri"),h=e("./utils/syncerror"),m=e("./utils/logger"),v=e("./entity"),g=e("./listitem"),_=e("./paginator"),y=e("./cache"),w=e("./mergingqueue"),k=e("./closeable"),C=function(e){function t(e,n,a){(0,c["default"])(this,t);var i=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e,a));return i.updateMergingQueue=new w.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{"ttl":t.ttl}:e}),i.cache=new y.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"_addOrUpdateItemOnServer","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a,i){var r,o;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={"data":n},"number"==typeof i&&(r.ttl=i),t.next=4,this.services.network.post(e,r,a);case 4:return(o=t.sent).body.data=n,o.body.date_updated=new Date(o.body.date_updated),t.abrupt("return",o.body);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"push","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){var a,i,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=(n||{}).ttl,f.validateOptionalTtl(a),t.next=4,this._addOrUpdateItemOnServer(this.links.items,e,void 0,a);case 4:return i=t.sent,r=Number(i.index),this._handleItemMutated(r,i.url,i.last_event_id,i.revision,e,i.date_updated,i.date_expires,!0,!1),t.abrupt("return",this.cache.get(r));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"set","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){var i,r=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a||{},f.validateOptionalTtl(i.ttl),t.abrupt("return",this.updateMergingQueue.squashAndAdd(e,i,function(t){return r._updateItemUnconditionally(e,n,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_updateItemUnconditionally","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){var i,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return i=t.sent,t.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,a);case 5:return r=t.sent,this._handleItemMutated(e,r.url,r.last_event_id,r.revision,r.data,r.date_updated,r.date_expires,!1,!1),t.abrupt("return",this.cache.get(e));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_updateItemWithIfMatch","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){var i,r,o,l;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:if(i=t.sent,!(r=n(f.deepClone(i.value)))){t.next=25;break}return o=i.revision,t.prev=6,t.next=9,this._addOrUpdateItemOnServer(i.uri,r,o,a);case 9:return l=t.sent,this._handleItemMutated(e,l.url,l.last_event_id,l.revision,l.data,l.date_updated,l.date_expires,!1,!1),t.abrupt("return",this.cache.get(e));case 14:if(t.prev=14,t.t0=t["catch"](6),412!==t.t0.status){t.next=22;break}return t.next=19,this._getItemFromServer(e);case 19:return t.abrupt("return",this._updateItemWithIfMatch(e,n,a));case 22:throw t.t0;case 23:t.next=26;break;case 25:return t.abrupt("return",i);case 26:case"end":return t.stop()}},t,this,[[6,14]])}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){var i,r=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a||{},f.validateOptionalTtl(i.ttl),t.abrupt("return",this.updateMergingQueue.add(e,i,function(t){return r._updateItemWithIfMatch(e,n,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.mutate(e,function(e){return(0,r["default"])(e,n)},a));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return n=t.sent,t.next=5,this.services.network["delete"](n.uri);case 5:a=t.sent,this._handleItemRemoved(e,a.body.last_event_id,void 0,new Date(a.body.date_updated),!1);case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"get","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.cache.get(e))){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",this._getItemFromServer(e));case 6:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_getItemFromServer","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n;return s["default"].wrap(function(t){
for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryItems({"index":e});case 2:if(!((n=t.sent).items.length<1)){t.next=7;break}throw new h.SyncError("No item with index "+e+" found",404,54151);case 7:return t.abrupt("return",n.items[0]);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"queryItems","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a,i,r,o=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new b.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Index",e.index).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return a=t.sent,i=a.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.index)?o._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(Number(e.index),new g.ListItem({"index":Number(e.index),"uri":e.url,"revision":e.revision,"lastEventId":e.last_event_id,"dateUpdated":e.date_updated,"dateExpires":e.date_expires,"value":e.data}),e.last_event_id),o.cache.get(e.index)}),r=a.body.meta,t.abrupt("return",new _.Paginator(i,function(e){return o.queryItems({"pageToken":e})},r.previous_token,r.next_token));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getItems","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},f.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getContext","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){var e;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.context){t.next=5;break}return t.next=3,this.services.network.get(this.links.context);case 3:e=t.sent,this._updateContextIfRequired(e.body.data,e.body.last_event_id);case 5:return t.abrupt("return",this.context);case 6:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){var n,a;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.validateMandatoryTtl(e),t.prev=1,n={"ttl":e},t.next=5,this.services.network.post(this.uri,n);case 5:a=t.sent,this.descriptor.date_expires=a.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t["catch"](1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}));return function(){return e.apply(this,arguments)}}()},{"key":"setItemTtl","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){var a,i,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.validateMandatoryTtl(n),t.next=3,this.get(e);case 3:return a=t.sent,i={"ttl":n},t.next=7,this.services.network.post(a.uri,i);case 7:r=t.sent,a.updateDateExpires(r.body.date_expires);case 9:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeList","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network["delete"](this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"onRemoved","value":function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{"isLocal":e})}},{"key":"shouldIgnoreEvent","value":function(e,t){return this.cache.isKnown(e,t)}},{"key":"_update","value":function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{"key":"_advanceLastEventId","value":function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{"key":"_updateRootDateUpdated","value":function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{"date_updated":e}))}},{"key":"_handleItemMutated","value":function(e,t,n,a,i,r,s,o,l){if(this.shouldIgnoreEvent(e,n))m["default"].trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(r);var c=this.cache.get(e);if(c)c.lastEventId<n&&(c.update(n,a,i,r),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,l,!1));else{var d=new g.ListItem({"index":e,"uri":t,"lastEventId":n,"revision":a,"value":i,"dateUpdated":r,"dateExpires":s});this.cache.store(e,d,n),this.emitItemMutationEvent(d,l,o)}}}},{"key":"emitItemMutationEvent","value":function(e,t,n){var a=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(a,{"item":e,"isLocal":!t})}},{"key":"_handleItemRemoved","value":function(e,t,n,a,i){this._updateRootDateUpdated(a),this.cache["delete"](e,t),this.broadcastEventToListeners("itemRemoved",{"index":e,"isLocal":!i,"value":n})}},{"key":"_handleContextUpdate","value":function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{"context":e,"isLocal":!1})}},{"key":"_updateContextIfRequired","value":function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(m["default"].trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{"key":"uri","get":function(){return this.descriptor.url}},{"key":"revision","get":function(){return this.descriptor.revision}},{"key":"lastEventId","get":function(){return this.descriptor.last_event_id}},{"key":"links","get":function(){return this.descriptor.links}},{"key":"dateExpires","get":function(){return this.descriptor.date_expires}},{"key":"type","get":function(){return"list"}},{"key":"indexName","get":function(){}},{"key":"queryString","get":function(){}},{"key":"sid","get":function(){return this.descriptor.sid}},{"key":"uniqueName","get":function(){return this.descriptor.unique_name||null}},{"key":"dateUpdated","get":function(){return this.descriptor.date_updated}}],[{"key":"type","get":function(){return"list"}}]),t}(v.SyncEntity);n.SyncListImpl=C;var x=function(e){function t(e){(0,c["default"])(this,t);var n=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return n.syncListImpl=e,n.syncListImpl.attach(n),n}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"push","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.push(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"set","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.set(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.mutate(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n,a){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.update(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.remove(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"get","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.get(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getContext","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getItems","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.getItems(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setTtl","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.setTtl(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setItemTtl","value":function(){var e=(0,o["default"])(s["default"].mark(function t(e,n){return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncListImpl.setItemTtl(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeList","value":function(){var e=(0,o["default"])(s["default"].mark(function t(){return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"close","value":function(){(0,i["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}},{"key":"uri","get":function(){return this.syncListImpl.uri}},{"key":"revision","get":function(){return this.syncListImpl.revision}},{"key":"lastEventId","get":function(){return this.syncListImpl.lastEventId}},{"key":"links","get":function(){return this.syncListImpl.links}},{"key":"dateExpires","get":function(){return this.syncListImpl.dateExpires}},{"key":"type","get":function(){return C.type}},{"key":"sid","get":function(){return this.syncListImpl.sid}},{"key":"uniqueName","get":function(){return this.syncListImpl.uniqueName}},{"key":"dateUpdated","get":function(){return this.syncListImpl.dateUpdated}}],[{"key":"type","get":function(){return C.type}}]),t}(k["default"]);n.SyncList=x,n["default"]=x},{"./cache":229,"./closeable":232,"./entity":235,"./listitem":237,"./mergingqueue":240,"./paginator":241,"./utils/logger":250,"./utils/sanitize":251,"./utils/syncerror":252,"./utils/uri":254,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58}],"249":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/get")),r=a(e("babel-runtime/core-js/promise")),s=a(e("babel-runtime/core-js/object/assign")),o=a(e("babel-runtime/regenerator")),l=a(e("babel-runtime/helpers/asyncToGenerator")),c=a(e("babel-runtime/core-js/object/get-prototype-of")),d=a(e("babel-runtime/helpers/classCallCheck")),u=a(e("babel-runtime/helpers/createClass")),p=a(e("babel-runtime/helpers/possibleConstructorReturn")),f=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var b=e("./utils/sanitize"),h=e("./utils/uri"),m=e("./utils/syncerror"),v=e("./utils/logger"),g=e("./entity"),_=e("./mapitem"),y=e("./paginator"),w=e("./cache"),k=e("./mergingqueue"),C=e("./closeable"),x=function(e){function t(e,n,a){(0,d["default"])(this,t);var i=(0,p["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this,e,a));return i.updateMergingQueue=new k.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{"ttl":t.ttl}:e}),i.cache=new w.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),n.items&&n.items.forEach(function(e){e.date_updated=new Date(e.date_updated),i.cache.store(e.key,new _.MapItem(e),e.last_event_id)}),i}return(0,f["default"])(t,e),(0,u["default"])(t,[{"key":"set","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){var i,r=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a||{},b.validateOptionalTtl(i.ttl),t.abrupt("return",this.updateMergingQueue.squashAndAdd(e,i,function(t){return r._putItemUnconditionally(e,n,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"get","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cache.has(e)){t.next=4;break}return t.abrupt("return",this.cache.get(e));case 4:return t.abrupt("return",this._getItemFromServer(e));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_getItemFromServer","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryItems({"key":e});case 2:if(!((n=t.sent).items.length<1)){t.next=7;break}throw new m.SyncError("No item with key "+e+" found",404,54201);case 7:return t.abrupt("return",n.items[0]);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){var i,r=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=a||{},b.validateOptionalTtl(i.ttl),t.abrupt("return",this.updateMergingQueue.add(e,i,function(t){return r._putItemWithIfMatch(e,n,t.ttl)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.mutate(e,function(e){return(0,s["default"])(e,n)},a));case 1:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_putItemUnconditionally","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){var i,r;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._putItemToServer(e,n,void 0,a);case 2:return i=t.sent,r=i.item,this._handleItemMutated(r.key,r.url,r.last_event_id,r.revision,r.data,r.date_updated,r.date_expires,i.added,!1),t.abrupt("return",this.cache.get(r.key));case 6:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"_putItemWithIfMatch","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){var i,r,s,l,c;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e)["catch"](function(t){if(404===t.status)return new _.MapItem({"key":e,"data":{},"last_event_id":-1,"revision":"-1","url":null,"date_updated":null,"date_expires":null});throw t});case 2:if(i=t.sent,!(r=n(b.deepClone(i.value)))){t.next=26;break}return s=i.revision,t.prev=6,t.next=9,this._putItemToServer(e,r,s,a);case 9:return l=t.sent,c=l.item,this._handleItemMutated(c.key,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,l.added,!1),t.abrupt("return",this.cache.get(c.key));case 15:if(t.prev=15,t.t0=t["catch"](6),412!==t.t0.status){t.next=23;break}return t.next=20,this._getItemFromServer(e);case 20:return t.abrupt("return",this._putItemWithIfMatch(e,n,a));case 23:throw t.t0;case 24:t.next=27;break;case 26:return t.abrupt("return",i);case 27:case"end":return t.stop()}},t,this,[[6,15]])}));return function(){return e.apply(this,arguments)}}()},{"key":"_putItemToServer","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a,i){var r,s,l,c,d;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new h.UriBuilder(this.links.items).pathSegment(e).build(),s={"data":n},"number"==typeof i&&(s.ttl=i),t.prev=3,t.next=6,this.services.network.put(r,s,a);case 6:return l=t.sent,(c=l.body).data=n,c.date_updated=new Date(c.date_updated),d=201===l.status.code,t.abrupt("return",{"added":d,"item":c});case 14:throw t.prev=14,t.t0=t["catch"](3),404===t.t0.status&&this.onRemoved(!1),t.t0;case 18:case"end":return t.stop()}},t,this,[[3,14]])}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n,a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}throw new Error("Key argument is invalid");case 2:return t.next=4,this.get(e);case 4:return n=t.sent,t.next=7,this.services.network["delete"](n.uri);case 7:a=t.sent,this._handleItemRemoved(e,a.body.last_event_id,void 0,new Date(a.body.date_updated),!1);case 9:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"queryItems","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n,a,i,r,s=this;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new h.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Key",e.key).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return a=t.sent,i=a.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.key)?s._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(e.key,new _.MapItem(e),e.last_event_id),s.cache.get(e.key)}),r=a.body.meta,t.abrupt("return",new y.Paginator(i,function(e){return s.queryItems({"pageToken":e})},r.previous_token,r.next_token));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getItems","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},b.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"forEach","value":function(e){var t=this;return new r["default"](function(n,a){t.queryItems().then(function i(t){t.items.forEach(function(t){return e(t)}),t.hasNextPage?t.nextPage().then(i)["catch"](a):n()})["catch"](a)})}},{"key":"shouldIgnoreEvent","value":function(e,t){return this.cache.isKnown(e,t)}},{"key":"_update","value":function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{"key":"_advanceLastEventId","value":function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{"key":"_updateRootDateUpdated","value":function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{"date_updated":e}))}},{"key":"_handleItemMutated","value":function(e,t,n,a,i,r,s,o,l){if(this.shouldIgnoreEvent(e,n))v["default"].trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(r);var c=this.cache.get(e);c?c.lastEventId<n&&(c.update(n,a,i,r),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,l,!1)):(c=new _.MapItem({"key":e,"url":t,"last_event_id":n,"revision":a,"data":i,"date_updated":r,"date_expires":s}),this.cache.store(e,c,n),this.emitItemMutationEvent(c,l,o))}}},{"key":"emitItemMutationEvent","value":function(e,t,n){var a=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(a,{"item":e,"isLocal":!t})}},{"key":"_handleItemRemoved","value":function(e,t,n,a,i){this._updateRootDateUpdated(a),this.cache["delete"](e,t),this.broadcastEventToListeners("itemRemoved",{"key":e,"isLocal":!i,"value":n})}},{"key":"onRemoved","value":function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{"isLocal":e})}},{"key":"setTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){var n,a;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.validateMandatoryTtl(e),t.prev=1,n={"ttl":e},t.next=5,this.services.network.post(this.uri,n);case 5:a=t.sent,this.descriptor.date_expires=a.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t["catch"](1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}));return function(){return e.apply(this,arguments)}}()},{"key":"setItemTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){var a,i,r;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.validateMandatoryTtl(n),t.next=3,this.get(e);case 3:return a=t.sent,i={"ttl":n},t.next=7,this.services.network.post(a.uri,i);case 7:r=t.sent,a.updateDateExpires(r.body.date_expires);case 9:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeMap","value":function(){var e=(0,l["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network["delete"](this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"uri","get":function(){return this.descriptor.url}},{"key":"links","get":function(){return this.descriptor.links}},{"key":"revision","get":function(){return this.descriptor.revision}},{"key":"lastEventId","get":function(){return this.descriptor.last_event_id}},{"key":"dateExpires","get":function(){return this.descriptor.date_expires}},{"key":"type","get":function(){return"map"}},{"key":"indexName","get":function(){}},{"key":"queryString","get":function(){}},{"key":"sid","get":function(){return this.descriptor.sid}},{"key":"uniqueName","get":function(){return this.descriptor.unique_name||null}},{"key":"dateUpdated","get":function(){return this.descriptor.date_updated}}],[{"key":"type","get":function(){return"map"}}]),t}(g.SyncEntity);n.SyncMapImpl=x;var T=function(e){function t(e){(0,d["default"])(this,t);var n=(0,p["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this));return n.syncMapImpl=e,n.syncMapImpl.attach(n),n}return(0,f["default"])(t,e),(0,u["default"])(t,[{"key":"set","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.set(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"get","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.get(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"mutate","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.mutate(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"update","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n,a){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.update(e,n,a));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"remove","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.remove(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"getItems","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.getItems(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"forEach","value":function(e){this.ensureNotClosed(),this.syncMapImpl.forEach(e)}},{"key":"setTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.setTtl(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setItemTtl","value":function(){var e=(0,l["default"])(o["default"].mark(function t(e,n){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.ensureNotClosed(),t.abrupt("return",this.syncMapImpl.setItemTtl(e,n));case 2:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"removeMap","value":function(){var e=(0,l["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"close","value":function(){(0,i["default"])(t.prototype.__proto__||(0,c["default"])(t.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}},{"key":"uri","get":function(){return this.syncMapImpl.uri}},{"key":"links","get":function(){return this.syncMapImpl.links}},{"key":"revision","get":function(){return this.syncMapImpl.revision}},{"key":"lastEventId","get":function(){return this.syncMapImpl.lastEventId}},{"key":"dateExpires","get":function(){return this.syncMapImpl.dateExpires}},{"key":"type","get":function(){return x.type}},{"key":"sid","get":function(){return this.syncMapImpl.sid}},{"key":"uniqueName","get":function(){return this.syncMapImpl.uniqueName}},{"key":"dateUpdated","get":function(){return this.syncMapImpl.dateUpdated}}],[{"key":"type","get":function(){return x.type}}]),t}(C.Closeable);n.SyncMap=T,n["default"]=T},{"./cache":229,"./closeable":232,"./entity":235,"./mapitem":239,"./mergingqueue":240,"./paginator":241,"./utils/logger":250,"./utils/sanitize":251,"./utils/syncerror":252,"./utils/uri":254,"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58}],"250":[function(e,t,n){"use strict";function a(e,t){return[(new Date).toISOString()+" Sync "+e+":"].concat((0,r["default"])(t))}var i,r=(i=e("babel-runtime/core-js/array/from"))&&i.__esModule?i:{"default":i};Object.defineProperty(n,"__esModule",{"value":!0});var s=e("loglevel");n["default"]={"setLevel":function(e){s.setLevel(e)},"trace":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,a("T",t))},"debug":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("D",t))},"info":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a("I",t))},"warn":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a("W",t))},"error":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a("E",t))}}},{"babel-runtime/core-js/array/from":31,"loglevel":199}],"251":[function(e,t,n){"use strict";function a(e){return!isNaN(parseInt(e))&&isFinite(e)}function i(e){return a(e)&&e>=0}var r,s=(r=e("babel-runtime/core-js/json/stringify"))&&r.__esModule?r:{"default":r};Object.defineProperty(n,"__esModule",{"value":!0});var o=e("./syncerror");n.deepClone=function(e){return JSON.parse((0,s["default"])(e))},n.validateOptionalTtl=function(e){if(void 0!==e&&!i(e))throw new o["default"]("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},n.validateMandatoryTtl=function(e){if(!i(e))throw new o["default"]("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},n.validatePageSize=function(e){var t;if(!(void 0===e||a(t=e)&&t>0))throw new o["default"]("Invalid pageSize parameter. Expected a positive integer, was '"+e+"'.",400,54455)}},{"./syncerror":252,"babel-runtime/core-js/json/stringify":34}],"252":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/create")),r=a(e("babel-runtime/core-js/object/set-prototype-of")),s=a(e("babel-runtime/core-js/array/from")),o=a(e("babel-runtime/core-js/reflect/construct")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,c["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return i.name=i.constructor.name,i.message=e+" (status: "+n+", code: "+a+")",i.status=n,i.code=a,i}return(0,u["default"])(t,e),t}(function(e){function t(){var t=(0,o["default"])(e,(0,s["default"])(arguments));return(0,r["default"])(t,(0,l["default"])(this)),t}return t.prototype=(0,i["default"])(e.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),r["default"]?(0,r["default"])(t,e):t.__proto__=e,t}(Error));n.SyncError=p;var f=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments[3];(0,c["default"])(this,t);var r=(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e,n,a))
;return r.body=i,r}return(0,u["default"])(t,e),t}(p);n.SyncNetworkError=f,n["default"]=p},{"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/object/set-prototype-of":43,"babel-runtime/core-js/reflect/construct":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"253":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/core-js/get-iterator")),s=a(e("babel-runtime/core-js/symbol/iterator")),o=a(e("babel-runtime/helpers/classCallCheck")),l=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var c=function(){function e(t,n){(0,o["default"])(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return(0,l["default"])(e,[{"key":"update","value":function(e){this.value=e}},{"key":"replace","value":function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{"key":"isRoot","get":function(){return null===this.parent}},{"key":"isLeaf","get":function(){return null===this.left&&null===this.right}},{"key":"isLeftChild","get":function(){return this.parent.left===this}}]),e}(),d=function(){function e(t,n){(0,o["default"])(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return(0,l["default"])(e,[{"key":"clear","value":function(){this.root=null,this.count=0}},{"key":"set","value":function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{"key":"insert","value":function(e,t){var n=new c(e,t);if(this.count++,this.root){for(var a=this.root;;)if(this.isLessThan(e,a.key)){if(!a.left){a.left=n;break}a=a.left}else{if(!a.right){a.right=n;break}a=a.right}for(n.parent=a,a=n;a.parent;){var i=a.parent,r=i.balanceFactor;if(a.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(r))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}a=i}}else this.root=n}},{"key":"get","value":function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{"key":"delete","value":function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,a=t.left,i=t.right;if(!!a!=!!i){var r=a||i;n||r?n&&!r?this.root=r:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var s=t.left;s.right;)s=s.right;if(t.left===s)t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.balanceFactor=t.balanceFactor,t={"parent":s,"isLeftChild":!0};else{var o=s.parent,l=s.left;o.right=l,l&&(l.parent=o),t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.left=t.left,s.left.parent=s,s.balanceFactor=t.balanceFactor,t={"parent":o,"isLeftChild":!1}}}for(this.count--;t.parent;){var c=t.parent,d=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(d)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{"key":"getNode","value":function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{"key":"rebalance","value":function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{"key":"rotateLeft","value":function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{"key":"rotateRight","value":function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{"key":s["default"],"value":i["default"].mark(function t(){var e,n,a,s,o,l;return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,n=!1,a=void 0,t.prev=3,s=(0,r["default"])(this.getIterator());case 5:if(e=(o=s.next()).done){t.next=12;break}return l=o.value,t.next=9,l;case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](3),n=!0,a=t.t0;case 18:t.prev=18,t.prev=19,!e&&s["return"]&&s["return"]();case 21:if(t.prev=21,!n){t.next=24;break}throw a;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])})},{"key":"getIterator","value":i["default"].mark(function n(){var e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e=this.root;case 1:if(!e){n.next=7;break}if(!this.isEqual(a,e.key)&&(null!==a||e.left)){n.next=4;break}return n.abrupt("break",7);case 4:e=this.isLessThan(a,e.key)||null===a?e.left:e.right,n.next=1;break;case 7:if(e){n.next=9;break}return n.abrupt("return",null);case 9:t=!0;case 10:if(!t){n.next=28;break}return n.next=13,[e.key,e.value];case 13:if(t=!1,!e.right){n.next=20;break}for(e=e.right;e.left;)e=e.left;t=!0,n.next=26;break;case 20:if(!e.parent){n.next=25;break}t=e.parent.left===e,e=e.parent,n.next=26;break;case 25:return n.abrupt("break",36);case 26:n.next=34;break;case 28:if(!e.parent){n.next=33;break}t=e.parent.left===e,e=e.parent,n.next=34;break;case 33:return n.abrupt("break",36);case 34:n.next=10;break;case 36:return n.abrupt("return",null);case 37:case"end":return n.stop()}},n,this)})},{"key":"getReverseIterator","value":i["default"].mark(function a(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:e=this.root;case 1:if(!e){a.next=7;break}if(!this.isEqual(n,e.key)&&(null!==n||e.right)){a.next=4;break}return a.abrupt("break",7);case 4:e=this.isLessThan(n,e.key)&&null!==n?e.left:e.right,a.next=1;break;case 7:if(e){a.next=9;break}return a.abrupt("return",null);case 9:t=!0;case 10:if(!t){a.next=28;break}return a.next=13,[e.key,e.value];case 13:if(t=!1,!e.left){a.next=20;break}for(e=e.left;e.right;)e=e.right;t=!0,a.next=26;break;case 20:if(!e.parent){a.next=25;break}t=e.parent.right===e,e=e.parent,a.next=26;break;case 25:return a.abrupt("break",36);case 26:a.next=34;break;case 28:if(!e.parent){a.next=33;break}t=e.parent.right===e,e=e.parent,a.next=34;break;case 33:return a.abrupt("break",36);case 34:a.next=10;break;case 36:return a.abrupt("return",null);case 37:case"end":return a.stop()}},a,this)})},{"key":"size","get":function(){return this.count}}]),e}();n.TreeMap=d},{"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/symbol/iterator":48,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"254":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(t){(0,i["default"])(this,e),this.base=t,this.args=new Array,this.paths=new Array}return(0,r["default"])(e,[{"key":"pathSegment","value":function(e){return this.paths.push(encodeURIComponent(e)),this}},{"key":"queryParam","value":function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{"key":"build","value":function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();n.UriBuilder=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"255":[function(e,t){t.exports={"_from":"twilio-sync@^0.11.4","_id":"twilio-sync@0.11.4","_inBundle":!1,"_integrity":"sha512-1Vyvrs5YsSQT+1vrqRWFIenVSCj3p7JwfeGqW60V04eFgrQPrs7huBKPGCZE1RkZ8P2PKOIiYBGnuLa+o81E7Q==","_location":"/twilio-sync","_phantomChildren":{},"_requested":{"type":"range","registry":!0,"raw":"twilio-sync@^0.11.4","name":"twilio-sync","escapedName":"twilio-sync","rawSpec":"^0.11.4","saveSpec":null,"fetchSpec":"^0.11.4"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.11.4.tgz","_shasum":"8fb59d0cf94a91f7be19686877b01693d708c963","_spec":"twilio-sync@^0.11.4","_where":"/home/travis/build/twilio/twilio-chat.js","author":{"name":"Twilio"},"browserify":{"transform":["babelify"]},"bundleDependencies":!1,"dependencies":{"loglevel":"^1.6.3","operation-retrier":"^3.0.0","platform":"^1.3.5","twilio-notifications":"^0.5.8","twilsock":"^0.5.11","uuid":"^3.3.2"},"deprecated":!1,"description":"Twilio Sync client library","devDependencies":{"@types/chai":"^4.1.7","@types/chai-as-promised":"7.1.0","@types/chai-string":"^1.4.1","@types/mocha":"^5.2.7","@types/node":"^12.0.4","@types/sinon":"^7.0.12","@types/sinon-chai":"^3.2.2","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","browserify":"^16.2.3","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.0","del":"^4.1.1","fancy-log":"^1.3.3","fs":"0.0.2","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2","jsdoc":"~3.5.5","jsonwebtoken":"^8.5.1","karma":"^4.1.0","karma-browserify":"^6.0.0","karma-browserstack-launcher":"^1.5.1","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","mocha":"^6.1.4","nyc":"^14.1.1","path":"^0.12.7","sinon":"^7.3.2","sinon-chai":"^3.3.0","source-map-explorer":"^1.8.0","ts-node":"^8.2.0","tslint":"^5.17.0","twilio":"^3.31.1","typescript":"^3.5.1","uglify-es":"^3.3.10","uglify-save-license":"^0.4.1","underscore":"^1.9.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0","watchify":"^3.11.1"},"engines":{"node":">=8"},"license":"MIT","main":"lib/index.js","name":"twilio-sync","types":"./lib/index.d.ts","version":"0.11.4"}},{}],"256":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/assign")),r=a(e("babel-runtime/core-js/object/get-prototype-of")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("events"),u=e("operation-retrier"),p=function(e){function t(e){(0,s["default"])(this,t);var n=(0,o["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this));return n.options=e?(0,i["default"])({},e):{},n}return(0,c["default"])(t,e),(0,l["default"])(t,[{"key":"inProgress","get":function(){return!!this.retrier}}]),(0,l["default"])(t,[{"key":"start","value":function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{"key":"stop","value":function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{"key":"modifyBackoff","value":function(e){this.newBackoff=e}},{"key":"attemptFailed","value":function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff&&(!this.usedBackoff||this.usedBackoff<this.newBackoff)?this.createRetrier():this.retrier.failed(new Error)}},{"key":"cancel","value":function(){this.retrier&&this.retrier.cancel()}},{"key":"cleanRetrier","value":function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{"key":"getRetryPolicy","value":function(){var e=(0,i["default"])({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{"key":"createRetrier","value":function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new u.Retrier(t),this.retrier.once("attempt",function(){e.retrier.on("attempt",function(){return e.emit("attempt")}),e.retrier.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(t){return e.emit("failed",t)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()["catch"](function(){})}}]),t}(d.EventEmitter);n.BackoffRetrier=p},{"babel-runtime/core-js/object/assign":37,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196,"operation-retrier":201}],"257":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/regenerator")),r=a(e("babel-runtime/helpers/asyncToGenerator")),s=a(e("babel-runtime/core-js/json/stringify")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/get")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("./logger"),h=e("./configuration"),m=e("./twilsock"),v=e("./packetinterface"),g=e("./websocketchannel"),_=e("./services/registrations"),y=e("./services/upstream"),w=e("./deferred"),k=e("./index"),C=e("./offlinestorage"),x=e("./tokenStorage"),T=function(e){function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,l["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));i.offlineStorageDeferred=new w.Deferred,a.continuationToken=a.continuationToken?a.continuationToken:x.TokenStorage.getStoredToken(n);var r=i.config=new h.Configuration(e,n,a);b.log.setLevel(r.logLevel);var s=new g.WebSocketChannel(r.url),c=a.transport?a.transport:new v.PacketInterface(s,r);return i.channel=a.channel?a.channel:new m.TwilsockImpl(s,c,r),i.registrations=a.registrations?a.registrations:new _.Registrations(c),i.upstream=new y.Upstream(c,i.channel,r),i.registrations.on("registered",function(e){return i.emit("registered",e)}),i.channel.on("message",function(e,t){return setTimeout(function(){return i.emit("message",e,t)},0)}),i.channel.on("stateChanged",function(e){return setTimeout(function(){return i.emit("stateChanged",e)},0)}),i.channel.on("connectionError",function(e){return setTimeout(function(){return i.emit("connectionError",e)},0)}),i.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return i.emit("tokenAboutToExpire")},0)}),i.channel.on("tokenExpired",function(){return setTimeout(function(){return i.emit("tokenExpired")},0)}),i.channel.on("connected",function(){return i.registrations.updateRegistrations()}),i.channel.on("connected",function(){return i.upstream.sendPendingMessages()}),i.channel.on("connected",function(){return setTimeout(function(){return i.emit("connected")},0)}),i.channel.on("initialized",function(e){i.handleStorageId(n,e),x.TokenStorage.storeToken(e.continuationToken,n),setTimeout(function(){return i.emit("initialized",e)},0)}),i.channel.on("disconnected",function(){return setTimeout(function(){return i.emit("disconnected")},0)}),i.channel.on("disconnected",function(){return i.upstream.rejectPendingMessages()}),i.channel.on("disconnected",function(){return i.offlineStorageDeferred.fail(new k.TwilsockError("Client disconnected"))}),i.offlineStorageDeferred.promise["catch"](function(){}),i}return(0,p["default"])(t,e),(0,c["default"])(t,[{"key":"emit","value":function(e){for(var n,a=arguments.length,i=Array(a>1?a-1:0),r=1;r<a;r++)i[r-1]=arguments[r];return b.log.debug("Emitting "+e.toString()+"("+i.map(function(e){return(0,s["default"])(e)}).join(", ")+")"),(n=(0,u["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"emit",this)).call.apply(n,[this,e].concat(i))}},{"key":"handleStorageId","value":function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(C.OfflineProductStorage.create(t.offlineStorage[e])),b.log.debug("Offline storage for '"+e+"' product: "+(0,s["default"])(t.offlineStorage[e])+".")}catch(n){this.offlineStorageDeferred.fail(new k.TwilsockError("Failed to parse offline storage for "+e+" "+(0,s["default"])(t.offlineStorage[e])+". "+n+"."))}else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id for '"+e+"' product: "+(0,s["default"])(t.offlineStorage)));else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id"))}},{"key":"storageId","value":function(){return this.offlineStorageDeferred.promise}},{"key":"updateToken","value":function(){var e=(0,r["default"])(i["default"].mark(function t(e){return i["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(b.log.trace("updating token '"+e+"'"),this.config.token!==e){t.next=3;break}return t.abrupt("return");case 3:return this.config.updateToken(e),t.abrupt("return",this.channel.updateToken(e));case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"setNotificationsContext","value":function(e,t){this.registrations.setNotificationsContext(e,t)}},{"key":"removeNotificationsContext","value":function(e){this.registrations.removeNotificationsContext(e)}},{"key":"connect","value":function(){return this.channel.connect()}},{"key":"disconnect","value":function(){return this.channel.disconnect()}},{"key":"get","value":function(e,t){return this.upstream.send("GET",e,t)}},{"key":"post","value":function(e,t,n){return this.upstream.send("POST",e,t,n)}},{"key":"put","value":function(e,t,n){return this.upstream.send("PUT",e,t,n)}},{"key":"delete","value":function(e,t){return this.upstream.send("DELETE",e,t)}},{"key":"isConnected","get":function(){return this.channel.isConnected}},{"key":"state","get":function(){return this.channel.state}}]),t}(f.EventEmitter);n.TwilsockClient=T,n.Twilsock=T},{"./configuration":258,"./deferred":259,"./index":264,"./logger":265,"./offlinestorage":267,"./packetinterface":268,"./services/registrations":278,"./services/upstream":279,"./tokenStorage":280,"./twilsock":281,"./websocketchannel":282,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/get":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196}],"258":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s="0.5.11",o=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i["default"])(this,e),this.activeGrant=n,this._token=t;var r="wss://tsock."+(a.region||"us1")+".twilio.com/v3/wsconnect",o=a.twilsock||a.Twilsock||{};this.url=o.uri||r,this._continuationToken=a.continuationToken?a.continuationToken:null,this.logLevel=a.logLevel?a.logLevel:"error",this.retryPolicy=a.retryPolicy?a.retryPolicy:{"min":1e3,"max":12e4,"randomness":.2},this.clientMetadata=a.clientMetadata?a.clientMetadata:{},this.clientMetadata.ver=s,this.initRegistrations=a.initRegistrations?a.initRegistrations:null,this.tweaks=a.tweaks?a.tweaks:null}return(0,r["default"])(e,[{"key":"updateToken","value":function(e){this._token=e}},{"key":"updateContinuationToken","value":function(e){this._continuationToken=e}},{"key":"token","get":function(){return this._token}},{"key":"continuationToken","get":function(){return this._continuationToken}}]),e}();n.Configuration=o},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"259":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var o=function(){function e(){var t=this;(0,r["default"])(this,e),this._promise=new i["default"](function(e,n){t._resolve=e,t._reject=n})}return(0,s["default"])(e,[{"key":"update","value":function(e){this._resolve(e)}},{"key":"set","value":function(e){this.current=e,this._resolve(e)}},{"key":"fail","value":function(e){this._reject(e)}},{"key":"promise","get":function(){return this._promise}}]),e}();n.Deferred=o},{"babel-runtime/core-js/promise":44,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"260":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e){return(0,r["default"])(this,t),(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e))}return(0,o["default"])(t,e),t}(e("./twilsockerror").TwilsockError);n.TransportUnavailableError=l},{"./twilsockerror":261,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"261":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/create")),r=a(e("babel-runtime/core-js/object/set-prototype-of")),s=a(e("babel-runtime/core-js/array/from")),o=a(e("babel-runtime/core-js/reflect/construct")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/possibleConstructorReturn")),u=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var p=function(e){function t(e){return(0,c["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e))}return(0,u["default"])(t,e),t}(function(e){function t(){var t=(0,o["default"])(e,(0,s["default"])(arguments));return(0,r["default"])(t,(0,l["default"])(this)),t}return t.prototype=(0,i["default"])(e.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),r["default"]?(0,r["default"])(t,e):t.__proto__=e,t}(Error));n.TwilsockError=p},{"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/object/set-prototype-of":43,"babel-runtime/core-js/reflect/construct":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"262":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e,n){(0,r["default"])(this,t);var a=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e));return a.reply=n,a}return(0,o["default"])(t,e),t}(e("./twilsockerror").TwilsockError);n.TwilsockReplyError=l},{"./twilsockerror":261,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"263":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e,n,a){(0,r["default"])(this,t);var o=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,n));return o.status=e,o.description=n,o.body=a,o}return(0,o["default"])(t,e),t}(e("./twilsockerror").TwilsockError);n.TwilsockUpstreamError=l},{"./twilsockerror":261,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"264":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./client");n.TwilsockClient=a.TwilsockClient,n.Twilsock=a.TwilsockClient;var i=e("./error/twilsockerror");n.TwilsockError=i.TwilsockError;var r=e("./error/transportunavailableerror");n.TransportUnavailableError=r.TransportUnavailableError},{"./client":257,"./error/transportunavailableerror":260,"./error/twilsockerror":261}],"265":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return[(new Date).toISOString()+" Twilsock "+e+":"].concat((0,o["default"])(t))}var r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("loglevel"),c=function(){function e(t){(0,r["default"])(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?" "+t+":":""}return(0,s["default"])(e,[{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i("I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i("W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i("E",t))}}],[{"key":"setLevel","value":function(e){l.setLevel(e)}},{"key":"trace","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.trace.apply(null,i("T",t))}},{"key":"debug","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.debug.apply(null,i("D",t))}},{"key":"info","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.info.apply(null,i("I",t))}},{"key":"warn","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.warn.apply(null,i("W",t))}},{"key":"error","value":function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];l.error.apply(null,i("E",t))}}]),e}();n.Logger=c;var d=new c("");n.log=d},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"loglevel":199}],"266":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=e("platform"),o=function(){function e(){(0,i["default"])(this,e)}return(0,r["default"])(e,null,[{"key":"getMetadata","value":function(e){"undefined"!=typeof navigator&&s.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},n={"env":s.name,"envv":s.version,"os":s.os.family,"osv":s.os.version,"osa":s.os.architecture,"sdk":"js-default"},a={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter(function(e){return e in t||e in n}).forEach(function(e){return a[e]=e in t?t[e]:n[e]}),a}}]),e}();n.Metadata=o},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"platform":203}],"267":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=e("./index"),o=function(){function e(t){(0,i["default"])(this,e),this.id=t}return(0,r["default"])(e,null,[{"key":"create","value":function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new s.TwilsockError('Field "storage_id" is missing')}}]),e}();n.OfflineProductStorage=o},{"./index":264,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"268":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/map")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/core-js/json/stringify")),u=a(e("babel-runtime/helpers/typeof"));Object.defineProperty(n,"__esModule",{"value":!0});var p=e("./logger"),f=e("uuid"),b=e("./error/twilsockerror"),h=e("./error/twilsockreplyerror"),m=e("./parser"),v=e("./protocol/messages"),g=e("./metadata");n.PacketResponse=function y(){(0,c["default"])(this,y)};var _=function(){function e(t,n){var a=this;(0,c["default"])(this,e),this.config=n,this.activeRequests=new o["default"],this.channel=t,this.channel.on("reply",function(e){return a.processReply(e)}),this.channel.on("disconnected",function(){a.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new b.TwilsockError("disconnected"))}),a.activeRequests.clear()})}return(0,l["default"])(e,[{"key":"processReply","value":function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests["delete"](e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new h.TwilsockReplyError("Transport failure: "+e.status.status,e)),p.log.trace("message rejected")))}},{"key":"storeRequest","value":function(e,t,n){var a={"resolve":t,"reject":n,"timeout":setTimeout(function(){p.log.trace("request",e,"is timed out"),n(new b.TwilsockError("Twilsock: request timeout: "+e))},3e4)};this.activeRequests.set(e,a)}},{"key":"shutdown","value":function(){this.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new b.TwilsockError("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{"key":"sendInit","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){var e,n,a;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return p.log.trace("sendInit"),e=g.Metadata.getMetadata(this.config),n=new v.Init(this.config.token,this.config.continuationToken,e,this.config.initRegistrations,this.config.tweaks),t.next=5,this.sendWithReply(n);case 5:return a=t.sent,t.abrupt("return",new v.InitReply(a.id,a.header.continuation_token,a.header.continuation_token_status,a.header.offline_storage,a.header.init_registrations,a.header.debug_info));case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"sendClose","value":function(){var e=new v.Close;this.send(e)}},{"key":"sendWithReply","value":function(e,t){var n=this;return new i["default"](function(a,i){var r=n.send(e,t);n.storeRequest(r,a,i)})}},{"key":"send","value":function(e,t){e.id=e.id||"TM"+f.v4();var n=m.Parser.createPacket(e,function(e){switch(void 0===e?"undefined":(0,u["default"])(e)){case"undefined":return"";case"object":return(0,d["default"])(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw p.log.debug("failed to send ",e,t),p.log.trace(t.stack),t}}},{"key":"isConnected","get":function(){return this.channel.isConnected}}]),e}();n.PacketInterface=_},{"./error/twilsockerror":261,"./error/twilsockreplyerror":262,
"./logger":265,"./metadata":266,"./parser":269,"./protocol/messages":272,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/typeof":57,"babel-runtime/regenerator":58,"uuid":283}],"269":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function r(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(t)}function s(e){return JSON.parse(r(e))}var o=a(e("babel-runtime/core-js/json/stringify")),l=a(e("babel-runtime/helpers/classCallCheck")),c=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("./logger"),u=function(){function e(){(0,l["default"])(this,e)}return(0,c["default"])(e,null,[{"key":"parse","value":function(e){var t=new Uint8Array(e),n=function(e){for(var t="",n=0;n<e.length;++n){var a=String.fromCharCode(e[n]);if(t+=a,"\r"===a){n+=2;break}}var i=t.split(" ");return{"size":n,"protocol":i[0],"version":i[1],"headerSize":Number(i[2])}}(t);if("TWILSOCK"===n.protocol&&"V3.0"===n.version){var a=null;try{a=s(t.subarray(n.size,n.size+n.headerSize))}catch(t){return void d.log.error("failed to parse message header",t,e)}d.log.debug("message received: ",a.method),d.log.trace("message received: ",a);var i=null;if(a.payload_size>0){var o=2+n.size+n.headerSize,l=a.payload_size;if(a.hasOwnProperty("payload_type")&&0!==a.payload_type.indexOf("application/json"))0===a.payload_type.indexOf("text/plain")&&(i=r(t.subarray(o,o+l)));else try{i=s(t.subarray(o,o+l))}catch(t){return void d.log.error("failed to parse message body",t,e)}}return{"method":a.method,"header":a,"payload":i}}d.log.error("unsupported protocol: "+n.protocol+" ver "+n.version)}},{"key":"createPacket","value":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=i(t);var n,a,r=(0,o["default"])(e)+"\r\n",s="TWILSOCK V3.0 "+(i(r)-2)+"\r\n";return d.log.debug("send request:",s+r+t),(n=encodeURIComponent(s+r+t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),a=new Uint8Array(n.length),Array.prototype.forEach.call(n,function(e,t){a[t]=e.charCodeAt(0)}),a).buffer}}]),e}();n.Parser=u},{"./logger":265,"babel-runtime/core-js/json/stringify":34,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"270":[function(e,t,n){"use strict";var a,i=(a=e("babel-runtime/helpers/classCallCheck"))&&a.__esModule?a:{"default":a};Object.defineProperty(n,"__esModule",{"value":!0});var r=e("uuid");n.AbstractMessage=function s(e){(0,i["default"])(this,s),this.id=e||"TM"+r.v4()}},{"babel-runtime/helpers/classCallCheck":50,"uuid":283}],"271":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(){(0,r["default"])(this,t);var e=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this));return e.method="close",e}return(0,o["default"])(t,e),t}(e("./abstractmessage").AbstractMessage);n.Close=l},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"272":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{"value":!0});var a=e("./init");n.Init=a.Init;var i=e("./initReply");n.InitReply=i.InitReply;var r=e("./update");n.Update=r.Update;var s=e("./message");n.Message=s.Message;var o=e("./reply");n.Reply=o.Reply;var l=e("./close");n.Close=l.Close},{"./close":271,"./init":273,"./initReply":274,"./message":275,"./reply":276,"./update":277}],"273":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e,n,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,r["default"])(this,t);var c=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this));return c.method="init",c.token=e,c.continuation_token=n,c.metadata=a,c.registrations=o,c.tweaks=l,c.capabilities=["client_update","offline_storage"],c}return(0,o["default"])(t,e),t}(e("./abstractmessage").AbstractMessage);n.Init=l},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"274":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits")),o=a(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{"value":!0});var l=e("./abstractmessage");n.ContinuationTokenStatus=function d(){(0,o["default"])(this,d)};var c=function(e){function t(e,n,a,s,l,c){(0,o["default"])(this,t);var d=(0,r["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e));return d.continuationToken=n,d.continuationTokenStatus=a,d.offlineStorage=s,d.initRegistrations=l,d.debugInfo=c,d}return(0,s["default"])(t,e),t}(l.AbstractMessage);n.InitReply=c},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"275":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e,n,a){(0,r["default"])(this,t);var o=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this));return o.method="message",o.active_grant=e,o.payload_type=n,o.http_request=a,o}return(0,o["default"])(t,e),t}(e("./abstractmessage").AbstractMessage);n.Message=l},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"276":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e){(0,r["default"])(this,t);var n=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e));return n.method="reply",n.payload_type="application/json",n.status={"code":200,"status":"OK"},n}return(0,o["default"])(t,e),t}(e("./abstractmessage").AbstractMessage);n.Reply=l},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"277":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var l=function(e){function t(e){(0,r["default"])(this,t);var n=(0,s["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this));return n.method="update",n.token=e,n}return(0,o["default"])(t,e),t}(e("./abstractmessage").AbstractMessage);n.Update=l},{"./abstractmessage":270,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],"278":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/set")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/map")),l=a(e("babel-runtime/core-js/object/get-prototype-of")),c=a(e("babel-runtime/helpers/classCallCheck")),d=a(e("babel-runtime/helpers/createClass")),u=a(e("babel-runtime/helpers/possibleConstructorReturn")),p=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var f=e("../logger"),b=e("events"),h=e("uuid"),m=e("../error/twilsockerror"),v=function(e){function t(e){(0,c["default"])(this,t);var n=(0,u["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this));return n.transport=e,n.registrations=new o["default"],n.registrationsInProgress=new o["default"],n}return(0,p["default"])(t,e),(0,d["default"])(t,[{"key":"putNotificationContext","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e,n){var a;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={"method":"put_notification_ctx","notification_ctx_id":e},t.next=3,this.transport.sendWithReply(a,n);case 3:t.sent;case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"deleteNotificationContext","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"method":"delete_notification_ctx","notification_ctx_id":e},t.next=3,this.transport.sendWithReply(n);case 3:t.sent;case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"updateRegistration","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e,n){var a,s;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.log.debug("update registration for context",e),(a=this.registrationsInProgress.get(e))||(a=new i["default"],this.registrationsInProgress.set(e,a)),s=h.v4(),a.add(s),t.prev=5,t.next=8,this.putNotificationContext(e,n);case 8:f.log.debug("registration attempt succeeded for context",n),a["delete"](s),0===a.size&&(this.registrationsInProgress["delete"](e),this.emit("registered",e)),t.next=19;break;case 13:t.prev=13,t.t0=t["catch"](5),f.log.warn("registration attempt failed for context",n),f.log.debug(t.t0),a["delete"](s),0===a.size&&(this.registrationsInProgress["delete"](e),this.emit("registrationFailed",e,t.t0));case 19:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return e.apply(this,arguments)}}()},{"key":"updateRegistrations","value":function(){var e=this;f.log.trace("refreshing "+this.registrations.size+" registrations"),this.registrations.forEach(function(t,n){e.updateRegistration(n,t)})}},{"key":"setNotificationsContext","value":function(e,t){if(!e||!t)throw new m.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{"key":"removeNotificationsContext","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.registrations.has(e)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.deleteNotificationContext(e);case 4:this.transport.isConnected&&this.registrations["delete"](e);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(b.EventEmitter);n.Registrations=v},{"../error/twilsockerror":261,"../logger":265,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/set":46,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":58,"events":196,"uuid":283}],"279":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={"protocol":t[1],"host":t[2],"hostname":t[3],"port":t[4],"pathname":t[5],"search":t[6],"hash":t[7],"params":null};if(n.search.length>0){var a=n.search.substring(1);n.params=a.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return n}throw new u.TwilsockError("Incorrect URI: "+e)}(t),a={"method":e,"host":n.host,"path":n.pathname};return n.params&&(a.params=n.params),a}var r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/promise")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{"value":!0});var d=e("../logger"),u=e("../error/twilsockerror"),p=e("../error/twilsockupstreamerror"),f=e("../protocol/messages"),b=e("../index"),h=function(){function e(t,n,a){(0,c["default"])(this,e),this.config=a,this.transport=t,this.pendingMessages=[],this.twilsock=n}return(0,l["default"])(e,[{"key":"saveMessage","value":function(e){var t=this;return new o["default"](function(n,a){var i={"message":e,"resolve":n,"reject":a,"alreadyRejected":!1,"timeout":setTimeout(function(){d.log.debug("request is timed out"),a(new u.TwilsockError("Twilsock: request timeout")),i.alreadyRejected=!0},2e4)};t.pendingMessages.push(i)})}},{"key":"sendPendingMessages","value":function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then(function(e){return t.resolve(e)})["catch"](function(e){return t.reject(e)}),clearTimeout(t.timeout)}catch(e){return d.log.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length&&"break"!==t(););}},{"key":"rejectPendingMessages","value":function(){this.pendingMessages.forEach(function(e){e.reject(new b.TransportUnavailableError("Can't connect to twilsock")),clearTimeout(e.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{"key":"actualSend","value":function(){var e=(0,s["default"])(r["default"].mark(function t(e){var n,a,i,s,o,l;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.to,a=e.headers,i=e.body,s={"host":n.host,"path":n.path,"method":n.method,"params":n.params,"headers":a},o=new f.Message(this.config.activeGrant,a["Content-Type"]||"application/json",s),t.next=7,this.transport.sendWithReply(o,i);case 7:if(!((c=l=t.sent)&&c.header&&c.header.http_status)||(r=l.header.http_status.code)>=200&&r<300){t.next=10;break}throw new p.TwilsockUpstreamError(l.header.http_status.code,l.header.http_status.status,l.body);case 10:return t.abrupt("return",{"status":l.header.http_status,"headers":l.header.http_headers,"body":l.body});case 11:case"end":return t.stop()}var r,c},t,this)}));return function(){return e.apply(this,arguments)}}()},{"key":"send","value":function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments[3];if(this.twilsock.isTerminalState)return o["default"].reject(new b.TransportUnavailableError("Can't connect to twilsock"));var r=function(e,t,n,a){return{"to":i(e,t),"headers":n,"body":a}}(e,t,n,a);return this.twilsock.isConnected?this.actualSend(r):this.saveMessage(r)}}]),e}();n.Upstream=h},{"../error/twilsockerror":261,"../error/twilsockupstreamerror":263,"../index":264,"../logger":265,"../protocol/messages":272,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":58}],"280":[function(e,t,n){(function(t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/helpers/classCallCheck")),r=a(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{"value":!0});var s=function(){function e(){(0,i["default"])(this,e)}return(0,r["default"])(e,null,[{"key":"storeToken","value":function(t,n){e.canStore&&e.sessionStorage.setItem(e.getKeyName(n),t)}},{"key":"getStoredToken","value":function(t){return e.canStore?e.sessionStorage.getItem(e.getKeyName(t)):null}},{"key":"initialize","value":function(){e.canStore&&(e.sessionStorage.getItem(e.initializedFlag)&&this.clear(),e.sessionStorage.setItem(e.initializedFlag,"true"),e.window.addEventListener("unload",function(){e.sessionStorage.removeItem(e.initializedFlag)}))}},{"key":"clear","value":function(){if(e.canStore){for(var t=[],n=0;n<e.sessionStorage.length;n++){var a=e.sessionStorage.key(n);a.startsWith(e.tokenStoragePrefix)&&t.push(a)}t.forEach(function(t){return e.sessionStorage.removeItem(t)}),e.sessionStorage.removeItem(e.initializedFlag)}}},{"key":"getKeyName","value":function(t){return""+e.tokenStoragePrefix+t}},{"key":"sessionStorage","get":function(){try{return t.sessionStorage}catch(e){return null}}},{"key":"window","get":function(){try{return t.window}catch(e){return null}}},{"key":"canStore","get":function(){return e.sessionStorage&&e.window}}]),e}();s.initializedFlag="twilio_twilsock_token_storage",s.tokenStoragePrefix="twilio_continuation_token_",n.TokenStorage=s,s.initialize()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],"281":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/promise")),r=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/core-js/object/get-prototype-of")),l=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/helpers/possibleConstructorReturn")),d=a(e("babel-runtime/helpers/inherits")),u=a(e("babel-runtime/helpers/classCallCheck")),p=a(e("babel-runtime/core-js/json/stringify"));a(e("babel-runtime/helpers/typeof")),Object.defineProperty(n,"__esModule",{"value":!0});var f=e("events"),b=e("javascript-state-machine"),h=e("./logger"),m=e("./protocol/messages"),v=e("./parser"),g=e("./error/twilsockreplyerror"),_=e("./backoffretrier");n.Response=function w(){(0,u["default"])(this,w)};var y=function(e){function t(e,n,a){(0,u["default"])(this,t);var i=(0,c["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return i.terminalStates=["disconnected","rejected"],i.lastEmittedState=void 0,i.tokenExpiredSasCode=20104,i.websocket=e,i.websocket.on("connected",function(){return i.fsm.socketConnected()}),i.websocket.on("disconnected",function(){return i.fsm.socketClosed()}),i.websocket.on("message",function(e){return i.onIncomingMessage(e)}),i.websocket.on("socketError",function(e){return i.emit("connectionError",{"terminal":!1,"message":e.message,"httpStatusCode":null,"errorCode":null})}),i.transport=n,i.config=a,i.retrier=new _.BackoffRetrier(a.retryPolicy),i.retrier.on("attempt",function(){return i.retry()}),i.retrier.on("failed",function(e){h.log.warn("Retrying failed: "+e.message),i.disconnect()}),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",function(){h.log.debug("Browser reported connectivity state: online"),i.fsm.systemOnline()}),window.addEventListener("offline",function(){h.log.debug("Browser reported connectivity state: offline"),i.websocket.close(),i.fsm.socketClosed()})),i.fsm=new b({"init":"disconnected","transitions":[{"name":"userConnect","from":["disconnected","rejected"],"to":"connecting"},{"name":"userConnect","from":["connecting","connected"]},{"name":"userDisconnect","from":["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],"to":"disconnecting"},{"name":"userRetry","from":["retrying"],"to":"connecting"},{"name":"socketConnected","from":["connecting"],"to":"initialising"},{"name":"socketClosed","from":["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],"to":"retrying"},{"name":"socketClosed","from":["disconnecting"],"to":"disconnected"},{"name":"socketClosed","from":["waitSocketClosed"],"to":"disconnected"},{"name":"socketClosed","from":["rejected"],"to":"rejected"},{"name":"initSuccess","from":["initialising"],"to":"connected"},{"name":"initError","from":["initialising"],"to":"error"},{"name":"tokenRejected","from":["initialising","updating"],"to":"rejected"},{"name":"protocolError","from":["initialising","connected","updating"],"to":"error"},{"name":"receiveClose","from":["initialising","connected","updating"],"to":"waitSocketClosed"},{"name":"receiveOffload","from":["initialising","connected","updating"],"to":"waitOffloadSocketClosed"},{"name":"unsupportedProtocol","from":["initialising","connected","updating"],"to":"unsupported"},{"name":"receiveFatalClose","from":["initialising","connected","updating"],"to":"unsupported"},{"name":"userUpdateToken","from":["disconnected","rejected","connecting","retrying"],"to":"connecting"},{"name":"userUpdateToken","from":["connected"],"to":"updating"},{"name":"updateSuccess","from":["updating"],"to":"connected"},{"name":"updateError","from":["updating"],"to":"error"},{"name":"userSend","from":["connected"],"to":"connected"},{"name":"systemOnline","from":["retrying"],"to":"connecting"}],"methods":{"onConnecting":function(){i.setupSocket(),i.emit("connecting")},"onEnterInitialising":function(){i.sendInit()},"onLeaveInitialising":function(){i.cancelInit()},"onEnterUpdating":function(){i.sendUpdate()},"onLeaveUpdating":function(){i.cancelUpdate()},"onEnterRetrying":function(){i.initRetry(),i.emit("connecting")},"onEnterConnected":function(){i.resetBackoff(),i.onConnected()},"onUserUpdateToken":function(){i.resetBackoff()},"onTokenRejected":function(){i.resetBackoff(),i.closeSocket(!0),i.finalizeSocket()},"onUserDisconnect":function(){i.closeSocket(!0)},"onEnterDisconnecting":function(){i.startDisconnectTimer()},"onLeaveDisconnecting":function(){i.cancelDisconnectTimer()},"onEnterWaitSocketClosed":function(){i.startDisconnectTimer()},"onLeaveWaitSocketClosed":function(){i.cancelDisconnectTimer()},"onEnterWaitOffloadSocketClosed":function(){i.startDisconnectTimer()},"onLeaveWaitOffloadSocketClosed":function(){i.cancelDisconnectTimer()},"onDisconnected":function(){i.resetBackoff(),i.finalizeSocket()},"onReceiveClose":function(e,t){i.onCloseReceived(t)},"onReceiveOffload":function(e,t){h.log.debug("onreceiveoffload: ",t),i.modifyBackoff(t.body),i.onCloseReceived(t.status)},"onUnsupported":function(){i.closeSocket(!0),i.finalizeSocket()},"onError":function(e,t){i.closeSocket(t),i.finalizeSocket()},"onEnterState":function(e){"none"!==e.from&&i.changeState(e)},"onInvalidTransition":function(e,t,n){h.log.warn("FSM: unexpected transition",t,n)}}}),i}return(0,d["default"])(t,e),(0,l["default"])(t,[{"key":"changeState","value":function(e){h.log.debug("FSM: "+e.transition+": "+e.from+" --> "+e.to),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{"key":"resetBackoff","value":function(){h.log.trace("resetBackoff"),this.retrier.stop()}},{"key":"modifyBackoff","value":function(e){h.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{"key":"startDisconnectTimer","value":function(){var e=this;h.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){h.log.debug("disconnecting is timed out"),e.closeSocket(!0)},3e3)}},{"key":"cancelDisconnectTimer","value":function(){h.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{"key":"initRetry","value":function(){h.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{"key":"retry","value":function(){"connecting"!=this.fsm.state?(h.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):h.log.trace("can\t retry as already connecting")}},{"key":"onConnected","value":function(){this.emit("connected")}},{"key":"finalizeSocket","value":function(){h.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{"key":"setupSocket","value":function(){h.log.trace("setupSocket:",this.config.token),this.websocket.connect()}},{"key":"onIncomingMessage","value":function(e){var t=v.Parser.parse(e),n=t.method,a=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(a),"notification"===n)this.emit("message",a.message_type,i);else if("reply"===a.method)this.transport.processReply({"id":a.id,"status":a.status,"header":a,"body":i});else if("client_update"===a.method)"token_about_to_expire"===a.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===a.method)if(308===a.status.code)h.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({"status":a.status.status,"body":i});else if(406===a.status.code){var r="Server closed connection because can't parse protocol: "+(0,p["default"])(a.status);this.emitReplyConnectionError(r,a,!0),h.log.error(r),this.fsm.receiveFatalClose()}else 417===a.status.code?(h.log.error("Server closed connection because can't parse client reply: "+(0,p["default"])(a.status)),this.fsm.receiveFatalClose(a.status.status)):410===a.status.code?(h.log.warn("Server closed connection: "+(0,p["default"])(a.status)),this.fsm.receiveClose(a.status.status),this.emit("tokenExpired")):401===a.status.code?(h.log.error("Server closed connection: "+(0,p["default"])(a.status)),this.fsm.receiveClose(a.status.status)):(h.log.warn("unexpected message: ",a.status),this.fsm.receiveOffload({"status":a.status.status,"body":null}))}},{"key":"sendInit","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){var e,n;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.log.trace("sendInit"),t.prev=1,t.next=4,this.transport.sendInit();case 4:e=t.sent,this.config.updateContinuationToken(e.continuationToken),this.fsm.initSuccess(e),this.emit("initialized",e),this.emit("tokenUpdated"),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](1),t.t0 instanceof g.TwilsockReplyError?(n=!1,h.log.warn("Init rejected by server: "+(0,p["default"])(t.t0.reply.status)),401===t.t0.reply.status.code||403===t.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(t.t0.reply.status),t.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===t.t0.reply.status.code?(this.modifyBackoff(t.t0.reply.body),this.fsm.initError(!0)):500===t.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(t.t0.message,t.t0.reply,n)):(this.emit("connectionError",{"terminal":!0,"message":t.t0.message,"httpStatusCode":null,"errorCode":null}),this.fsm.initError(!0)),this.emit("tokenUpdated",t.t0);case 15:case"end":return t.stop()}},t,this,[[1,11]])}));return function(){return e.apply(this,arguments)}}()},{"key":"sendUpdate","value":function(){var e=(0,s["default"])(r["default"].mark(function t(){var e,n,a;return r["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.log.trace("sendUpdate"),e=new m.Update(this.config.token),t.prev=2,t.next=5,this.transport.sendWithReply(e);case 5:n=t.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),t.t0 instanceof g.TwilsockReplyError?(a=!1,h.log.warn("Token update rejected by server: "+(0,p["default"])(t.t0.reply.status)),401===t.t0.reply.status.code||403===t.t0.reply.status.code?(a=!0,this.fsm.tokenRejected(t.t0.reply.status),t.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===t.t0.reply.status.code?(this.modifyBackoff(t.t0.reply.body),this.fsm.updateError(t.t0.reply.status)):this.fsm.updateError(t.t0.reply.status),this.emitReplyConnectionError(t.t0.message,t.t0.reply,a)):(this.emit("error",!1,t.t0.message,null,null),this.fsm.updateError(t.t0)),this.emit("tokenUpdated",t.t0);case 14:case"end":return t.stop()}},t,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{"key":"emitReplyConnectionError","value":function(e,t,n){var a=t.status&&t.status.description?t.status.description:e,i=t.status.code,r=t.status&&t.status.errorCode?t.status.errorCode:null;this.emit("connectionError",{"terminal":n,"message":a,"httpStatusCode":i,"errorCode":r})}},{"key":"cancelInit","value":function(){h.log.trace("cancelInit")}},{"key":"cancelUpdate","value":function(){h.log.trace("cancelUpdate")}},{"key":"confirmReceiving","value":function(e){h.log.trace("confirmReceiving");try{this.transport.send(new m.Reply(e.id))}catch(e){h.log.debug("failed to confirm packet receiving",e)}}},{"key":"closeSocket","value":function(e){var t=this;h.log.trace("closeSocket (graceful: "+e+")"),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout(function(){return t.fsm.socketClosed()},0)}},{"key":"connect","value":function(){h.log.trace("connect"),this.fsm.userConnect()}},{"key":"disconnect","value":function(){var e=this;return h.log.trace("disconnect"),this.fsm.is("disconnected")?i["default"].resolve():new i["default"](function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()})}},{"key":"updateToken","value":function(e){var t=this;return h.log.trace("updateToken:",e),new i["default"](function(e,n){t.once("tokenUpdated",function(t){t?n(t):e()}),t.fsm.userUpdateToken()})}},{"key":"onCloseReceived","value":function(){this.websocket.close()}},{"key":"isConnected","get":function(){return"connected"===this.state&&this.websocket.isConnected}},{"key":"state","get":function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{"key":"isTerminalState","get":function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}}]),t}(f.EventEmitter);n.TwilsockChannel=y,n.TwilsockImpl=y},{"./backoffretrier":256,"./error/twilsockreplyerror":262,"./logger":265,"./parser":269,"./protocol/messages":272,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/core-js/promise":44,"babel-runtime/helpers/asyncToGenerator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/helpers/typeof":57,"babel-runtime/regenerator":58,"events":196,"javascript-state-machine":198}],"282":[function(e,t,n){(function(t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=a(e("babel-runtime/core-js/object/get-prototype-of")),r=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),l=a(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{"value":!0});var c=e("events"),d=e("./logger"),u=function(n){function a(n){(0,r["default"])(this,a);var s=(0,o["default"])(this,(a.__proto__||(0,i["default"])(a)).call(this));return s.url=n,s.WebSocket=t.WebSocket||t.MozWebSocket||e("ws"),s}return(0,l["default"])(a,n),(0,s["default"])(a,[{"key":"connect","value":function(){var e=this;d.log.trace("connecting to socket");var t=new this.WebSocket(this.url);t.binaryType="arraybuffer",
t.onopen=function(){d.log.debug("socket opened "+e.url),e.emit("connected")},t.onclose=function(t){d.log.debug("socket closed",t),e.emit("disconnected",t)},t.onerror=function(t){d.log.debug("error:",t),e.emit("socketError",t)},t.onmessage=function(t){e.emit("message",t.data)},this.socket=t}},{"key":"send","value":function(e){this.socket.send(e)}},{"key":"close","value":function(){if(d.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}},{"key":"isConnected","get":function(){return this.socket&&1===this.socket.readyState}}]),a}(c.EventEmitter);n.WebSocketChannel=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":265,"babel-runtime/core-js/object/get-prototype-of":41,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"events":196,"ws":59}],"283":[function(e,t){var n=e("./v1"),a=e("./v4"),i=a;i.v1=n,i.v4=a,t.exports=i},{"./v1":286,"./v4":287}],"284":[function(e,t){for(var n=[],a=0;a<256;++a)n[a]=(a+256).toString(16).substr(1);t.exports=function(e,t){var a=t||0,i=n;return[i[e[a++]],i[e[a++]],i[e[a++]],i[e[a++]],"-",i[e[a++]],i[e[a++]],"-",i[e[a++]],i[e[a++]],"-",i[e[a++]],i[e[a++]],"-",i[e[a++]],i[e[a++]],i[e[a++]],i[e[a++]],i[e[a++]],i[e[a++]]].join("")}},{}],"285":[function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var a=new Uint8Array(16);t.exports=function(){return n(a),a}}else{var i=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},{}],"286":[function(e,t){var n,a,i=e("./lib/rng"),r=e("./lib/bytesToUuid"),s=0,o=0;t.exports=function(e,t,l){var c=t&&l||0,d=t||[],u=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:a;if(null==u||null==p){var f=i();null==u&&(u=n=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==p&&(p=a=16383&(f[6]<<8|f[7]))}var b=void 0!==e.msecs?e.msecs:(new Date).getTime(),h=void 0!==e.nsecs?e.nsecs:o+1,m=b-s+(h-o)/1e4;if(m<0&&void 0===e.clockseq&&(p=p+1&16383),(m<0||b>s)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=b,o=h,a=p;var v=(1e4*(268435455&(b+=122192928e5))+h)%4294967296;d[c++]=v>>>24&255,d[c++]=v>>>16&255,d[c++]=v>>>8&255,d[c++]=255&v;var g=b/4294967296*1e4&268435455;d[c++]=g>>>8&255,d[c++]=255&g,d[c++]=g>>>24&15|16,d[c++]=g>>>16&255,d[c++]=p>>>8|128,d[c++]=255&p;for(var _=0;_<6;++_)d[c+_]=u[_];return t||r(d)}},{"./lib/bytesToUuid":284,"./lib/rng":285}],"287":[function(e,t){var n=e("./lib/rng"),a=e("./lib/bytesToUuid");t.exports=function(e,t,i){var r=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[r+o]=s[o];return t||a(s)}},{"./lib/bytesToUuid":284,"./lib/rng":285}],"288":[function(e,t){t.exports={"name":"twilio-chat","version":"3.3.2","description":"Twilio Chat service client library","main":"lib/index.js","browser":"browser/index.js","types":"./lib/client.d.ts","author":"Twilio","license":"MIT","dependencies":{"twilio-mcs-client":"^0.3.1","twilio-notifications":"^0.5.8","twilio-sync":"^0.11.4","twilsock":"^0.5.11","iso8601-duration":"^1.2.0","loglevel":"^1.6.3","operation-retrier":"^3.0.0","platform":"^1.3.5","rfc6902":"^3.0.2","uuid":"^3.3.2"},"devDependencies":{"@types/chai":"^4.1.7","@types/chai-as-promised":"^7.1.2","@types/chai-string":"^1.4.1","@types/core-js":"^2.5.0","@types/mocha":"^5.2.7","@types/node":"^12.7.5","@types/sinon":"^7.0.12","@types/sinon-chai":"^3.2.2","async":"^3.0.1","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","backoff":"^2.5.0","browserify":"^16.2.3","browserify-replace":"^1.0.0","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.0","del":"^5.1.0","fancy-log":"^1.3.3","fs":"0.0.2","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0","jsdoc":"~3.5.5","jsdoc-strip-async-await":"^0.1.0","mocha":"^6.1.4","mocha.parallel":"^0.15.6","nyc":"^14.1.1","path":"^0.12.7","sinon":"^7.3.2","sinon-chai":"^3.3.0","source-map-explorer":"^2.0.1","ts-node":"^8.2.0","tslint":"^5.17.0","twilio":"^3.31.1","typescript":"^3.6.3","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"engines":{"node":">=6"}}},{}]},{},[3])(3)});var scheduleLimit=2,LiveEventStream=null,ChannelBindings={},ChatAudioOn=!1,LoadingNextPage=!1,EntriesPerPage=30,KnownBlockedNumbers=new Set(["+266696687","+17378742833","7378742833","2562533","8656696"]),__clickLock=!1,stripeLoaded=!1;if(window.text_log)var text_or_call="texts";else text_or_call="calls";!function(e){"use strict";e.fit=function(e,t){if(t=t==undefined?32:t,e.length<=t)return e;var n=t-3,a=e.lastIndexOf(" ",n);return(-1==a||a<t/2)&&(a=n),e.substr(0,a)+"..."},e.visible=function(t){var n=e(t),a=n.offset().top+n.height()>=e(window).scrollTop(),i=n.offset().top<=e(window).scrollTop()+e(window).height();return a&&i}}(jQuery);var CallsTable=new Map,NewCallSet=new Set,CheckInProgressCall=new Set,CallsInProgress=new Map,CheckingInProgressCalls=new Set,InProgressCallTimer=null,UpdatingCalls=new Map,FetchQueue={},Partials={},Templates={"caller_profile":null,"caller_analytics":null,"caller_session":null,"caller_sale":null,"caller_messages":null,"caller_transcription":null,"call_flow":null,"dynamics_panel":null,"sendgrid_panel":null,"reminder_panel":null,"salesforce_panel":null,"desk_com_panel":null,"text_message":null,"live_call":null,"custom":null,"custom_action":null,"do_not_call":null,"hubspot_panel":null,"zoho_panel":null,"zendesk_panel":null},CallList=function(){"use strict";function e(e){window.AutoLoadCalls=e}function t(){var e=[{"id":"caller_actions","on":!0,"sort":!1},{"id":"caller","on":!0,"sort":"down"},{"id":"inputs","on":!0,"sort":!1},{"id":"message_body","on":!0,"sort":!1},{"id":"source","on":!0,"sort":"down"},{"id":"source_detail","on":!0,"sort":!1}];CTM.meta.custom_panels.forEach(function(t){e.push({"id":"c"+t.id,"label":t.name,"icon":"font-"+t.icon,"classes":" col-custom ","on":window.UserPrefs.columns["c"+t.id],"sort":!1,"allowed":!0})}),e=e.concat([{"id":"csr","label":window.CTMScoring.column_name,"on":!0,"sort":"down"},{"id":"audio","on":!0,"sort":!1},{"id":"metrics","on":!0,"sort":"down"},{"id":"receiving_number","on":!0,"sort":"down"},{"id":"actions","on":!0,"sort":!1}]).map(function(e){e.on=window.UserPrefs.columns[e.id],e.allowed=window.AllowedAccess[e.id],e.col=e.id.replace(/_/g,"-");var t=CTM.localize("Call","columns."+e.id)||CTM.localize("Call","columns."+e.id.replace("_","-"));return t&&(e.label||""===e.label||(e.label=t.name),e.label||""===e.label||(e.label=t.label),e.icon=e.icon||t.icon),e});var t=HoganTemplates["calls/header_table"].render({"headers":e});$("#calls thead").html(t);var n=$("<table>");$("#calls tfoot #calls-footer-header").html(n.html(t).find("tr").html());const a=[{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e},{"headers":e}];$(".calls-loader").remove(),$("#calls tfoot").prepend(HoganTemplates["calls/loader_rows"].render({"rows":a}));var i=W();$("#calls-error > td").attr("colspan",i)}function n(){function e(e){if(e.origin==window.location.protocol+"//"+window.location.host){var t=e.data.query;t?we(!0,t):e.data.loadMore&&se()}else console.error("origin mismatch")}function n(){if(document[i])c=performance.now();else if(window.AutoLoadCalls&&!Query.callNav&&!$("audio").length&&"wrapup"!=$("body").attr("data-status")){performance.now()-c>4e3&&CTMsearch()}}AccountSwitch.onSwitched(function(e){console.log("switched:",e,window.ctmEmbed),0==e?"sf"==window.ctmEmbed?window.location="/calls/phone?embed=sf&agency_id="+CTM.agency:window.location.reload():"sf"==window.ctmEmbed&&window.location.toString().match(/calls\/phone/)?window.location="/calls/phone?embed=sf&agency_id="+CTM.agency:window.location.reload()}),t(),window.AllowedAccess.status_filters||$("#call_status").closest(".field").hide(),Object.keys(HoganTemplates).filter(function(e){return e.match(/calls\/_/)}).forEach(function(e){Partials[e]=Partials[e.replace(/calls\/_/,"")]=HoganTemplates[e]}),["call_row","call_edit","call_nav","caller_profile","chat","caller_session","caller_analytics","caller_messages","caller_messages_emails","yes_no_modal","caller_transcription","call_form_fields","caller_sale","call_flow","custom","custom_action","dynamics_panel","sendgrid_panel","reminder_panel","salesforce_panel","desk_com_panel","scripts_panel","add_agent_profile","text_message","call_path","listen","flag_call","audio_player","do_not_call","live_call","stripe_payment","zoho_panel","zendesk_panel","mailchimp","hubspot_panel"].forEach(function(e){Templates[e]=function(t){return HoganTemplates["calls/"+e].render($.extend({"KLASS":"Call"},t),Partials)}}),ke=Templates.call_row,Ce=Templates.call_edit,xe=Templates.call_nav,CTMInitFilters(),re();var a=updateFromHash();$(window).data("URLChangeLock",!0),we(!0,Query,function(){if(!isNaN(parseInt(a.callId))&&a.callNav){var e=$("#call-row-"+a.callId);e.length>0?l(a.callNav,e):(setURLState({"callNav":a.callNav,"callId":a.callId}),_e(a.callId,function(e){l(a.callNav,$("#call-row-"+e.id))}))}$(window).on("hashchange",URLChangeEvent)}),$("#make-call").click(function(e){e.preventDefault(),CTM.phonemode?$("body").animateClass().toggleClass("contacts"):ctmOpenPhone()}),$("#view-voicemail").click(function(e){e.preventDefault(),re(),$("#search-box").val('tag_list:"voicemail" OR status:"no answer" AND _exists_:audio'),CTMsearch()}),$("#show-calls").click(function(){$("#direction").select2("val",["inbound","outbound","form"]),window.CTMsearch().then(function(){})}),$("#show-texts").click(function(){$("#direction").select2("val",["msg_inbound","msg_outbound"]),window.CTMsearch().then(function(){})}),window.CTMLoadOnScroll=function(){if(!isMobileLayout()&&!$("body.focus").length||!$("body").hasClass("call-log-open"))if(CTM.phonemode&&isMobileLayout())$(window).off("scroll",window.CTMLoadOnScroll);else if((!CTM.phonemode||"wrapup"!=$("body").attr("data-status"))&&window.innerHeight+window.scrollY>=document.body.offsetHeight-500){let e=$("body").data("loadingMore");if(e&&(new Date).getTime()-e<1500)return void console.log("skip loading not enough time has past");$("body").data("loadingMore",(new Date).getTime()),se()&&console.log("skip loading we're currently loading more calls")}},$(window).on("scroll",window.CTMLoadOnScroll),$(window).on("resize",function(){isMobileLayout()&&$("body").hasClass("call-log-open")&&G()}),$("#calls").on("click",".call-row .openable",function(e){if("_blank"!=e.target.getAttribute("target")){if("false"==$(this).attr("data-key"))return!0;e.preventDefault(),e.stopPropagation();var t=GetSelectedText();t&&t.length>3&&!CTM.phonemode||($(this).closest("tr").find(".caller-account").length?$(this).closest("tr").find(".caller-account a.action.account").click():$(this).hasClass("call-source-detail")?je.source_detail.apply(this):je.toggle.apply(this))}}),$("#calls").on("click","a.search",function(e){if(isMobileLayout()){if(CTM.phonemode)return;if("caller_number"!=(r=$(this).attr("data-field"))&&"name"!=r)return}if(!o()){e.preventDefault(),e.stopPropagation();var t=$(this);if(t.hasClass("call_path")){var n=parseInt(t.closest(".log-column").attr("data-id")),a=CallsTable.get(n).call_path.map(function(e){return"<li>"+escapeHtml(e.route_name)+"</li>"}).join("");return t.popover({"content":"<ul>"+a+"</ul>","html":!0,"placement":"left","title":"Call Path <small>key events of the call</small>","container":"body","trigger":"manual","template":'<div class="popover call-log-popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'}),void t.popover("toggle")}var i=t.attr("data-search")||t.text(),r=t.attr("data-field"),s=i.replace(/:/,"\\:");r&&(s=r+':"'+s+'"'),$("#search-box").val(s),ie()}}),$("#search-box").on("blur",function(){$("#search-box").addClass("subtle").closest("form.search").removeClass("focused")}),$("#search-box").on("focus",function(){$("#search-box").removeClass("subtle").closest("form.search").addClass("focused")}),$("#calls").on("click",".action",function(e){if("_blank"!=e.target.getAttribute("target")){e.preventDefault(),e.stopPropagation();var t=$(this).attr("data-action"),n=$(this).attr("data-id");"edit"==t&&$("#call-edit-panel-"+n).length>0?K(n,"caller_profile"):window.AllowedAccess.score_edit||"caller_sale"!=t&&"sale"!=t?je[t].apply(this):console.log("not allowed to access sale")}}),$("#calls").on("click",".additional-audio",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).attr("data-action");je[t].apply(this)}),$("#calls").on("click",".direction",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).attr("data-action");je[t].apply(this)}),$("#calls").on("click",".transcription-available, .keyword-spotted",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt($(this).attr("data-id"));CallsTable.get(t);window.AllowedAccess.receiving_number?window.CallActions.transcription.apply($("#call-row-"+t).get(0)):console.log("not allowed to access sale")}),$("#calls").on("click",".call-receiving-number .change-agent",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest("td").attr("data-id"),n=$(this).closest(".agent"),a=HoganTemplates["calls/_agent_selector"].render({"id":n.attr("data-id"),"canAddAgents":CTM.canAddAgents});$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t+"/phone_settings.json",function(e){if(!e.settings.allow_agent_changes){let e="agent_id:"+n.attr("data-id");return $("#search-box").val(e),void ie()}var t=n.html();n.html(a);var i=n.closest("tr");i.addClass("editing-agent"),n.find(".input-agent-selector").select2({"placeholder":"Type the agent name","ajax":{"url":"/api/v1/accounts/"+CTM.account+"/agents.json?hide="+(CTM.hide_agency_admins?"1":"0"),"dataType":"json","data":function(e,t){return{"filter":e,"per_page":10,"page":t}},"results":function(e,t){var n=10*t<e.total_entries;return{"results":$.map(e.agents,function(e){return{"id":e.id,"text":e.name,"description":e.email,"pic_url":e.pic_url}}),"more":n}}},"formatResult":formatStandardResult,"formatSelection":formatStandardResult,"width":"200px","escapeMarkup":function(e){return e}}).on("change",function(){var e=n.find(".input-agent-selector").select2("val"),a=n.closest(".log-column").attr("data-id");n.html('saving... <i class="font-spinner-2 icon-loop-repeat"></i>'),$.post("/api/v1/accounts/"+CTM.account+"/agents/"+e+"/assign_call.json",{"call_id":a},function(e){prepareAgent(e.agent),n.replaceWith(Partials["calls/_call_agent"].render({"agent":e.agent})),i.removeClass("editing-agent")}).fail(function(){n.html("error saving..."),setTimeout(function(){n.html(t),i.removeClass("editing-agent")},3e3)}).always(function(){})}),setTimeout(function(){n.find(".input-agent-selector").select2("open")},0),n.find(".remove-agent").click(function(e){e.preventDefault(),e.stopPropagation();var a=n.attr("data-id"),r=n.closest(".log-column").attr("data-id");n.html('deleting... <i class="font-spinner-2 icon-loop-repeat"></i>'),$.post("/api/v1/accounts/"+CTM.account+"/agents/"+a+"/remove_call.json",{"call_id":r,"_method":"delete"},function(){n.replaceWith(Partials["calls/_call_agent"].render({})),i.removeClass("editing-agent")}).fail(function(){n.html("error updating..."),setTimeout(function(){n.html(t),i.removeClass("editing-agent")},3e3)}).always(function(){})}),n.find(".cancel-agent-select").click(function(e){e.preventDefault(),e.stopPropagation(),n.html(t),i.removeClass("editing-agent")}),n.find(".add-agent").click(function(e){function a(){$("#modal-frame .role-definitions [data-role]").hide(),$('#modal-frame .role-definitions [data-role="'+escapeFindAttr(l.val())+'"]').show()}function r(){n.closest(".log-column").attr("data-id");var e=$("#modal-frame form"),t=e.find('input[name="agent[first_name]"]'),a=e.find('input[name="agent[last_name]"]'),i=e.find('input[name="agent[email]"]'),r=$.trim(t.val()),s=$.trim(a.val()),o=$.trim(i.val()),l=[];return t.removeClass("error"),a.removeClass("error"),i.removeClass("error"),$("#modal-frame span.error.messages").remove(),r.length||(l.push("first name is required"),t.addClass("error").after("<span class='error messages'>is required</span>")),s.length||(l.push("last name is required"),a.addClass("error").after("<span class='error messages'>is required</span>")),o.length||(l.push("email is required"),i.addClass("error").after("<span class='error messages'>is required</span>")),o.length&&!o.match(/.+@.+/)&&(l.push("email is invalid"),i.addClass("error").after("<span class='error messages'>is invalid</span>")),!l.length}function s(){function e(e){CTM.trk.event("Usage","AddAgentSave","Call Log saveAgent Success",CTM.account),prepareAgent(e.agent),n.replaceWith(Partials["calls/_call_agent"].render({"agent":e.agent})),i.removeClass("editing-agent")}function a(){CTM.trk.event("Usage","AddAgentSave","Call Log saveAgent Failure",CTM.account),n.html("error saving..."),setTimeout(function(){n.html(t),i.removeClass("editing-agent")},3e3)}function s(){}if(r()){var l=n.closest(".log-column").attr("data-id"),c=$("#modal-frame form");if(c.append("<input type='hidden' name='agent[call_id]' value='"+l+"'/>"),o){var d=new FormData(c.get(0)),u=new XMLHttpRequest;u.open("POST",c.attr("action")),u.onreadystatechange=function(){4==this.readyState&&s()},u.onload=function(){200==this.status?e(JSON.parse(this.responseText)):a({})},u.onerror=function(){a({})},u.send(d)}else $.post(c.attr("action"),c.serialize(),e).fail(a).always(s);$("#modal-frame .modal").modal("hide"),n.html('saving... <i class="font-spinner-2 icon-loop-repeat"></i>')}}e.preventDefault(),e.stopPropagation(),CTM.trk.event("Usage","AddAgentClick","Call Log .add-agent",CTM.account);var o=typeof window.FormData!=undefined;$("#modal-frame").html(Templates.add_agent_profile({"hasFormData":o,"accountId":CTM.account})),$("#modal-frame .chzn-select").select2();var l=$('#modal-frame select[name="agent[role]"]');l.on("change",function(){a()}),a(),$("#modal-frame .action-cancel").click(function(e){e.preventDefault(),e.stopPropagation(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .action-create").click(function(e){e.preventDefault(),e.stopPropagation(),s()});var c=$('#modal-frame input[name="agent[email]"]'),d=c.val();c.change(function(){var e=$(this).val(),t=$("#modal-frame .user-email-exists");t.hide(),e&&e!=d&&$.get("/account_users/check_email.json",{"email":e},function(e){e&&e.slug&&e.slug.length&&e.slug.match(/USR/)&&(t.html('A user with this email address already exists.<br/><a href="'+e.slug+'">show user</a>'),t.show())})}),$("#modal-frame form").submit(function(e){e.preventDefault(),e.stopPropagation(),s()}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0})})})}),CTM.phonemode&&$("#calls").on("click",".caller-info-section .agent-initials",function(e){var t=$(this).closest("tr.call-row"),n=t.attr("data-active-action");n&&(e.preventDefault(),e.stopPropagation(),"answer"==n?je.answer_call.apply(t):"hold"==n?je.pickup_call_on_hold.apply(t):"listen"==n&&je.live_listen.apply(t))}),InitLogHeader(),$("#call-customize .dropdown-menu a").each(function(){$(this).find("i.toggle").toggleClass("font-checkmark-2",window.UserPrefs.columns[$(this).attr("data-col").replace(/-/g,"_")])}),$("#call-customize .dropdown-menu a").click(function(e){e.preventDefault();var t=$(this).attr("data-col").replace(/-/g,"_"),n=window.UserPrefs.columns[t]=!window.UserPrefs.columns[t];$(this).find("i.toggle").toggleClass("font-checkmark-2",n),s()}),$("#call-customize > .button").toggleClass("pulsebutton",0==W()),$("#call-section-customize .dropdown-menu a").each(function(){$(this).find("i.toggle").toggleClass("font-checkmark-2",window.UserPrefs.sections[$(this).attr("data-col").replace(/-/g,"_")])}),$("#call-section-customize .dropdown-menu a").click(function(e){e.preventDefault();var t=$(this).attr("data-col").replace(/-/g,"_"),n=window.UserPrefs.sections[t]=!window.UserPrefs.sections[t];$(this).find("i.toggle").toggleClass("font-checkmark-2",n),$('[data-target="#log-actions-collapse"]').click(),s()}),$("#call-section-customize > .button").toggleClass("pulsebutton",0==V()),CTM.filter_follow&&(window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)),$("#exclude-bulk-filtered").click(function(e){e.preventDefault();var t="<h3>Exclude {{total}} Calls</h3><p>The calls excluded will no longer be visible to any report.</p>";bootbox.confirm(Mustache.to_html(t,{"total":Se}),function(e){if(e){var t=Query;t.total=Se,$.post("/api/v1/accounts/"+CTM.account+"/calls/exclude_filter",t)}bootbox.hideAll()})}),$("#include-bulk-filtered").click(function(e){e.preventDefault();var t="<h3>Include {{total}} Calls</h3><p>The calls include will be visible to all reports.</p>";bootbox.confirm(Mustache.to_html(t,{"total":Se}),function(e){if(e){var t=Query;t.total=Se,$.post("/api/v1/accounts/"+CTM.account+"/calls/include_filter",t)}bootbox.hideAll()})});var i,r,c=performance.now();"undefined"!=typeof document.hidden?(i="hidden",r="visibilitychange"):"undefined"!=typeof document.msHidden?(i="msHidden",r="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(i="webkitHidden",r="webkitvisibilitychange"),document.addEventListener(r,n,!1)}function a(){$("form.search i.font-search").removeClass("font-search").addClass("font-spinner-2 icon-loop-repeat"),$(".call-edit-frame .navbar-header .paths-sm .close-mobile-nav i").removeClass("font-chevron-left").addClass("font-spinner-2 icon-loop-repeat")}function i(){$("form.search i.font-spinner-2").removeClass("font-spinner-2 icon-loop-repeat").addClass("font-search"),$(".call-edit-frame .navbar-header .paths-sm .close-mobile-nav i").removeClass("font-spinner-2 icon-loop-repeat").addClass("font-chevron-left"),$("#calls").css({"opacity":1})}function r(){Object.keys(window.UserPrefs.columns).forEach(function(e){var t=window.UserPrefs.columns[e],n=e.replace(/_/g,"-");$("#calls th.col-"+n+", .log-column.call-"+n).toggleClass("hidden-col",!t),$("tr.call-row").toggleClass("col-"+e,t)}),$("#call-customize > .button").toggleClass("pulsebutton",0==W()),Object.keys(window.UserPrefs.sections).forEach(function(e){var t=window.UserPrefs.sections[e],n=e.replace(/_/g,"-");$(".log-column.call-"+n).toggleClass("hidden-section",!t),$("tr.call-row").toggleClass("section-"+e,t)}),$("#call-section-customize > .button").toggleClass("pulsebutton",0==V())}function s(){r();var e=W();$("#calls-error > td").attr("colspan",e),$.post("/calls/column_viewable_update",{"type":window.text_log?"text":"call","value":JSON.stringify(window.UserPrefs.columns),"sections":JSON.stringify(window.UserPrefs.sections)})}function o(){return CTM.phonemode&&"wrapup"==$("body").attr("data-status")}function l(e,t){if(t)var n=t,a=t.find(".call-caller-actions a[data-action=edit]");else a=$(this).closest(".call-row").find(".call-caller-actions a[data-action=edit]"),n=this;a.length>0?J.call(a[0],e):J.call(n,e)}function c(){$(this).fadeOut(function(){$(this).parent().find("[data-action=text],[data-action=callback]").fadeIn()})}function d(){if(CTM._super&&!CTM.support_allowed)bootbox.alert(CTM.localize("Call","extra.support_access_required"));else{var e=CallsTable.get(parseInt($(this).data("id")));e.can_callback=!e.can_answer_call&&!e.can_live_listen&&!e.can_pickup_hold&&window.CTM_CALLBACK_ON&&!KnownBlockedNumbers.has(e.caller_number)&&"Error"!=e.name&&window.AllowedAccess.callback&&e.caller_number&&e.caller_number.length>6,e.can_callback?c.call(this,"text_message"):l.call(this,"text_message")}}function u(){l.call(this,"scripts_panel")}function p(){CTM._super&&!CTM.support_allowed?bootbox.alert(CTM.localize("Call","extra.support_access_required")):l.call(this,"text_message")}function f(){var e=$(this).attr("data-digits"),t=$(this).attr("data-id"),n=$(this).attr("data-from-number");ctmOpenPhone(n,t,e)}function b(){var e=$(this).attr("data-id");ctmOpenPhone(null,e,null,e)}function h(){var e=$(this).attr("data-id"),t=HoganTemplates["calls/on_hold"].render({"id":e});$("#modal-frame").html(t),$("#modal-frame .modal-body").css({"overflow":"auto"}),$("#modal-frame .action-close").click(function(e){e.preventDefault(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0}),$("#transfer_to_phone_number_input").phoneCountryComboBox({"search_without_mask":!0}),setupMultiPicker("#transfer_to_agent_picker","agent","Select an agent",!0,{"live":1,"noEdit":!0,"allowedSelf":1}),setupMultiPicker("#transfer_to_queue_picker","call_queue","Select a queue",!0,{"noEdit":!0,"allowedSelf":1,"allow_transfers":1}),$("#transfer_to_me_action").click(function(){ctmOpenPhone(null,null,null,e),$("#modal-frame .modal").modal("hide")}),$("#transfer_to_agent_action").click(function(){$(".hold-dialog .modal-footer").show(),$("#transfer_to_agent_container").show(),$("#transfer_to_number_container").hide(),$("#transfer_to_queue_container").hide()}),$("#transfer_to_agent_button").click(function(){var t=$("#transfer_to_agent_picker").select2("val"),n={"route_to":"agent_id","call_id":e,"agent_id":t,"skip_already_on_hold":1,"transfer_type":"transfer"};console.log("entered:",n),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e+"/transfer/active",n,function(e){e.success||bootbox.alert("There was an issue trying to transfer to the selected agent. The caller is still on hold.")}).fail(function(){bootbox.alert("There was an issue trying to transfer to the selected agent. The caller is still on hold.")}),$("#modal-frame .modal").modal("hide")}),$("#transfer_to_phone_number_action").click(function(){$(".hold-dialog .modal-footer").show(),$("#transfer_to_number_container").show(),$("#transfer_to_agent_container").hide(),$("#transfer_to_queue_container").hide()}),$("#transfer_to_number_button").click(function(){var t=$("#transfer_to_phone_number_input").phoneCountryComboBox("digits"),n={"route_to":"number","call_id":e,"to_number":t,"skip_already_on_hold":1,"transfer_type":"transfer"};console.log("entered:",t,n),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e+"/transfer/active",n,function(e){e.success||bootbox.alert("There was an issue trying to transfer to "+t+". The caller is still on hold.")}).fail(function(){bootbox.alert("There was an issue trying to transfer to "+t+". The caller is still on hold.")}),$("#modal-frame .modal").modal("hide")}),$("#transfer_to_queue_action").click(function(){$(".hold-dialog .modal-footer").show(),$("#transfer_to_agent_container").hide(),$("#transfer_to_number_container").hide(),$("#transfer_to_queue_container").show()}),$("#transfer_to_queue_button").click(function(){var t=$("#transfer_to_queue_picker").select2("val"),n={"route_to":"queue_id","call_id":e,"queue_id":t,"skip_already_on_hold":1,"transfer_type":"transfer"};console.log("entered:",n),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e+"/transfer/active",n,function(e){e.success||bootbox.alert("There was an issue trying to transfer to the selected queue. The caller is still on hold.")}).fail(function(){bootbox.alert("There was an issue trying to transfer to the selected queue. The caller is still on hold.")}),$("#modal-frame .modal").modal("hide")})}function m(){l.call(this,"live_call")}function v(){l.call(this,"caller_transcription")}function g(){CTM._super&&!CTM.support_allowed?bootbox.alert(CTM.localize("Call","extra.support_access_required")):l.call(this,"caller_transcription")}function _(){l.call(this,"caller_messages")}function y(){l.call(this,"reminder_panel")}function w(){l.call(this,"caller_sale")}function k(){$("body").hasClass("has-chat")||!$(this).hasClass("answerable")?l.call(this,"call_chat"):bootbox.alert("Unable to answer chat. Do you have a chat license?")}function C(){CTM._super&&!CTM.support_allowed?bootbox.alert(CTM.localize("Call","extra.support_access_required")):l.call(this,"call_form_fields")}function x(){l.call(this,"call_flow")}function T(){function e(t,n,a,i){var r=a.info?a.info:{};r.name_type?ctmFlash("Enhanced caller ID information found"):ctmFlash("No enhanced caller ID information found","warning");"C"==r.name_type?(r.first_name+" "+r.last_name).replace(/^\s*/,""):"B"==r.name_type&&r.business_name,$("#calls tr[data-number='"+escapeFindAttr(a.caller_number)+"'] a[data-action=lookup]").remove(),i&&a.caller_number&&$("table.calllog tr[data-number='"+escapeFindAttr(a.caller_number)+"']").each(function(){var t=parseInt($(this).attr("id").replace(/call-/,""));e($(this),t,a,!1)})}function t(){r[n]||(r[n]=!0,$.post("/targus/lookup_status/"+n+".json",{"noise":a},function(a){"processing"==a.status?(s[n]&&(clearTimeout(s[n]),delete s[n]),s[n]=setTimeout(t,8e3)):(e(i,n,a,!0),s[n]&&(clearTimeout(s[n]),delete s[n]))}).always(function(){delete r[n]}))}var n=$(this).attr("data-id"),a=null,i=$("#call-row-"+n),r={},s={};bootbox.dialog({"message":'<h3>Enhanced Caller ID Lookup</h3><p>This will look for the caller\'s full name and billing address in our premium database. If <i>at least</i> a full name is identified, then your account will be charged <b class="callerid-price"></b> for the results. Typically you can expect to get information back for about 50% of the callers.</p><p>Do you want to perform an enhanced caller ID lookup now?</p>',"onEscape":function(){},"buttons":{"cancel":{"label":"Cancel","className":"btn-default","callback":function(){}},"success":{"label":"Look Up","className":"btn-primary","callback":function(){var r=i.closest(".call-row").attr("data-number");$("#calls tr[data-number='"+escapeFindAttr(r)+"'] a[data-action=lookup]").removeClass("font-more2").html('<i class="font-spinner-2 icon-loop-repeat"></i>'),$.post("/targus/lookup/"+n+".json",{},function(r){a=r.noise,"processing"==r.status?setTimeout(t,2e3):e(i,n,r,!0)},"json")}}}}),$.ajax({"url":"/api/v1/plans/call_log","data":{"flag":"targus","plan":CTM.plan_name},"success":function(e){try{var t=e.features.call_log[0].plans[0].price;t&&$(".bootbox").find(".callerid-price").html("$"+t)}catch(n){}}})}function S(){Me&&(clearTimeout(Me),Me=null);var e=this;$.post("/salesforce/haslead",{"call_id":e.callId},function(t){t.lead?($(e.anchor).attr("href",t.iurl+"/"+t.lead),$(e.anchor).find(".text").html("lead"),$(e.anchor).removeAttr("rel"),e.anchor=null):t.contact?($(e.anchor).attr("href",t.iurl+"/"+t.contact),$(e.anchor).find(".text").html("contact"),$(e.anchor).removeAttr("rel"),e.anchor=null):(Me&&(clearTimeout(Me),Me=null),Me=setTimeout(S.bind(e),3e3))},"json")}function M(){var e=$(this).attr("href");$.trim(e).length>5&&window.open(e,"_blank")}function j(){var e=$(this).attr("href");$.trim(e).length>5&&window.open(e,"_blank")}function E(e){var t=e.call;e.record;if(window.SFLeadSearchCallId=null,e.instance_url=CTM.sf.instance_url,e.call=CallsTable.get(parseInt(t.call_id)),e.call.name){var n=e.call.name.split(" ");e.call.first_name=n[0],e.call.last_name=n[n.length-1]}}function A(e){console.log("bind to call: ",e),$("form.sf-create").submit(function(t){t.preventDefault();var n={"FirstName":$(this).find("input[name=FirstName]").val(),"LastName":$(this).find("input[name=LastName]").val(),"Phone":$(this).find("input[name=Phone]").val(),"Email":$(this).find("input[name=Email]").val(),"call_id":e.id};bootbox.hideAll(),bootbox.alert("<h3>Creating new Lead/Record</h3>"+ProgressBarHtml+"<p>This should just take a second...</p>"),$.post("/salesforce/createnew",n,function(){window.SFLeadUpdateCallId=e.id})})}function P(e,t){window.SFLeadSearchCallId&&window.SFLeadSearchCallId==t.call.call_id&&(E(t),bootbox.hideAll(),bootbox.alert(HoganTemplates["calls/sf_lead_add"].render(t)),A(t.call))}function I(e,t){window.SFLeadUpdateCallId&&window.SFLeadUpdateCallId==t.id&&(window.SFLeadUpdateCallId=null,$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t.id+"/sfrecord.json",function(){bootbox.hideAll();var e=t.id;setTimeout(function(){
$("[data-id="+e+"].salesforce.action").addClass("flashit"),setTimeout(function(){$("[data-id="+e+"].salesforce.action").removeClass("flashit")},4e3)},2e3),setTimeout(function(){var t=CallsTable.get(parseInt(e));console.log("call Pop Lead:",t),t.salesforce&&t.salesforce.url&&bootbox.alert("<h3><a href='"+t.salesforce.url+"' target='_blank' onclick='bootbox.hideAll()'> Navigate to matching "+t.salesforce.reference+"</h3><a href='"+t.salesforce.url+"' target='_blank' onclick='bootbox.hideAll()'>open lead</a>")},4e3)}).fail(function(){bootbox.hideAll(),bootbox.alert("Failed to add to Salesforce.  Check with your administrator and the integration logs for details")}))}function D(e,t){window.SFLeadSearchCallId&&window.SFLeadSearchCallId==t.call.call_id&&(window.SFLeadSearchCallId=null,E(t),bootbox.hideAll(),setTimeout(function(){bootbox.alert(HoganTemplates["calls/sf_lead"].render(t)),$("form.sf-append").submit(function(e){e.preventDefault(),bootbox.hideAll(),bootbox.alert("<h3>Adding Task to Lead.</h3>"+ProgressBarHtml+"<p>This should just take a second...</p>"),$.post("/salesforce/appendtask",{"call_id":t.call.id,"record_id":t.record.Id},function(){window.SFLeadUpdateCallId=t.call.id})}),A(t.call)},1e3))}function R(){var e=this,t=$(this).attr("data-id"),n=$(this).attr("href");if($.trim(n).length>5)return CTM.sf.open_in_edit_mode&&(n+="/e"),void window.open(n,"_blank");CTM.sf.prompt_on_manual?(bootbox.alert("<h3>Searching Salesforce for Lead/Contact</h3>"+ProgressBarHtml+"<p>Please wait while a matching lead/contact record is found...</p>"),window.SFLeadSearchCallId=null,$.post("/salesforce/addlead",{"call_id":t,"prompt":"1"},function(){window.SFLeadSearchCallId=t;var e=null,n=function(){clearTimeout(e),window.SFLeadSearchCallId==t&&(console.log("check prompt",t),$.get("/salesforce/check_prompt",{"call_id":t},function(t){"found"==t.status?t.data&&t.data.record?(console.log("record found"),$(window).trigger("ctm.salesforce.record_found",t.data)):e=setTimeout(n,4e3):"notfound"==t.status&&(console.log(t),$(window).trigger("ctm.salesforce.record_not_found",t.data))}))};e=setTimeout(n,4e3)})):bootbox.dialog({"message":"<h3>Add Salesforce Lead</h3><p>Are you sure you want to add this caller to Salesforce as a lead?</p>","onEscape":function(){},"buttons":{"cancel":{"label":"Cancel","className":"btn-default","callback":function(){}},"success":{"label":"Add to Salesforce","className":"btn-primary","callback":function(){$(e).find(".text").html("..."),$.post("/salesforce/addlead",{"call_id":t},function(){setTimeout(S.bind({"callId":t,"anchor":e}),4e3)},"json").fail(function(){$(e).find(".text").html("failed"),setTimeout(function(){$(e).find(".text").html("add")},4e3)})}}}})}function L(){var e=$(this).attr("href");window.open(e,"_blank")}function N(){var e=parseInt($(this).attr("data-id")),t=ue(CallsTable.get(e));(function(){$("#modal-frame").html(Templates.mailchimp(t)),$("#modal-frame .action-cancel").click(function(e){e.preventDefault(),e.stopPropagation(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0})})()}function O(){var e=$(this).attr("data-id");$("#calls .last-active-row").removeClass("last-active-row"),$("#call-row-"+e).removeClass("call-active").addClass("last-active-row"),$.get("/calls/"+e+"/calllog.json",function(t){t.audio_url&&(t.audio_url=t.audio_url.replace(/^http:/,"https:"));var n=t.twilio_sid.substring(0,2),a="SM"==n||"MM"==n,i="calls/";a&&(i="sms/");for(var r=0;r<t.logs.length;r++){var s=new Date(1970,0,1);s.setTime(1e3*t.logs[r].ts);var o=s.getFullYear(),l=s.getMonth()+1,c=s.getDate(),d=s.getHours(),u=s.getMinutes(),p=s.getSeconds(),f="AM";l<10&&(l="0"+l),c<10&&(c="0"+c),u<10&&(u="0"+u),p<10&&(p="0"+p),d>=12&&(d-=12,f="PM"),0==d?d="12":d<10&&(d="0"+d);var b=o+"-"+l+"-"+c+" "+d+":"+u+":"+p+" "+f;t.logs[r].date=b,t.logs[r].msg&&"object"==typeof t.logs[r].msg&&(t.logs[r].msg=JSON.stringify(t.logs[r].msg))}var h=Templates.yes_no_modal({"header":"Account: <a href='https://www.twilio.com/user/account/subaccounts'>"+CTM.account+"</a>, <a target='_blank' href='https://www.twilio.com/user/account/log/"+i+t.twilio_sid+"' style='word-break:break-word'>"+t.twilio_sid+"</a>  (<a target='_blank' href='/calls/"+e+"/calllog?more=1'>more detail</a>)","message":Hogan.compile("{{#logs}}<div tabindex='-1' style='border-color:1px solid #ccc;margin-top:10px;width:100%;outline-offset:-2px;overflow-x:hidden;word-break:break-word'>{{msg}}</div><span class='hint'>{{date}}</span>{{/logs}}<div style='height:10px'></div>{{#audio_url}}<audio controls autoplay src='{{audio_url}}'></audio><div style='height:10px'></div>{{/audio_url}}").render(t)});$("#modal-frame").html(h),a||$("#modal-frame .modal-footer").prepend("<a data-id='"+e+"' class='killcall button pull-left' style='margin-right:5px'>Kill In-Progress Call</a> <a data-id='"+e+"' class='recovercall button pull-left'>Recover Audio <span class='status' style='position:static'></span></a>"),$("#modal-frame .modal-body").css({"overflow":"auto"}),$("#modal-frame .action-no").hide(),$("#modal-frame .action-no").click(function(e){e.preventDefault(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .action-yes").html(CTM.localize("Call","actions.close.short_label")),$("#modal-frame .action-yes").click(function(e){e.preventDefault(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .recovercall").click(function(e){if(e.preventDefault(),!$(this).hasClass("disabled")){var t=$(this).attr("data-id");$("#modal-frame .recovercall .status").addClass("icon-loop-repeat font-refresh"),$("#modal-frame .recovercall").addClass("disabled"),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+t+"/audio_recovery_check.json",function(){setTimeout(function(){$("#modal-frame .recovercall").removeClass("disabled"),$("#modal-frame .recovercall .status").removeClass("icon-loop-repeat font-refresh")},3e3)},"json")}}),$("#modal-frame .killcall").click(function(e){e.preventDefault();var t=$(this).attr("data-id");confirm("Are you sure?")&&$.post("/api/v1/accounts/"+CTM.account+"/calls/"+t+"/stop_call.json",{"_method":"delete"},function(){},"json")}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0})},"json")}function F(){var e=$(this).attr("data-id"),t=$(this).attr("data-account");AccountSwitch.perform("/accounts/"+t+"/enable?redir=/calls#callNav=caller_profile&callId="+e)}function z(){var e=parseInt($(this).attr("data-id")),t=ue(CallsTable.get(e));"in progress"==t.call_status&&$.post("/api/v1/accounts/"+t.account_id+"/calls/"+t.id+"/recording_stop").fail(function(){bootbox.alert("Error disabling Call Recording. Proceed with Caution or Try again")});var n=function(){$("#modal-frame").html(Templates.stripe_payment(t)),$("#modal-frame .action-cancel").click(function(e){e.preventDefault(),e.stopPropagation(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0})};stripeLoaded?n():$.getScript("https://js.stripe.com/v3/",function(){stripeLoaded=!0,n()}).fail(function(){bootbox.alert("Error loading Stripe.  Try again")})}function H(){function e(){var e=$("#modal-frame input[name=exclude]").prop("checked"),t=$("#modal-frame input[name=block]").prop("checked"),n=$("#modal-frame input[name=redact]").prop("checked"),a=$("#modal-frame input[name=quality]:checked").prop("checked"),i=$("#modal-frame input[name=block_name]").prop("checked"),r=$("#modal-frame .redact-confirm-box").prop("checked");if($(".cnam-block").toggle(t&&i),e|t|n|a){var s=[];if(e)"exclude"==$("#modal-frame input[name=exclude]").val()?s.push("Exclude"):s.push("Include"),$("#modal-frame .exclude-related").show();else $("#modal-frame .exclude-related").hide();if(t)"block"==$("#modal-frame input[name=block]").val()?s.push("Block"):s.push("Unblock"),CTM.prevent_blocking_by_caller_cnam?"admin"==CTM.role?$("#modal-frame .name-block").show():$("#modal-frame .name-block").hide():$("#modal-frame .name-block").show(),"admin"==CTM.role&&$("#modal-frame .agency-block").show();else $("#modal-frame .name-block").hide(),$("#modal-frame .agency-block").hide();if(n)"redact"==$("#modal-frame input[name=redact]").val()&&s.push("Redact"),$("#modal-frame .redact-related").show(),$("#modal-frame .redact-confirm").show();else $("#modal-frame .redact-related").hide(),$("#modal-frame .redact-confirm").hide();$("#send-button-feedback").prop("disabled",n&&!r),a?(s.push("Send Feedback"),$("#send-button-feedback").removeClass("activebutton"),$("#send-button-feedback").addClass("callout"),$("#modal-frame .quality-issues").css({"visibility":"visible"}),$("#modal-frame .quality-issues").show()):($("#send-button-feedback").addClass("activebutton"),$("#send-button-feedback").removeClass("callout"),$("#modal-frame .quality-issues").hide()),$("#send-button-feedback").html(s.join("&nbsp;&amp;&nbsp;")),$("#send-button-feedback").show()}else $("#send-button-feedback").hide(),$("#modal-frame .exclude-related").hide(),$("#modal-frame .redact-related").hide(),$("#modal-frame .name-block").hide(),$("#modal-frame .agency-block").hide(),$("#modal-frame .quality-issues").hide();return[t,e,a,n]}function t(e){var t=e.text.split(":"),n='<span class="result-text">'+escapeHtml(t[0].trim())+"</span>";return t.length>1&&(n+=' <span class="result-desc">'+escapeHtml(t[1].trim())+"</span>"),n}var n=parseInt($(this).attr("data-id")),a=ue(CallsTable.get(n));$("#modal-frame").html(Templates.flag_call(a)),$("#modal-frame").find("[title]").tooltip(),$("#report-spammer").click(function(e){e.preventDefault(),$("#spam-block-section").html(ProgressBarHtml),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/spam").done(function(){$("#spam-block-section").html("<strong>This contact was reported as a spammer</strong>")})}),$("#unmark-spammer").click(function(e){e.preventDefault(),$("#spam-block-section").html(ProgressBarHtml),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/unspam").done(function(){$("#spam-block-section").html('<button class="button activebutton" id="report-spammer"> <i class="font-spam"></i> Mark as Spam </button> <i class="font-help" title="This activity was from a spammer.  Marking this call will help block future calls from similar people or automated systems"></i><br/>'),$("#report-spammer").click(function(e){e.preventDefault(),$("#spam-block-section").html(ProgressBarHtml),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/spam").done(function(){$("#spam-block-section").html("<strong>This contact was reported as a spammer</strong>")})})})}),$("#send-button-feedback").click(function(t){t.preventDefault();var n=$(this).attr("data-id"),a=e(),i=[];if(a[1]){var r=!0,s="exclude"==$("#modal-frame input[name=exclude]").val(),o="include_call"==(m=s?"exclude_call":"include_call"),l=$("#modal-frame input[name=exclude_related]").prop("checked"),c={"exclude":l};i.push($.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/"+m+".json",c))}if(a[0]){var d="block_call"==(m="block"==$("#modal-frame input[name=block]").val()?"block_call":"unblock_call"),u={"cnam":$("#modal-frame input[name=block_name]").prop("checked"),"agency":$("#modal-frame input[name=agency_all]").prop("checked"),"exclude":o};i.push($.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/"+m+".json",u));var p=!0}if(a[2]){var f=$("#modal-frame input[name=quality]:checked").val(),b=$("#modal-frame select[name=issues]").val();i.push($.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/feedback",{"quality":f,"issues":b}))}if(a[3]){var h=!0,m=($("#modal-frame input[name=redact]").val(),"redact"),v={"redact_related":$("#modal-frame input[name=redact_related]").prop("checked")};i.push($.post("/api/v1/accounts/"+CTM.account+"/calls/"+n+"/"+m+".json",v))}$("#modal-frame .modal").modal("hide"),$.when.apply($,i).done(function(){if(r&&s){var e=$("#call-stats .total").prop("total")?$("#call-stats .total").prop("total"):parseInt($("#call-stats .total > .text").text());l?setTimeout(function(){var t=$("#call-row-"+n).attr("data-number"),a='tr[data-number="'+escapeFindAttr(t)+'"]',i=$(a).length;$(a).remove(),e-=i},1e3):setTimeout(function(){$("#call-row-"+n).remove(),e-=1},1e3),setTimeout(function(){if(window.text_log)var t=CTM.localize("Call","extra.filtered_texts",{"count":e});else t=CTM.localize("Call","extra.filtered_calls",{"count":e});$("#call-stats .total > .text, #call-stats .total + .popover .total-text span, .call-stats-mobile > span > span").text(t),$("#call-stats .total").prop("total",e)},1e3)}p&&(d?($("#call-row-"+n).removeClass("block"),$("#call-row-"+n).addClass("unblock")):($("#call-row-"+n).addClass("block"),$("#call-row-"+n).removeClass("unblock"))),h&&$("#call-row-"+n).addClass("redacted")})}),$("#modal-frame input[name=exclude]").change(e),$("#modal-frame input[name=redact]").change(e),$("#modal-frame input[name=block]").change(e),$("#modal-frame input[name=quality]").change(e),$("#modal-frame input[name=block_name]").change(e),$("#modal-frame .redact-confirm-box").change(e),$("#modal-frame .chzn-select").select2(),$("#modal-frame .quality-issues select").select2({"formatResult":t,"formatSelection":t}),$("#modal-frame .action-cancel").click(function(e){e.preventDefault(),e.stopPropagation(),$("#modal-frame .modal").modal("hide")}),$("#modal-frame .modal").modal({"backdrop":"static","show":!0,"keyboard":!0})}function U(){$(this).attr("data-id");"true"==$(this).attr("data-key")&&l.call(this,"caller_session")}function B(e){e.access=window.AllowedAccess,e.plan=CTM.plan,e.access||(e.access={},Object.keys(window.UserPrefs.columns).forEach(function(t){e.access[t]=!0}),e.access.source_name=!0),e.can_email=e.access.actions&&e.access.email}function q(e,t){var n=[];for(var a in t.custom_fields)if(t.custom_fields.hasOwnProperty(a)){var i=t.custom_fields[a],r=CTM.meta.custom_fields.find(function(e){return e.api_name==a});if(r&&r.panel==e){var s="";if("bool"==r.field_type)s=1==i?'<i class="font-checkmark-2"></i>':"";else if("rating"==r.field_type)s="\u2605\u2605\u2605\u2605\u2605".substring(0,i||0);else if(i&&"url"==r.field_type)s='<a href="'+escapeHtml(i)+'">'+escapeHtml(i)+"</a>";else if("duration"==r.field_type){var o="second";(i=parseInt(i))%60==0?(o="minute",(i/=60)%60==0?(o="hour",(i/=60)%24==0?(o="day",(i/=24)>1&&(o="days")):i>1&&(o="hours")):i>1&&(o="minutes")):i>1&&(o="seconds"),s=i+" "+o}if(i){var l={"val":{"value":i,"display_value":s,"name":r.name,"read_only":r.read_only},"meta":r};n.push(l)}}}return n}function G(){var e=$(".call-edit-container .close-call-panel"),t=e.prev();t.length&&t.hasClass("focus-call-panel")||(e.before('<div class="focus-call-panel"><i class="font-expand-2"></i></div>'),$("body").data("focus-enabled")||($("body").data("focus-enabled",!0),$("body").on("click",".focus-call-panel",function(){$("body").toggleClass("focus")}))),isMobileLayout()&&$("#call-log-table").css({"height":$("#calls .main-list tr.call-edit > td:first-child .call-edit-frame").height()+"px"})}function W(){var e=0;return Object.keys(UserPrefs.columns).forEach(function(t){window.AllowedAccess[t]&&UserPrefs.columns[t]&&e++}),e}function V(){var e=0;return Object.keys(UserPrefs.sections).forEach(function(t){window.AllowedAccess[t]&&UserPrefs.sections[t]&&e++}),e}function Q(){var e=$(".main-list > tr.call-edit"),t=[],n="",a=$("body").hasClass("oncall");e.find(".navbar-sidenav .navbar-collapse .navbar-nav").find("li").each(function(e,i){(a||"1"!=$(i).find("a").attr("data-live"))&&(t.push('<option data-icon="'+$(i).find("a > i:first").attr("class")+'" value="'+escapeHtml($(i).attr("data-action"))+'">'+escapeHtml($(i).find("a .caption").text())+"</option>"),$(i).hasClass("active")&&(n=$(i).attr("data-action")))}),$("#call-log-header > .panel-picker").html("<select>"+t.join("")+"</select>").find("select").select2({"dropdownCssClass":"panel-picker-dropdown"}).on("change",function(){e.find('.navbar a[data-action="'+escapeFindAttr($(this).select2("val"))+'"]').click()}),n&&$("#call-log-header > .panel-picker").select2("val",n)}function Y(e,t,n){t.tags=t.tag_list.join(","),t.column_count=W(),B(t);var a=e.next();a.find(".navbar-sidenav .navbar-collapse .navbar-nav").html(xe(t)),CTM.phonemode&&!$("#call-log-header > .panel-picker").length&&$("#call-log-header #call-stats").after('<div class="panel-picker"></div>'),Q(),a.find(".close-mobile-nav").click(function(){K.call(this,t.id)}),$e.setup(t,n)}function K(e,t,n){if(LiveEventStream)try{console.log("close LiveEventStream"),LiveEventStream.close(),LiveEventStream=null}catch(i){}if(!o()){n||($("body").removeClass("call-log-open"),updateScrollable()),$(".call-log-popover").fadeOut(),delete Query.callNav,delete Query.callId,setURLState(Query,!0);var a=$("#call-row-"+e).find(".log-column.call-caller-actions a[data-action=edit] .text");if(a.data("open",!1),a.html(CTM.localize("Call","actions.edit.short_label")),!$("#call-row-"+e).length||!$("#call-row-"+e).offset()||CTM.phonemode&&isMobileLayout()||$("html, body").scrollTop($("#call-row-"+e).offset().top-125),$("#calls .last-active-row").removeClass("last-active-row"),$(`#call-row-${e}`).removeClass("call-active").addClass("last-active-row"),!n){if($("#call-"+e).length){if(CTM.phonemode&&this&&$(this).hasClass("close-mobile-nav")&&"function"==typeof closePhone&&($("body").hasClass("standalone")||$("body").hasClass("native")))return void closePhone();$("#call-"+e).get(0).offsetHeight,$("#call-"+e).removeClass("showing").addClass("hiding"),setTimeout(function(){$("#call-"+e).remove(),$(".call-edit").length||$(".call-log-toolbar").html(""),$("body").removeClass("call-log-hiding")},350)}$("body").removeClass("call-log-showing").addClass("call-log-hiding"),setTimeout(function(){$("body").removeClass("call-log-hiding")},350)}}}function J(e){if(!o()){var t=$(this).attr("data-id");if(t){e||(e=window.text_log?"text_message":!window.AllowedAccess.profile&&$(this).closest("tr").hasClass("form")?"call_form_fields":"caller_profile");var n=$("#calls").data("activeCall");if(n&&t!=n&&K(n,null),!($("#call-"+t).length>0&&$("#call-edit-panel-"+t).length>0)||e&&$("#call-edit-panel-"+t).attr("data-action")!=e){$("#call-edit-panel-"+t).length>0&&e&&$("#call-edit-panel-"+t).attr("data-action")!=e&&K(t,null,!0);var a=$("#call-row-"+t);if(a.addClass("call-active"),console.log("doing a scroll"),!a.length||!a.offset()||CTM.phonemode&&isMobileLayout()||$("html, body").scrollTop(a.offset().top-($("#content").offset().top+40)),!$(this).data("loading")){var i=a.find(".action[data-action=edit]");i.find(".text").html("..."),$(this).data("loading",!0);var r=$(this).closest(".call-row"),s=r.next().hasClass("call-edit");s||r.after(Ce({"id":t,"column_count":W()}));var l=r.next(),c=l.attr("id");if(!s){setTimeout(function(){l.find(".loading-call").show()},500),l.get(0).offsetHeight,l.removeClass("hiding").addClass("showing"),$("body").removeClass("call-log-hiding").addClass("call-log-showing"),setTimeout(function(){$("#"+c).length?($("body").addClass("call-log-open"),updateScrollable(),G()):(console.log("add call-log-hiding"),$("body").addClass("call-log-hiding").removeClass("call-log-showing"),setTimeout(function(){console.log("transisition finished hiding"),$("body").removeClass("call-log-hiding")},350))},350),$(".call-log-toolbar").html('<div class="navbar">'+l.find(".call-edit-frame .sidebar-nav .navbar > *:first")[0].outerHTML+"</div>"),$(".call-log-toolbar .navbar-toggle").click(function(e){e.preventDefault();$("#call-"+t+" .navbar-toggle").click()});var d=$("#call-"+t+" .header.crumbs .actions .custom, .call-log-toolbar .header.crumbs .actions .custom");r.find("a.action:not([data-action=edit]):not([data-action=call-xml]):not([data-action=email]):not([data-action=text])").each(function(e,t){if((t=$(t)).find(".a-icon").length){d.append('<a class="button" title="'+escapeHtml(t.find(".text").text().trim())+'" data-placement="bottom"><i class="'+escapeHtml(t.find(".a-icon").attr("class"))+'"></i></a>');var n=d.find(".button:last");n.tooltip({"delay":{"show":800,"hide":100}}),n.click(function(e){e.preventDefault(),t.click()})}else;})}var u=this,p="";window.__ctm_search_all&&(p="?agency=true"),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t+".json"+p,function(t){var n=t;"error"==n?(console.log("error"),l.remove(),$(".call-log-toolbar").html("")):($(u).data("loading",!1),i.find(".text").html(CTM.localize("Call","actions.close.short_label")).data("open",!0),Y(r,ue(n),e)),$(window).trigger("ctm.open.call",t)}).fail(function(e){console.log("error",e),l.remove(),$(".call-log-toolbar").html("")}),$("#calls").data("activeCall",t),CTM.phonemode&&!s&&isMobileLayout()&&($(".number-frame input.phonenumber-input").phoneCountryComboBox("set",a.attr("data-number")),showDialer())}}else K(t,e)}}}function Z(){}function X(e,t){var n;try{n=t.currentTime}catch(i){}var a=window.open("/calls/"+e+"/playback?currentTime="+n,"CallRecording","toolbars=0,menubar=0,location=0,resizable=1,scrollbars=1,status=1,width=444,height=160");return a.focus(),t.stop(),a}function ee(){let e=$(this).attr("href"),t=$(this).closest(".call-row"),n=(t.attr("data-id"),$(this).closest(".audio-wrapper")),a=n.find(".audio-player"),i=a.next("span");if(0==$(n).find("audio").length&&i.length)a.attr("data-audio-mp3",e+".mp3"),a.attr("data-audio-wav",e),te.apply(a.get(0));else{var r=t.data("mediaElement");r.stop(),r.setSrc(e+".mp3"),r.play()}}function te(e){if(CTM.left_nav){if(console.log("clicked on playbackAction"),CTM.left_nav&&$(".call-audio-review-frame .player_ui").length&&$(this).data("id")==$(".call-audio-review-frame").data("id")){let e=$(".call-audio-review-frame").data("mediaElement");return console.log("play/pause existing audio"),void(e.paused?(e.play(),console.log(this.classList),$(this).removeClass("font-headphones").addClass("font-pause")):(e.pause(),$(this).addClass("font-headphones").removeClass("font-pause")))}return CTM.left_nav&&(console.log("load new playback reset any existing"),$(".audio-player.font-pause").addClass("font-headphones").removeClass("font-pause")),window.autoPlaybackEnabled=!0,void l.call(this,"caller_transcription")}let t=$(this),n=t.closest(".call-row"),a=n.attr("data-id"),i=t.closest(".audio-wrapper"),r=t.next("span");if($("#calls .last-active-row").removeClass("last-active-row"),$("#call-row-"+a).removeClass("call-active").addClass("last-active-row"),0==i.find("audio").length&&r.length){let o=i.html();function s(l,c){console.log("loading player with: ",l,c),i.prepend(Templates.audio_player({"mp3":l,"wav":c,"download_links":window.AllowedAccess.download_links}));let d=i.find("audio");d.mediaelementplayer({"enableKeyboard":!1,"audioWidth":"80px","enableAutosize":!0,"features":["playpause","progress","current"],"success":function(e){e.play(),n.data("mediaElement",e)}}),$(i).find(".replace").replaceWith(r.detach()),$(i).find(".mejs-container").css({"height":"40px"}),d.on("play pause ended",function(){document.title=document.title.replace("\u25b6",""),$("audio").each(function(){if(!this.paused)return document.title="\u25b6 "+document.title.replace("\u25b6 ",""),!1})}),d.on("error",function(){let e=d.get(0);e&&e.error&&4==e.error.code?(console.log(e.error),e.error.message&&e.error.message.match(/Empty src/)?d.closest("td").html("<p>Unable to load - try again</p>"):l?(i.html(o),s(null,c)):(i.html(o),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+a+"/phone_settings.json",function(e){e.settings.allow_recording_listen?ctmFlash("Unable to access audio.  The audio file may no longer be available or you may no longer have access.","error"):ctmFlash("Access Denied.  You do not have access to the audio file.","error")}).fail(function(){ctmFlash("Unable to access audio.  The audio file may no longer be available or you may no longer have access.","error")}))):d.closest("td").html("<p>Error Offline?</p>")}),t.removeClass("noborder-small action audio audio-player font-headphones").addClass("popout-link"),window.AllowedAccess.download_links?(t.addClass("popout-link").html('<i class="font-external-link"></i> pop out').attr("title","click to pop audio out of call log"),t.click(te)):t.html(""),i.find("a.additional-audio").click(ee),e&&(e.preventDefault(),e.stopPropagation())}s($(t).attr("data-audio-mp3"),$(t).attr("data-audio-wav"))}else"_blank"==t.attr("target")?e&&e.stopPropagation():(e&&(e.preventDefault(),e.stopPropagation()),X(n.attr("data-id"),n.data("mediaElement")))}function ne(e,t,n){console.log("CTMOpenPanel:",e,t);let a="#call-edit-panel-"+e;if($("#call-row-"+e).length){if(console.log("load from DOM"),$(a).length&&$(a).attr("data-action")==t)return void("function"==typeof n&&n(CallsTable.get(e)));$(window).one("ctm.open.call",function(e,t){console.log("got open:",t),"function"==typeof n&&n(t)}),l(t,$("#call-row-"+e))}else console.log("fetchCallAndRender",e),_e(e,function(e){console.log("fetch and render",e),a="#call-edit-panel-"+e.id,$(a).length&&$(a).attr("data-action")==t?"function"==typeof n&&n(CallsTable.get(e.id)):($(window).one("ctm.open.call",function(e,t){console.log("got open:",t),"function"==typeof n&&n(t)}),l(t,$("#call-row-"+e.id)))},null,!0,!0)}function ae(){setQueryFiltersFromInput(),Query.after=null,Query.page=1,Query.with_time=1,we(!0,Query)}function ie(e){return $("#search-box").data("searching",!0),re(),e&&$("#search-box").val(e),setQueryFiltersFromInput(),new Promise(function(e,t){we(!0,Query,e,t)})}function re(){for(var e in Query)delete Query[e];Query.page=1,0}function se(e){return!!LoadingNextPage||($("#calls").hasClass("more-calls")?(Query.page++,console.log("moreCalls after: ",Query.after),$("#calls tbody.main-list tr:last").addClass("pagemarker"),we(!1,Query,e),!1):void 0)}function oe(e){var t={"protocol":"","hostname":"","port":"","pathname":"","search":"","hash":"","host":""};if(!e||""==e||"://?"==e)return t;try{var n=document.createElement("a");n.href=e;var a=document.createElement("div");return a.style.display="none",a.appendChild(n),document.body.appendChild(a),{"protocol":n.protocol,"hostname":n.hostname,"port":n.port,"pathname":decodeURIComponent(n.pathname),"search":decodeURIComponent(n.search),"hash":n.hash,"host":n.host}}catch(i){return t}}function le(e){$("#calls").removeClass("more-calls").show(),$("#calls-error").data("retry",e),$("#calls-error").show(),window._kmq&&_kmq.push(["record","NetworkError"])}function ce(e){if(e){if("unset"==e.name&&(e.name=""),e.score>0){e.stars=[];for(var t=0;t<e.score&&t<5;t++)e.stars.push("font-star")}return 0==parseInt(e.value)?delete e.value:"string"==typeof e.value&&e.value.match(/\.\d$/)&&(e.value=e.value+"0"),e}}function de(e){try{var t=(e=sprintf("%.2f",parseFloat(e))).match(/(.*)\.00$/);t&&(e=t[1])}catch(n){}return e}function ue(e){e.plan=CTM.plan,e._super=CTM._super,e.support_allowed=!(CTM._super&&!CTM.support_allowed),e.isAgent="agent"==CTM.role,e.canAddAgents=CTM.canAddAgents,e.saleColumnName=window.CTMScoring.columnName?window.CTMScoring.columnName:window.CTMScoring.columnName=capitaliseFirstLetter(window.CTMScoring.column_name),e.account_owner=CTM.owner,e.account_owner_no_keywords=CTM.owner&&!CTM.plan.base.keywords,e.call_notifications_path=CTM.call_notifications_path,e.change_plan_accounts_path=CTM.change_plan_accounts_path,e.referrer_str=e.referrer,e.referrer=(e.referrer,e.referrer_str),e.agency_all=window.__ctm_search_all;var t,n,a,i=e.account_id;prepareAgent(e),e.account_id=i,e.phone_number_digits=e.caller_number.replace(/\D/g,""),("(not provided)"==e.search||!e.search)&&e.keyword&&$.trim(e.keyword).length>0&&(e.search=e.keyword),e.is_spam=e.spam&&e.spam.risk&&"low"!=e.spam.risk&&"expired"!=e.spam.risk,e.isTextInbound="msg_inbound"==e.direction,e.isTextOutbound="msg_outbound"==e.direction,e.isText=e.isTextInbound||e.isTextOutbound,e.isInbound="inbound"==e.direction,e.isOutbound="outbound"==e.direction,e.isCall=e.isInbound||e.isOutbound,e.isForm=!!e.form||"form"==e.direction,e.isChat="chat"==e.direction,e.keywordSpotted=e.spotted&&e.spotted.length>0,e.isChatSMS="sms"==e.chat_type,CTM.hubspot&&CTM.hubspot.on&&(e.hubspot_portal_id=CTM.hubspot.portal_id);try{e.canText=!1}catch(h){console.log("error:",h)}if(e.form&&e.form.custom&&$.each(e.form.custom,function(e,t){$.isArray(t.value)?t.value=$.map(t.value,function(e){return escapeHtml(e)}).join("<br/>"):t.value=escapeHtml(t.value),t.label||(t.label=t.id)}),e.hasCallerloc=e.city||e.state||e.country,e.showCallerloc=!CTM.hide_call_id_loc,e.referrer_str&&"object"==typeof e.referrer_str&&(e.referrer_str=escapeHtml(e.referrer_str.protocol+"//"+e.referrer_str.host+decodeURIComponent(e.referrer_str.pathname)+decodeURIComponent(e.referrer_str.search))),e.referrer=oe(e.referrer_str),e.location_str="string"==typeof e.location?e.location:e.location_str,e.location_str&&"object"==typeof e.location_str&&(e.location_str=escapeHtml(e.location_str.protocol+"//"+e.location_str.host+decodeURIComponent(e.location_str.pathname)+decodeURIComponent(e.location_str.search))),e.location=oe(e.location_str),e.caller_number_complete&&(e.caller_digits=$.trim(e.caller_number_complete.replace(/\D/g,""))),e.tracking_number&&(e.called_digits=$.trim(e.tracking_number.replace(/\D/g,""))),e.call_length=he(e),prepareAgent(e.agent),e.has_audio=!0,e.talk_time>2&&e.audio?e.time_icon="font-volume-up":2==e.talk_time&&e.audio?e.time_icon="font-volume-down":(e.has_audio=!!e.audio&&!!e.audio.match(/s3\.amazonaws|api\/v1\/accounts/),e.time_icon="font-volume-off"),e.has_audio&&(e.audio="https://"+window.location.hostname+"/api/v1/accounts/"+e.account_id+"/calls/"+e.sid+"/recording"),e.call_status?"completed"==e.call_status||"answered"==e.call_status?e.status_icon="font-phone-hang-up":"delivered"==e.call_status||"sent"==e.call_status?e.status_icon="font-redo-2":"received"==e.call_status?e.status_icon="font-checkmark-2":e.status_icon="font-blocked":"completed"==e.dial_status||"answered"==e.dial_status?(e.status_icon="font-phone-hang-up",e.call_status="completed"):"ringing"==e.dial_status?(e.status_icon="font-phone-2",e.call_status="waiting"):"in-progress"==e.dial_status?(e.status_icon="font-phone-wave",e.call_status="in progress"):(e.status_icon="font-phone-slash",e.call_status="no answer"),e.hide_tags=!window.AllowedAccess.tags,CTM._super&&!CTM.support_allowed?(e.can_playback=!1,e.can_live_listen=!1):(e.can_playback=window.AllowedAccess.playback,e.can_download_links=window.AllowedAccess.download_links,e.can_share_audio=(navigator.share,!0),e.can_delete_audio=!e.isAgent),"hold"==e.dial_status)e.status_icon="font-phone-pause",e.call_status="hold",e.can_pickup_hold=!0,e.isChat&&(e.can_answer_call=!0);else{let t=new Set(["CallHold","RoutingRule","CustomPanel","Contact","Recording Start","CallTransfer","VoiceMenuItem"]),n=(e.call_path||[]).filter(function(e){return!t.has(e.route_type)}),a=null;n.length>0&&(a=n[n.length-1]),("in progress"==e.call_status||"in-progress"==e.call_status)&&(e.isInbound||e.isForm||e.isChat)&&a&&("CallQueue"==a.route_type&&!e.agent_id&&!CTM.prevent_manager_roles||a.route_id==CTM.user&&(e.legs&&(0==e.legs.length||e.legs.filter(function(e){return e.to.match(/agent_/)&&"ringing"==e.status}).length>0)||e.isForm||e.isChat)&&e.agent_id==CTM.user)?e.can_answer_call=window.AllowedAccess.answering:e.isChat&&!e.agent_id&&["in progress","in-progress","hold","ringing"].includes(e.call_status)&&(e.can_answer_call=!0),!e.can_answer_call&&window.isWebRTCSupported&&("in progress"!=e.call_status&&"in-progress"!=e.call_status||"agent"==CTM.role||!(e.isOutbound||e.isInbound&&a&&"CallQueue"==a.route_type)||(e.can_live_listen=e.can_playback))}if(e.phonemode=CTM.phonemode,e.active=e.can_answer_call||e.can_pickup_hold||e.can_live_listen,e.in_progress="in progress"==e.call_status&&e.can_live_listen,e.can_answer_call?(e.active_class="pulsebutton",e.active_title="Answer incoming call",e.active_icon="font-phone-incoming",e.active_action="answer"):e.can_pickup_hold?(e.active_title="Pick up this call on hold",e.active_icon="font-phone-outgoing",e.active_action="hold"):e.can_live_listen&&(e.active_title="Listen to an in-progress call",e.active_icon="font-feed",e.active_action="listen"),e.caller&&e.caller.notes&&e.caller.notes.length&&e.caller.notes.forEach(function(t){t.created=moment(t.created,"YYYY-MM-DD hh:mm A ZZ").format("ddd MMM Do, YYYY h:mm a"),t.owner=t.agent&&null==t.agent.id&&"admin"==CTM.role,t.owner|=t.agent&&t.agent.id==CTM.user,window.CTM_ALLOW_ADMIN_EDIT_ON&&"admin"==CTM.role&&(t.owner=!0),t.this_call=t.call_id==e.id,t.formattedNote=MarkDownFormatter(t.note||"")}),e.called_at){var r=e.called_at.split(" ");e.call_date=r.shift(),(new Date).getFullYear()==new Date(1e3*e.unix_time).getFullYear()?e.call_date_formated=moment(e.call_date).format("ddd MMM Do"):e.call_date_formated=moment(e.call_date).format("ddd MMM Do, YYYY"),r.pop(),e.call_time=r.join(" ")}e.notes&&e.notes.length>0&&(e.summary=$.fit(e.notes,48));try{
e.campaign&&e.campaign.length>0?n=e.campaign:e.ga&&e.ga.campaign&&e.ga.campaign.length>0&&(n=e.ga.campaign),n||(n=e.web_source)}catch(h){console.error(h)}try{e.medium&&e.medium.length>0?t=e.medium:e.ga&&e.ga.medium&&e.ga.medium.length>0&&(t=e.ga.medium)}catch(h){console.error(h)}try{a=t||"",t!=n&&(a+=" / "+n)}catch(h){console.error(h)}e.campaign_medium_str=a,e.tags&&e.tags.length&&"string"!=typeof e.tags?e.tag_list=e.tags.join(","):"string"==typeof e.tags&&(e.tag_list=[e.tags]),e.prefs=window.UserPrefs,e.visible_custom_panels=[],e.visible_custom_actions=[],$e.prepare(e),B(e),e.can_lookup=!KnownBlockedNumbers.has(e.caller_number)&&"Error"!=e.name&&window.CTM_MANUAL_LOOKUP,e.can_callback=!e.can_answer_call&&!e.can_live_listen&&!e.can_pickup_hold&&window.CTM_CALLBACK_ON&&!KnownBlockedNumbers.has(e.caller_number)&&"Error"!=e.name&&window.AllowedAccess.callback&&e.caller_number&&e.caller_number.length>6,e.can_callback&&e.callbacks&&(e.callback_count=e.callbacks.length),e.emails&&e.emails.length>0&&(e.emails_count=e.emails.length),e.can_email=window.CTM_EMAIL_ON&&window.AllowedAccess.email,e.can_exclude=window.CTM_EXCLUDE_ON&&window.AllowedAccess.exclude,e.can_block=window.CTM_BLOCK_ON&&window.AllowedAccess.block,e.can_redact=window.CTM_REDACT_ON&&"admin"==CTM.role,e.can_flag=e.can_exclude||e.can_block||e.can_redact,e.can_do_not_call=CTM.phonemode,e.can_stripe=window.CTM_STRIPE_ON,e.caller_number&&e.caller_number.match(/^\+1/)&&!e.extended_lookup&&window.CTM_CALLER_LOOKUP_ON||(e.can_lookup=!1),e.caller_business=e.extended_lookup_on&&e.extended_lookup&&"B"==e.extended_lookup.name_type,e.caller_consumer=e.extended_lookup_on&&e.extended_lookup&&"C"==e.extended_lookup.name_type,e.caller_number_blocked?e.blocked_text="unblock":e.blocked_text="block",""!=e.name&&null!=e.name||(KnownBlockedNumbers.has(e.caller_number)?e.name="Restricted":e.name="Not Provided");try{e.likelihood&&(e.likelihood=de(e.likelihood)),e.score&&(e.likelihood=de(e.score))}catch(h){console.error(h)}e.contact_custom_fields=q("contact",e),e.score_custom_fields=q("score",e);try{e.sale&&(e.sale.date&&new Date(e.sale.date),e.sale=ce(e.sale))}catch(h){console.error(h)}try{e.extended_lookup&&("M"==e.extended_lookup.gender&&(e.caller_gender="Male",e.caller_gender_symbol="<i class='font-male'></i>"),"F"==e.extended_lookup.gender&&(e.caller_gender="Female",e.caller_gender_symbol="<i class='font-female'></i>"))}catch(h){console.error(h)}if(e.can_see_profile=!0,window.AllowedAccess.profile||(e.can_see_profile=!1),e.sms_allowed=CTM.sms_allowed,$.isArray(e.message_media))for(var s=0,o=e.message_media.length;s<o;++s){var l=e.message_media[s];l.type&&l.type.match(/image/)&&(l.is_image=!0)}if(e.tag_list&&e.tag_list.length&&(e.has_tags=!0),e.hasVoiceAnalysis=!e.isText,e.hasCallFlow=!e.isText&&window.AllowedAccess.caller_insights&&window.AllowedAccess.receiving_number,"hold"!=e.dial_status&&"in-progress"!=e.dial_status&&"in progress"!=e.dial_status&&"ringing"!=e.dial_status||CheckInProgressCall.add(e.id),CTM.sf.on)try{!e.salesforce&&CTM.sf.legacy&&(e.salesforce={}),CTM.sf.legacy||!e.salesforce||Object.keys(e.salesforce).length||delete e.salesforce,e.allow_sf_data="admin"==CTM.role||!CTM.sf.limit_access_to_data}catch(h){console.error(h),e.allow_sf_data=!1}else e.salesforce&&delete e.salesforce,e.allow_sf_data=!1;try{e.desk_com=CTM&&CTM.desk_com&&CTM.desk_com.on}catch(h){console.log("desk.com integration error",h)}try{e.call_scripts=!0}catch(h){console.log("call scripts integration error:",h)}try{e.shopify=CTM&&CTM.shopify&&CTM.shopify.on}catch(h){console.log("shopify integration error",h)}try{e.zendesk=CTM&&CTM.zendesk&&CTM.zendesk.on}catch(h){console.log("zendesk integration error",h)}!e.sale||e.sale.conversion||e.sale.name||e.sale.score||delete e.sale;var c=e.visible_custom_actions.length;if(e.can_email&&++c,e.can_flag&&++c,e.salesforce&&++c,e.hubspot&&++c,e.marketo&&++c,e._super&&++c,e.can_stripe&&++c,e.msdynamics_record&&++c,e.mailchimp&&++c,c>4&&(e.more_actions=!0),e.transfers&&e.transfers.length>0){var d=new Date(1e3*e.transfers[e.transfers.length-1].start_time),u=new Date(1e3*e.unix_time),p=formatDuration((d-u)/1e3);e.view_transfers=[{"duration":p}]}e.zoho=CTM.zoho.on,e.dynamics=CTM.dynamics.on,e.zendesk=CTM.zendesk.on,e.sendgrid=CTM.sendgrid.replace_panel,e.mailchimp=CTM.mailchimp.on,e.can_remind=CTM.reminder,e.hide_remind_action=CTM.hide_remind_action,e.hide_remind_panel=CTM.hide_remind_panel,e.message_body&&(e.message_body_html=anchorme(escapeHtml(e.message_body).replace(/&amp;/g,"&").replace(/&#x2F;/g,"/")),"media"==e.message_body&&(e.message_body_html=" ",e.message_body=" ")),NewCallSet.has(e.id)||"in-progress"!=e.dial_status&&"ringing"!=e.dial_status||(NewCallSet.add(e.id),window.ctmPhoneSettings.preload_scripts&&CTM.deskmode&&$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/call_scripts.json",function(t){t&&t.call_script&&t.call_script.remote_url&&CTM.deskmode&&phoneMessageHandler({"origin":window.location.origin,"data":{"event":"preloadCallScript","callId":e.id,"remoteUrl":t.call_script.remote_url}})}));var f=CallsTable.get(parseInt(e.id));if("object"==typeof f){for(var b in e)e.hasOwnProperty(b)&&(f[b]=e[b]);CallsTable.set(parseInt(e.id),f)}else CallsTable.set(parseInt(e.id),e);return CallsTable.get(parseInt(e.id))}function pe(e){for(var t in ue(e),e["visible-columns"]="",window.UserPrefs.columns)window.AllowedAccess.hasOwnProperty(t)&&window.AllowedAccess[t]&&window.UserPrefs.columns.hasOwnProperty(t)&&window.UserPrefs.columns[t]&&(e["visible-columns"]+=" col-"+t);for(var t in e["visible-sections"]="",window.UserPrefs.sections)window.AllowedAccess.hasOwnProperty(t)&&window.AllowedAccess[t]&&window.UserPrefs.sections.hasOwnProperty(t)&&window.UserPrefs.sections[t]&&(e["visible-sections"]+=" section-"+t);return ke(e)}function fe(e,t){var n=CallsTable.get(parseInt(e));for(var a in t)n[a]=t[a];be(n,pe(n),!0)}function be(e,t,n){let a=$("#call-row-"+e.id);if(a.length){if(n){let n=a.data("mediaElement"),s=n&&!n.paused&&!n.ended;if(s){if(UpdatingCalls.has(e.id))return;var i=n.currentTime}let o=a.find(".input-agent-selector:not(.select2-container)"),l=$(t);if(e.active)a.attr("data-active","1");else if(a.removeAttr("data-active"),CTM.phonemode&&isMobileLayout()&&"1"==a.attr("data-new"))return void a.remove();var r=l.attr("data-active-action");r?a.attr("data-active-action",r):a.removeAttr("data-active-action"),a.find("> td").each(function(e,t){if(t=$(t),!o.length||!t.hasClass("call-receiving-number")){if(t.hasClass("call-custom"))var n=l.find("> td > [data-action="+t.find("[data-action]").attr("data-action")+"]").parent();else n=l.find('> td[class="'+t.attr("class")+'"]');n.length&&t.replaceWith(n)}}),s&&(UpdatingCalls.set(e.id,{"currentTime":i}),setTimeout(function(){a.find("a.audio-player");window.ctmPlayCallRecording(e.id,i,!0),setTimeout(function(){UpdatingCalls["delete"](e.id)},300)},100))}}else{if(console.log("document not found:",e.id),$("#calls tbody.main-list tr.no-calls").remove(),CTM.phonemode&&isMobileLayout()&&!e.active){let e=$('#calls tbody.main-list > tr[data-new="1"]:last');return void(e.length?(e.after(t),e.next().attr("data-old","1")):($("#calls tbody.main-list").prepend(t),$("#calls tbody.main-list > tr:first-child").attr("data-old","1")))}$("#calls tbody.main-list").prepend(t),$("#calls tbody.main-list > tr:first-child").attr("data-new","1")}}function he(e){if("hold"==e.status||"in progress"==e.status||"ringing"==e.status){if(e.unix_time&&!isNaN(parseInt(e.unix_time))&&parseInt(e.unix_time)>0)var t=moment().diff(moment(String(e.unix_time),"X"),"seconds");else t=7401;return t>7400?($("#call-row-"+e.id+" .call-audio .duration").html("<i class='font-volume-off'></i> ..."),"..."):formatDuration(t)}return formatDuration(e.duration)}function me(e){"hold"!=e.status&&"in progress"!=e.status&&"ringing"!=e.status||window.requestAnimationFrame(function(){$("#call-row-"+e.id+" .call-audio .duration").html("<i class='font-volume-off'></i> "+he(e))})}function ve(e){try{if(!((e-Ee)/1e3>1))return;Ee=e;let n=new Set,a=Array.from(CheckInProgressCall);for(let e=0,t=a.length;e<t;++e){let t=parseInt(a[e]),i=CallsTable.get(t);if(i)if("hold"==i.call_status||"in progress"==i.call_status||"ringing"==i.dial_status){if(!CheckingInProgressCalls.has(t)){if(CallsInProgress.has(t)){moment().diff(moment(CallsInProgress.get(t)))/1e3>200&&!CheckingInProgressCalls.has(t)&&(n.add(t),CheckingInProgressCalls.add(t))}else CallsInProgress.set(t,new Date);me(i)}}else CallsInProgress["delete"](t),CheckInProgressCall["delete"](t);else CallsInProgress["delete"](t),CheckInProgressCall["delete"](t)}n.size&&$.post("/calls/check_calls_status",{"ids":Array.from(n)},function(e){e.defer||Object.keys(e).forEach(function(e){e=parseInt(e),CheckingInProgressCalls["delete"](e),CallsInProgress["delete"](e)})}).fail(function(e){console.log(e.responseText)})}catch(t){console.log(t)}finally{InProgressCallTimer&&(window.cancelAnimationFrame(InProgressCallTimer),InProgressCallTimer=null),InProgressCallTimer=window.requestAnimationFrame(ve)}}function ge(e){try{if((e-Pe)/1e3>scheduleLimit){scheduleLimit=CTM.phonemode&&(window.ctmEmbed||window.opener)?3:2,Pe=e,Ae&&(clearTimeout(Ae),Ae=null);let t=new Set,n=new Map;for(let e in FetchQueue){FetchQueue[e];t.add(e),n.set(e,FetchQueue[e])}if(FetchQueue={},!t.size)return;$.post("/api/v1/accounts/"+CTM.account+"/calls/fetch",{"ids":Array.from(t)},function(e){n.forEach(function(t,n){let r=e.calls[n];r&&(t.replace||a(),be(r,pe(r),t.replace),t.replace||i(),t.callbacks&&t.callbacks.forEach(function(e){if("function"==typeof e)try{e(r)}catch(t){console.log(t)}}))}),!Query.callNav&&window.AutoLoadCalls&&CallsTable.size>40&&!$("audio").length&&0==window.scrollY&&CTMsearch()},"json")}}catch(t){console.log(t)}finally{Ie&&(window.cancelAnimationFrame(Ie),Ie=null),Ie=window.requestAnimationFrame(ge)}}function _e(e,t,n,a,i){a&&i?(console.log("force fetchCallAndRender"),CTM.core.get("/api/v1/accounts/"+CTM.account+"/calls/"+e+".json").then(function(e){if("error"==e)console.error("error:",e);else{var t=function(){console.log("updateCallRowMarkup",e),be(e,pe(e),!0),CallsTable.set(parseInt(e.id),e)};if($("#search-box").data("searching")){console.log("we're searching right now defer");var n=$("#search-box").data("afterSearch");n||(n=[]),n.push(t),$("#search-box").data("afterSearch",n)}else t()}})["catch"](function(e){console.error("error",e)})):(FetchQueue[e]||(FetchQueue[e]={"callbacks":[],"replace":!1}),FetchQueue[e].callbacks.push(t),FetchQueue[e].replace|=n)}function ye(e){try{CTM.phonemode&&isMobileLayout()?($('#calls tbody.main-list tr:not([data-active="1"]):not([data-old="1"])').remove(),$("#calls tbody.main-list").append(e)):$("#calls tbody.main-list").html(e)}catch(t){console.log("error",t)}}function we(e,t,n,r){function s(a){const r=performance.now();LoadingNextPage=!1,a.calls.length,Se=a.total_entries,a&&1==a.page&&(o.data("count",0),o.data("calls",[]),o.removeAttr("data-available")),i(e),e&&(console.log("clear List"),InProgressCallTimer&&(window.cancelAnimationFrame(InProgressCallTimer),InProgressCallTimer=null),InProgressCallTimer=window.requestAnimationFrame(ve),CallsTable=new Map,CheckInProgressCall=new Set,CallsInProgress=new Map,CheckingInProgressCalls=new Set);try{a.calls.sort(function(e,t){const n=["in-progress","in progress"].includes(e.dial_status),a=["in-progress","in progress"].includes(t.dial_status);return n&&a?0:n?-1:0}),a.calls.sort(function(e,t){return"ringing"==e.dial_status&&"ringing"==t.dial_status?0:"ringing"==e.dial_status?-1:0}),a.calls.sort(function(e,t){return"hold"==e.dial_status&&"hold"==t.dial_status?0:"hold"==e.dial_status?-1:0})}catch(m){window.Honeybadger&&"function"==typeof Honeybadger.setContext&&Honeybadger.notify(m)}const s=a.calls.map(pe);let l=0;e?ye(s.join("")):Te&&s.length?(Te=!1,$("#calls tbody.main-list").html(s.join(""))):(l=$("#calls tbody.main-list tr").length-1,$("#calls tbody.main-list").append(s.join(""))),delete t.stats,delete t.entries_per_page,delete t.all,delete t.group_callers,delete t.per_page,delete t.limit_fields,delete t.contact_number,setURLState(t),Query.after=a.after,console.log("set after query: ",Query.after),requestAnimationFrame(function(){CTMCallStats(a,Templates)});const c=W();if(0==s.length&&(0==parseInt(Query.page)||1==parseInt(Query.page))){let e={"column_count":c};CTM.phonemode&&isMobileLayout()||(!window.filtered&&$('.menu-item a[href="/accounts/setup"]').length>0&&(e.message='Check out <a href="/accounts/setup"><i class="font-thumbs-up3"></i> New User Onboarding</a> to get started with your new account.'),window.filtered&&!CTM.filter_follow&&(e.message='<a onclick="$(\'#clear-search\').click()"><i class="font-remove-circle"></i> clear search</a>')),$("#calls tbody.main-list").html(HoganTemplates["calls/no_calls_template"].render(e)),Te=!0}let d="#calls tbody.main-list .call";l>0&&(d+=":gt("+l+")");const u=$(d+" a[title]"),p=$(d+" i[title]"),f=$(d+" span[title]");if(window.requestAnimationFrame(function(){u.tooltip({"delay":{"show":800,"hide":100}}),u.removeAttr("title")}),window.requestAnimationFrame(function(){p.tooltip({"delay":{"show":800,"hide":100}}),p.removeAttr("title")}),window.requestAnimationFrame(function(){f.tooltip({"delay":{"show":800,"hide":100}}),f.removeAttr("title")}),window.requestAnimationFrame(function(){$("#calls-error > td").attr("colspan",c)}),a.next_page&&c>0?$("#calls").addClass("visible more-calls"):$("#calls").addClass("visible").removeClass("more-calls"),"function"==typeof n&&n(s),LoadingNextPage=!1,window.CTM&&window.CTM.embed)try{if(window.parent&&window.parent.CallLogResize){var b=$(".calls-loader").is(":visible");$(".calls-loader").hide(),window.parent.CallLogResize($("html").height()),b&&$(".calls-loader").show()}}catch(m){}$("body").removeClass("call-log-open"),$("body").hasClass("call-log-showing")&&$("body").removeClass("call-log-showing").addClass("call-log-hiding"),updateScrollable(),$(".calls-loader").hide();const h=performance.now();CTM.trk.timing("CallLog","results",h-r,CTM.account+":"+CTM.user)}if(LoadingNextPage)return;performance.now();LoadingNextPage=!0;const o=$("#search-box").parent().find(".new-calls");for(var l in $("#calls-error").hide(),$("#call-stats .total").popover("hide"),$("#call-stats .total").popover("destroy"),$("#call-stats .popover").remove(),window.text_log&&("object"!=typeof t.direction&&(t.direction=[]),t.direction=t.direction.filter(function(e){return"msg_inbound"==e||"msg_outbound"==e}),t.direction.length||(t.direction=["msg_inbound","msg_outbound"])),t)t[l]||"number"==typeof t[l]||delete t[l];t&&t.end_date&&t.start_date?($("#report-filter-box .dates").show(),$("#report-filter-box .label").show()):($("#report-filter-box .dates").hide(),$("#report-filter-box .label").hide()),a(e),t.entries_per_page=EntriesPerPage,Query.after&&(t.after=Query.after),window.__ctm_search_all&&(t.all=1),t.stats="off",t.exclude_fields="transcription_text,chat_messages",$("#calls tbody.main-list tr.no-calls").remove(),$(".calls-loader").show();const c="/api/v1/accounts/"+CTM.account+"/calls/search.json",d=function(){LoadingNextPage=!0,$("#search-box").data("searching",!0),$.post(c,t,s,"json").fail(function(){"function"==typeof r&&r(),le(d)}).always(function(){LoadingNextPage=!1,$("#search-box").data("searching",!1);for(var e=$("#search-box").data("afterSearch")||[];e.length;){var t=e.pop();"function"==typeof t&&t()}})};return $.post(c,t,s,"json").fail(function(){setTimeout(d,500)}).always(function(){LoadingNextPage=!1,$("#search-box").data("searching",!1);for(var e=$("#search-box").data("afterSearch")||[];e.length;){var t=e.pop();"function"==typeof t&&t()}})}var ke=null,Ce=null,xe=null,Te=!1,Se=0;InitQueryLog(),window.ColumnActions={"hide":function(e){window.UserPrefs.columns[e]=!1,$('#call-customize .dropdown-menu a[data-col="'+escapeFindAttr(e)+'"] i.toggle').removeClass("font-checkmark-2"),s()},"applySortUI":function(e,t){$("#calls thead th.sort_asc").removeClass("sort_asc"),$("#calls thead th.sort_desc").removeClass("sort_desc");var n=$("#calls thead th.col-"+e.replace("_","-"));n.addClass("sort_"+("ASC"==t?"asc":"desc")),"ASC"==t?n.attr("data-dir","up"):n.attr("data-dir","down")},"sort":function(e,t){Query.order=e,Query.page=1,Query.sort_dir=t,we(!0,Query)}},window.updateColumnHeaders=r,window.toggleAction=l,window.contactOptionAction=c,window.CTMblockedCall=function(e,t){fe(e,{"caller_number_blocked":t})},window.CTMunblockedCall=function(e){fe(e,{"caller_number_blocked":null})};var Me=null,$e=function(){function t(e){CTM.deskmode&&"function"==typeof CTM.deskmodeWrapupComplete?CTM.deskmodeWrapupComplete(e.id):CTM.phonemode&&$("body").hasClass("exclusive-wrapup")&&"wrapup"==$("body").attr("data-status")&&stopWrapup()}function n(e,t){t||(t="custom_field"),clearErrors(e);var n=e.find('.field:visible > label ~ [name^="'+t+'["][required], .field:visible > label ~ * [name^="'+t+'["][required], .col-xs-12:visible > label ~ [name^="'+t+'["][required], .col-xs-12:visible > label ~ * [name^="'+t+'["][required]').filter(function(){var e=$(this);if("checkbox"==e.attr("type"))return!this.checked;var t=e.val();return 0==t.length||$.isBlank(t)});if(n.length){var a={};return n.each(function(){a[' [name="'+escapeFindAttr($(this).attr("name"))+'"]']=["required field"]}),formResponse(e,{"errors":a}),console.warn("required fields not provided"),!1}return!0}function a(e){e.custom_panels=[],(CTM.meta.custom_panels||[]).forEach(function(a){if(e.custom_panels.push(a),window.AllowedAccess["c"+a.id])if(e.custom_fields){var i=q(a.id,e);e.visible_custom_panels.push({"hasValues":!!i.length,"values":i,"panel":a,"visible":window.UserPrefs.columns["c"+a.id],"visible_section":window.UserPrefs.sections["c"+a.id],"panel_id":a.id})}else e.visible_custom_panels.push({"hasValues":!1,"panel":a,"visible":window.UserPrefs.columns["c"+a.id],"visible_section":window.UserPrefs.sections["c"+a.id],"panel_id":a.id});O["custom_"+a.id]=function(e){function i(){var a=$("#call-"+e.id+"-custom"),i=a.attr("action");n(a)&&(a.find("input[type=checkbox]").each(function(){this.checked?this.value="1":(this.value="0",this.checked=!0)}),$.post(i,a.serialize(),function(){K(e.id),ctmFlash("Saved Changes"),t(e)}).fail(function(){ctmFlash("Error saving changes","error")}))}window.didCustomPanelMessageBind||(window.didCustomPanelMessageBind=!0,window.addEventListener("message",LambdaCustomPanelMessage,!1),window.addEventListener("ctm.theme.update",function(){var t=$("#call-"+e.id+"-custom iframe").get(0);t.contentWindow.postMessage({"type":"theme-mode","payload":{"dark":$("html.dark").length>0}},t.getAttribute("src"))},!1)),s(e,"custom_"+a.id);var r="#call-edit-panel-"+e.id;o(r,e.id),e.panel=a,e.panel.custom_fields=setupCustomFields(a.id,e);try{e.panel.frame_url?e.panel_frame_url=Mustache.to_html(e.panel.frame_url,e):e.panel_frame_url=""}catch(l){console.error(l)}$(r).html(Templates.custom(e)),prepareDependentFields(r,e.panel.custom_fields),$(r).find(".form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G(),$("#call-"+e.id+"-custom").submit(function(e){e.preventDefault(),i()}),$("#call-"+e.id+"-custom input[type=button]").click(function(e){e.preventDefault(),i()}),$(window).trigger("call."+e.id+".panel.open")},je["custom_"+a.id]=function(){CTM._super&&!CTM.support_allowed?bootbox.alert(CTM.localize("Call","extra.support_access_required")):l.call(this,"custom_"+a.id)}}),e.custom_actions=[],(CTM.meta.custom_actions||[]).filter(function(e){return CTM.phonemode||!e.live}).forEach(function(t){e.visible_custom_actions.push(t),je["custom_"+t.id]=function(){var a=$(this).closest("td");e.id==a.attr("data-id")||isNaN(parseInt(a.attr("data-id")))||(e=CallsTable.get(parseInt(a.attr("data-id"))));var i="<p>"+CTM.localize("Call","panels.custom_action.message")+"</p>";t.fields&&t.fields.length&&(i='<div class="field">'+t.fields.map(function(e){try{return e.input_name="custom_action["+e.api_name+"]",""+prepareCustomField(e,null).field_partial}catch(t){}return""}).join('</div><div class="field">')+"</div>"),i+="</form>",bootbox.dialog({"message":'<h3><i class="font-'+t.icon+'"></i> '+t.name+" <small>"+t.description+'</small></h3><form id="custom_action">'+i+"</form>","onEscape":function(){},"buttons":{"cancel":{"label":"Cancel","className":"btn-default","callback":function(){}},"success":{"label":"Perform Action","className":"btn-primary","callback":function(){if(!n($("#custom_action"),"custom_action"))return!1;$.post("/api/v1/accounts/"+CTM.account+"/custom_actions/"+t.id+"/run?call_id="+e.id,$("#custom_action").serialize(),function(){}).fail(function(){})}}}})},CTM.phonemode&&(e.custom_actions.push(t),O["custom_"+t.id]=function(e){function a(){var a=$("#call-"+e.id+"-custom");a.attr("action");n(a,"custom_action")&&$.post("/api/v1/accounts/"+CTM.account+"/custom_actions/"+t.id+"/run?call_id="+e.id,a.serialize(),function(){}).fail(function(){})}s(e,"custom_"+t.id);var i="#call-edit-panel-"+e.id;o(i,e.id),e.panel=t,e.panel.custom_fields=t.fields.map(function(e){try{return e.input_name="custom_action["+e.api_name+"]",{"field_partial":""+prepareCustomField(e,null).field_partial}}catch(t){}return""}),$(i).html(Templates.custom_action(e)),prepareDependentFields(i,e.panel.custom_fields),$(i).find(".form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G(),$("#call-"+e.id+"-custom").submit(function(e){e.preventDefault(),a()}),$("#call-"+e.id+"-custom input[type=button]").click(function(e){e.preventDefault(),a()})},je["custom_"+t.id]=function(){l.call(this,"custom_"+t.id)})})}function i(e,t){t||(t=window.text_log?"text_message":"form"!=e.direction||window.AllowedAccess.profile?"caller_profile":"call_form_fields"),(window.AllowedAccess.score_edit||"caller_sale"!=t)&&(window.AllowedAccess.profile||"caller_profile"!=t)&&(window.AllowedAccess.receiving_number&&window.AllowedAccess.caller_insights||"call_flow"!=t)&&O[t]?(O[t](e),r(e),window._kmq&&_kmq.push(["record","NavAction",{"View":t}])):K(e.id)}function r(e){var t=$("#call-"+e.id);t.find(".navbar");t.find(".navbar a[data-action]").click(function(n){if(n.preventDefault(),t.find(".navbar-toggle").hasClass("collapsed")||t.find(".navbar-toggle").click(),!$(this).closest("li").hasClass("active")){var a=$(this).attr("data-action");if(window.AllowedAccess.score_edit||"caller_sale"!=a)if(window.AllowedAccess.profile||"caller_profile"!=a)if(window.AllowedAccess.receiving_number&&window.AllowedAccess.caller_insights||"call_flow"!=a){var i=CallsTable.get(parseInt(e.id));i?O[a](i):O[a](e)}else console.log("access denied profile access rejected");else console.log("access denied profile access rejected");else console.log("access score edit access rejected")}})}function s(e,t){if(e){Query.callNav=t,"caller_analytics"==t&&(t="caller_session");var n=$("#call-"+e.id).find(".navbar");n.find("li").removeClass("active"),n.find("li a[data-action="+t+"]").closest("li").addClass("active"),$("#call-log-header > .panel-picker > select").select2("val",t),$("#call-"+e.id).attr("data-panel",t),$("#call-"+e.id).find(".call-edit-container").html('<ul class="nav navbar-nav">'+xe($.extend({"texts_last":!0},e))+"</ul>");var a=$("#call-"+e.id).find(".call-edit-container .navbar-nav");a.find('> li > a[data-action="'+t+'"]').after('<div class="close-call-panel"><i class="font-close"></i></div><div class="call-edit-panel" id="call-edit-panel-'+e.id+'" data-action="'+t+'"></div>'),a.find("> li.active").removeClass("active"),a.find('> li > a[data-action="'+t+'"]').closest("li").addClass("active"),a.find("> li > a[data-action]").click(function(e){e.preventDefault(),$(this).closest("li").hasClass("active")?($(this).closest("li").toggleClass("collapsed"),G()):n.find('a[data-action="'+escapeFindAttr($(this).attr("data-action"))+'"]').click()}),Query.callId=e.id,setURLState(Query);var i=$("#call-row-"+e.id+".mobile-opened");i.length&&(i.removeClass("mobile-opened"),i.addClass("mobile-closed")),G()}}function o(e,t){$(e).html('<div class="field"><h3>&nbsp;<small class="call-id">'+CTM.localize("Call","extra.call_id")+": "+t+'</small></h3><div class="card" style="min-height:250px"><div class="loading-call" style="display:none;padding-top:90px">'+ProgressBarHtml+"</div></div></div>"),setTimeout(function(){$(e).find(".loading-call").show(),G()},250),G()}function c(e){s(e,"caller_analytics");var t="#call-edit-panel-"+e.id;o(t,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/visitors.json",function(n){n.forEach(function(e){e.score&&(e.likelihood=de(e.score))}),$(t).html(Templates.caller_analytics({"call":e,"visitors":n,"total_visitors":n.length})),$(t).find(".check-google-analytics").click(function(t){t.preventDefault();var n=$(this);n.data("clicked")||(n.data("clicked",!0),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/google_linked_check.json",function(e){bootbox.alert(HoganTemplates["calls/google_linked_check"].render(e))}).always(function(){n.data("clicked",!1)}))}),$(t).find(".toggle-visitor").click(function(t){t.preventDefault();var a=$(this).attr("data-id");$(this).closest("table").find("tr").removeClass("active-visitor");var i,r=n.filter(function(e){return e.visitor.id==a})[0];if($(this).hasClass("use-visitor")){if($(this).closest("tr").addClass("active-visitor"),$(this).closest("table").find("tbody tr").each(function(){$(this).find("td:first .toggle-visitor").html("use").removeClass("remove-visitor").addClass("use-visitor"),$(this).find("td:first .lookup-campaign").hide()}),$(this).html("do not use").removeClass("use-visitor").addClass("remove-visitor"),$(this).closest("td").find(".lookup-campaign").show(),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/use_visitor?vid="+a),(i=$("#call-row-"+e.id+" .call-source-detail")).length){r.location=r.visitor.detail.table.url,r.location.pathname=r.location.path,r.referrer=r.visitor.detail.table.ref;try{r.search="",r.visitor.detail.table.keywords&&(r.search=r.visitor.detail.table.keywords.join(" ")),r.score&&(r.likelihood=de(r.score))}catch(t){console.error(t)}i.html(Partials["calls/_source_detail_col"].render({"visitor":r,"plan":CTM.plan})),$("#call-row-"+e.id+" .call-source-detail a").tooltip({"delay":{"show":800,"hide":100}}),$("#call-row-"+e.id+" .call-source-detail span").tooltip({"delay":{"show":800,"hide":100}})}}else $.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/not_visitor",{"_method":"delete"}),$(this).html("use").removeClass("remove-visitor").addClass("use-visitor"),$(this).closest("td").find(".lookup-campaign").hide(),(i=$("#call-row-"+e.id+" .call-source-detail")).length&&i.html(Partials["calls/_source_detail_col"].render({})),delete e.referrer_str,delete e.referrer,delete e.location_str,delete e.location,delete e.likelihood,delete e.keyword,delete e.ad_targeting_type,delete e.ad_format,delete e.adgroup_id,delete e.ad_network,delete e.ad_targeting_type,delete e.ad_slot_position,delete e.ad_slot,delete e.ad_content,delete e.ad_match_type,CallsTable.set(parseInt(e.id),e)}),$(t).find(".lookup-campaign").click(function(e){e.preventDefault();var t=$(this).attr("data-id"),n=$(this);n.removeClass("font-analytics").addClass("font-coffee"),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+t+"/lookup_campaign",function(){n.hasClass("font-coffee")&&(n.removeClass("font-coffee").addClass("font-checkmark-2"),setTimeout(function(){n.hasClass("font-checkmark-2")&&n.removeClass("font-checkmark-2").addClass("font-analytics")},500))},"json")}),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})},"json").always(function(){G()})}function d(e){if(window.mapboxgl)e();else{var t=document.createElement("link");t.rel="stylesheet",t.href="https://api.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css",document.body.appendChild(t);var n=document.createElement("script");n.async=!0,n.src="//api.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js",n.onload=function(){mapboxgl.accessToken="pk.eyJ1IjoidGFmMiIsImEiOiJjajl5b3MyNTExYW5nMzNtZDQ5MTEybHNnIn0.dDcVNFgbzeFscX7-mZznGQ",e()},n.onerror=e,document.body.appendChild(n)}}function u(e){s(e,"caller_session");var t="#call-edit-panel-"+e.id;o(t,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/web.json",function(n){var a,i,r=null;if(n.session){if(n.session.score&&(n.session.score=de(n.session.score)),n.session.paths=n.session.url_history.map(function(e){var t=new Date(e.ts),n={};return r?(n.start=r.host!=e.host,n.host=e.host,n.path="/"+e.pathname,n.ts=t,n.time=moment(t).format("MMM Do, h:mm:ss a"),n.start||(r.duration=moment(n.ts).from(moment(r.ts),!0)),r=n,n):r={"host":e.host,"path":""==e.pathname?"/":e.pathname,"start":!0,"ts":t,"time":moment(t).format("MMM Do, h:mm:ss a")}}),n.session.paths.length>0){var s=n.session.paths[0];s.is_first=!0,s.url=n.session.landing_url,s.time=moment(new Date(n.session.times[0])).format("MMM Do, h:mm:ss a"),(r=n.session.paths[n.session.paths.length-1]).is_last=!0,r.url=n.session.last_url}var o=n.session.paths.length>19;o&&(n.session.morePaths=n.session.paths.splice(19,n.session.paths.length-19)),$(t).html(Templates.caller_session({"call":e,"session":n.session,"show_more":o,"total_cookies":n.session.cookies.length,"hasGAaccess":"admin"==CTM.role})),$(t).find(".show-more-toggle").click(function(e){e.preventDefault(),$(t).find(".show-more").toggle()})}else $(t).html(Templates.caller_session({"call":e}));if(console.log("session data:",n.session,e),n.session&&n.session.loc.length?(console.log("show map"),a=n.session.loc[0],i=n.session.loc[1]):e.latitude&&e.longitude&&(a=e.latitude,i=e.longitude),a&&i)try{d(function(){try{var e=new mapboxgl.Map({"container":$(t).find(".map-session").get(0),"style":"mapbox://styles/mapbox/streets-v10","center":[i,a],"zoom":9});e.addControl(new mapboxgl.NavigationControl),e.on("load",function(){e.addLayer({"id":"places","type":"symbol","source":{"type":"geojson","data":{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"description":"Website Visitor Triangulated Position by IP Address","icon":"circle"},"geometry":{"type":"Point","coordinates":[i,a]}}]}},"layout":{"icon-image":"{icon}-15","icon-allow-overlap":!0}}),e.on("click","places",function(t){(new mapboxgl.Popup).setLngLat(t.features[0].geometry.coordinates).setHTML(t.features[0].properties.description).addTo(e)}),e.on("mouseenter","places",function(){e.getCanvas().style.cursor="pointer"}),e.on("mouseleave","places",function(){e.getCanvas().style.cursor=""})})}catch(n){console.log(n)}})}catch(l){console.log(l)}$(t).find(".cookies").click(function(e){e.preventDefault(),$(t).find(".listed-cookies").toggle()}),$(t).find(".check-google-analytics").click(function(t){t.preventDefault();var n=$(this);if(!n.data("clicked")){n.data("clicked",!0);var a=n.html();n.text("Loading..."),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/google_linked_check.json",function(t){$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/ga_events.json",function(e){t.ga_events=e.events,t.events=t.events.map(function(e){var n={"uacode":e};return t.link_status.forEach(function(e){"success"==e.status&&e.links.forEach(function(e){n.uacode==e.uacode&&(n.adwords=e.adwords)})}),n}),bootbox.alert(HoganTemplates["calls/google_linked_check"].render(t))}).always(function(){n.data("clicked",!1),n.html(a)})})}}),$(".close-call-panel, a.close-button, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})},"json").always(function(){G()})}function p(e,t){var a=$("#call-"+e+"-sale");if(n(a)){var i=a.serialize(),r=a.attr("action");$("#call-"+e+"-sale .form-actions input[type=button]").attr("disabled","disabled"),$.post(r,i,function(e){t(e)}).fail(function(){ctmFlash("Error saving. Please try again. If this problem continues, contact support.","error")}).always(function(){$("#call-"+e+"-sale .form-actions input[type=button]").removeAttr("disabled")})}}function f(e,t,n,a,i){let r=e.agent?e.agent.name:e.business_number,s=e.cnam?e.cnam:e.caller_number,o=t.name,l=t.text,c=!1;return t.name=t.speaker,t.text="",prepareAgent(t),t.name=o,t.text=l,n&&t.words.forEach(function(e){e.text=e.word,e.offset=e.start_time.seconds+e.start_time.nanos/1e9,e.score=sprintf("%.2f",100*(e.confidence?e.confidence:t.confidence))}),null!=t.channel&&(1==t.channel?"function"==typeof a&&a(t.speaker):2==t.channel&&"function"==typeof i&&i(t.speaker),c=!0,t.no_labels?(parseInt(t.speaker)%2==0?t.direction="outbound":t.direction="inbound",t.speaker="Speaker "+t.speaker):t.channel%2==0?(isNaN(parseInt(t.speaker))||(t.speaker=s),t.direction="outbound"):t.channel%2==1&&(isNaN(parseInt(t.speaker))||(t.speaker=r),
t.direction="inbound"),t.words=t.words.filter(function(e){return"%HESITATION"!=e[0]}).map(function(e){var t;return t="."==e[0]||e[1]>.8?"high":e[1]<.8&&e[1]>.5?"medium":"low",{"text":e[0],"offset":e[2],"confidence":t,"score":sprintf("%.2f",100*e[1])}})),c}function b(e){s(e,"caller_transcription");let t="#call-edit-panel-"+e.id;o(t,e.id),console.log("load transcript panel for:",e.id);let n=window.autoPlaybackEnabled;e.audio&&(e.mp3_audio=e.audio+".mp3"),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/phone_settings.json",function(a){let i=a.settings;e.phone_settings=i,"in progress"==e.call_status&&e.can_live_listen?(R(e,i,a.live,a.details),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})):i.allow_recording_listen?$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/transcription.json",function(a){function i(e,n,a){e.style.display="inline-block",e.onerror=function(){e.style.display="none",$.get(n,{"pass":1,"type":"png"},function(t){setTimeout(function(){e.style.display="inline-block",e.onerror=function(){a<8&&setTimeout(function(){i(e,n,a+1)},1e4)},e.src=t.wave_url},1e4)})},e.src=n+".png",$(t).find(".mejs-time-rail").append(e)}e.has_outline=a.outline&&a.outline.length,e.text_outline=a.outline;let r=!1,s=(e.direction,e.agent?e.agent.name:e.business_number),o=e.cnam?e.cnam:e.caller_number,l=!1;e.text_outline&&"function"==typeof e.text_outline.forEach&&(l=e.text_outline.length>0,e.text_outline.forEach(function(t){let n=f(e,t,!1,function(e){o=e},function(e){s=e});r=r||n})),e.hasChannels=r,e.hasChannels&&(s&&e.right_talk_time&&(e.rightSpeaker=s),o&&e.left_talk_time&&(e.leftSpeaker=o),e.left_talk_time_string=h(e.left_talk_time),e.right_talk_time_string=h(e.right_talk_time)),$(t).html(Templates.caller_transcription(e)),CTM.left_nav&&n&&($(t).find(".player_ui .full-player").addClass("row"),$(t).find(".player_ui .keywords").length&&$(t).find(".player_ui .talk_time").append($(t).find(".player_ui .keywords").detach()),$(t).find(".player_ui footer .delete-audio").removeClass("pull-right").addClass("col-md-offset-1"),$(t).find(".player_ui footer .delete-audio .text").hide(),$(t).find(".player_ui .download-link .text").hide(),$(t).find(".player_ui .talk_time").addClass("col-xs-3").css({"margin-top":"20px"}),$(t).find(".player_ui .talk_time").append($(t).find(".player_ui footer").detach()),$(t).find(".player_ui .full-player .inner-player-section").addClass("col-xs-8"),$(t).find(".player_ui .full-player .inner-player-section").after($(t).find(".player_ui .talk_time").detach()),$(t).find(".player_ui").width($(t).width())),"deleted"==a.status?$(t).find(".card:first").html(Mustache.to_html("<p>Audio was deleted by {{email}} on {{date}}</p>",{"email":a.user,"date":a.date})):(CTM.left_nav&&n?($(t).find("audio").css("height","60"),$(t).find(".inner-player-section").css("max-width",.666666666666666*$(t).width())):($(t).find("audio").css("width","100%"),$(t).find("audio").css("height","60")),$(t).find("[title]").tooltip(),$(t).find("audio").mediaelementplayer({"defaultAudioHeight":60,"setDimensions":!0,"features":["speed","playpause","current","progress","duration","tracks","volume","fullscreen"],"enableKeyboard":!0,"audioVolume":"vertical","success":function(a){if($(".call-audio-review-frame").data("mediaElement",a),window.autoPlaybackEnabled){window.autoPlaybackEnabled=!1;const t=function(){a.play(),a.removeEventListener("canplay",t),CTM.left_nav&&$("td.call-audio[data-id="+e.id+"] .audio-player").removeClass("font-headphones").addClass("font-pause")};a.addEventListener("canplay",t,!1)}if($(t).find(".jump").click(function(e){e.preventDefault();let t=$(this).attr("data-position");t=parseFloat(t),isFinite(t)&&a.setCurrentTime(t)}),l){console.log("it has words load'em and connect to event handlers",e.id),$(".live-transcript[data-id="+e.id+"]").show();let t=$(".live-transcript[data-id="+e.id+"]"),n=e.text_outline,i=n.length,r=null;a.addEventListener("play",function(){console.log("showing transcript"),t.show()}),a.addEventListener("timeupdate",function(){function e(e){for(var t=0;t<i;++t){var a=n[t];if(a.s<=e&&a.e>=e)return a;if(a.s>e)break}}let s=e(a.currentTime);console.log("time:",a.currentTime,s,t.get(0)),s&&r!=s&&(r=s,t.html(s.speaker+" : "+s.text))}),a.addEventListener("ended",function(){t.html(""),t.hide(),r=null}),a.addEventListener("paused",function(){})}if($("#call-wave-"+e.id).length>0){const n=$(t).find(".mejs-time-rail").width(),a=2*$(t).find(".mejs-time-rail").height();console.log("computed width: ",n),$("#call-wave-"+e.id).css({"visibility":"hidden","width":n,"height":a});const r=$(t).find("audio source[type=audio\\/wav]").attr("src");i(new Image,r,1),$("#call-wave-"+e.id).hide()}CTM.left_nav&&n&&(console.log("move player"),$(".call-audio-review-frame").prepend($(t).find(".player_ui")),$(".call-audio-review-frame").find("footer").after("<div class='clear'></div>"),$(t).find(".field:first").hide(),$(".call-audio-review-frame").find(".player_ui").removeClass("card"),$(".call-edit-frame .navbar-sidenav li[data-action=caller_transcription]").hide(),$(".call-edit-frame .navbar-sidenav li[data-action=caller_sale] a").trigger("click"))}})),$(".share-audio-for-call").click(async function(t){t.preventDefault();let n={};switch(e.direction){case"inbound":case"outbound":n.title="Phone Call",n.text=e.transcription_text?e.transcription_text:`Call Recording: ${e.audio}`,n.url=e.audio;break;case"form":n.title="Web Form";break;case"chat":n.title="Chat";break;case"msg_inbound":case"msg_outbound":n.title="Text Message",n.text=e.message_body}console.log("share:",n);try{await navigator.share(n)}catch(t){console.error(t)}}),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G()}).fail(function(){$(t).html('<div class="field"><h3>Voice Analysis <small>transcription of the call</small> <small class="call-id">'+CTM.localize("Call","extra.call_id")+": "+e.id+'</small></h3><div class="card"><p>Voice analysis not available.</p></div></div>'),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}):($(t).html('<div class="field"><h3>Voice Analysis <small>transcription of the call</small> <small class="call-id">'+CTM.localize("Call","extra.call_id")+": "+e.id+'</small></h3><div class="card"><p>Voice analysis not available.</p></div></div>'),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}))}).fail(function(){$(t).html('<div class="field"><h3>Voice Analysis <small>transcription of the call</small> <small class="call-id">'+CTM.localize("Call","extra.call_id")+": "+e.id+'</small></h3><div class="card"><p>Voice analysis not available.</p></div></div>'),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})})}function h(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),a="";return a=Math.floor(e-(3600*t+60*n))<=1?"s \\secon\\d":"s \\secon\\d\\s",1==n?a="m \\minu\\te "+a:n>1&&(a="m \\minu\\te\\s "+a),1==t?a="H \\hour "+a:t>1&&(a="H \\hour\\s "+a),(new Date).clearTime().addSeconds(e).toString(a)}function m(e){s(e,"caller_sale");var n="#call-edit-panel-"+e.id;o(n,e.id),$.get("/api/v1/accounts/"+e.account_id+"/calls/"+e.id+"/sale.json",function(a){a.none?e.sale=!1:(e.sale=a,e.sale.sale_date||(e.sale.sale_date=moment().format("YYYY-MM-DD"))),e.scoring_settings=window.CTMScoring,e.auth_form_tag_token=CTM.auth_form_tag_token,e.sale_custom_fields=setupCustomFields("score",e),$(n).html(Templates.caller_sale(e)),prepareDependentFields(n,e.sale_custom_fields),$(n).find(".boot-switch input[type=checkbox]").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(){$("#call-"+e.id+"-sale_converted").prop("checked")?$("#call-"+e.id+"-sale_value").show():$("#call-"+e.id+"-sale_value").hide(),G()}),$("#call-"+e.id+"-sale_converted").prop("checked")&&$("#call-"+e.id+"-sale_value").show(),e.sale&&e.sale.score&&($("#service_rep_call-"+e.id+"-score").val(e.sale.score),$("#service_rep_call-"+e.id+"-score option[value="+e.sale.score+"]").attr("selected","selected")),$("#call-edit-panel-"+e.id+" .star").ratingPicker({"path":CTM.cdn+"/assets/stars","cancel":!0,"start":function(){var e=$(this).attr("data-rating");return parseInt(e)},"starOff":"star-off-big.png","starOn":"star-on-big.png","width":180,"target":"#service_rep_call-"+e.id+"-score","targetType":"number","targetKeep":!0,"hintList":["bad","poor","regular","good","great"]}),e.sale&&e.sale.service_rep_name&&($("#who-"+e.id+"-sold").val(e.sale.service_rep_name),$("#who-"+e.id+"-sold option").each(function(){$(this).attr("value")==e.sale.service_rep_name&&$(this).attr("selected","selected")})),window.CTMScoring.use_tag_list||CTMTagPicker("#who-"+e.id+"-sold","Select tag",{"object_type":"csr","maximum":1,"allowClear":!0}),$(n).find(".date-picker").datepicker({"endDate":new Date,"format":"yyyy-mm-dd","autoclose":!0});var i=e.id;$(n).find("form .form-actions input[type=button]").click(function(t){t.preventDefault(),$("#call-"+e.id+"-sale").submit()}),$("#call-"+e.id+"-sale").submit(function(n){n.preventDefault(),p(i,function(n){!n.service_rep_call||n.service_rep_call.conversion||n.service_rep_call.name||n.service_rep_call.score||delete n.service_rep_call,K(i);var a={"sale":ce(n.service_rep_call),"id":e.id},r=Partials["calls/_call_row_sale_column"].render(a);$("#call-row-"+e.id+" td.call-csr").html(r),t(e)})}),$(n).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),$("#call-"+e.id+"-sale .delete-sale").click(function(t){t.preventDefault(),$.post("/api/v1/accounts/"+e.account_id+"/calls/"+e.id+"/sale.json",{"_method":"delete"},function(){K(e.id);var t=Partials["calls/_call_row_sale_column"].render({"id":e.id,"saleColumnName":capitaliseFirstLetter(window.CTMScoring.column_name)});$("#call-row-"+e.id+" td.call-csr").html(t)},"json")}),G()})}function v(e){if(e=ue(CallsTable.get(e.id)),console.log("clicked to open chat or view chat?",e),$("#call-row-"+e.id+"[data-active-action=answer]").length&&!e.agent)console.log("we can answer this chat",e),"function"==typeof window.AnswerChatDirect?AnswerChatDirect(e.id):window.location.replace("https://"+CTM.host+"/calls/desk#callNav=call_chat&callId="+e.id);else{if(e.agent&&e.agent.id==CTM.user&&["in-progress","in progress","hold","ringing"].includes(e.call_status))return void("function"==typeof window.AnswerChatDirect?AnswerChatDirect(e.id):window.location.replace("https://"+CTM.host+"/calls/desk#callNav=call_chat&callId="+e.id));var t=e.id;s(e,"call_chat");var n="#call-edit-panel-"+e.id;function a(){K(t)}function i(e){$(n).find(".new-msg-input").hide().prev("h3").hide(),$(n).find(".chat-session-ended").show(),$("#message .message-thread .progress").remove(),!CTM._super||CTM.support_allowed?(e.chat_messages&&(e.chat_messages.forEach(function(t){console.log("auto adding chat",t),t.author=t.from,t.attributes=t.attributes||{};try{if(jQuery.isEmptyObject(t.attributes)&&t.properties)t.attributes=JSON.parse(t.properties);else if(t.from.match(/^agent_/)&&e.agent){var n=t.from.split(":")[1];n==CTM.email?(t.attributes.name=CTM.first_name+" "+CTM.last_name,t.attributes.alias_name=CTM.chat_alias_name,t.attributes.pic_url=CTM.pic_url):e.agent.email==n&&(t.attributes.name=e.agent.name,t.attributes.alias_name=e.agent.chat_alias_name,t.attributes.pic_url=e.agent.pic_url)}delete t.properties,delete t.from}catch(a){console.error(a)}t.channel={"uniqueName":e.id},"media"==t.type&&(t.media_url="/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/chat_media/"+t.sid),l(t,!0)}),r(!0)),G()):bootbox.alert(CTM.localize("Call","extra.support_access_required"))}function r(e){var t=$("#active-logs").height();if(t||(t=0),$("#message").length){$("#message").get(0).scrollIntoView({"behavior":"smooth","block":"end","inline":"nearest"});var n=$("#message").scrollTop(),a=$("#message").height()+$("#message .message-thread").height();e||a-n>1e3?window.requestAnimationFrame(function(){var e=$("#message").height()+$("#message .message-thread").height();$("#message").scrollTop(e),"function"==typeof window.resizeCallLog&&G()}):window.requestAnimationFrame(function(){$("#message").animate({"scrollTop":a},"fast"),"function"==typeof window.resizeCallLog&&G()})}}function o(){function a(e){var a=CallsTable.get(t);if(e&&"success"!=e.status)return console.log("we've started collection of chat"),void i(a);a.chatClient&&a.chatChannel?(m(a.chatClient,a.chatChannel),h(a.chatClient,a.chatChannel),$(n).find(".transfer-chat-button").hide(),$(n).find(".chat-party-button").hide()):Twilio.Chat.Client.create(e.token).then(function(n){a.chatClient=n,n.getUser(e.identity).then(function(s){a.chatUser=s,n.getChannelBySid(e.channel).then(function(e){a.chatChannel=e,a.chatUsers=new Map,e.getMembers().then(function(e){e.forEach(function(e){e.identity.match(/^agent_/)&&d(e)}),r(!0)}),console.log("got channel",e),v(n,e)})["catch"](function(e){console.log("failed to get a chat session:",e),ctmFlash("Error chat session is not available","error"),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t+".json",function(e){i(e)},"json")})})})}if("hold"!=e.status&&"ringing"!=e.status&&"in progress"!=e.status&&"started"!=e.chat_status)return console.log("status not matched"),void i(e);$.post("/api/v1/chat/"+t+"/watch",function(e){e&&"after hours"==e.status?$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t+".json",function(e){i(e)},"json"):(console.log("chat res:",e),"failure"!=e.status?Twilio.Chat?a(e):setTimeout(function(){Twilio.Chat?a(e):setTimeout(function(){a(e)},3e3)},1e3):bootbox.alert(e.reason))}).fail(function(){ctmFlash("Another agent has the chat"),K(t)})}function l(e,t){var n="inbound",a=e.author,i=null;(e.author.match(/agent_\d+:/)||"system"==e.author)&&(n="outbound",a=e.attributes.name,i=e.attributes.pic_url),console.log("messagedAddedEventHandler",e);var r=e.channel.uniqueName;if(!$("#call-edit-panel-"+r).length){var s=$("#active-logs [data-id="+r+"]");s.attr("data-badge")||s.attr("data-badge",0);var o=parseInt(s.attr("data-badge"));return isNaN(o)&&(o=0),void s.attr("data-badge",o+1)}var l="client:"+r;if(e.body!="ping "+l&&e.body!="pong "+l){var c=e.body;if("json"==e.type){let e=JSON.parse(c);c=e.body+" "+e.translated}g({"author":e.author,"sender_name":a,"chat_alias_name":e.attributes.alias_name,"direction":n,"pic_url":i,"media":e.media,"created_at":e.timestamp||e.sent_at,"media_url":e.media_url,"body":c,"type":e.attributes.type,"agent_visible":e.attributes.agent_visible,"client_visible":e.attributes.client_visible},1==t)}}function c(e,t){$(".chat-audio-toggle").click(function(e){e.preventDefault(),ChatAudioOn?(ChatAudioOn=!1,$(".chat-audio-toggle i").removeClass("font-volume-high").addClass("font-volume-mute-2")):(ChatAudioOn=!0,$(".chat-audio-toggle i").removeClass("font-volume-mute-2").addClass("font-volume-high"))}),ChannelBindings[t.entityName]||(ChannelBindings[t.entityName]=!0,t.on("messageAdded",function(e){$("#message .message.typing").remove(),l(e),e.author&&!e.author.match(CTM.email)&&ChatAudioOn&&ChatAudio.play()}),t.on("memberLeft",function(e){console.log("member left:",e),e.identity.match(/^agent_/)||(console.log("customer left the chat"),b(t))}),t.on("memberJoined",function(e){console.log("member joined:",e),d(e)}),t.on("typingStarted",function(e){u(e)}),t.on("typingEnded",function(e){p(e)}))}function d(t){t.getUser().then(function(n){var a=n.attributes,i={"name":a.name,"chat_alias_name":a.alias_name,"pic_url":a.pic_url};prepareAgent(i),e.chatUsers.set(t.identity,a)})}function u(t){var n=e.chatUsers.get(t.identity),a=$('#message .message.typing[data-author="'+t.identity+'"]:last');a.length?a.next().length&&p(t):g({"author":t.identity,"sender_name":n?n.name:"","pic_url":n?n.pic_url:"","typing":!0,"direction":t.identity.match(/agent_\d+:/)||"system"==t.identity?"outbound":"inbound"},!0)}function p(e){var t=$('#message .message.typing[data-author="'+e.identity+'"]:last');if(t.length){var n=t.prev();n.length&&n.hasClass("message")&&n.hasClass("inbound_message")==t.hasClass("inbound_message")&&n.addClass("last-message"),t.remove()}}function f(){K.call(this,e.id),$.post("/api/v1/chat/"+t+"/leave",function(){}).fail(function(){console.log("request error")})}function b(n){$.post("/api/v1/chat/"+t+"/end",function(){e.chat_messages=[],i(e),n&&delete window.ChannelBindings[n.entityName]}).fail(function(){console.log("request error")})}function h(t,a){$(n).find(".message_body").on("input",function(){this.style.height="5px";var e=this.scrollHeight,t=30;e<t&&(e=t),e+="px",$(".save-new-button").toggleClass("disabled",!($(this).val()||$("#message_upload").val())),this.style.height!=e&&(this.style.height=e,$(this).parent().find(".save-new-button, .file-attachment-toggle").css({"height":e,"line-height":e}),G())}).on("keydown",function(e){"/"!=e.originalEvent.key||$(this).val()||($(n).find(".responses-picker.select2-container").show(),$(n).find("input.responses-picker").select2("open"),e.preventDefault())}),$(n).find(".file-attachment-toggle").click(function(e){e.preventDefault();var t=$(this).closest(".new-msg-input").find(".file-attachment-container");if(t.hasClass("file-attachment-container")){var n=$(this).find("i:first");n.hasClass("font-caret-right")?(n.removeClass("font-caret-right").addClass("font-caret-down"),t.show()):(n.removeClass("font-caret-down").addClass("font-caret-right"),t.hide()),G()}}),setupMultiPicker($(n).find(".responses-picker"),"message_response","Select a response",!0,{"noEdit":!0,"descriptions":1,"formatters":{"formatResult":function(t){if(t.description)try{t.description=Mustache.render(t.description,e)}catch(n){}return formatStandardResult(t)}}}),$(n).find(".responses-picker").on("select2-close",function(){$(n).find(".responses-picker.select2-container").hide(),$(n).find(".message_body").focus()}).on("change",function(){$(n).find(".message_body").val(Mustache.render($(this).select2("data").description,e)),$(this).val("")}),$(n).find(".responses-button").click(function(){$(n).find(".responses-picker.select2-container").show(),$(n).find("input.responses-picker").select2("open")}),$("#message_upload").on("change",function(){var e=$("#message_upload").get(0).files[0];$(".save-new-button");if(e){var t=new FileReader;t.onload=function(){document.getElementById("preview_file")?$(".preview-pic").attr("src",t.result):$('<span class="preview" id="preview_file"><img class="preview-pic" src="'+t.result+'" title="'+e.name+'"/></span>').insertAfter("#message_upload"),setTimeout(function(){G()},100),$("#message_body").trigger("input")},t.readAsDataURL(e)}else{var n=document.getElementById("preview_file");n&&n.parentNode.removeChild(n),$("#message_body").trigger("input")}});var i=document.getElementById("message");i&&(i.ondragover=function(e){e.preventDefault()},i.ondrop=function(e){if(e.preventDefault(),e.dataTransfer.items&&"file"===e.dataTransfer.items[0].kind){$(".file-attachment-container").is(":hidden")&&$(".file-attachment-toggle").click();var t=e.dataTransfer.items[0].getAsFile();const n=new DataTransfer;n.items.add(t),document.getElementById("message_upload").files=n.files}}),$("#message_body").keypress(function(e){13==e.keyCode?(e.preventDefault(),_(a)):a.typing()}),$(n).find(".message_body").focus(),$("#message .leave-chat-button").click(function(e){e.preventDefault(),f(a)}),$("#message .end-chat-button").click(function(e){e.preventDefault(),bootbox.dialog({"message":"<h3>"+CTM.localize("Call","actions.end_chat.title")+"</h3><p>"+CTM.localize("Call","actions.end_chat.message")+"</p>","onEscape":function(){},"closeButton":!1,"buttons":{"cancel":{"label":CTM.localize("Call","actions.cancel.label"),"className":"btn-primary","callback":function(){}},"success":{"label":CTM.localize("Call","actions.end_chat.label"),"className":"btn-default btn-danger","callback":function(){b(a)}}}})}),$("#message .send-chat-button").click(function(e){e.preventDefault(),_(a)}),$("#message .transfer-chat-button").click(function(e){e.preventDefault(),console.log("display popover to pick an agent who is available")}),$("#message .chat-party-button").click(function(t){t.preventDefault(),console.log("display members in the chat"),e.chatChannel&&e.chatChannel.getMembers().then(function(e){e.forEach(function(e){console.log(e)})})})}function m(e,t){t.getMessages().then(function(e){$("#message .message-thread .progress").remove(),e.items.forEach(function(e){var t="inbound",n=e.author,a=null;(e.author.match(/agent_\d+:/)||"system"==e.author)&&(t="outbound",n=e.attributes.name,a=e.attributes.pic_url);var i=e.body;e.attributes.translated&&(i=i+" "+e.attributes.translated),g({"author":e.author,"sender_name":n,"chat_alias_name":e.attributes.alias_name,"pic_url":a,"direction":t,"media":e.media,"created_at":e.timestamp,"body":i,"type":e.attributes.type,"agent_visible":e.attributes.agent_visible,"client_visible":e.attributes.client_visible},!0)}),r(!0)})["catch"](function(e){console.error(e),bootbox.alert("Error loading the chat has it already ended?  Checking the chat history check back on this soon")})}function v(e,t){console.log("startChat",e,t),c(e,t),m(e,t),h(e,t)}function g(e,n){if(e.body!="ping client:"+t&&e.body!="pong client:"+t&&("undefined"==typeof e.agent_visible||0!=e.agent_visible)){var a=e.name;e.name=e.sender_name,prepareAgent(e),e.sender_name=e.name,e.name=a,e.inbound_message="inbound"==e.direction,e.outbound_message="outbound"==e.direction,e.created_at=moment(e.created_at).format("YYYY-MM-DD hh:mm:ss A"),e.body&&(e.body_html=anchorme(escapeHtml(e.body).replace(/&amp;/g,"&").replace(/&#x2F;/g,"/").replace(new RegExp("\r?\n","g"),"<br />"))),"system"==e.author&&(e.direction="inbound",e.inbound_message=!0,e.outbound_message=!1,e.system=!0);var i=!1;$("#message .message-thread .message:last[data-author='"+e.author+"']").hasClass(e.direction+"_message")?$("#message .message-thread .message:last").removeClass("last-message"):i=!0,$("#message .message-thread").append(HoganTemplates["calls/_chat_message"].render(e));var s=$("#message .message-thread .message:last"),o=["last-message"];i&&o.push("first-message"),e.media?e.media.getContentUrl().then(function(e){s.find(".bubble p").after('<div class="medias"><a href="'+e+'" target="_blank" class="media image"><img src="'+e+'"/></a></div>')}):e.media_url&&s.find(".bubble p").after('<div class="medias"><a href="'+e.media_url+'" target="_blank" class="media image"><img src="'+e.media_url+'"/></a></div>'),$("#message .message-thread .message:last").addClass(o.join(" ")),n||r()}}function _(e){CallsTable.get(t);var n=$("#message_body").val();if(n||$("#message_upload").val()){if($("#message_body").val("").trigger("input"),n&&e.sendMessage(n,{"name":CTM.first_name+" "+CTM.last_name,"alias_name":CTM.chat_alias_name,"pic_url":CTM.pic_url}),$("#message_upload").val()){var a=new FormData;a.append("media",$("#message_upload")[0].files[0]),e.sendMessage(a)}$("#message_upload").val("").trigger("change"),G()}}e.user={"first_name":CTM.first_name,"last_name":CTM.last_name,"alias_name":CTM.chat_alias_name},$(n).html(Templates.chat(e)),$(n).closest(".call-edit-container").find(".close-call-panel").click(function(e){e.preventDefault(),a()}),$(n).find("form .form-actions a.close").click(function(e){e.preventDefault(),a()}),o()}}function g(e){s(e,"call_form_fields");var t="#call-edit-panel-"+e.id;$(t).html(Templates.call_form_fields(e)),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),$(t).find(".form-control").on("click",function(){if(window.getSelection&&(e=window.getSelection().getRangeAt(0)).startOffset>=e.endOffset){var e,t=window.getSelection();(e=document.createRange()).selectNodeContents(this),t.removeAllRanges(),t.addRange(e)}}),G()}function _(e){s(e,"do_not_call");var t="#call-edit-panel-"+e.id;$(t).html(Templates.do_not_call(e)),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),$(t).find(".do-not-call-button").click(function(){$.post("/api/v1/accounts/"+CTM.account+"/do_not_calls",{"number":e.caller_number}).always(function(){"function"==typeof hangupLiveCall&&window.CallIsLive?hangupLiveCall(!0):bootbox.dialog({"message":"<h3>Do Not Call</h3><p><b>"+escapeHtml(e.caller_number)+"</b> has been added to the Do Not Call list.</p>","buttons":{}})})}),G()}function y(e){function t(){$(`#call-edit-panel-${e.id}`).get(0).scrollIntoView({"behavior":"smooth","block":"end","inline":"nearest"}),setTimeout(function(){$(`#call-edit-panel-${e.id}`).get(0).scrollIntoView({"behavior":"smooth","block":"end","inline":"nearest"})},500),setTimeout(function(){$(`#call-edit-panel-${e.id}`).get(0).scrollIntoView({"behavior":"smooth","block":"end","inline":"nearest"})},1e3)}function n(){var e="",t="";$(u).find(".message-thread .message").removeClass("first-message").removeClass("last-message"),$(u).find(".message-thread .message").each(function(n,a){var i=$(a).find(".page-header"),r=i.find(".agent-initials").attr("title")||i.find(".agent-initials").attr("data-original-title"),s=$(a).hasClass("inbound_message");(r!=e||s!=t)&&($(a).addClass("first-message"),$(a).prev().addClass("last-message")),e=r,t=s}),$(u).find(".message-thread .message:last").addClass("last-message"),G(),setTimeout(function(){G()},800)}function a(e){var t={};if(!e||!Object.keys(e).length)return t;for(var n in e)e.hasOwnProperty(n)&&("to_number"!=n||$(u).find(".to_number").is(":visible")?t[n]=e[n]:t.body=e[n]);return t}function i(e,t){formResponse($("#message"),{"errors":a(e?e.errors:null,t),"warnings":a(e?e.warnings:null,t)}),G()}function r(n){$(n).closest(".call-edit-container").find(".close-call-panel").click(function(t){t.preventDefault(),K(e.id)}),$(n).find(".file-attachment-toggle").click(function(e){e.preventDefault();var t=$(this).closest(".new-msg-input").find(".file-attachment-container");if(t.hasClass("file-attachment-container")){var n=$(this).find("i:first");n.hasClass("font-caret-right")?(n.removeClass("font-caret-right").addClass("font-caret-down"),t.show()):(n.removeClass("font-caret-down").addClass("font-caret-right"),t.hide()),G()}}),setupMultiPicker('#message [name="message[from_number]"]',"tracking_number","From number",!0,{"sms_enabled":1,"idstr":1,"noEdit":!0}),$(n).find("input[name='message[to_number]']").phoneCountryComboBox({"version":3}),e.caller_number&&$(n).find("input[name='message[to_number]']").phoneCountryComboBox("set",e.caller_number),setupMultiPicker($(n).find(".responses-picker"),"message_response","Select a response",!0,{"noEdit":!0,"descriptions":1,"formatters":{"formatResult":function(t){if(t.description)try{t.description=Mustache.render(t.description,e)}catch(n){}return formatStandardResult(t)}}}),$(n).find(".responses-picker").on("select2-close",function(){$(n).find(".responses-picker.select2-container").hide(),$(n).find(".message_body").focus()}).on("change",function(){$(n).find(".message_body").val(Mustache.render($(this).select2("data").description,e)),$(this).val("")}),$(n).find(".responses-button").click(function(){$(n).find(".responses-picker.select2-container").show(),$(n).find("input.responses-picker").select2("open")}),$(n).find(".message_body").on("keydown",function(e){"/"!=e.originalEvent.key||$(this).val()?13==e.keyCode&&(e.preventDefault(),$("#message").trigger("submit")):($(n).find(".responses-picker.select2-container").show(),$(n).find("input.responses-picker").select2("open"),e.preventDefault())}),$("#message_upload").on("change",function(){var e=$("#message_upload").get(0).files[0],t=$(".save-new-button");if(e){var n=new FileReader;n.onload=function(){document.getElementById("preview_file")?$(".preview-pic").attr("src",n.result):$('<span class="preview" id="preview_file"><img class="preview-pic" src="'+n.result+'" title="'+e.name+'"/></span>').insertAfter("#message_upload"),setTimeout(function(){G()},100)},t.prop("disabled",!1),t.removeClass("disabled"),n.readAsDataURL(e)}else{var a=document.getElementById("preview_file");a&&a.parentNode.removeChild(a),t.prop("disabled",!0),t.addClass("disabled")}});var a=document.getElementById("message");a.ondragover=function(e){e.preventDefault()},a.ondrop=function(e){if(e.preventDefault(),e.dataTransfer.items&&"file"===e.dataTransfer.items[0].kind){$(".file-attachment-container").is(":hidden")&&$(".file-attachment-toggle").click();var t=e.dataTransfer.items[0].getAsFile();const n=new DataTransfer;n.items.add(t),document.getElementById("message_upload").files=n.files}},$(document).on({"dragover":function(){return!1},"drop":function(){return!1}}),$("#message").submit(function(e){e.preventDefault(),clearErrors($("#message")),G();var a=new FormData(this),r=$("#message_upload"),s=r.get(0).files[0];if(s){if(s.size>5242880)return addErrors($("#message_upload"),["The selected file is too large to upload"]),void G();if(-1==r.attr("accept").split(",").indexOf(s.type))return addErrors($("#message_upload"),["Invalid content type:"+s.type]),void G()}if("Safari"==browserName()&&!$("#message_upload").val()){var o=$("#message_upload"),l=o.parent();o.detach(),a=new FormData(this),l.prepend(o)}$(n).find(".save-new-button i").addClass("font-spinner-2 icon-loop-repeat").removeClass("font-reply");var c=$(this).find(".save-new-button");c.prop("disabled",!0),c.addClass("disabled"),G(),$(n).find(".message-send-progress > span").css({"width":"0%"}),$(n).find(".message-send-progress").show(),$.ajax({"url":"/messages.json","type":"POST","xhr":function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&$(n).find(".message-send-progress > span").css({"width":Math.round(100*e.loaded/e.total)+"%"})},!1),e},"beforeSend":function(){$(n).find(".message_body").prop("disabled",!0),$(".message_upload").prop("disabled",!0)},"success":function(){$(n).find(".message_body").val("").trigger("input"),$(n).find(".message_upload").val("");var e=document.getElementById("preview_file");e&&e.parentNode.removeChild(e),$("#message_body").focus(),$(n).find(".message_body").focus(),t()},"error":function(e){i(e.responseJSON)},"complete":function(){setTimeout(function(){$(n).find(".message_body").prop("disabled",!1),$(n).find(".message_upload").prop("disabled",!1),$(n).find(".save-new-button i").removeClass("font-spinner-2 icon-loop-repeat").addClass("font-reply"),c.prop("disabled",!1),c.removeClass("disabled"),$(n).find(".message-send-progress").hide(),$("#message_body").focus(),$(n).find(".message_body").focus()},800)},"data":a,"cache":!1,"contentType":!1,"processData":!1})}),setAndUpdateCharacterCount($(n).find(".message_body"),$(n).find("input[name='message[from_number]']"),null,function(){var e=$(n).find(".save-new-button"),t=$("#message_upload").val()||$(n).find(".message_body").val();e.prop("disabled",!t),e.toggleClass("disabled",!t)},{"hint":$(n).find(".message_body").parent().next()}),$(n).find("[title]").tooltip(),$(n).find(".save-new-button").click(function(){$(this).hasClass("disabled")||$("#message").submit()}),$(n).find(".message_body").on("input",function(){this.style.height="5px";var e=this.scrollHeight,t=30;e<t&&(e=t),e+="px",this.style.height!=e&&(this.style.height=e,$(this).parent().find(".save-new-button, .file-attachment-toggle").css({"height":e,"line-height":e}),G())}),t(),$(n).find(".message-load-more").click(function(t){t.preventDefault(),d||(l++,window.loadTextMessageThread(e,l,c))}),G(),$(n).find(".message_body").focus(),t()}var l=1,c=10,d=!1;s(e,"text_message");var u="#call-edit-panel-"+e.id;o(u,e.id),!CTM._super||CTM.support_allowed?($(".close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),window.activeTextMessageInjectThread=function(e){console.log("thread: ",e),$("#message .message-thread").append($(HoganTemplates["calls/_text_message_thread"].render(e))),n(),console.log("update scroll position"),t()},window.prepareTextMessage=function(e,t){t.inbound_message="inbound"==t.direction,t.outbound_message=!t.inbound_message,t.status_warning="undelivered"==t.status,t.status_error="unsent"==t.status,t.status_visible=t.status_warning||t.status_error;var n=t.name;return t.name=t.agent_id,prepareAgent(t),t.name=n,t.body_html=anchorme(escapeHtml(t.body).replace(/&amp;/g,"&").replace(/&#x2F;/g,"/")),$.each(t.medias,function(e,t){t.type.match(/image/)?t.image=!0:t.image=!1}),t},window.prepareTextMessages=function(e,t){
return t.tracking_number_sid||(t.tracking_number_sid=e.tracking_number_sid),t.to=e.caller_number,t.id=e.message_id,t.user={"first_name":CTM.first_name,"last_name":CTM.last_name,"id":CTM.user},$.each(t.thread,function(t,n){window.prepareTextMessage(e,n)}),t},window.loadTextMessageThread=function(e,a,i,s){d=!0,$(".message-load-more > a .font-refresh").addClass("icon-loop-repeat");var o={"page":a=a||1,"per_page":i=i||10},l=e.message_id;l||(l="lookup_by_call"),$.get("/api/v1/accounts/"+CTM.account+"/sms/"+(e.message_id||"lookup_by_call")+"/thread.json?call_id="+e.id,o,function(a){if(a.thread.forEach(function(e){"media"==e.body&&(e.body="",e.body_html="")}),s)$(u).html(Templates.text_message(window.prepareTextMessages(e,a))),"lookup_by_call"==l&&!$(u).find(".message-parent").val().length&&a.thread.length&&$(u).find(".message-parent").val(a.thread[a.thread.length-1].id),r(u);else{var i=$(".new-message .message").map(function(){return $(this).attr("data-id")}).toArray(),o=a.thread.filter(function(e){return!i.find(function(t){return e.id==t})}).map(function(t){return HoganTemplates["calls/_text_message_thread"].render(window.prepareTextMessage(e,t))}).join("");$("#message .message-thread").prepend(o),$("#message [title]:not([data-original-title])").tooltip()}a.total<=a.page*a.per_page&&$(".message-load-more").hide(),n(),s&&(console.log("do setup"),t())}).always(function(){$(".message-load-more > a .font-refresh").removeClass("icon-loop-repeat"),d=!1})},window.loadTextMessageThread(e,l,c,!0)):bootbox.alert(CTM.localize("Call","extra.support_access_required"))}function w(e){function t(e,t){$(e).html(Templates.scripts_panel(t)),$(e).find(".form-actions a.close").click(function(e){e.preventDefault(),K(t.id)}),CTM.phonemode&&t.call_script&&t.call_script.use_iframe&&t.call_script.fullscreen_mode&&$("body").addClass("focus"),G()}s(e,"scripts_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/call_scripts.json",function(a){CTM.deskmode&&a.call_script.remote_url&&a.call_script.use_iframe?phoneMessageHandler({"origin":window.location.origin,"data":{"event":"loadCallScript","callId":e.id,"remoteUrl":a.call_script.remote_url}}):(e.call_script=a.call_script,"in progress"!=e.status&&e.call_script.end_call_url&&(e.call_script.remote_url=e.call_script.end_call_url),t(n,e))}).fail(function(){e.sforce=null,t(n,e)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function k(e){function t(e,t,n){t.id;var a=HoganTemplates["calls/shopify_customer_data"].render({"customers":n}),i=HoganTemplates["calls/shopify_panel"].render({"call":t,"shopify_customer_data":a});$(e).html(i),$(".shopify_search_form").submit(function(n){n.preventDefault();var a=$(this).find("input[name='shop_q']").val();0!==a.length?($(".shopify_search_results").html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/shopify/customer_info?c_name="+a,function(n){var a=HoganTemplates["calls/shopify_customer_data"].render({"call":t,"customers":n.customers,"search":!0});$(e).find(".shopify_search_results").html(a)}).fail(function(){ctmFlash("Error while searching for customer","error")})):ctmFlash("Customer name is required for search","error")}),$(".shopify_orders_toggle").on("click",function(){$(".customer_order_history").toggleClass("hide")}),G()}s(e,"shopify_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),console.log(e);var a=e.caller_digits;$.get("/api/v1/accounts/"+CTM.account+"/shopify/customer_info?c_num="+a,function(a){t(n,e,a.customers)}).fail(function(){ctmFlash(res.reason,"error")})}function C(e){function t(e,t){t.id;var n=HoganTemplates["calls/hubspot_panel"].render(t);$(e).html(n),$(e).find(".form-actions a.close").click(function(e){e.preventDefault(),K(t.id)}),G()}e.hubspot&&e.hubspot.profile_url&&(e.hubspot_contact_id=e.hubspot.profile_url.split("/").pop(-1)),s(e,"hubspot_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),t(n,e),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function x(e){function n(e,n,i){n.id;var r=HoganTemplates["calls/zendesk_panel"].render({"call":n,"api_domain":i.api_domain});$(e).html(r);var s=i.initial_search_results;$(e).find(".search_string").val(i.search_string),$(e).find(".close_zendesk_button").click(function(e){e.preventDefault(),K.call(this,n),t(n)}),a(i.search_ticket_status),s.length>0&&s.forEach(function(t){t.forEach(function(t){var n=new Date(t.created_at),a=new Date(t.updated_at),r={"year":"numeric","month":"long","day":"numeric","hour":"2-digit","minute":"2-digit"},s='<tr class="ticket_row" data-ticket-id="'+t.id+'"><td>'+t.status.charAt(0).toUpperCase()+t.status.slice(1)+"</td><td>"+t.subject+"</td><td>"+n.toLocaleDateString("en-US",r)+"</td><td>"+a.toLocaleDateString("en-US",r)+'</td><td><a href="https://'+i.api_domain+".zendesk.com/tickets/"+t.id+'" target="_blank">View</a></td></tr>';$(e).find("table.search_results_table").append(s)})}),$(".close-call-panel, .close-mobile-nav").click(function(e){e.preventDefault(),K.call(this,n.id)}),G()}function a(e){var t='<select class="ticket_choice" name="ticket_choice" multiple="multiple"><option></option>';["New","Open","Pending","Hold","Solved","Closed"].forEach(function(n){var a=!e.length||e.includes(n)?"selected":"";t+='<option value="'+n+'" '+a+">"+n+"</option>"}),t+="</select>",$(i).find(".search_status").append(t),$(".ticket_choice").select2({"width":"50%"})}s(e,"zendesk_panel");var i="#call-edit-panel-"+e.id;o(i,e.id),$.get("/integrations/zendesk/settings?call_id="+e.id,function(t){n(i,e,t)})}function T(e){function t(e,t,n,a){t.id;var i=HoganTemplates["calls/zoho_panel"].render({"call":t,"default_module":a});$(e).html(i),$(e).find(".zoho_module").append(n).select2({"dropdownAutoWidth":!0}),$(e).find(".form-actions a.close").click(function(e){e.preventDefault(),K(t.id)}),G()}s(e,"zoho_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),$.get("/integrations/zoho/modules",function(a){var i="",r=null;a.forEach(function(e){var t=e["default"]?"selected":"";t&&(r=e),i+='<option value="'+e.api_name+'" '+t+">"+e.name+"</option>"}),t(n,e,i,r)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function S(e){function t(e,t){t.id;var n=HoganTemplates["calls/dynamics_panel"].render({"call":t});$(e).html(n),G()}s(e,"dynamics_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),t(n,e),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function M(e){function t(e,t){t.id;var n=HoganTemplates["calls/sendgrid_panel"].render({"call":t});$(e).html(n),$(".card.sendgrid > .field > .more-addrs a").click(function(e){e.preventDefault();var n=$(this).attr("data-type");$(this).replaceWith('<label style="margin-top:10px" for="call_notification_'+n+"_"+t.id+'">'+escapeHtml($(this).attr("data-name"))+' <i class="font-help" title="'+escapeHtml($(this).attr("data-desc"))+'"></i></label><input type="text" id="call_notification_'+n+"_"+t.id+'" name="call_notification['+n+']" class="input-xxlarge"/><br/>'),setupMultiPicker("#call_notification_"+n+"_"+t.id,"email","Email address",!1,{"tags":!0,"allowClear":!0}),$("label[for=call_notification_"+n+"_"+t.id+"] i[title]").tooltip()}),$(".send_sendgrid_email").on("click",function(){var t=$("#sendgrid_form").serialize();$.post("integrations/sendgrid/send_message",t,function(){ctmFlash("Email queued"),$(e).find(".sendgrid_message").val(""),$(e).find(".sendgrid_template").val(""),$(e).find(".email_to").val("")})}),G()}s(e,"sendgrid_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),t(n,e),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function j(e){function t(e,t){t.id;var n=HoganTemplates["calls/reminder_panel"].render({"call":t});$(e).html(n),G()}s(e,"reminder_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),t(n,e),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)})}function E(e){function t(e){var t=e.name.split(" ");e.first_name=t.shift(),e.last_name=t.join(" "),e.desk_call_details={"email":e.email,"user":CTM.email}}function n(n){$(n).find(".desk_com_customer_details").click(function(){var t=$(this),n=t.closest(".cases"),a=(t.attr("data-call-id"),{"customer_id":t.attr("data-customer-id")});n.html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customer.json",a,function(t){n.html(Partials["calls/_desk_com_cases"].render(t)),n.find('select[name="desk_com_case_status"]').each(function(){$(this).val($(this).data("status"))}).on("change",function(){var t={"status":$(this).data("status"),"case_id":$(this).data("caseid")};$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customer_ticket?update_case_status",t,function(e){console.log(e),"false"==e?ctmFlash("Error saving status. Was the issue already closed?"):ctmFlash("Case status successfully updated!")}).fail(function(){})}),$(n).find(".desk-replies").click(function(t){t.preventDefault();var a=$(this).attr("data-type"),i=$(this).attr("data-id");n.find(".desk-replies-list[data-id="+escapeFindAttr(i)+"]").html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_"+a+".json",{"case_id":i},function(e){n.find(".desk-replies-list[data-id="+escapeFindAttr(i)+"]").html(HoganTemplates["calls/_desk_com_"+a].render(e))}).fail(function(){n.find(".desk-replies-list[data-id="+escapeFindAttr(i)+"]").html("error")})})}).fail(function(){n.html("error")})}),$(n).find(".desk_com_customer_add_case").click(function(){bootbox.dialog({"message":"<h3>Loading...</h3>"+ProgressBarHtml}),t(e),e.customer_id=$(this).attr("data-customer-id"),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_custom_fields.json",function(t){bootbox.hideAll(),setTimeout(function(){console.log(t),e.desk_case_custom_fields=t.custom_fields.filter(function(e){return"ticket"==e.type}),e.desk_case_labels=t.labels,e.desk_case_groups=t.groups,console.log(e),bootbox.confirm({"message":HoganTemplates["calls/desk_com_add_case"].render(e),"buttons":{"confirm":{"label":"Add New Case","className":"btn-success"}},"callback":function(t){if(t){var n=$("#desk-customer-form").serialize();$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customer_ticket",n,function(){ctmFlash("posted new ticket successfully")}).fail(function(){ctmFlash("ticket creation failed")})}}}),$(".labels-multipick").select2({"data":e.desk_case_labels,"multiple":!0}),$(".groups-multipick").select2({"data":e.desk_case_groups}),setTimeout(function(){$(".field [data-custom-field]").each(function(){var e=$(this).attr("data-type");"boolean"==e&&($(this).attr("type","checkbox"),$(this).val("1")),console.log("bind field:",e)})},1e3)},900)}).fail(function(){bootbox.hideAll(),bootbox.alert("We encountered an error communicating with Desk.com")})}),G()}function a(e,n){$(e).html(Templates.desk_com_panel(n)),$(e).find(".desk_com_results").html(ProgressBarHtml),$(e).find("a.close").click(function(e){e.preventDefault(),K(n.id)}),$(".close-call-panel, .close-mobile-nav").click(function(e){e.preventDefault(),K.call(this,n.id)}),$(e).find(".clear-search").click(function(t){if(t.preventDefault(),!$(e).find(".search-now").data("searching")){$(e).find(".search-now").data("searching",!0),$(e).find(".text-filter").val("");var a=$(e).find(".text-filter").val();console.log("search:",a);var r={"search":a};$(e).find(".desk_com_results").html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_customers.json",r,function(t){i(e,t)}).fail(function(){cases.html("error")}).done(function(){$(e).find(".search-now").data("searching",!1)})}}),$(e).find(".search-now").click(function(t){if(t.preventDefault(),!$(e).find(".search-now").data("searching")){$(e).find(".search-now").data("searching",!0);var a=$(e).find(".text-filter").val(),r=$(".desk_com_search_type").val(),s={"search":a,"type":r};$(e).find(".desk_com_results").html(ProgressBarHtml),"customer"==r?$.get("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_customers.json",s,function(t){i(e,t)}).fail(function(){cases.html("error")}).done(function(){$(e).find(".search-now").data("searching",!1)}):$.get("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_customers.json",s,function(t){$(e).find(".desk_com_results").html(Partials["calls/_desk_com_cases"].render(t)),$(".cases").find('select[name="desk_com_case_status"]').each(function(){$(this).val($(this).data("status"))}).on("change",function(){var e={"status":$(this).data("status"),"case_id":$(this).data("caseid")};$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_customer_ticket?update_case_status",e,function(e){"false"==e?ctmFlash("Error saving status. Was the issue already closed?"):ctmFlash("Case status successfully updated!")}).fail(function(){ctmFlash("Error saving status. Was the issue already closed?")})})}).fail(function(){cases.html("error")}).done(function(){$(e).find(".search-now").data("searching",!1)})}}),$(e).find(".add-new-customer").click(function(){t(n),bootbox.dialog({"message":"<h3>Loading...</h3>"+ProgressBarHtml}),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_custom_fields.json",function(e){bootbox.hideAll(),setTimeout(function(){console.log(e),n.desk_customer_custom_fields=e.filter(function(e){return"customer"==e.type}),n.desk_case_custom_fields=e.filter(function(e){return"ticket"==e.type}),bootbox.confirm({"message":HoganTemplates["calls/desk_com_add_customer"].render(n),"buttons":{"confirm":{"label":"Add New Customer","className":"btn-success"}},"callback":function(e){if(e){var t=$("#desk-customer-form").serialize();$.post("/api/v1/accounts/"+CTM.account+"/calls/"+n.id+"/desk_com_customer_ticket",t,function(){}).fail(function(){})}}}),setTimeout(function(){$(".field [data-custom-field]").each(function(){var e=$(this).attr("data-type");"boolean"==e&&($(this).attr("type","checkbox"),$(this).val("1")),console.log("bind field:",e)})},1e3)},900)}).fail(function(){bootbox.hideAll(),bootbox.alert("We encountered an error communicating with Desk.com")})})}function i(t,a){e.desk_com_record=a,e.desk_com_record.entries.forEach(function(e){e.avatar&&(e.avatar=e.avatar.replace(/default=404&/,""));var t={"pic_url":e.avatar,"name":e.display_name};if(prepareAgent(t),e.avatar=t.pic_url,e.display_name=t.name,e.initials=t.initials,e.custom_fields){var n=[];for(var a in e.custom_fields)n.push({"name":a,"value":e.custom_fields[a]});e.custom_fields=n}}),e.desk_com_domain=CTM.desk_com.domain,$(t).find(".desk_com_results").html(HoganTemplates["calls/_desk_com_results"].render(e)),n(t)}$(document).on("click",".desk-new-note",function(t){t.preventDefault();var n=$(this).data("id");e.desk_com_case_id=n,bootbox.hideAll(),bootbox.confirm({"message":HoganTemplates["calls/desk_com_add_note"].render(e),"buttons":{"confirm":{"label":"Add New Note","className":"btn-success"}},"callback":function(t){if(t){var n=$("#desk-new-note-form").serialize();$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customer_ticket?new_note",n,function(){}).fail(function(){})}}})}),$(document).on("click",".desk-assign-agent",function(t){t.preventDefault();var n=$(this).data("id"),a=$(this).parents(".box").find(".case-name-assignment");console.log(a),e.desk_com_case_id=n,$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_agents.json",function(t){bootbox.hideAll(),setTimeout(function(){e.agents=t.agents,bootbox.confirm({"message":HoganTemplates["calls/desk_com_change_agent"].render(e),"buttons":{"confirm":{"label":"Update Agent on Ticket","className":"btn-success"}},"callback":function(t){if(t){var n=$("#desk-update-agent-form").serialize(),i=$(".agent-multipick").select2("data").text;$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customer_ticket?update_agent",n,function(e){"false"==e?(ctmFlash("Error updating agent status. Is the case already closed?"),a.text(i)):ctmFlash("Agent successfully updated.")}).fail(function(){ctmFlash("There was an error updating the agent. Please try again.")})}}}).init(function(){$(".agent-multipick").select2({"data":t.agents})})})})}),s(e,"desk_com_panel");var r="#call-edit-panel-"+e.id;o(r,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/desk_com_customers.json",function(t){a(r,e),i(r,t)}).fail(function(){e.sforce=null,a(r,e)})}function A(e){function t(e,t){$(e).html(Templates.salesforce_panel(t)),$(e).find(".unlink-sf-action").click(function(n){n.preventDefault(),bootbox.confirm("This will unlink the Salesforce "+t.salesforce.reference+" from this call.  Are you sure you want to continue?",function(n){n&&($(e).html(ProgressBarHtml),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+t.id+"/unlink_sfrecord",{"_method":"delete"},function(){}).always(function(){K(t.id)}))})}),$(e).find("a.close").click(function(e){e.preventDefault(),K(t.id)}),$(".close-call-panel, .close-mobile-nav").click(function(e){e.preventDefault(),K.call(this,t.id)}),$(e).find(".load-history").click(function(e){e.preventDefault(),$("#salesforce-lead-task-history").html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+t.id+"/sftasks.json",function(e){$("#salesforce-lead-task-history").html(Partials["calls/_sf_tasks"].render(e))}).fail(function(){$("#salesforce-lead-task-history").html("error loading data...")})}),G()}s(e,"salesforce_panel");var n="#call-edit-panel-"+e.id;o(n,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/sfrecord.json",function(a){e.sforce=a.record,t(n,e)}).fail(function(){e.sforce=null,t(n,e)})}function P(e,t){function n(t){function n(e,t){return"<div class='col-md-6' style='padding-bottom:5px;'><span class='col-md-6 text-right' style='text-transform:uppercase'>"+e.replace(/_/g," ")+"</span><span class='col-md-6'>"+t+"</span></div>"}function a(e,t,n,a,i){var r=n.response.map(function(e){return[new Date(e.timestamp_ms).getTime(),parseFloat(e[a])]}),s={"name":t,"pointStart":r[0][0],"pointInterval":1e3,"data":r};e.highcharts({"credits":{"enabled":!1},"title":{"text":""},"xAxis":{"type":"datetime"},"plotOptions":{"spline":{"marker":{"enabled":!0}}},"yAxis":{"title":{"text":i},"stackLabels":{"enabled":!0,"style":{"fontWeight":"bold","color":Highcharts.theme&&Highcharts.theme.textColor||"gray"},"formatter":function(){return this.total>0?this.total:""}}},"series":[s]})}function i(e){try{$("#call-jitter .graph").highcharts("destroy"),$("#call-latency .graph").highcharts("destroy"),$("#call-audio-input-level .graph").highcharts("destroy"),$("#call-audio-output-level .graph").highcharts("destroy"),$("#call-received-packets-lost .graph").highcharts("destroy"),$("#call-mos .graph").highcharts("destroy")}catch(t){}a($("#call-jitter .graph"),"Jitter",e,"jitter","(ms)"),a($("#call-latency .graph"),"Latency",e,"rtt","(ms)"),a($("#call-audio-input-level .graph"),"Audio Input Level",e,"audio_level_in","k"),a($("#call-audio-output-level .graph"),"Audio Output Level",e,"audio_level_out","k"),a($("#call-received-packets-lost .graph"),"Packets Lost",e,"packets_lost","%"),a($("#call-mos .graph"),"MOS",e,"mos","")}function r(e,t,n){return e==undefined?"NA":n&&t>e?sprintf("<strong style='color:red'>%.2f</strong>",e):!n&&t<e?sprintf("<strong style='color:red'>%.2f</strong>",e):sprintf("%.2f",e)}function s(e,t,n,a){var i=[];return i.push("<td>"+e+"</td>"),i.push("<td>"+(n==undefined?"NA":n)+"</td>"),i.push("<td>"+r(t.min,n,a)+"</td>"),i.push("<td>"+r(t.max,n,a)+"</td>"),i.push("<td>"+r(t.avg,n,a)+"</td>"),i.push("<td>"+r(t.p50,n,a)+"</td>"),i.push("<td>"+r(t.p95,n,a)+"</td>"),i.push("<td>"+r(t.p99,n,a)+"</td>"),i.push("<td>"+r(t.total,n,a)+"</td>"),"<tr>"+i.join("")+"</tr>"}function o(e){if(console.log("displaySummary:",e),e.summary){var t=[];Object.keys(e.summary.publisher_metadata).forEach(function(a){if("location"!=a){var i=e.summary.publisher_metadata[a];t.push(n(a,i))}}),Object.keys(e.summary.client_metadata).forEach(function(a){var i=e.summary.client_metadata[a];t.push(n(a,i))});var a=e.summary.metrics,i=[],r="<tr><th>PARAMETER</th><th>THRESHOLD</th><th>MIN</th><th>MAX</th><th>AVG</th><th>P50</th><th>P95</th><th>P99</th><th>TOTAL</th></tr>";i.push(s("Jitter (ms)",a.jitter,30)),i.push(s("MOS",a.mos,3,!0)),i.push(s("Latency (ms)",a.rtt,400)),i.push(s("Audio Input Level",a.audio_level_in)),i.push(s("Audio Output Level",a.audio_level_out)),i.push(s("Received Packets Lost",a.packets_lost)),i.push(s("Received Received",a.packets_received)),i.push(s("Received Sent",a.packets_sent)),$("#call-summary .data").html("<div class='row'>"+t.join("")+"</div><div class='clear'></div><table class='table table-hover'><thead>"+r+"</thead><tbody>"+i.join("")+"</tbody></table>")}else $("#call-summary .data").html("<h3>Summary Loading Please wait 10 minutes.</h3>")}var l={},c={};$(e).html('<div id=\'insights-info\'><style>.graph {  width:100%;}\n#insights-info:not(.call-loaded) .call-detail {  display: none;}\n#insights-info.call-loaded .call-status {  display: none;}</style><div class="row"><div class="field call-status" id="call-status"><h3>Status</h3><div class="card"><div id="loader-view"></div><div class="field" id="call-not-supported" style="display:none"><p>Call insights are not available for this call.</p></div></div></div><div class="field call-detail" id="call-leg-selector" style="display:none"><h3>Call Leg</h3><div class="card"><div class="field"><input type="text" id="leg-selector" style="width:400px"/><span class="hint">Call legs are individual components of a single call</span></div></div></div><div class="field call-detail" id="call-summary"><h3>Summary <small>Information about the client browser</small></h3><div class="card"><div class="data"></div></div></div><div class="field call-detail" id="call-jitter"><h3>Jitter <small>Jitter is the variation in latency across the network. High jitter indicates bad network and adversely affects call quality.</small></h3><div class="card"><div class="graph"></div></div></div><div class="field call-detail" id="call-latency"><h3>Latency <small>Round-Trip Time (RTT) is the length of time it takes for a packet to be sent plus the length of time it takes for an acknowledgment of that signal to be received. High RTT could cause audio latency.</small></h3><div class="card"><div class="graph"></div></div></div><div class="field call-detail" id="call-audio-input-level"><h3>Audio Input Level <small>This is the strength of the audio input signal from client device. This changes during a call. Constant input level for a long period could be due to a muted microphone.</small></h3><div class="card"><div class="graph"></div></div></div><div class="field call-detail" id="call-audio-output-level"><h3>Audio Output Level <small>This is the strength of the audio output signal on client device. Unchanged audio output level could be due to a muted input on the other end or due to being placed on hold.</small></h3><div class="card"><div class="graph"></div></div></div><div class="field call-detail" id="call-received-packets-lost"><h3>Received Packets Lost <small>Packet loss occurs when one or more packets of data fail to reach their destination. Packet loss is typically caused by network congestion, and adversely affects call quality.</small></h3><div class="card"><div class="graph"></div></div></div><div class="field call-detail" id="call-mos"><h3>MOS <small>Mean Opinion Score is a subjective measurement of call quality. Low MOS indicates poor call quality.</small></h3><div class="card"><div class="graph"></div></div></div></div></div></div>');var d=t.id;$("#loader-view").html(ProgressBarHtml),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+d+"/client_log?type=summary",function(e){$("#loader-view").html("").hide(),$("#insights-info").addClass("call-loaded"),e=e.filter(function(e){return!!e.call_sid}),l=e,e.length>1&&($("#call-leg-selector #leg-selector").val(e[0].call_sid).select2({"data":e.map(function(e,t){return{"id":e.call_sid,"text":"Leg "+(t+1),"description":e.call_sid}}),"formatResult":formatStandardResult,"formatSelection":formatStandardResult}),$("#call-leg-selector").show(),$("#call-leg-selector select").change(function(){var e=$(this).val();o(l.filter(function(t){return t.call_sid==e})[0]),i(c.filter(function(t){return t.response[0].call_sid==e})[0])})),e.length>0&&e[0]?o(e[0]):($("#call-not-supported").show(),$("#insights-info").removeClass("call-loaded"))}),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+d+"/client_log?type=metrics",function(e){e=e.filter(function(e){return e&&e.response&&e.response.length>0}),c=e,e.length>0&&e[0]?i(e[0]):($("#call-not-supported").show(),$("#insights-info").removeClass("call-loaded"))})}if(window.Highcharts||F)n(t);else{F=!0,console.log("inject");var a=document.createElement("script");a.onload=function(){n(t)},a.src="/assets/ctm-highcharts.js",document.body.appendChild(a)}}function I(e){s(e,"call_flow");var t="#call-edit-panel-"+e.id;o(t,e.id),$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/call_log.json?times=1",function(n){n.times&&n.times.length?(n.times.forEach(function(e){e.events.forEach(function(e){if("Say"==e.route_name||"Play"==e.route_name)e.route_name="Play Message",e.say=!0;else if("Gather"==e.route_name)e.route_name="Collect Input",e.nodes&&e.nodes.forEach(function(e){(e.lang||e.voice)&&(e.say=!0)});else if(e.keypress){var t=e.route_to.match("(.*):"+e.keypress.replace(/\*/g,"\\*")+"$");t&&(e.route_to=t[1])}else"endcall"==e.route_name||"listen"==e.route_name||"coach"==e.route_name||"Capture"==e.route_type&&(e.route_name="Input",e.keypress=e.route_to);switch(e.route_type){case"Lambda":e.icon="font-code";break;case"Trigger":e.icon="font-bolt";break;case"Notification":e.icon="font-envelope"}})}),$(t).html(Templates.call_flow({"id":e.id,"v2":n.v2,"times":n.times,"status_icon":e.status_icon,"call_status":e.call_status}))):$(t).html(Templates.call_flow(e)),$(t).find(".upload_say").sayUpload(),$(t).find(".embed-window").click(function(e){e.preventDefault(),bootbox.dialog({"title":"Logs","message":"<div id='log-loading'>"+ProgressBarHtml+"</div>"}),$.get($(this).attr("href"),function(e){e&&e.logs?$("#log-loading").html("<table>"+e.logs.reverse().map(function(e){return"<tr><td>"+moment(new Date(1e3*e[0])).format()+"</td><td>"+(e[1]&&e[1].msg?e[1].msg:e[1])+"</td></tr>"}).join("")+"</table>"):$("#log-loading").html("Expired")}).fail(function(){$("#log-loading").html("Error loading")})}),$(t).find(".form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G(),$(t).find(".insights").click(function(n){n.preventDefault(),P($(t).find(".timeline").closest(".call-edit-panel"),e)})}).fail(function(){$(t).find(".card").css({"min-height":""}).html("<p>Failed to load panel</p>")})}function D(e,t,n,a){if(LiveEventStream)try{LiveEventStream.close()}catch(r){}const i=new EventSource(`/api/v1/listen/stream.json?callId=${e.id}&offset=${a}`);LiveEventStream=i,i.addEventListener("open",()=>{const r=HoganTemplates["calls/_message_speaker"],s=$("#live-outline");i.addEventListener("data",t=>{a=t.lastEventId;const i=JSON.parse(t.data);i.results&&i.results.forEach(t=>{let a=t.alternatives[0];a.channel_tag=t.channel_tag;let i=s.data(`lastChannel${t.channel_tag}`);const o=s.data(`lastChannel${t.channel_tag}_low`);if(t.isFinal&&a.words.length){console.log("got a final",i),a.speaker=n[1==t.channel_tag?0:1],a.text=a.transcript,a.direction=1==t.channel_tag?"inbound":"outbound",f(e,a,!0);const o=r.render(a);if(i&&t.channel_tag==t.channel_tag){const e=i.next(".message");i.html(o),console.log(`check last channel${t.channel_tag} next message channel:`,e.data("channel")),e.data("channel")==t.channel_tag&&(console.log(`remove from next channel${t.channel_tag} last-message`),e.removeClass("last-message")),console.log(`clear lastChannel${t.channel_tag}`),s.data(`lastChannel${t.channel_tag}`,null),s.data(`lastChannel${t.channel_tag}_low`,null)}else s.prepend(o)}else if(a.transcript){a.speaker=n[1==t.channel_tag?0:1],a.text=a.transcript,a.direction=1==t.channel_tag?"inbound":"outbound",a.low=t.stability<.09,a.low?s.data(`lastChannel${t.channel_tag}_low`,a.text):a.text=o.replace(/segments.text/,`<cite>${a.text}</cite>`),f(e,a,!0),a.partial=!0;const l=r.render(a);if(i&&t.channel_tag==t.channel_tag)i.html(l);else{s.prepend(l);const e=`.message[data-channel=${t.channel_tag}]:first`;s.data(`lastChannel${t.channel_tag}`,s.find(e))}}})}),i.addEventListener("end",()=>{i.close(),"in progress"==CallsTable.get(e.id).status&&$("#live-outline").length&&D(e,t,n,a)}),i.addEventListener("timeout",r=>{console.log("timeout:",r.data),i.close(),"in progress"==CallsTable.get(e.id).status&&$("#live-outline").length&&(console.log("resume from timeout"),D(e,t,n,a))}),i.addEventListener("message",e=>{console.log("message:",e.data)})}),i.addEventListener("error",r=>{console.log("error:",r),i.close(),"in progress"==CallsTable.get(e.id).status&&$("#live-outline").length&&(console.log("resume from error"),D(e,t,n,a))})}function R(e,t,n,a){function i(){$(s).find(".live-listen").data("live",!0),console.log("signal startLiveListen"),$(s).find("#live-call-"+e.id).get(0).contentWindow.postMessage({"action":"startLiveListen","id":e.id,"user":CTM.user},window.location.origin)}function r(){$(s).find(".live-listen").data("live",!1),$(s).find("#live-call-"+e.id).get(0).contentWindow.postMessage({"action":"stopLiveListen","id":e.id,"user":CTM.user},window.location.origin)}const s="#call-edit-panel-"+e.id;e.live=n,$(s).html(Templates.live_call(e)),n&&D(e,s,a,0);var o=$(s+" .detail").width();$(s+" .detail").html("<canvas id='live-call-wave-"+e.id+"' width='"+o+"' height='25' style='width:100%;height:25px'></canvas>"),$(s).find(".call-insights").click(function(){P($(s).find("#live-panel-"+e.id),e)}),$(s).find(".close-call-panel, a.close-button, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id),r()}),$(s).find(".live-listen").click(function(){t.allow_live_listen&&($(this).data("live")?(r(),$(s).find(".live-listen i").addClass("font-play"),$(s).find(".live-listen i").removeClass("font-stop")):($(s).find(".live-listen i").addClass("font-stop"),$(s).find(".live-listen i").removeClass("font-play"),i()))}),$(s).find(".whisper").click(function(){t.allow_whisper?$(this).data("whisper")?($(this).data("whisper",!1),$(this).find("i").addClass("font-bubbles-3"),$(this).find("i").removeClass("font-feed"),r()):($(this).find("i").removeClass("font-bubbles-3"),$(this).find("i").addClass("font-feed"),r(),$(s).find("#live-call-"+e.id).get(0).contentWindow.postMessage({"action":"startWhisper","id":e.id,"user":CTM.user},window.location.origin),$(this).data("whisper",!0)):bootbox.alert("You do not have access to whisper/coach with the agent on this call.  You either need to contact your account administrator or upgrade to the contact center plan.")}),$(s).find(".barge").click(function(){t.allow_barge?(ctmOpenPhone(null,null,null,e.id,null,e.id),r()):bootbox.alert("You do not have access to barge into this phone call.  You either need to contact your account administrator or upgrade to the contact center plan.")}),$(s).find(".drop").click(function(){t.allow_drop?bootbox.prompt({"title":"Are you sure you want to drop the live call?  Confirm your password.","callback":function(t){t&&(bootbox.dialog({"message":"Processing."}),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/endcall",{"password":t},function(){setTimeout(function(){bootbox.hideAll(),b(e=CallsTable.get(e.id))},2e3)}).fail(function(){bootbox.hideAll(),ctmFlash("Unable to end active phone call.  Invalid password?","error")}))},"inputType":"password"}):bootbox.alert("You do not have access to drop this call.  You either need to contact your account administrator or upgrade to the contact center plan.")});var l=$(s).find("#live-call-"+e.id).get(0),c=!1;l.contentWindow.addEventListener("message",function(t){if(t.origin===window.location.origin)switch(t.data.action){case"starting-session":$(s).find(".live-listen .text").html("Joining Call...");break;case"start-session":$(s).find(".live-listen .text").html("Listening Live");break;case"resuming-session":$(s).find(".live-listen .text").html("Joining Call...");break;case"paused-session":$(s).find(".live-listen .text").html("Recording Stopped");break;case"disconnect-session":$(s).find(".live-listen .text").html("Stopped Listening");break;case"end-session":c&&($(s).find(".live-listen .text").html("Call Ended"),setTimeout(function(){b(e=CallsTable.get(e.id))},2e3));break;case"error-session":console.log("session error event"),$(s).find(".live-listen .text").html("Error"),$(s).find("#live-panel-"+e.id).html("Error Connecting to Call"),c=!0}}),t.allow_live_listen?setTimeout(function(){
$(s).find(".live-listen").trigger("click")},1500):$(s).find(".detail").html("<div class='field'><p>You do not have access to this call.</p></div>"),$(s).find("button[title]").tooltip({"delay":{"show":800,"hide":100}})}function L(e){s(e,"caller_messages");var t="#call-edit-panel-"+e.id;o(t,e.id),e.email_subject="Follow-up from our call",e.call_notifications_path=CTM.call_notifications_path,$(t).html(Templates.caller_messages(e)),setupMultiPicker("#call_notification_to_"+e.id,"email","Email address",!1,{"tags":!0,"allowClear":!0}),$("label[for=call_notification_to_"+e.id+"] i[title]").tooltip(),$("#email_call_"+e.id+" .more-addrs a").click(function(t){t.preventDefault();var n=$(this).attr("data-type");$(this).replaceWith('<label style="margin-top:10px" for="call_notification_'+n+"_"+e.id+'">'+escapeHtml($(this).attr("data-name"))+' <i class="font-help" title="'+escapeHtml($(this).attr("data-desc"))+'"></i></label><input type="text" id="call_notification_'+n+"_"+e.id+'" name="call_notification['+n+']" class="input-xxlarge"/><br/>'),setupMultiPicker("#call_notification_"+n+"_"+e.id,"email","Email address",!1,{"tags":!0,"allowClear":!0}),$("label[for=call_notification_"+n+"_"+e.id+"] i[title]").tooltip()}),$("#email_call_"+e.id).submit(function(t){t.preventDefault();var n=this,a=$(n).find(".form-actions input[type=submit]").val();$(n).find(".form-actions input[type=submit]").val("...").prop("disabled",!1);var i=$(this).serialize();$.post($(this).attr("action")+".json",i,function(t){$(n).find(".form-actions input[type=submit]").val(a).prop("disabled",!1),"sending"==t.status?K(e.id):ctmFlash(t.reason,"error")},"json").fail(function(){$(n).find(".form-actions input[type=submit]").val(a).prop("disabled",!1)})}),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),setTimeout(function(){$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/emails.json",function(n){n.length&&(n=n.map(function(e){return e.to_emails=e.to.join(","),e}),$("#sent_mails_for_"+e.id).html(Templates.caller_messages_emails({"emails":n})),$(t).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G())})},400)}function N(e){function a(e){function a(a,i){if(!a.data("saving")&&n(a)){a.data("saving",!0);var r=a.find("input[type=submit]").html();return a.find("input[type=submit]").html("Saving...").addClass("disabled"),a.find(".form-actions .loader").css({"visibility":"visible"}),i&&K(e.id),a.find(".call_comments").prop("disabled",!0),CallsTable["delete"](e.id),$.post(a.attr("action"),a.serialize(),"json").done(function(e){var n=e.call;n&&CallsTable.has(parseInt(n.id))&&CallsTable["delete"](parseInt(n.id)),scheduleLimit=.3,t(n)}).always(function(){a.find(".call_comments").prop("disabled",!1),$(a).find(".form-actions .loader").css({"visibility":"hidden"}),$(a).find("input[type=submit]").html(r).removeClass("disabled"),$(a).data("saving",!1),i&&K(e.id)})}}function r(n,a,i,r,s){if(!n.data("saving")){n.data("saving",!0);var o=n.find("input[type=submit]").html();n.find("input[type=submit]").html("Saving...").addClass("disabled"),n.find(".form-actions .loader").css({"visibility":"visible"});var l=n.attr("data-id"),c="/add_comment",d=!1;r&&K(l),i&&(d=!0,c="/update_comment?note_id="+i);var u=$.post("/api/v1/accounts/"+CTM.account+"/calls/"+l+c,{"note":a},"json").done(function(e){if(e.formattedNote=MarkDownFormatter(e.note||""),d){var n=$('.notes-section a[data-comment="'+escapeFindAttr(i)+'"]').closest(".comment-display");n.find(".comment-frame").html(e.formattedNote),n.find(".comment-raw").html(e.note)}else prepareAgent(e.agent),$(".notes-section").prepend(Partials["calls/_comment"].render(e));t({"id":l})}).always(function(){$(n).find(".form-actions .loader").css({"visibility":"hidden"}),$(n).find("input[type=submit]").html(o).removeClass("disabled"),$(n).data("saving",!1),r&&K(e.id)});"function"==typeof s&&u.done(s)}}function s(){var e=$(this);e.find(".indicator-loop").addClass("show-loop"),e.find(".indicator-loop .save").addClass("font-spinner-2 icon-loop-repeat"),e.prop("disabled",!0),e.addClass("disabled");var t=e.find("span").html();return e.find("span").html("Saving...").addClass("disabled"),function(){e.find(".indicator-loop .save").removeClass("font-spinner-2 icon-loop-repeat"),e.find(".indicator-loop").removeClass("show-loop"),e.prop("disabled",!1),e.removeClass("disabled"),e.find("span").html(t).removeClass("disabled")}}if(e.caller&&(e.caller_custom_fields=setupCustomFields("contact",e,!0)),e.show_notes=window.CTMScoring.notes_on,e.caller&&e.caller.notes){e.show_notes=e.show_notes||e.caller.notes.length>0;for(var o=0,l=e.caller.notes.length;o<l;o++)e.caller.notes[o].agent.pic_url=e.caller.notes[o].agent.pic,prepareAgent(e.caller.notes[o].agent)}e.caller&&e.caller.alternative_number==e.caller_number_bare&&(e.caller.alternative_number=e.caller_number),$(i).html(Templates.caller_profile(e)),prepareDependentFields(i,e.caller_custom_fields),$(i).find("[title]").tooltip(),CTMTagPicker($(i).find(".tag-list"),"Tag this call");var c=$(i).find(".caller_number").phoneCountryComboBox({"version":3,"noPlus":!0});(c=c.closest(".phone-picker")).css({"width":"100%","display":"inline-block","margin":"2px 0"}),c.find(".country-picker .select2-choice").css({"height":"32px","line-height":"30px"}),c.find("input.phone-input-control").css({"height":"30px"}),c.find("div.combobox-button").css({"height":"30px"}),c.find("div.combobox-button .toggle-mask").css({"top":"9px"}),c.find(".select2-container.select2-container-multi").css({"height":"32px"}),$(i).find("form").on("click",".delete-comment",function(e){e.preventDefault();var t=$(this).closest("form").attr("data-id"),n=$(this).closest(".box"),a=$(this).closest(".delete-comment").attr("data-id");bootbox.dialog({"message":"<h3>Delete Note</h3><p>Are you sure you want to delete this note? This action cannot be undone.</p>","onEscape":function(){},"buttons":{"cancel":{"label":"Cancel","className":"btn-primary","callback":function(){}},"success":{"label":"Delete Note","className":"btn-default","callback":function(){n.remove(),$.post("/api/v1/accounts/"+CTM.account+"/calls/"+t+"/delete_comment",{"_method":"delete","note_id":a})}}}})}),$(i).find("form").on("click",".edit-comment",function(e){e.preventDefault();$(this).attr("data-call-id");var t=$(this).attr("data-comment"),n=$(this).closest(".box").find(".comment-body"),a=n.find(".comment-raw").html(),i=n.closest(".card").find(".main-notes");n.find(".comment-display").hide(),i.hide();var r={"note_id":t,"note_notes":a,"editing":!0},s=Partials["calls/_edit_comment"].render(r);n.find(".comment-editable").html(s),n.find(".edit-notes").find(".cancel").click(function(e){e.preventDefault(),n.find(".comment-editable").html(""),n.find(".comment-display").show(),i.show()})}),$(i).find("form").on("click",".save-note",function(e){e.preventDefault();var t=s.call(this,"Saving Notes..."),n=$(this).closest("form"),a=$(this).closest(".comment-body"),i=n.find(".call_comments:visible"),o=i.val(),l=i.attr("data-note_id");r(n,o,l,!1,function(){l?($(".main-notes").show(),$(".comment-editable").html(""),$(".comment-display").show(),a.find(".comment-frame").html(o)):i.val(""),t()})}),$(i).find("form").on("click",".save-note-close",function(t){t.preventDefault();s.call(this,"Saving Notes...");var n=$(this).closest("form"),a=n.find(".call_comments:visible"),i=a.val(),o=a.attr("data-note_id");K(e.id),r(n,i,o,!1)}),$(i).find("form .save-profile").click(function(e){e.preventDefault();var t=s.call(this,"Saving Profile..."),n=a($(this).closest("form"),!1);n?n.done(t):t()}),$(i).find("form .save-profile-close").click(function(e){e.preventDefault();var t=s.call(this,"Saving Profile..."),n=a($(this).closest("form"),!0);n?n.done(t):t()}),$(i).find("form").submit(function(e){e.preventDefault(),a($(this),!0)}),$(i).find("form .form-actions a.close").click(function(t){t.preventDefault(),K(e.id)}),$(".close-call-panel, .close-mobile-nav").click(function(t){t.preventDefault(),K.call(this,e.id)}),G(),$(i).find(".load-more-notes").click(function(t){t.preventDefault();var n=$(this),a=n.data("offset");$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+"/notes.json",{"note_offset":a},function(e){e.notes_next_offset>0?n.data("offset",e.notes_next_offset):n.hide(),$(".notes-section").append(e.notes.map(function(e){return e.formattedNote=MarkDownFormatter(e.note||""),prepareAgent(e.agent),Partials["calls/_comment"].render(e)}).join(""))})})}s(e,"caller_profile");var i="#call-edit-panel-"+e.id;o(i,e.id),e.scoring_settings=window.CTMScoring,e.caller?a(e):$.get("/api/v1/accounts/"+CTM.account+"/calls/"+e.id+".json",function(t){e=ue(t),CallsTable.set(t.id,e),a(e)})}var O={"caller_profile":N,"caller_analytics":c,"caller_session":u,"caller_sale":m,"caller_transcription":b,"caller_messages":L,"call_form_fields":g,"call_chat":v,"call_flow":I,"text_message":y,"dynamics_panel":S,"sendgrid_panel":M,"reminder_panel":j,"salesforce_panel":A,"desk_com_panel":E,"scripts_panel":w,"shopify_panel":k,"do_not_call":_,"hubspot_panel":C,"zoho_panel":T,"zendesk_panel":x};CTM.phonemode&&(window.NavActions=O);var F=!1;return{"prepare":a,"setup":i,"autoLoad":e}}();window.resizeCallLog=G,window.updateFocusNav=Q,window.updateCallActionPanel=K,window.closePanel=K,window.ctmPlayCallRecording=function(e,t,n){var a=$("#call-row-"+e);if(a.length){var i=a.find("a.audio-player");if(i.length)return te.apply(i,{}),void(t&&setTimeout(function(){a.data("mediaElement")?(isFinite(t)&&a.data("mediaElement").setCurrentTime(t),a.data("mediaElement").play()):setTimeout(function(){a.data("mediaElement")&&(isFinite(t)&&a.data("mediaElement").setCurrentTime(t),a.data("mediaElement").play())},1e3)},200));a.data("mediaElement")&&n&&(t&&isFinite(t)&&a.data("mediaElement").setCurrentTime(t),a.data("mediaElement").play())}};var je={"toggle":l,"callback":f,"text":p,"text_options":d,"live_listen":v,"live_call":m,"answer_call":b,"pickup_call_on_hold":h,"email":_,"sale":w,"transcription":g,"lookup":T,"flag":H,"stripe":z,"account":F,"source_detail":U,"edit":J,"reviewed":Z,"playback":te,"toggleAudio":ee,"salesforce":R,"hubspot":M,"marketo":j,"infolog":O,"formFields":C,"call_flow":x,"reminder":y,"chat":k,"scripts":u,"msdynamics":L,"mailchimp":N};$(window).on("ctm.salesforce.record_found",D),$(window).on("ctm.salesforce.record_not_found",P),$(window).on("ctm.salesforce.lead_update",I),window.CallActions=je,window.CTMOpenPanel=ne,window.CTMfilter=ae,window.CTMsearch=ie,$(function(){$("#calls-error a").on("click",function(){var e=$("#calls-error").data("retry");e&&(e(),$("#calls-error").data("retry",null))})}),CTM.canAddAgents=["admin","agency_admin"].filter(function(e){return e==CTM.role}).length>0;var Ee=performance.now(),Ae=null,Pe=performance.now(),Ie=null;return Ie&&(window.cancelAnimationFrame(Ie),Ie=null),Ie=window.requestAnimationFrame(ge),window.fetchCallAndRender=_e,window.clearCallList=ye,window.CTMFetchCalls=we,{"init":n}}();CTMInitLogAccess(CallList.init);